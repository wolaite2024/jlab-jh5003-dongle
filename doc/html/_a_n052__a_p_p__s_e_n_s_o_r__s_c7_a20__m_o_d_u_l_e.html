<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="Sensor_SC7A20_Manual"></a>
APP SENSOR SC7A20 Module Application Note    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/08/12</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Sensor_Sc7a20_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/07/12  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/08/12  </td><td class="markdownTableBodyCenter">Normal update   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#Sensor_Sc7a20_Rev">Revision History</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#Sensor_Sc7a20_Table_List">Table List</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#Sensor_Sc7a20_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#Sensor_Sc7a20_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#APP_SENSOR_SC7A20_Module_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#APP_SENSOR_SC7A20_Module_McuConfigTool_Configuration">2 McuConfigTool Configuration</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#APP_SENSOR_SC7A20_Module_Source_Code_Overview">3 Source Code Overview</a><ul>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#Initialize_Sensor_Sc7a20_Settings">3.1 Initialize Sensor Sc7a20 Settings</a></li>
<li><a class="el" href="_a_n052__a_p_p__s_e_n_s_o_r__s_c7_a20__m_o_d_u_l_e.html#Handle_Sc7a20_Message">3.2 Handle Sc7a20 Message</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Sensor_Sc7a20_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Sensor_Sc7a20_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 Enable Sc7a20 on the McuConfig Tool</a></li>
<li><a href="#figure_2_2">Figure 2-2 Set Sc7a20 Pin on the McuConfig Tool</a></li>
<li><a href="#figure_2_3">Figure 2-3 Set Sc7a20 Parameter on the McuConfig Tool</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Sensor_Sc7a20_Glossary"></a>
Glossary</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APP_SENSOR_SC7A20_Module_Introduction"></a>
1  Introduction</h2>
<p>The purpose of this document is to give an overview of the app sensor SC7A20 module for customer. The document describes how to use app sensor SC7A20 module in app project. The source code consists of <b>APP_SENSOR_SC7A20</b> part. The details will be described in the following sections.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APP_SENSOR_SC7A20_Module_McuConfigTool_Configuration"></a>
2  McuConfigTool Configuration</h2>
<p>Gsensor SC7A20 can be enabled in "HW Feature" page.</p>
<div class="image">
<img src="mcuconfig_sc7a20_enable.png" alt="mcuconfig_sc7a20_enable.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Enable Sc7a20 on the McuConfig Tool</b></div></center><p>Select i2c and intterupt pin.</p>
<div class="image">
<img src="mcuconfig_SC7A20_pin_setting.png" alt="mcuconfig_SC7A20_pin_setting.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 Set Sc7a20 Pin on the McuConfig Tool</b></div></center><p>Below is Gsensor SC7A20 parameter's default value.</p>
<div class="image">
<img src="mcuconfig_sc7a20_default_settings.png" alt="mcuconfig_sc7a20_default_settings.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Set Sc7a20 Parameter on the McuConfig Tool</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="APP_SENSOR_SC7A20_Module_Source_Code_Overview"></a>
3  Source Code Overview</h2>
<p>This section describes app sensor sc7a20 module. The reference file is shown as follows:</p>
<ul>
<li>Project source code directory: sdk\src\mcu\sensor\mems_sensor\iqs\sensor_sc.c This module is used to handle app sensor sc7a20 message.</li>
</ul>
<h3><a class="anchor" id="Initialize_Sensor_Sc7a20_Settings"></a>
3.1  Initialize Sensor Sc7a20 Settings</h3>
<p>source code directory: sdk/src/mcu/sensor/mems_sensor/iqs/sensor_sc.c <br />
 Configure i2c and ready pinmux settings.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sensor_sc_init(T_SC_DEV *dev)</div><div class="line">{</div><div class="line">    memcpy((uint8_t *)&amp;sc_dev, (uint8_t *)dev, <span class="keyword">sizeof</span>(sc_dev));</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((!sc_dev.is_mfb) &amp;&amp; (!sc_dev.is_ld))</div><div class="line">    {</div><div class="line">        sensor_int_init(sc_dev.int_pinmux, sc_dev.pull_value, <span class="keyword">true</span>, sc_dev.gpio_cb);</div><div class="line">    }</div><div class="line"></div><div class="line">    sensor_i2c_init(SC7A20_I2C_ID, SC7A20_I2C_ADDR, SC7A20_I2C_LOCK, SC7A20_I2C_SPEED);</div><div class="line">    sensor_sc7a20_setup();</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="Handle_Sc7a20_Message"></a>
3.2  Handle Sc7a20 Message</h3>
<p>source code directory: sdk/src/mcu/sensor/mems_sensor/iqs/sensor_jsa.c <br />
 Handle sc7a20 detect pin interrupt.</p>
<div style="page-break-after: always;"></div><div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group___s_e_c_t_i_o_n___exported___macros.html#gaf901ecfe15c401262a5dfd752a0b0287">ISR_TEXT_SECTION</a> <span class="keywordtype">void</span> app_sensor_key_sc7a20_irq(uint32_t param)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">if</span> (int_status == SC7A20_INT_RELEASED)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gabfa5fe624354a71be9842bbdaaeb868f">hal_gpio_irq_change_polarity</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.click_int_pinmux,</div><div class="line">                                     <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#gga73aa619532bdbf9d2b620ec419641690ad67ef08eb10e464490335f1267f5d61b">GPIO_IRQ_ACTIVE_LOW</a>);</div><div class="line">        gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a> = 1;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> ((sc7a20_db.click_status == 0) &amp;&amp;</div><div class="line">            (timer_idx_gsensor_click_detect == 0))</div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___d_l_p_s___exported___functions.html#ga034420ab656a4b9286d7bf35e149a16a">app_dlps_enable</a>(<a class="code" href="group___a_p_p___d_l_p_s___exported___macros.html#ga9736593545da647d1fefb751f23eb9ec">APP_DLPS_ENTER_CHECK_GPIO</a>);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gabfa5fe624354a71be9842bbdaaeb868f">hal_gpio_irq_change_polarity</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.click_int_pinmux,</div><div class="line">                                     <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#gga73aa619532bdbf9d2b620ec419641690a3e3edb0a796ad9411de885e2a7e8f45b">GPIO_IRQ_ACTIVE_HIGH</a>);</div><div class="line">        gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a> = 0;</div><div class="line"></div><div class="line">        gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#acb5cfd209ba75c853d03f701e7f91679">type</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074af11ba4096588dc277d9bd604f1007024">IO_MSG_TYPE_GPIO</a>;</div><div class="line">        gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggac53061b3924b56c44eacd7e43a711f10a82f3b86e3de3a0ba25aea091f60b73f0">IO_MSG_GPIO_GSENSOR</a>;</div><div class="line"></div><div class="line">        <a class="code" href="group___a_p_p___i_o___m_s_g.html#ga88a966ae202533d382e23ae22b27b819">app_io_msg_send</a>(&amp;gpio_msg);</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>source code directory: sdk/src/sample/rws/app_io_msg.c <br />
 Handle io msg which is sent from sc7a20 interrupt handler.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___i_o___m_s_g.html#gab3416cc2898ca3f036749335997d4841">app_io_handle_msg</a>(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> io_driver_msg_recv)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (msgtype)</div><div class="line">    {</div><div class="line">        ...</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggac53061b3924b56c44eacd7e43a711f10a82f3b86e3de3a0ba25aea091f60b73f0">IO_MSG_GPIO_GSENSOR</a>:</div><div class="line">                app_sensor_key_gsensor_handle_msg(&amp;io_driver_msg_recv);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>source code directory: sdk/src/sample/rws/app_sensor_key.c <br />
 Handle click msg from io msg.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> app_sensor_key_gsensor_handle_msg(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> *io_driver_msg_recv)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if F_APP_SENSOR_SC7A20_SUPPORT</span></div><div class="line">    ...</div><div class="line"></div><div class="line">    status = app_sensor_key_sc7a20_click_read(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#affa82f8f62523f4f7f2e53a23683acd5">gsensor_click_threshold</a>,</div><div class="line">                                              <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a762f0f2b807e5ed4d61dd098ea1c76c4">gsensor_noise_threshold</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (status)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (timer_idx_gsensor_click_detect == 0)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___t_i_m_e_r.html#ga7e0ebc306e15dabba884fda9e981df9a">app_start_timer</a>(&amp;timer_idx_gsensor_click_detect, <span class="stringliteral">&quot;gsensor_click_detect&quot;</span>,</div><div class="line">                            app_sensor_key_timer_id, APP_TIMER_GSENSOR_CLICK_DETECT, 0, <span class="keyword">false</span>,</div><div class="line">                            SC7A20_GSENSOR_CLICK_DETECT_TIME);</div><div class="line"></div><div class="line">            sc7a20_db.click_timer_cnt = 0;</div><div class="line">            sc7a20_db.click_timer_total_cnt = 0;</div><div class="line">            sc7a20_db.click_final_cnt = 0;</div><div class="line">        }</div><div class="line"></div><div class="line">        sc7a20_db.click_status = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <a class="code" href="group___a_p_p___d_l_p_s___exported___functions.html#ga034420ab656a4b9286d7bf35e149a16a">app_dlps_enable</a>(<a class="code" href="group___a_p_p___d_l_p_s___exported___macros.html#ga9736593545da647d1fefb751f23eb9ec">APP_DLPS_ENTER_CHECK_GPIO</a>);</div><div class="line">    }</div><div class="line"></div><div class="line">    ...</div><div class="line">#endif</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div><p>Read click counts and handle key operataions.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_sensor_key_timeout_cb(uint8_t timer_evt, uint16_t param)</div><div class="line">{</div><div class="line">    <span class="keywordflow">case</span> APP_TIMER_GSENSOR_CLICK_DETECT:</div><div class="line">        {</div><div class="line"><span class="preprocessor">#if F_APP_SENSOR_SC7A20_SUPPORT</span></div><div class="line">            uint8_t click_cnt;</div><div class="line"></div><div class="line">            click_cnt = app_sensor_key_sc7a20_get_cnts();</div><div class="line">            <span class="keywordflow">if</span> (click_cnt == 1)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___a_p_p___k_e_y___p_r_o_c_e_s_s.html#ga1c98165920d82bfb2e749794633046bf">app_key_single_click</a>(KEY0_MASK);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (click_cnt &gt;= 2)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (click_cnt &gt;= 7)</div><div class="line">                {</div><div class="line">                    click_cnt = 7;</div><div class="line">                }</div><div class="line">                <a class="code" href="group___a_p_p___k_e_y___p_r_o_c_e_s_s.html#gaae648fe7fbeb36e74527d1e14a8ee753">app_key_hybrid_multi_clicks</a>(KEY0_MASK, click_cnt);</div><div class="line">            }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
