<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p>
<h1><a class="anchor" id="Dongle_App_Page"></a>
Dongle App User Manual </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p>
<center><b>V1.1</b></center><p><br />
 </p><center><b>2023/07/31</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Demo_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2022/03/25  </td><td class="markdownTableBodyCenter">Draft release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/07/31  </td><td class="markdownTableBodyCenter">Modify structure   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Demo_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#Audio_Demo_Rev">Revision History</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#Audio_Demo_Table_List">Table List</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#Audio_Demo_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#Audio_Demo_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r1-introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r2-project-overview">2 Project Overview</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r3-sdk-architecture">3 SDK Architecture</a><ul>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r31-overview">3.1 Overview</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r32-dongle-specific">3.2 Dongle-specific</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r33-image-layout">3.3 Image layout</a></li>
</ul>
</li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r4-system-architecture">4 System Architecture</a><ul>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r41-software-layer">4.1 Software layer</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r42-general">4.2 General</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r43-application-audio-path">4.3 Application audio path</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r44-legacy-bt-common">4.4 Legacy BT common</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r45-legacy-bt-gaming">4.5 Legacy BT gaming</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r46-legacy-bt-general">4.6 Legacy BT general</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r47-legacy-bt-teams">4.7 Legacy BT teams</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r48-le-audio">4.8 LE Audio</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r49-bt-ual">4.9 BT UAL</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r410-led">4.10 LED</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r411-basic-supported-modules">4.11 Basic supported modules</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r412-data-stream">4.12 Data stream</a></li>
</ul>
</li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r5-main-process">5 Main Process</a><ul>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r51-system-startup">5.1 System startup</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r52-application-startup">5.2 Application startup</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r53-app-task-message-loop">5.3 App task message loop</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r54-mmi-actions">5.4 MMI actions</a></li>
</ul>
</li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r6-development">6 Development</a><ul>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r61-quick-start">6.1 Quick start</a><ul>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r611-compilation">6.1.1 Compilation</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r612-download-images">6.1.2 Download images</a></li>
</ul>
</li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r62-evb-introduction">6.2 EVB Introduction</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r63-print-log">6.3 Print log for debugging</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r64-mcuconfig">6.4 MCUConfig</a></li>
<li><a class="el" href="_a_n025__d_o_n_g_l_e__a_p_p.html#dongle-r65-troubleshooting">6.5 Troubleshooting</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Demo_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_2_1">Table 2-1 Dongle Function list</a></li>
<li><a href="#table_3_1">Table 3-1 Dongle Source Code list</a></li>
<li><a href="#table_3_2">Table 3-2 Keil Project list</a></li>
<li><a href="#table_4_1">Table 4-1 Gaming dongle source file list</a></li>
<li><a href="#table_4_2">Table 4-2 Audio Path API list</a></li>
<li><a href="#table_4_3">Table 4-3 Legacy BT file list</a></li>
<li><a href="#table_4_4">Table 4-4 Legacy BT Event list</a></li>
<li><a href="#table_4_5">Table 4-5 Legacy BT AVRCP Event list</a></li>
<li><a href="#table_4_6">Table 4-6 LE Audio Source File list</a></li>
<li><a href="#table_4_7">Table 4-7 LE Audio BIS Source File list</a></li>
<li><a href="#table_5_1">Table 5-1 Gaming Dongle MMI Actions list</a></li>
<li><a href="#table_5_2">Table 5-2 General &amp;&amp; Teams Dongle MMI Actions list</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Demo_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_3_1">Figure 3-1 Flash Image Layout</a></li>
<li><a href="#figure_4_1">Figure 4-1 Dongle Software Layer</a></li>
<li><a href="#figure_4_2">Figure 4-2 App Audio Path Flow</a></li>
<li><a href="#figure_4_3">Figure 4-3 Gaming downstream Play Flow</a></li>
<li><a href="#figure_4_4">Figure 4-4 Gaming upstream Record Flow</a></li>
<li><a href="#figure_4_5">Figure 4-5 RWS CIS Flow</a></li>
<li><a href="#figure_4_6">Figure 4-6 Headset CIS Flow</a></li>
<li><a href="#figure_4_7">Figure 4-7 BA without PAST Flow</a></li>
<li><a href="#figure_4_8">Figure 4-8 BA and PAST on the same device Flow</a></li>
<li><a href="#figure_4_9">Figure 4-9 BA and PAST on different devices Flow</a></li>
<li><a href="#figure_4_10">Figure 4-10 Data Stream Flow</a></li>
<li><a href="#figure_5_1">Figure 5-1 App Startup Flow</a></li>
<li><a href="#figure_5_2">Figure 5-2 App Task Message Loop</a></li>
<li><a href="#figure_5_3">Figure 5-3 App, Framework and upperstack/gap</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Demo_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BT  </td><td class="markdownTableBodyCenter">Bluetooth   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AVRCP  </td><td class="markdownTableBodyCenter">Audio Video Remote Control Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">A2DP  </td><td class="markdownTableBodyCenter">Advanced Audio Distribution Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CIS  </td><td class="markdownTableBodyCenter">Connected Isochronous Stream   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BIS  </td><td class="markdownTableBodyCenter">Broadcast Isochronous Stream   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">BAP  </td><td class="markdownTableBodyCenter">Basic Audio Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CAS  </td><td class="markdownTableBodyCenter">Common Audio Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CSIS  </td><td class="markdownTableBodyCenter">Coordinated Set Identification Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ASCS  </td><td class="markdownTableBodyCenter">Audio Stream Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PACS  </td><td class="markdownTableBodyCenter">Published Audio Capabilities Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TBS  </td><td class="markdownTableBodyCenter">Telephone Bearer Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">MCS  </td><td class="markdownTableBodyCenter">Media Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MICS  </td><td class="markdownTableBodyCenter">Microphone Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AICS  </td><td class="markdownTableBodyCenter">Audio Input Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCS  </td><td class="markdownTableBodyCenter">Volume Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VOCS  </td><td class="markdownTableBodyCenter">Volume Offset Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BASS  </td><td class="markdownTableBodyCenter">Broadcast Audio Scan Service   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="dongle-r1-introduction"></a>
1 Introduction</h2>
<p>Dongle is basically a small audio transceiver that is used as wireless audio source. It is inserted to a PC, or laptop, or smart phone, etc., and transfer audio to or receive audio from earbuds or wireless headphone. It can provide isochronous audio stream and low latency. <br />
 This document describes SDK architecture, System Architecture, Main Process, and Development parts. We wish it can do help for you. <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="dongle-r2-project-overview"></a>
2 Project Overview</h2>
<p>Here is the brief description of dongle functionality.</p>
<center><div id="table_2_1"><b>Table 2-1 Dongle Function list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Function  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Legacy BT gaming  </td><td class="markdownTableBodyLeft">Low latency bidirectional audio input/output via classic BT, <br />
 Gaming BT connection with auto-pairing, <br />
 Gaming BT reconnection, <br />
 Stereo audio downstream (Playback), <br />
 Monophonic audio upstream (Call or open recording), <br />
 Gaming (Low latency) or normal mode, <br />
 A2DP support, <br />
 AVRCP support, <br />
 Key, <br />
 LED, <br />
 USB HID, <br />
 USB Audio Class, <br />
 Other basic functionality such as SPP, UART, TIMER, etc.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Legacy BT general  </td><td class="markdownTableBodyLeft">Legacy BT connection with auto-pairing, <br />
 Legacy BT reconnection, <br />
 Stereo audio downstream (Playback without upstream open), <br />
 Bidirectional monophonic audio stream (Call or open recording), <br />
 A2DP support, <br />
 AVRCP support, <br />
 HFP support, <br />
 Key, <br />
 LED, <br />
 USB HID, <br />
 USB Audio Class, <br />
 Other basic functionality such as SPP, UART, TIMER, etc.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Legacy BT Teams  </td><td class="markdownTableBodyLeft">In addition to Legacy BT general, there is Teams function.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">LE Audio Unicast Source  </td><td class="markdownTableBodyLeft">Unicast Source, <br />
 Stereo audio downstream (Playback), <br />
 Monophonic audio upstream (Call or open recording), <br />
 Key, <br />
 LED, <br />
 USB HID, <br />
 USB Audio Class, <br />
 Other basic functionality such as GATT, UART, TIMER, etc.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">LE Audio Broadcast Source  </td><td class="markdownTableBodyLeft">Broadcast Source, <br />
 Stereo audio downstream (Playback), <br />
 Key, <br />
 LED, <br />
 USB HID, <br />
 USB Audio Class, <br />
 Other basic functionality such as GATT, UART, TIMER, etc.   </td></tr>
</table>
<p>NOTE: Gaming, General/Teams are mutually exclusive. They are different targets in dongle Keil project. <br />
 Legacy, LE audio unicast source and LE audio broadcast source are different running modes. These modes are switched by key.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="dongle-r3-sdk-architecture"></a>
3 SDK Architecture</h2>
<h3><a class="anchor" id="dongle-r31-overview"></a>
3.1 Overview</h3>
<ul>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_USER_GUIDE">SDK User Guide </a></li>
</ul>
<h3><a class="anchor" id="dongle-r32-dongle-specific"></a>
3.2 Dongle-specific</h3>
<p>Project location: <b>sdk/board/evb/dongle/dongle_rtl87x3e.uvprojx</b> <br />
 Source code location:</p>
<center><div id="table_3_1"><b>Table 3-1 Dongle Source Code list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Source File Folder  </th><th class="markdownTableHeadNone">Function   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sdk/src/app/bqb  </td><td class="markdownTableBodyNone">bqb related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">sdk/src/app/cli  </td><td class="markdownTableBodyNone">command line related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sdk/src/app/console  </td><td class="markdownTableBodyNone">console related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">sdk/src/app/general_bt  </td><td class="markdownTableBodyNone">telephone dongle related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sdk/src/app/le_bt  </td><td class="markdownTableBodyNone">le audio related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">sdk/src/app/le_bt/le_audio_service  </td><td class="markdownTableBodyNone">le audio service related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sdk/src/app/legacy_bt  </td><td class="markdownTableBodyNone">gaming dongle related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">sdk/src/app/mp  </td><td class="markdownTableBodyNone">mp related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sdk/src/app/ual  </td><td class="markdownTableBodyNone">ual related source file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">sdk/src/app/usb  </td><td class="markdownTableBodyNone">usb related source file   </td></tr>
</table>
<p>There are three Targets in dongle project. They are defined for gaming, general, and teams.</p>
<center><div id="table_3_2"><b>Table 3-2 Keil Project list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Target in dongle Keil project  </th><th class="markdownTableHeadLeft">Function  </th><th class="markdownTableHeadLeft">Macro (mandatory)   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">dongle_bank0_bb2_ccut_gaming  </td><td class="markdownTableBodyLeft">Legacy BT gaming, <br />
 LE Audio  </td><td class="markdownTableBodyLeft">LEGACY_BT_GAMING   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">dongle_bank0_bb2_ccut_general  </td><td class="markdownTableBodyLeft">Legacy BT general, <br />
 LE Audio,  </td><td class="markdownTableBodyLeft">LEGACY_BT_GENERAL   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">dongle_bank0_bb2_ccut_teams  </td><td class="markdownTableBodyLeft">Legacy BT Teams, <br />
 LE Audio,  </td><td class="markdownTableBodyLeft">LEGACY_BT_TEAMS   </td></tr>
</table>
<h3><a class="anchor" id="dongle-r33-image-layout"></a>
3.3 Image layout</h3>
<div class="image">
<img src="dongle_image_layout.png" alt="dongle_image_layout.png"/>
</div>
<center><div id="figure_3_1"><b>Figure 3-1 Flash Image Layout </b></div></center><p>Besides the images, there is some space for app_cfg_nv, FTL and etc. <br />
 The dongle app related image files are APP_Config_RTL8763EAU.bin, SYSTEM_Config_RTL8763EAU.bin and dongle_bankXXX.bin <br />
 The APP_Config_RTL8763EAU.bin is the app config, it has lots of customized configurations such as "Bluetooth name", "USB VID/PID", etc. <br />
 The SYSTEM_Config_RTL8763EAU.bin is the system config, such as "Bluetooth address", Tx Power, etc. <br />
 The dongle_bankXXX.bin is the dongle application. <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="dongle-r4-system-architecture"></a>
4 System Architecture</h2>
<h3><a class="anchor" id="dongle-r41-software-layer"></a>
4.1 Software layer</h3>
<p>The whole program can be roughly divided into three layers: APPLICATION, MIDDLEWARE and LOW-LEVEL. <br />
</p>
<div class="image">
<img src="dongle_software_layer.png" alt="dongle_software_layer.png"/>
</div>
<center><div id="figure_4_1"><b>Figure 4-1 Dongle Software Layer </b></div></center><h3><a class="anchor" id="dongle-r42-general"></a>
4.2 General</h3>
<p>Here are the application C source files and their descriptions. <br />
</p>
<center><div id="table_4_1"><b>Table 4-1 Gaming dongle source file list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">C source file  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_auto_power_off.c  </td><td class="markdownTableBodyLeft">App auto power off mechanism.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_cfg.c  </td><td class="markdownTableBodyLeft">Load MCU APP_RTL8763EAU_xxx.bin and app_cfg_nv.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_cli_main.c  </td><td class="markdownTableBodyLeft">Handle app and gaming subcommands from console (DATA UART). <br />
 These subcommand handlers send messages to app task.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_console_msg.c  </td><td class="markdownTableBodyLeft">Handle the massages from console (sub)commands handlers.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_cyclic_buffer.c  </td><td class="markdownTableBodyLeft">Cyclic buffer initialization, de-init, read/write, etc.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_device.c  </td><td class="markdownTableBodyLeft">App power on/off flow   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_dlps.c  </td><td class="markdownTableBodyLeft">Deep Low power manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_dongle_vol.c  </td><td class="markdownTableBodyLeft">Dongle volume control, it is related to USB hid and BT AVRCP. <br />
 LE Audio volume control is implemented in le_vc_service.c   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_dsp_cfg.c  </td><td class="markdownTableBodyLeft">Load DSP config   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_gpio.c  </td><td class="markdownTableBodyLeft">GPIO driver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_io_msg.c  </td><td class="markdownTableBodyLeft">The main entry of app message handler that invokes various message handlers.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_io_output.c  </td><td class="markdownTableBodyLeft">Output 10HZ square wave   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_key_gpio.c  </td><td class="markdownTableBodyLeft">GPIO key driver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_key_process.c  </td><td class="markdownTableBodyLeft">GPIO key process. Detect what is a key single click, double click, multi click, etc.,<br />
and then execute the corresponding MMI action.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_led_ctl.c  </td><td class="markdownTableBodyLeft">LED Control. Defined different modes, each of them incorporates three LEDs. <br />
One LED setting is keep-on, or keep-off, or on-off, or bypass, or breathing.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_line_in.c  </td><td class="markdownTableBodyLeft">LINE IN plug in/out detection driver.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_link_util.c  </td><td class="markdownTableBodyLeft">Basic BR/EDR link manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_main.c  </td><td class="markdownTableBodyLeft">Application main entry.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_mmi.c  </td><td class="markdownTableBodyLeft">MMI handlers, such as key short/long press, factory reset, working mode change, etc.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_status_report.c  </td><td class="markdownTableBodyLeft">Report codec statistics   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_util.c  </td><td class="markdownTableBodyLeft">Calculate checksum   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">dongle_media.c  </td><td class="markdownTableBodyLeft">Monitor media stream state.   </td></tr>
</table>
<h3><a class="anchor" id="dongle-r43-application-audio-path"></a>
4.3 Application audio path</h3>
<p>audio_path.lib is a static library that hides the complex audio pipes and tracks and provides unified APIs for developers. <br />
</p>
<div class="image">
<img src="app_audio_path.png" alt="app_audio_path.png"/>
</div>
<center><div id="figure_4_2"><b>Figure 4-2 App Audio Path Flow </b></div></center><p>Input terminals are defined below. Its acronym is IT.</p>
<div class="fragment"><div class="line"><span class="comment">/* Audio path input terminal type */</span></div><div class="line"><span class="keyword">enum</span> iterminal_type</div><div class="line">{</div><div class="line">    IT_SBC = 0x00,</div><div class="line">    IT_LC3FRM,</div><div class="line">    IT_MIC,</div><div class="line">    IT_AUX,</div><div class="line">    IT_UDEV_IN1, <span class="comment">/* usb isoc out */</span></div><div class="line">    IT_RELAY_CODE1, <span class="comment">/* For relaying encoded frames from one path to another. */</span></div><div class="line">    IT_MSBC,</div><div class="line">    IT_MAX,</div><div class="line">};</div></div><!-- fragment --><p>Output terminals are defined below. Its acronym is OT.</p>
<div class="fragment"><div class="line">/* Audio path output terminal type */</div><div class="line">enum oterminal_type</div><div class="line">{</div><div class="line">    OT_SBC = 0x00,</div><div class="line">    OT_LC3FRM,</div><div class="line">    OT_SPK,</div><div class="line">    OT_AUX,</div><div class="line">    OT_UDEV_OUT1, /* usb isoc in */</div><div class="line">    OT_RELAY_CODE1,</div><div class="line">    OT_MSBC,</div><div class="line">    OT_MAX,</div><div class="line">};</div></div><!-- fragment --><center><div id="table_4_2"><b>Table 4-2 Audio Path API list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">API  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_init()  </td><td class="markdownTableBodyLeft">Initialize audio path module   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_createv()  </td><td class="markdownTableBodyLeft">Create one or more audio paths   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_release_by_itot()  </td><td class="markdownTableBodyLeft">Release an audio path with IT or OT matched.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_fill_async()  </td><td class="markdownTableBodyLeft">Fill PCM data to the audio path which is identified by IT.<br />
Call this func when the context is different from the app task.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_fill()  </td><td class="markdownTableBodyLeft">Similar functionality as the above func, but call this func in <br />
the app task context. NOTE: The two functions are mutually <br />
exclusive.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_fill_code()  </td><td class="markdownTableBodyLeft">Fill encoded data to the audio path that will decode it.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_resume_dec()  </td><td class="markdownTableBodyLeft">For decoding, there is a space limit. The buffer for storing <br />
decoded data would not be as big as possible.<br />
So we provide a mechanism that monitors the watermark of <br />
the buffer and pauses or resumes the decoding subroutine.<br />
This function is used to decrease the watermark when the <br />
decoded data was fetched.<br />
It decreases the watermark and check if the decoder should be <br />
resumed.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_watermark()  </td><td class="markdownTableBodyLeft">Return the current watermark.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_handle_msg()  </td><td class="markdownTableBodyLeft">A wrapper function for handling audio path messages.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_reg_monitor()  </td><td class="markdownTableBodyLeft">Register a monitor to get audio path state when the state of any <br />
audio path changes.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_set_input_mute()  </td><td class="markdownTableBodyLeft">Mute an input terminal.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_set_aux_mute()  </td><td class="markdownTableBodyLeft">Mute the AUX OUT or Speaker.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_audio_path_set_aux_track_volume()  </td><td class="markdownTableBodyLeft">Increase or decrease the AUX OUT or Speaker volume.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_path_set_pipe_volume()  </td><td class="markdownTableBodyLeft">Set the audio pipe gain. Currently we only support set lc3 <br />
encode gain.   </td></tr>
</table>
<p>uapi audio events are associated with the corresponding audio path state. <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> uapi_audio_event</div><div class="line">{</div><div class="line">    EVENT_AUDIO_PATH_READY,</div><div class="line">    EVENT_AUDIO_PATH_RELEASED,</div><div class="line">    EVENT_AUDIO_PATH_DATA_IND,</div><div class="line">    EVENT_AUDIO_PATH_STREAM_STARTED,</div><div class="line">    EVENT_AUDIO_PATH_STREAM_STOPPED,</div><div class="line">};</div></div><!-- fragment --><p>These events will be passed to the user callback which is registered at audio path creation. <br />
 When low level audio pipe or track started, the EVENT_AUDIO_PATH_READY will be emitted. <br />
 EVENT_AUDIO_PATH_DATA_IND is generated when the encoded data or decoded data is ready. <br />
</p>
<p>audio monitor events are defined for user who wants to monitor the state of all audio paths. <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> audio_monitor_event</div><div class="line">{</div><div class="line">    EVENT_AUDIO_CREATED           = 0,</div><div class="line">    EVENT_AUDIO_STARTED           = 1,</div><div class="line">    EVENT_AUDIO_MUTED             = 2,</div><div class="line">    EVENT_AUDIO_UNMUTED           = 3,</div><div class="line">    EVENT_AUDIO_VOLUME_CHANGED    = 4,</div><div class="line">    EVENT_AUDIO_STOPPED           = 5,</div><div class="line">    EVENT_AUDIO_RELEASED          = 6,</div><div class="line">};</div></div><!-- fragment --><p>There is a message header associated with any above monitor event. <br />
 The path_id or it or ot indicates the audio path. <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structaudio__monitor__msghdr.html">audio_monitor_msghdr</a></div><div class="line">{</div><div class="line">    uint8_t <a class="code" href="structaudio__monitor__msghdr.html#af2b019c85ded9e6d92b8364daa94ce21">path_id</a>;</div><div class="line">    uint8_t <a class="code" href="structaudio__monitor__msghdr.html#a9295640264f17eb9997e34e27ca183a1">it</a>;</div><div class="line">    uint8_t <a class="code" href="structaudio__monitor__msghdr.html#ada592c67d5472310212ec2b127421f9b">ot</a>;</div><div class="line">    uint8_t <a class="code" href="structaudio__monitor__msghdr.html#a5b16cde76ddd2d653b1c6968e015038d">codec_type</a>; <span class="comment">/* TODO: Encode or decode or ... */</span></div><div class="line">};</div></div><!-- fragment --><h3><a class="anchor" id="dongle-r44-legacy-bt-common"></a>
4.4 Legacy BT common</h3>
<p>This module contains the common code for BR/EDR BT. <br />
</p>
<center><div id="table_4_3"><b>Table 4-3 Legacy BT file list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">C source file  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_a2dp.c  </td><td class="markdownTableBodyLeft">Initialize A2DP and handle A2DP related events.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_avrcp.c  </td><td class="markdownTableBodyLeft">Initialize AVRCP and handle AVRCP related events.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_bond.c  </td><td class="markdownTableBodyLeft">Read/write/remove BR/EDR device bond information   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_gap.c  </td><td class="markdownTableBodyLeft">Handle GAP related events.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_sdp.c  </td><td class="markdownTableBodyLeft">Define various SDP records and register them.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_spp.c  </td><td class="markdownTableBodyLeft">Initialize SPP and handle SPP related events.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">legacy_audio_wrapper.c  </td><td class="markdownTableBodyLeft">A wrapper for legacy BT related APIs.   </td></tr>
</table>
<p>a2dp event from framework:</p>
<center><div id="table_4_4"><b>Table 4-4 Legacy BT A2DP Event list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_CONN_IND  </td><td class="markdownTableBodyLeft">Indicate A2DP connection indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_CONFIG_CMPL  </td><td class="markdownTableBodyLeft">Indicate A2DP set configuration complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_OPEN  </td><td class="markdownTableBodyLeft">Indicate A2DP stream open   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_START_IND  </td><td class="markdownTableBodyLeft">Indicate A2DP stream start indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_START_RSP  </td><td class="markdownTableBodyLeft">Indicate A2DP stream start response   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_STOP  </td><td class="markdownTableBodyLeft">Indicate A2DP stream stop   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_CLOSE  </td><td class="markdownTableBodyLeft">Indicate A2DP stream close   </td></tr>
</table>
<ul>
<li><a class="el" href="_a2_d_p.html#A2DP_USER_MANU">A2DP Application Note </a></li>
</ul>
<p>avrcp event from framework:</p>
<center><div id="table_4_5"><b>Table 4-5 Legacy BT AVRCP Event list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_CONN_IND  </td><td class="markdownTableBodyLeft">Indicate AVRCP connection indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_CONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate AVRCP connection complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_VOLUME_CHANGED  </td><td class="markdownTableBodyLeft">Indicate AVRCP volume changed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_VOLUME_UP  </td><td class="markdownTableBodyLeft">Indicate AVRCP volume up   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_VOLUME_DOWN  </td><td class="markdownTableBodyLeft">Indicate AVRCP volume down   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_REG_VOLUME_CHANGED  </td><td class="markdownTableBodyLeft">Indicate AVRCP register volume changed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_PLAY_STATUS_CHANGED_REG_REQ  </td><td class="markdownTableBodyLeft">Indicate AVRCP register play status <br />
changed notification register request   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_DISCONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate AVRCP disconnected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_PLAY  </td><td class="markdownTableBodyLeft">Indicate AVRCP play key release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_STOP  </td><td class="markdownTableBodyLeft">Indicate AVRCP stop key release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_PAUSE  </td><td class="markdownTableBodyLeft">Indicate AVRCP pause key release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_REWIND_START  </td><td class="markdownTableBodyLeft">Indicate AVRCP rewind key press   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_REWIND_STOP  </td><td class="markdownTableBodyLeft">Indicate AVRCP rewind key release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_FAST_FORWARD_START  </td><td class="markdownTableBodyLeft">Indicate AVRCP fast forward key press   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_FAST_FORWARD_STOP  </td><td class="markdownTableBodyLeft">Indicate AVRCP fast forward key release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_FORWARD  </td><td class="markdownTableBodyLeft">Indicate AVRCP forward key release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_BACKWARD  </td><td class="markdownTableBodyLeft">Indicate AVRCP backward key release   </td></tr>
</table>
<ul>
<li><a class="el" href="_a_v_r_c_p.html#AVRCP_USER_MANU">AVRCP Application Note </a></li>
</ul>
<h3><a class="anchor" id="dongle-r45-legacy-bt-gaming"></a>
4.5 Legacy BT gaming</h3>
<p>The Gaming module is a static library gaming_bt.lib. <br />
 It incorporates the functions below: <br />
</p>
<ul>
<li>Gaming Bluetooth connection</li>
<li>Gaming Bluetooth disconnection</li>
<li>Gaming entering and exit</li>
<li>Load/Store/Remove device bond information</li>
<li>Input PCM data from USB Isochronous OUT pipe</li>
<li>Output SBC frames that comes from audio path</li>
<li>Send A2DP packets containing SBC frames</li>
<li>Receive SPP packets that includes encoded frames</li>
<li>Decoding encoded frames by audio path.</li>
<li>Send decoded PCM data to host via USB Isochronous IN pipe</li>
<li>Start discovery</li>
<li>Stop discovery</li>
</ul>
<p>Bidirectional audio transfer</p>
<div class="image">
<img src="gaming_downstream.png" alt="gaming_downstream.png"/>
</div>
<center><div id="figure_4_3"><b>Figure 4-3 Gaming downstream Play Flow </b></div></center><p><br />
</p>
<div class="image">
<img src="gaming_upstream.png" alt="gaming_upstream.png"/>
</div>
<center><div id="figure_4_4"><b>Figure 4-4 Gaming upstream Record Flow </b></div></center><p>Events from the library: <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="group___g_a_m_i_n_g___b_t.html#ga136f401b659fc558784ea5787b8db6c8">gaming_bt_event</a></div><div class="line">{</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8a5ec3373c5708ceb8ddd8562e988633dc">EVENT_GAMING_DEVICE_CONNECTED</a> = 0,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8aeac0c15d5d0332f87f28ef3abc823870">EVENT_GAMING_DEVICE_DISCONNECTED</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8ab53feead55b3b1174253754f5222878a">EVENT_GAMING_PROFILE_CONNECTED</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8ac69ba171410c336183d9bc558048e8ea">EVENT_GAMING_PROFILE_DISCONNECTED</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8ad4276e2a22cf107d8fe33ecea01cbf46">EVENT_GAMING_DEVICE_FOUND</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8a4532ab1244ee0a08628a88f790f5445c">EVENT_GAMING_DISCOVERY_STOPPED</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8a8fbdf3fd6170323b7e87fd7e5afd3e44">EVENT_GAMING_DISCOVERY_STARTING</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8a8cf004b23b65f8c43e72fefe29d90d9e">EVENT_GAMING_DISCOVERY_STARTED</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8a20b68e2a19bbf6b2cbac28656a797d43">EVENT_GAMING_DISCOVERY_STOPPING</a>,</div><div class="line">    <a class="code" href="group___g_a_m_i_n_g___b_t.html#gga136f401b659fc558784ea5787b8db6c8af7315299ad8681ee33667f122ef6f460">EVENT_GAMING_LED_INDICATOR</a>,</div><div class="line">};</div></div><!-- fragment --><p>The function <b><a class="el" href="group___gaming___b_t___exported___functions.html#ga4ee15c4290417f6c91c8864ec214d842" title="Gaming bt manager event callback register. ">gaming_bt_reg_cback()</a></b> is used to register a user callback into gaming module. <br />
 The user callback will be called when one of the above events is emitted. <br />
 The callback prototype is below: <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> bool (*<a class="code" href="group___g_a_m_i_n_g___b_t.html#ga5aa79a78c0ee2fc6789a6d287c4c558f">gaming_bt_cback_t</a>)(uint8_t evt, uint8_t *data, uint16_t len);</div></div><!-- fragment --><p>NOTE: there is only one user callback. <br />
 About how to use the gaming API, please refer to legacy_audio_wrapper.c <br />
</p>
<h3><a class="anchor" id="dongle-r46-legacy-bt-general"></a>
4.6 Legacy BT general</h3>
<p>T.B.D</p>
<h3><a class="anchor" id="dongle-r47-legacy-bt-teams"></a>
4.7 Legacy BT teams</h3>
<p>T.B.D</p>
<h3><a class="anchor" id="dongle-r48-le-audio"></a>
4.8 LE Audio</h3>
<p>The LE Audio is versatile. It provides a series of roles, such as Unicast Source, Broadcast Source, Unicast Sink, Broadcast Sink, and associated services and profiles. <br />
 Below are two typical scenarios for Unicast Source on Dongle: <br />
</p>
<div class="image">
<img src="leaudio_unicast_1.png" alt="leaudio_unicast_1.png"/>
</div>
<center><div id="figure_4_5"><b>Figure 4-5 RWS CIS Flow </b></div></center><p>NOTE: Dongle can receive audio data from one of CISes, decode the data and send the decoded data to Host. <br />
</p>
<div class="image">
<img src="leaudio_unicast_2.png" alt="leaudio_unicast_2.png"/>
</div>
<center><div id="figure_4_6"><b>Figure 4-6 Headset CIS Flow </b></div></center><p>NOTE: Dongle can receive audio data from the CIS, decode the data and send the decoded data to Host. <br />
</p>
<p>Dongle source files for unicast source are below: <br />
</p>
<center><div id="table_4_6"><b>Table 4-6 LE Audio CIS Source File list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">C source file  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_le_audio.c  </td><td class="markdownTableBodyLeft">Provide autopair and reconnect Unicast Source API.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">le_audio_data.c  </td><td class="markdownTableBodyLeft">Send CIS data and receive CIS data.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">le_audio_lib_msg.c  </td><td class="markdownTableBodyLeft">Handle messages from ble audio lib.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">le_audio_service.c  </td><td class="markdownTableBodyLeft">BLE audio manager.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">le_csis_client_service.c  </td><td class="markdownTableBodyLeft">Coordinated Set Identification Service client.<br />
It is used to find another device that is configured as <br />
a member of a group, such as a pair of earbuds.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">le_media_player.c  </td><td class="markdownTableBodyLeft">MCS implementation. <br />
It's like a media player. Earbuds send PLAY, PAUSE, etc., <br />
control commands to the player. <br />
The player updates play status and send the status <br />
notification to earbuds.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">le_mic_service.c  </td><td class="markdownTableBodyLeft">MICS Client. Mute/Unmute microphone on earbuds.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">le_unicast_src_service.c  </td><td class="markdownTableBodyLeft">BAP, ASCS, PACS client implementation.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">le_vc_service.c  </td><td class="markdownTableBodyLeft">VCS client. Control the volume on remote device. <br />
The remote device sends volume changed notification <br />
to dongle when it's volume changes.   </td></tr>
</table>
<div style="page-break-after: always;"></div><p>The Broadcast scenarios are shown below:<br />
</p>
<div class="image">
<img src="leaudio_broadcast_1.png" alt="leaudio_broadcast_1.png"/>
</div>
<center><div id="figure_4_7"><b>Figure 4-7 BA without PAST Flow </b></div></center><p><br />
</p>
<div class="image">
<img src="leaudio_broadcast_2.png" alt="leaudio_broadcast_2.png"/>
</div>
<center><div id="figure_4_8"><b>Figure 4-8 BA and PAST on the same device Flow </b></div></center><p><br />
</p>
<div class="image">
<img src="leaudio_broadcast_3.png" alt="leaudio_broadcast_3.png"/>
</div>
<center><div id="figure_4_9"><b>Figure 4-9 BA and PAST on different devices Flow </b></div></center><p><br />
</p>
<p>Dongle source files for Broadcasting are below: <br />
</p>
<center><div id="table_4_7"><b>Table 4-7 LE Audio BIS Source File list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">C source files  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">le_ba_service.c  </td><td class="markdownTableBodyLeft">Broadcast assistant.<br />
Send SyncInfo data to the sink by PAST. PAST: Periodic <br />
Advertising Sync Transfer.<br />
NOTE: the Broadcast Source and Broadcast Assistant <br />
can be the same device, for example, dongle has both <br />
Broadcast Source and Broadcast Assistant roles.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">le_bst_src_service.c  </td><td class="markdownTableBodyLeft">Broadcast Source. Initialize broadcast source, <br />
start/stop broadcasting.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">le_broadcast_mgr.c  </td><td class="markdownTableBodyLeft">Broadcast manager.   </td></tr>
</table>
<p>Some functions are defined for exchanging information between the leaudio.lib and application. <br />
 First, when calling <b><a class="el" href="group___l_e_a___l_i_b___exported___functions.html#ga815f80e2bf34eb3a54f8c0750f747aaa" title="Initialize LE audio. ">ble_audio_init()</a></b>, one application callback is passed to the leaudio.lib. <br />
</p>
<div class="fragment"><div class="line"><a class="code" href="group___l_e_a___l_i_b___exported___functions.html#ga815f80e2bf34eb3a54f8c0750f747aaa">ble_audio_init</a>(ble_audio_msg_cb, evt_queue, io_queue);</div></div><!-- fragment --><p>When one BLE audio service discovery is done, the above registered callback function will be invoked with the corresponding message. <br />
 Here is the message list below: <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a770bc738600823cc7e68d6a24a4e282d">LE_AUDIO_MSG_GROUP_BASS</a>         = 0x0000,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a772d7850251a7999ad9bda252fe90f57">LE_AUDIO_MSG_GROUP_BASS_CLIENT</a>  = 0x0100,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a31636dc0f5ee4e99afd0f7d08c5826dc">LE_AUDIO_MSG_GROUP_PACS</a>         = 0x0200,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a8a360ea3b3a9940d73b16027d39a4814">LE_AUDIO_MSG_GROUP_PACS_CLIENT</a>  = 0x0300,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ae6ad4dc5311c95e6ccd32a3cded46c69">LE_AUDIO_MSG_GROUP_CSIS</a>         = 0x0400,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a>  = 0x0500,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ae0ccd63fc19b54ff69e4748858fef4fb">LE_AUDIO_MSG_GROUP_ASCS</a>         = 0x0600,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a419b1598d8a096ce2cc61bf50ab0c43f">LE_AUDIO_MSG_GROUP_ASCS_CLIENT</a>  = 0x0700,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a18e741126e835a6a5b4fe6a950723f27">LE_AUDIO_MSG_GROUP_VOCS</a>         = 0x0800,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29af727e4741e5a2fc5c4a94de0ac58e4d3">LE_AUDIO_MSG_GROUP_VOCS_CLIENT</a>  = 0x0900,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ab17180dde0bae24f0eca81f3fbbb42e0">LE_AUDIO_MSG_GROUP_VCS</a>          = 0x0A00,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a6fe9c21eda862072adeb07569f061495">LE_AUDIO_MSG_GROUP_VCS_CLIENT</a>   = 0x0B00,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29af1594d0cba309da20ccea4606381b743">LE_AUDIO_MSG_GROUP_AICS</a>         = 0x0C00,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29adc2cf922a0a46a73cfd35e1428940110">LE_AUDIO_MSG_GROUP_AICS_CLIENT</a>  = 0x0D00,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a84a15be6b2ae89f276e84325e5b7cbbd">LE_AUDIO_MSG_GROUP_MICS</a>         = 0x0E00,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a5dc72cd8810f460b13f5d99ab832746e">LE_AUDIO_MSG_GROUP_MICS_CLIENT</a>  = 0x0F00,</div><div class="line">    LE_AUDIO_MSG_GROUP_CCP          = 0x1000,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a53167cf6e599c92bf0bb364c1a912016">LE_AUDIO_MSG_GROUP_CCP_CLIENT</a>   = 0x1100,</div><div class="line">    LE_AUDIO_MSG_GROUP_MCS          = 0x1200,</div><div class="line">    LE_AUDIO_MSG_GROUP_MCS_CLIENT   = 0x1300,</div><div class="line">    LE_AUDIO_MSG_GROUP_OTS          = 0x1400,</div><div class="line">    LE_AUDIO_MSG_GROUP_OTS_CLIENT   = 0x1500,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ad2f55728d111c85fc7661daedfefa3f5">LE_AUDIO_MSG_GROUP_TMAS</a>         = 0x1600,</div><div class="line">    LE_AUDIO_MSG_GROUP_TMAP_CLIENT  = 0x1700,</div><div class="line"></div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa971fa1cee42dd31a188a1f714208d40">LE_AUDIO_MSG_GROUP_CAP</a>          = 0x2000,</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a9ae28cff0720bdd5bec81f8774802ba6">LE_AUDIO_MSG_GROUP_BAP</a>          = 0x2100,</div><div class="line">} <a class="code" href="group___l_e_a___l_i_b___exported___types.html#gab1ac9b0faffc97f453668dadc3417e29">T_LE_AUDIO_MSG_GROUP</a>;</div></div><!-- fragment --><p>BAP messages: <br />
</p>
<div class="fragment"><div class="line">LE_AUDIO_MSG_BAP_PACS_DIS_DONE                    = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a9ae28cff0720bdd5bec81f8774802ba6">LE_AUDIO_MSG_GROUP_BAP</a> | 0x00,</div><div class="line">LE_AUDIO_MSG_BAP_PAC_NOTIFY                       = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a9ae28cff0720bdd5bec81f8774802ba6">LE_AUDIO_MSG_GROUP_BAP</a> | 0x01,</div><div class="line">LE_AUDIO_MSG_BAP_ASCS_DIS_DONE                    = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a9ae28cff0720bdd5bec81f8774802ba6">LE_AUDIO_MSG_GROUP_BAP</a> | 0x02,</div></div><!-- fragment --><p>For unicast source, there are at least two messages that will be received. <br />
 They are LE_AUDIO_MSG_BAP_PACS_DIS_DONE and LE_AUDIO_MSG_BAP_ASCS_DIS_DONE. <br />
 If the remote device supports CSIS, CSIS client messages would be received. <br />
</p>
<div class="fragment"><div class="line"><a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0baa93208780c099d2480f1593dc3d81993">LE_AUDIO_MSG_CSIS_CLIENT_DIS_DONE</a>           = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x00,</div><div class="line"><a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba4963165bfde752ad506c94c0559f1e18">LE_AUDIO_MSG_CSIS_CLIENT_SEARCH_TIMEOUT</a>     = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x01,</div><div class="line"><a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba292a6eb97c8867e7c9975cd5e5f3bb2e">LE_AUDIO_MSG_CSIS_CLIENT_SEARCH_DONE</a>        = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x02,</div><div class="line">LE_AUDIO_MSG_CSIS_CLIENT_MEMBS_CONN         = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x03,</div><div class="line"><a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba88009d7764ee8e42f5cc84b44a3cd452">LE_AUDIO_MSG_CSIS_CLIENT_SET_MEM_FOUND</a>      = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x04,</div><div class="line">LE_AUDIO_MSG_CSIS_CLIENT_COOR_SET_DEL       = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x05,</div><div class="line">LE_AUDIO_MSG_CSIS_CLIENT_LOCK_REQ_DONE      = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x06,</div><div class="line">LE_AUDIO_MSG_CSIS_CLIENT_UNLOCK_REQ_DONE    = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x07,</div><div class="line">LE_AUDIO_MSG_CSIS_CLIENT_LOCK_STATE_CHANGE  = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x08,</div><div class="line"><a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0bab0006ddd5ea80ce026726596688c04f0">LE_AUDIO_MSG_CSIS_CLIENT_READ_RESULT</a>        = <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29aa7e8f8c4f37108536dfea0b4b3ba2f86">LE_AUDIO_MSG_GROUP_CSIS_CLIENT</a> | 0x09,</div></div><!-- fragment --><p>The message LE_AUDIO_MSG_CSIS_CLIENT_DIS_DONE indicates that the CSIS discovery is done. <br />
 The LE_AUDIO_MSG_CSIS_CLIENT_READ_RESULT means the ATT read result from CSIS server. <br />
 The LE_AUDIO_MSG_CSIS_CLIENT_SET_MEM_FOUND is related to advertising. When Unicast Source receives ADV data that contains RSI and the Unicast Source can resolve the RSI with SIRK, this message will be emitted. <br />
 <br />
 For Broadcast Source, there are two concise API <b>bs_start_broadcast()</b> and <b>bs_stop_broadcast()</b>. <br />
 The <b>bs_start_brodcast()</b> is used to start broadcasting. The broadcast incorporates Extended Advertising, Periodic Advertising, and one or more Broadcast Isochronous Streams. <br />
</p>
<h3><a class="anchor" id="dongle-r49-bt-ual"></a>
4.9 BT UAL</h3>
<p>This module is based on framework library, upperstack library and leaudio library. <br />
 It provides a wrapper for Bluetooth adapter, LE Scanner, LE Advertising, LE ACL connections, and Bluetooth device management. <br />
</p>
<p>User can call <b>bt_adap_start_discovery()</b> to start BR/EDR inquiring, LE scanning or both. <br />
 The injected callback as a parameter will be called when any BR/EDR device or LE advertiser is found. <br />
 The <b>bt_adap_stop_discovery()</b> is used to stop inquiring or LE scanning or both. <br />
</p>
<p>For LE Advertising, this library will use Extended advertising if it is supported. <br />
 Application can have multiple advertising instances. <br />
 Before starting extended advertising, <b>ble_alloc_adv_instance()</b> should be invoked. This function allocates an advertising instance, set advertising parameters, and set advertising data. <br />
</p>
<p>After creating the advertising instance, <b>ble_enable_adv()</b> is used to start advertising. <br />
</p>
<p>To create an LE ACL connection, this library provides a unified connection API <b>bt_dev_le_gatt_connect()</b> that establishes an LE ACL connection with background connection or direct connection. <br />
 Either background connection or direction connection, <b>bt_dev_le_gatt_connect()</b> all uses the whitelist connection. <br />
</p>
<p>To detach LE ACL connection, <b>bt_dev_le_gatt_disconnect()</b> will be called. <br />
</p>
<p>For device bond storage, this library brings two APIs <b>bt_dev_create_bond()</b> and <b>bt_dev_remove_bond()</b>. <br />
 The <b>bt_dev_create_bond()</b> aims to do pairing with the remote device which is identified by the input bdaddr and addr_type. <br />
 When <b>bt_dev_remove_bond()</b> is called, the bond info are removed and the connection would be detached if it exists. <br />
</p>
<h3><a class="anchor" id="dongle-r410-led"></a>
4.10 LED</h3>
<p>In app_led_ctl.c, three LEDs are bound for different LED modes. <br />
 It means that we control three LED together when one LED mode is set. <br />
 For each LED, its state can be set to BYPASS (No change), ON, or OFF, or ON_OFF(Blinking), or Breathing. <br />
 User can add its own LED modes. They only need to change two variables for adding one LED mode. <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_t___l_e_d___t_a_b_l_e.html">T_LED_TABLE</a> LED_TABLE[APP_LED_MODE_COUNT_NUM][LED_NUM] =</div><div class="line">{</div><div class="line">    <span class="comment">//APP_LED_MODE_All_OFF,                     //0</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>}</div><div class="line">    },</div><div class="line">    <span class="comment">//APP_LED_MODE_All_ON,                     //1</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>}</div><div class="line">    },</div><div class="line">    <span class="comment">//APP_LED_MODE_POWER_OFF,                     //2</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>}</div><div class="line">    },</div><div class="line">    <span class="comment">//APP_LED_MODE_POWER_ON,                      //3</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ab4c4c850a6454de34f1355b61f271d70">LED_TYPE_BYPASS</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ab4c4c850a6454de34f1355b61f271d70">LED_TYPE_BYPASS</a>}</div><div class="line">    },</div><div class="line">    <span class="comment">//APP_LED_MODE_CHARGING,                      //4</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11a9e004cac18fdafa704bc7b637f74920c">LED_TYPE_ON_OFF</a>, 10, 10, 1, 0},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ab4c4c850a6454de34f1355b61f271d70">LED_TYPE_BYPASS</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ab4c4c850a6454de34f1355b61f271d70">LED_TYPE_BYPASS</a>}</div><div class="line">    },</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> t_app_led_mode</div><div class="line">{</div><div class="line">    APP_LED_MODE_ALL_OFF                = 0x00,</div><div class="line">    APP_LED_MODE_ALL_ON                 = 0x01,</div><div class="line">    APP_LED_MODE_POWER_OFF              = 0x02,</div><div class="line">    APP_LED_MODE_POWER_ON               = 0x03,</div><div class="line"></div><div class="line">    APP_LED_MODE_CHARGING               = 0x04,</div><div class="line">    APP_LED_MODE_LOW_BATTERY            = 0x05,</div><div class="line">    APP_LED_MODE_CHARGING_COMPLETE      = 0x06,</div><div class="line">    APP_LED_MODE_CHARGING_ERROR         = 0x07,</div><div class="line">    APP_LED_MODE_OTA_PAIRING            = 0x08,</div><div class="line">    APP_LED_MODE_FACTORY_RESET          = 0x09,</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="dongle-r411-basic-supported-modules"></a>
4.11 Basic supported modules</h3>
<ul>
<li>PWM<ul>
<li><a class="el" href="_a_n021__p_w_m__application__note.html#PWM_Page">PWM Function Application Note </a></li>
</ul>
</li>
<li>HW Timer<ul>
<li>HW Timers are highly precise. You can use them when you do isochronous actions.</li>
<li><a class="el" href="group___a_p_p___h_w___t_i_m_e_r.html">App Hw Timer</a></li>
</ul>
</li>
<li>GPIO<ul>
<li><a class="el" href="_u_m012__i_o__d_e_m_o.html#IO_Demo_App_Page">IO User Manual </a></li>
</ul>
</li>
<li>KEY<ul>
<li><a class="el" href="_a_n014__k_e_y__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#KEY_Page">KEY Function Application Note </a></li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="dongle-r412-data-stream"></a>
4.12 Data stream</h3>
<p>We can think of the system from the data stream perspective: <br />
</p><ul>
<li>1. bt data stream <br />
</li>
<li>2. io data stream <br />
</li>
<li>3. storage data stream <br />
</li>
<li>4. dsp audio/voice data stream <br />
</li>
</ul>
<div class="image">
<img src="data_stream.png" alt="data_stream.png"/>
</div>
<center><div id="figure_4_10"><b>Figure 4-10 Data Stream Flow </b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="dongle-r5-main-process"></a>
5 Main Process</h2>
<h3><a class="anchor" id="dongle-r51-system-startup"></a>
5.1 System startup</h3>
<p>There are several causes of MCU reboot: PoR (Power-on reset), Power-down wakeup and WDT (Watchdog timer) timeout. <br />
 When MCU reboot happens, the processor executes the first code in ROM. <br />
 The ROM code copies some Patch code to internal RAM and runs its initialization code. <br />
 Then the ROM or Patch code verifies various images in Flash and execute the image code. <br />
 At last, the ROM or Patch code starts up the application in MCUAPP image. <br />
</p>
<h3><a class="anchor" id="dongle-r52-application-startup"></a>
5.2 Application startup</h3>
<p>Before app <b><a class="el" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Entry of APP code. ">main()</a></b>, there are two startup routines <b>Reset_Handler()</b> and <b>system_init()</b> that perform any initialization work required before calling app <b><a class="el" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Entry of APP code. ">main()</a></b> function. <br />
 In <b>system_init()</b> of system_rtl87x3.c, <b><a class="el" href="group___h_a_l__87x3d___s_y_s_t_e_m___s_t_a_t_u_s___a_p_i___exported___functions.html#gaa4f0575fd9e0aafca17a35441d9a3d2a" title="init upperstack ">sys_hall_upperstack_ini()</a></b> is called to start BT upperstack. <br />
</p>
<p>In the app <b><a class="el" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Entry of APP code. ">main()</a></b> function, a series of modules is initialized. <br />
</p>
<div class="image">
<img src="app_startup.png" alt="app_startup.png"/>
</div>
<center><div id="figure_5_1"><b>Figure 5-1 App Startup Flow </b></div></center><p>At the end of app <b><a class="el" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Entry of APP code. ">main()</a></b>, app task and OS scheduler are started. <br />
 App task will receive a variety of messages and the corresponding message handlers will be invoked. <br />
</p>
<p>After app task and OS scheduler start up, the app task will receive BT_EVENT_READY message when the stack initialization is done, then it calls app_mmi_handle_action(MMI_DEV_POWER_ON) to start framework power mgr. <br />
 SYS_EVENT_POWER_ON message will be emitted by framework and app task will do some power related actions after receiving this message. <br />
 For more details, please refer to app_device.c <br />
</p>
<h3><a class="anchor" id="dongle-r53-app-task-message-loop"></a>
5.3 App task message loop</h3>
<div class="image">
<img src="app_task_msg_loop.png" alt="app_task_msg_loop.png"/>
</div>
<center><div id="figure_5_2"><b>Figure 5-2 App Task Message Loop </b></div></center><p>App task receives messages from various modules: BT stack, Framework, IO module. <br />
 It doesn't directly handle the messages from BT stack and Framework. <br />
 It just calls the BT stack APIs and Framework APIs to handle the messages, and then Framework and BT stack will invoke app's callbacks that are registered during app initialization. <br />
</p>
<div class="image">
<img src="app_interactive.png" alt="app_interactive.png"/>
</div>
<center><div id="figure_5_3"><b>Figure 5-3 App, Framework and upperstack/gap </b></div></center><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_task(<span class="keywordtype">void</span> *pvParameters)</div><div class="line">{</div><div class="line">    uint8_t event;</div><div class="line"></div><div class="line">    bt_adap_start_task(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#ga1dc336635d2a407d06df2101d4208c43">audio_evt_queue_handle</a>, <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gae608acf4da9aeedaf885f18e8b91eefc">audio_io_queue_handle</a>, <a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#gaaf45be3842e5882f90db4267ffbfe036">MAX_NUMBER_OF_GAP_MESSAGE</a>);</div><div class="line">    app_usb_layer_init();</div><div class="line"><span class="preprocessor">#if DONGLE_LE_AUDIO</span></div><div class="line">    app_le_audio_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    ble_service_mgr_init(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#ga1dc336635d2a407d06df2101d4208c43">audio_evt_queue_handle</a>, <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gae608acf4da9aeedaf885f18e8b91eefc">audio_io_queue_handle</a>);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef APP_LATENCY_MEASURE_PIN_REUSE</span></div><div class="line">    <span class="comment">//latency_measure_pin_reuse_init();</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___o_s__87x3d___message.html#ga10998e34fdfdd3297af840e60d03b09b">os_msg_recv</a>(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#ga1dc336635d2a407d06df2101d4208c43">audio_evt_queue_handle</a>, &amp;event, 0xFFFFFFFF) == <span class="keyword">true</span>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___m_s_g___exported___types.html#gabe0f8f9b88e43b5899548e9b1247cbfb">EVENT_GROUP</a>(event) == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga43f50ce527e4dfb45fec14124060cd48a0cdd31cbb0e50228edad06b4a1d1adfd">EVENT_GROUP_IO</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> io_msg;</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___o_s__87x3d___message.html#ga10998e34fdfdd3297af840e60d03b09b">os_msg_recv</a>(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gae608acf4da9aeedaf885f18e8b91eefc">audio_io_queue_handle</a>, &amp;io_msg, 0) == <span class="keyword">true</span>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (event == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggae013f504d288fa3c19ec0f1af745975ca54fa1d4504aab64b0e290572ad56a13e">EVENT_IO_TO_APP</a>)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="group___a_p_p___i_o___m_s_g.html#gab3416cc2898ca3f036749335997d4841">app_io_handle_msg</a>(io_msg);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___m_s_g___exported___types.html#gabe0f8f9b88e43b5899548e9b1247cbfb">EVENT_GROUP</a>(event) == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga43f50ce527e4dfb45fec14124060cd48a68015f69fe03c89bfab96d75c108d0e9">EVENT_GROUP_STACK</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#gadc91ccdf8fda07b12ab307882d2b8b7d">gap_handle_msg</a>(event);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___m_s_g___exported___types.html#gabe0f8f9b88e43b5899548e9b1247cbfb">EVENT_GROUP</a>(event) == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga43f50ce527e4dfb45fec14124060cd48a09543b3091008504c7bad75d70d0d168">EVENT_GROUP_FRAMEWORK</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#ga25d19b4ba80245203fc7db6a8be1e6c3">sys_mgr_event_handle</a>(event);</div><div class="line">            }</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___d_l_p_s___exported___functions.html#ga034420ab656a4b9286d7bf35e149a16a">app_dlps_enable</a>(APP_DLPS_ENTER_CHECK_MSG);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="dongle-r54-mmi-actions"></a>
5.4 MMI actions</h3>
<p>There are many MMI actions, but in dongle project, only a few actions are used. <br />
</p>
<div class="fragment"><div class="line">MMI_DEV_POWER_ON = 0x54,</div><div class="line">MMI_DEV_POWER_OFF = 0x56,</div><div class="line">...</div><div class="line"></div><div class="line">MMI_DONGLE_LINK1_KEY_LONG_PRESS  = 0xF2,</div><div class="line">MMI_DONGLE_LINK1_KEY_SHORT_PRESS = 0xF3,</div><div class="line">MMI_DONGLE_LINK2_KEY_LONG_PRESS  = 0xF4,</div><div class="line">MMI_DONGLE_LINK2_KEY_SHORT_PRESS = 0xF5,</div><div class="line">MMI_DONGLE_WORKING_MODE_CHANGE   = 0xF6,</div></div><!-- fragment --><p>The table 5-1 shows the default mmi action in gaming dongle.</p>
<center><div id="table_5_1"><b>Table 5-1 Gaming Dongle MMI Actions list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">MMI Actions  </th><th class="markdownTableHeadNone">Mode  </th><th class="markdownTableHeadNone">State  </th><th class="markdownTableHeadNone">Action   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMI_DONGLE_WORKING_MODE_CHANGE  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Switch To BIS   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Switch To CIS   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Switch To BR/EDR   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK1_KEY_LONG_PRESS  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Scan BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Scan CIS device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK1_KEY_SHORT_PRESS  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Reconnect BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">Connected  </td><td class="markdownTableBodyNone">Disconnect BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Start Broadcast   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">Broadcasting  </td><td class="markdownTableBodyNone">Stop Broadcast   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Reconnect CIS device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">Connected  </td><td class="markdownTableBodyNone">Disconnect CIS device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK2_KEY_LONG_PRESS  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Scan 2nd BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK2_KEY_SHORT_PRESS  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Reconnect <br />
2nd BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">Connected  </td><td class="markdownTableBodyNone">Disconnect <br />
2nd BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
</table>
<p>The table 5-2 shows the default mmi action in general and teams dongle.</p>
<center><div id="table_5_2"><b>Table 5-2 General &amp;&amp; Teams Dongle MMI Actions list </b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">MMI Actions  </th><th class="markdownTableHeadNone">Mode  </th><th class="markdownTableHeadNone">State  </th><th class="markdownTableHeadNone">Action   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMI_DONGLE_WORKING_MODE_CHANGE  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Switch To BIS   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Switch To CIS   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Switch To BR/EDR   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK1_KEY_LONG_PRESS  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Scan BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">Scan CIS device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK1_KEY_SHORT_PRESS  </td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Reconnect BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BR/EDR  </td><td class="markdownTableBodyNone">Connected  </td><td class="markdownTableBodyNone">Disconnect BR/EDR device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Start Broadcast   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">BIS  </td><td class="markdownTableBodyNone">Broadcasting  </td><td class="markdownTableBodyNone">Stop Broadcast   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">IDLE  </td><td class="markdownTableBodyNone">Reconnect CIS device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CIS  </td><td class="markdownTableBodyNone">Connected  </td><td class="markdownTableBodyNone">Disconnect CIS device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK2_KEY_LONG_PRESS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">MMI_DONGLE_LINK2_KEY_SHORT_PRESS  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA  </td><td class="markdownTableBodyNone">NA   </td></tr>
</table>
<p>The main MMI handle entry is <b><a class="el" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09" title="App need to process key message are handle in this function. User trigger the specific key process...">app_mmi_handle_action()</a></b>. <br />
 This function is called wherever you want to do a MMI action. <br />
 Such as when you detect power applied, you can call <b>app_mmi_handle_action(MMI_DEV_POWER_ON)</b> to do customized software power sequence. <br />
 NOTE: You must implement the code for MMI_DEV_POWER_ON case in <b><a class="el" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09" title="App need to process key message are handle in this function. User trigger the specific key process...">app_mmi_handle_action()</a></b> <br />
</p>
<p>For the key MMI action, the user just needs to configure the app_cfg_const.key table[2][9][8]. <br />
 For example, <br />
</p>
<div class="fragment"><div class="line"><a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga393ab9a24c3a115ecce9e496edfac608">key_table</a>[0][0][<a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggae89dd5598d6962f0315e94850daa5027ab06c98e0690323281de57d04b23539b6">KEY0</a>] = MMI_DONGLE_WORKING_MODE_CHANGE;</div><div class="line"><a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga393ab9a24c3a115ecce9e496edfac608">key_table</a>[0][0][<a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggae89dd5598d6962f0315e94850daa5027aa2a969defdcf0e12ab262fc2526bbb62">KEY1</a>] = MMI_DONGLE_LINK1_KEY_SHORT_PRESS;</div><div class="line"><a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga393ab9a24c3a115ecce9e496edfac608">key_table</a>[1][0][<a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggae89dd5598d6962f0315e94850daa5027aa2a969defdcf0e12ab262fc2526bbb62">KEY1</a>] = MMI_DONGLE_LINK1_KEY_LONG_PRESS;</div><div class="line"><a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga393ab9a24c3a115ecce9e496edfac608">key_table</a>[0][0][<a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggae89dd5598d6962f0315e94850daa5027a11fd81feb2ad8559d86dfe9752381a92">KEY2</a>] = MMI_DONGLE_LINK2_KEY_SHORT_PRESS;</div><div class="line"><a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga393ab9a24c3a115ecce9e496edfac608">key_table</a>[1][0][<a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggae89dd5598d6962f0315e94850daa5027a11fd81feb2ad8559d86dfe9752381a92">KEY2</a>] = MMI_DONGLE_LINK2_KEY_LONG_PRESS;</div></div><!-- fragment --><p>The first index is 0 or 1. The value 0 represents key short press. The value 1 represents key long press. <br />
 The second index is always zero for dongle. The third index is key index. <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="dongle-r6-development"></a>
6 Development</h2>
<h3><a class="anchor" id="dongle-r61-quick-start"></a>
6.1 Quick start</h3>
<h4><a class="anchor" id="dongle-r611-compilation"></a>
6.1.1 Compilation</h4>
<p>If user wants to develop gaming dongle, please choose dongle_bank0_bb2_ccut_gaming target in dongle_rtl87x3e.uvprojx. <br />
 Besides, there are two other targets: dongle_bank0_bb2_ccut_general and dongle_bank0_bb2_ccut_teams. They all support HFP for bidirectional audio. <br />
</p>
<h4><a class="anchor" id="dongle-r612-download-images"></a>
6.1.2 Download images</h4>
<p>We have a utility that is placed in tool/MPPGTool to download the prebuilt images and application image. <br />
 Refer to MPPGTool</p>
<h3><a class="anchor" id="dongle-r62-evb-introduction"></a>
6.2 EVB Introduction</h3>
<p>Refer to <a class="el" href="_u_m001__q_u_i_c_k__s_t_a_r_t.html#Quick_Start">Quick Start User Guide </a> <br />
 The introduction helps user to set up the development and debugging environment quickly. <br />
 The dongle project uses three LEDs and KEYs. <br />
 Their connections are shown as below:</p>
<div class="fragment"><div class="line"><a class="code" href="group__x3d___r_t_l876_x___pin___number.html#ga3d767e16f12a6ee542079f3c9677192c">ADC_1</a>(<a class="code" href="group__x3d___r_t_l876_x___pin___number.html#ga6e605c856305ec72ac000d8cc45ab0b9">P0_1</a>): <a class="code" href="group__x3e___p_a_d___function___config.html#gga1e9a8598118641671df650c8a1699e68aa688958b70395170ecf516290f2634a5">LED0</a></div><div class="line"><a class="code" href="group__x3d___r_t_l876_x___pin___number.html#ga0a5c0ef038f9728173ca136eed5c9cd2">P1_0</a>: <a class="code" href="group__x3e___p_a_d___function___config.html#gga1e9a8598118641671df650c8a1699e68adac6477842247cab1a8c02c65f431b44">LED1</a></div><div class="line"><a class="code" href="group__x3d___r_t_l876_x___pin___number.html#gaaae6a77f4b93ec74cb11947217dd8fd1">P2_1</a>: <a class="code" href="group__x3e___p_a_d___function___config.html#gga1e9a8598118641671df650c8a1699e68a8379bbaa96d151e6adac488b2a147b7a">LED2</a></div><div class="line"></div><div class="line">KEY_0: MFB</div><div class="line">KEY_1: <a class="code" href="group__x3d___r_t_l876_x___pin___number.html#gaa7c3cebcd9dc4598bb69e51ecee85bd0">P1_1</a></div><div class="line">KEY_2: <a class="code" href="group__x3d___r_t_l876_x___pin___number.html#ga9216eb7ac06cf1906b8c3e6884943b5e">P2_2</a></div></div><!-- fragment --><p>When power is applied to EVB, the app <b><a class="el" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Entry of APP code. ">main()</a></b> will finally be executed and LED0 keeps on. <br />
 If user presses MFB key, the working mode will change and the LED0 will change to the corresponding mode. <br />
 LED0 keeps on: Legacy Gaming/General mode <br />
 LED0 flashes slowly: Broadcast mode <br />
 LED0 flashes quickly: Unicast Source mode <br />
</p>
<p>In Legacy Gaming mode, KEY_1 is used to establish the BR/EDR ACL connection while KEY_2 is used to establish the second connection. <br />
 In Legacy General mode, only one connection can be set up with KEY_1. KEY_2 is not used. <br />
 In Broadcast mode, only KEY_1 is used to start/stop broadcasting. <br />
 In Unicast Source mode, only KEY_1 is used to auto pairing with a remote device or reconnect to the bonded device. <br />
</p>
<p>In Legacy gaming mode or Unicast source mode, long press key will start pairing process. <br />
 Dongle will create bond with the remote device whose advertising data contains UUID ASCS. <br />
 Short press key will trigger reconnection if there is a bond between dongle and the remote device. <br />
</p>
<h3><a class="anchor" id="dongle-r63-print-log"></a>
6.3 Print log for debugging</h3>
<p>Log is transmitted via P2_0 that is UART TX from dongle perspective. The default baudrate is 2M. <br />
 The Log tool is a Windows program which is placed in tool/DebugAnalyzer. <br />
 In order to show the readable log in the tool, some traces should be added. <br />
</p>
<div class="fragment"><div class="line">settings:</div><div class="line">App trace file: dongle_bank0.trace</div><div class="line">DSP trace files: DSP_APP.trace, DSP_SDK_AUDIO.trace, DSP_SDK_VOICE.trace</div></div><!-- fragment --><ul>
<li>DebugAnalyser</li>
</ul>
<h3><a class="anchor" id="dongle-r64-mcuconfig"></a>
6.4 MCUConfig</h3>
<p>MCUConfig contains three images that are generated by MCUConfig Tool. <br />
 The images are CFG_RTL8763EAU_xxx.bin, APP_RTL8763EAU_xxx.bin and VPData_RTL8763EAU_xxx.bin <br />
 User can configure Bluetooth Device Address, KEY mappings, LED mappings, etc., with this tool. <br />
</p>
<ul>
<li>MCUConfigTool</li>
</ul>
<h3><a class="anchor" id="dongle-r65-troubleshooting"></a>
6.5 Troubleshooting</h3>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
