<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="Device_Page"></a>
Device Function Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.0.0.1</b></center><p><br />
 </p><center><b>2023/04/18</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Device_Page_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2023/04/18  </td><td class="markdownTableBodyCenter">Modify some format   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page_Rev">Revision History</a></li>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page_Table_List">Table List</a></li>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page_Source_Code_Overview">2 Source Code Overview</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Device_Page_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Device_Page_Figure_List"></a>
Figure List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Device_Page_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Device_Page_Introduction"></a>
1 Introduction</h2>
<p>The purpose of this document is to give an overview of app device manage. <br />
 It is consist of several callback function mainly.</p><ol type="1">
<li>app_device_dm_cback <br />
 a. App execute app_mmi_handle_action(MMI_DEV_POWER_ON or MMI_DEV_POWER_OFF), <br />
 &#160;&#160;&#160;last call sys_mgr_power_on or sys_mgr_power_off to framework. <br />
 b. Framework handle the sys_mgr_power_on or sys_mgr_power_off, then post <br />
 &#160;&#160;&#160;system event SYS_EVENT_POWER_ON and SYS_EVENT_POWER_OFF to app device. <br />
 c. App device execute module startup or shutdown, such as bt policy and so on. <br />
 <br />
</li>
<li>app_device_bt_cback <br />
 a. Framework post bt stack event to app, such as BT_EVENT_READY after reboot. <br />
 b. When receive BT_EVENT_READY, app device execute power on or go to power down. <br />
 <br />
</li>
<li>app_device_link_policy_ind <br />
 a. When receive SYS_EVENT_POWER_ON, app device execute the app_bt_policy_startup. <br />
 b. The bt policy module would post link related event to app device, <br />
 &#160;&#160;&#160;such as BP_EVENT_STATE_CHANGED and BP_EVENT_RADIO_MODE_CHANGED. <br />
 c. App device would handle the bt policy event to do ui action, ex. led and vp. <br />
 <br />
</li>
<li>app_device_relay_cback and app_device_parse_cback <br />
 a. Handle b2b relay info of device. <br />
</li>
</ol>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Device_Page_Source_Code_Overview"></a>
2 Source Code Overview</h2>
<p>This section discribes the main parts of device source code.</p>
<h3>Main event handle</h3>
<div class="fragment"><div class="line"><span class="comment">//system event handle</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_device_dm_cback(<a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#ga17c64f28c161ee1a43e988bbf7aa08ba">T_SYS_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#gga58c18773b27c0caf62739de85017a0a8a89ffb71e8cb42c90440d17ddf58e9032">SYS_EVENT_POWER_ON</a>:</div><div class="line">        {</div><div class="line">            ......</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga26ee4bfa6bc6384d87ae1dd7a0e6f5e9">app_bt_policy_startup</a>(app_device_link_policy_ind, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">            ......</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#gga58c18773b27c0caf62739de85017a0a8a1ef8ec2159a968408f240fdefc6d1cc9">SYS_EVENT_POWER_OFF</a>:</div><div class="line">        {</div><div class="line">            ......</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga15c15429dae5cb688de8c5500ec4de90">app_bt_policy_shutdown</a>();</div><div class="line"></div><div class="line">            ......</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//bt stack event handle</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_device_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> BT_EVENT_BT_READY:</div><div class="line">        {</div><div class="line">            ......</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (power_on_flg)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___a_p_p___m_m_i.html#gae6ee7d9fbb005ffecdb406cca1d6c24b">app_audio_tone_play</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#adef2bdc67e70a1f4f95e7127765bdcdd">tone_power_on</a>, <span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line">                <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(<a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1babc5c64c8724149c79fa5ad7da4ab036e">MMI_DEV_POWER_ON</a>);</div><div class="line">                <a class="code" href="group___a_p_p___d_l_p_s___exported___functions.html#ga034420ab656a4b9286d7bf35e149a16a">app_dlps_enable</a>(<a class="code" href="group___a_p_p___d_l_p_s___exported___macros.html#ga9736593545da647d1fefb751f23eb9ec">APP_DLPS_ENTER_CHECK_GPIO</a>);</div><div class="line">            }</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.bt_is_ready = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">            ......</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//bt policy (link) event handle</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_device_link_policy_ind(<a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga6e70b8a0cc718188bb90563706f46a0b">T_BP_EVENT</a> event, <a class="code" href="struct_t___b_p___e_v_e_n_t___p_a_r_a_m.html">T_BP_EVENT_PARAM</a> *event_param)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gga6e70b8a0cc718188bb90563706f46a0baf491415f5b1cb1ab86b71289345f47e1">BP_EVENT_STATE_CHANGED</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gga6e70b8a0cc718188bb90563706f46a0ba144b500187f7272fbf59e77e5aa26458">BP_EVENT_RADIO_MODE_CHANGED</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gga6e70b8a0cc718188bb90563706f46a0badf82be05f57961dc56192cb2ba276abf">BP_EVENT_BUD_CONN_START</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    ......</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gga6e70b8a0cc718188bb90563706f46a0baf713aae78f76970f128060db22640790">BP_EVENT_SRC_AUTH_SUC</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    ......</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//b2b device info sync event handle</span></div><div class="line"></div><div class="line">uint16_t app_device_relay_cback(uint8_t *buf, uint8_t msg_type, <span class="keywordtype">bool</span> total)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">switch</span> (msg_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a27d8e40e7522c5c42fa6344192588278">APP_REMOTE_MSG_SYNC_DB</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_device_parse_cback(uint8_t msg_type, uint8_t *buf, uint16_t len, <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gaace2acad12d0cc49aac6a477ccb1c74b">T_REMOTE_RELAY_STATUS</a> status)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (msg_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a27d8e40e7522c5c42fa6344192588278">APP_REMOTE_MSG_SYNC_DB</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a210d30175b523934a138fbbbc6eee14d">APP_REMOTE_MSG_LINK_RECORD_ADD</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a76b02e44a37fcb3b7e929076f970639a">APP_REMOTE_MSG_LINK_RECORD_DEL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31aaa1ca110518404da83ad392d4a98f807">APP_REMOTE_MSG_LINK_RECORD_XMIT</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a14c7aeb8072cca5529c5ca2e7a51cc86">APP_REMOTE_MSG_LINK_RECORD_PRIORITY_SET</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a136f4238e4a7fb2081c409004b57dab1">APP_REMOTE_MSG_DEVICE_NAME_SYNC</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31acdb26869e0f7e73696a1e07a8122eb81">APP_REMOTE_MSG_LE_NAME_SYNC</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga88e86cd39560817dd54ddb25fe6f3d31a19973383830eda0cfe1882a95a4d2a25">APP_REMOTE_MSG_POWERING_OFF</a>:</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
