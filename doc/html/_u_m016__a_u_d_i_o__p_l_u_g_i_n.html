<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="Audio_Plugin_Page"></a>
Audio Plugin User Manual </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.4</b></center><p><br />
 </p><center><b>2023/05/30</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Plugin_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2022/02/25  </td><td class="markdownTableBodyCenter">Initial version   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2022/10/24  </td><td class="markdownTableBodyCenter">Update the occasion description and add images for AMP operation flow   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.2  </td><td class="markdownTableBodyCenter">2022/11/14  </td><td class="markdownTableBodyCenter">Fix the format issue   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.3  </td><td class="markdownTableBodyCenter">2022/12/16  </td><td class="markdownTableBodyCenter">Fix the errata in the code snippet   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.4  </td><td class="markdownTableBodyCenter">2023/05/30  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Rev">Revision History</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Table_List">Table List</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Introduction">1 Introduction</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Policy">2 Policy</a><ul>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Occasion">2.1 Occasion</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Action_Handler">2.2 Action Handler</a></li>
</ul>
</li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_API">3 API</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Sample_Plugin_Instance">4 Sample Plugin Instance</a><ul>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#AMP_Policy">4.1 AMP Policy</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#AMP_Power_On">4.2 AMP Power On Procedure</a></li>
<li><a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#AMP_Power_Off">4.3 AMP Power Off Procedure</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Audio_Plugin_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Audio_Plugin_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_1">Figure 1-1 Audio Subsystem Architecture</a></li>
<li><a href="#figure_1_2">Figure 1-2 Audio Plugin general flow</a></li>
<li><a href="#figure_2_1">Figure 2-1 Audio Plugin Occasions</a></li>
<li><a href="#figure_4_1">Figure 4-1 AMP Power On Procedure</a></li>
<li><a href="#figure_4_2">Figure 4-2 AMP Power Off Procedure</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Audio_Plugin_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AMP  </td><td class="markdownTableBodyCenter">Amplifier   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GPIO  </td><td class="markdownTableBodyCenter">General Purpose Input Output   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">HAL  </td><td class="markdownTableBodyCenter">Hardware Abstraction Layer   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Audio_Plugin_Introduction"></a>
1 Introduction</h2>
<p>Audio Plugin is a module of the audio subsystem. The Figure 1-1 shows a simplified software architecture of the audio subsystem. The whole subsystem consists of application layer, framework and HAL.</p>
<div class="image">
<img src="audio_subsystem_architecture.png" alt="audio_subsystem_architecture.png"/>
</div>
 <center><div id="figure_1_1"><b>Figure 1-1 Audio Subsystem Architecture </b></div></center><p>As shown in Figure 1-1, Audio Plugin interacts with External Device module and Audio Path module. The External Device module locates in application layer. It controls the external device, such as external amplifier and external DSP. The Audio Path module manages the control path of different data streams. It deals with all kinds of SoC internal devices, such as CODEC, SPORT and DSP.</p>
<p>The aim of Audio Plugin is to support cooperations between customized external devices and SoC internal devices. The idea is that external device can be treated as a plugin instance to do some action at some specific occasions which are exposed by Audio Path module. After the action is done, the plugin instance has to inform to the Audio Plugin module, which will inform back to Audio Path module finally, so that the entire control path can be continued from the occasion. This general interaction flow is shown in Figure 1-2.</p>
<div class="image">
<img src="audio_plugin_general_flow.png" alt="audio_plugin_general_flow.png"/>
</div>
 <center><div id="figure_1_2"><b>Figure 1-2 Audio Plugin general flow </b></div></center><div style="page-break-after: always;"></div> <h2><a class="anchor" id="Audio_Plugin_Policy"></a>
2 Policy</h2>
<p>Before explaining the usage of Audio Plugin APIs, the concept of policy has to be introduced first. A policy is a contract between external device and Audio Plugin. It specifies which action should be executed at which occasion of which category of an audio path. The categories, occasions and action handlers are predefined by Audio Plugin and a policy is a combination of them.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structt__audio__plugin__policy.html">t_audio_plugin_policy</a></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#ga08a57466fff5ba405ae41d69a7356578">T_AUDIO_CATEGORY</a>              <a class="code" href="structt__audio__plugin__policy.html#a4fd06d8d59d45363a9f80a2029a4d56c">category</a>;</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga47e273e740ff749390f020ee9133af06">T_AUDIO_PLUGIN_OCCASION</a>       <a class="code" href="structt__audio__plugin__policy.html#a72812d7cd842efc7fc04d13f070f4634">occasion</a>;</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gafcb2e73c3faca2ea4e9281d6a69bc5de">P_AUDIO_PLUGIN_ACTION_HANDLER</a> <a class="code" href="structt__audio__plugin__policy.html#a0755afda947fc733cc31f5a1c83afe58">handler</a>;</div><div class="line">} <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gacac9243e7c9588a46ad38326bf32fa5f">T_AUDIO_PLUGIN_POLICY</a>;</div></div><!-- fragment --><h3><a class="anchor" id="Occasion"></a>
2.1 Occasion</h3>
<p>An occasion describes the internal stages during the lifecyle of an audio path. Generally, a complete audio path involves analog part and digital part. The name of occasion indicates the state of these internal parts. The occasion is defined as below.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga112b710543cbe4f9a88c22f34b5d8adb">t_audio_plugin_occasion</a></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>,</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba6cb49e71440588f74affd35cfe301ac2">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_OFF</a>,</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>,</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>,</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba78ddaf307896c5860ba2b6f88cedf18d">AUDIO_PLUGIN_OCCASION_NUM</a>,</div><div class="line">} <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga47e273e740ff749390f020ee9133af06">T_AUDIO_PLUGIN_OCCASION</a>;</div></div><!-- fragment --><p>The Figure 2-1 shows the relationship of the exposed occasions and the states involved internal device. From the perspective of Audio Path, starting or stopping a path is a sequential operation. When a path is starting, it enables on the internal CODEC, SPORT and DSP in sequence. When a path is stopping, it disables the internal DSP, SPORT and CODEC in sequence. In order to integrate with the internal control flow, the plugin instance shall do right thing at right occasion.</p>
<div class="image">
<img src="audio_plugin_occasion.png" alt="audio_plugin_occasion.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Audio Plugin Occasions </b></div></center><p><b>Note:</b></p><ol type="1">
<li>The <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a> is <b>mandatory</b>.</li>
<li>Since the data stream will come after <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, the plugin instance shall make sure it has been ready for the data stream before giving the acknowledgement for <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>.</li>
</ol>
<h3><a class="anchor" id="Action_Handler"></a>
2.2 Action Handler</h3>
<p>An action handler is defined by external device and registered to Audio Plugin when creating a plugin instance. Here is the prototype of action handler.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structt__audio__plugin__param.html">t_audio_plugin_param</a></div><div class="line">{</div><div class="line">    uint32_t <a class="code" href="structt__audio__plugin__param.html#ae1405c5b5683979cfa1a7e22567d203e">dac_sample_rate</a>;</div><div class="line">    uint32_t <a class="code" href="structt__audio__plugin__param.html#a5beaf1a9134b9c9359965913e429b624">adc_sample_rate</a>;</div><div class="line">} <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gae7994040c59004fe7b3a1bdbc635119a">T_AUDIO_PLUGIN_PARAM</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gafcb2e73c3faca2ea4e9281d6a69bc5de">P_AUDIO_PLUGIN_ACTION_HANDLER</a>)(<a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gaf5b174b6d7b8764cd9c90d9b29becec8">T_AUDIO_PLUGIN_HANDLE</a> handle,</div><div class="line">                                              <a class="code" href="structt__audio__plugin__param.html">T_AUDIO_PLUGIN_PARAM</a>  param,</div><div class="line">                                              <span class="keywordtype">void</span>                 *context);</div></div><!-- fragment --><p>The action handler, as well as the policy, is designed and applied per audio path so that some information of the audio path can be passed to external device. Currently, Audio Plugin will pass the sample rates in TX/RX direction of an audio path as a parameter. The external device can use this parameter if interests.</p>
<p>The context parameter of action handler is used for a handshake between Audio Plugin and external device. It tracks the current policy and its related audio path. The <b>context</b> parameter shall be reserved and passed back when informing Audio Plugin that the action of current policy has been finished.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Audio_Plugin_API"></a>
3 API</h2>
<div class="fragment"><div class="line"><a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gaf5b174b6d7b8764cd9c90d9b29becec8">T_AUDIO_PLUGIN_HANDLE</a> <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga3f3eeeb9a5716ad19781d0837fe2e9c5">audio_plugin_create</a>(<span class="keyword">const</span> <a class="code" href="structt__audio__plugin__policy.html">T_AUDIO_PLUGIN_POLICY</a> *policies, uint32_t count)</div></div><!-- fragment --><p> Create a plugin instance for external device via registering a policy table. This API shall be invoked successfully first so that a plugin instance handle can be returned for further operations.</p>
<p><b>Note:</b> The policy table cannot be empty.</p>
<p>See a sample code snippet as below: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> app_amp_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">//...</span></div><div class="line">    app_amp_db.plugin_handle = <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga3f3eeeb9a5716ad19781d0837fe2e9c5">audio_plugin_create</a>(app_amp_policies,</div><div class="line">                                                   <span class="keyword">sizeof</span>(app_amp_policies) / <span class="keyword">sizeof</span>(app_amp_policies[0]));</div><div class="line">    <span class="keywordflow">if</span> (app_amp_db.plugin_handle == <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">    <span class="comment">//...</span></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --><p> <br />
 </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga23075fea6afa94912ff29c4428a1e4d5">audio_plugin_msg_send</a>(<a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gaf5b174b6d7b8764cd9c90d9b29becec8">T_AUDIO_PLUGIN_HANDLE</a> handle, <span class="keywordtype">void</span> *context)</div></div><!-- fragment --><p> Inform Audio Plugin that the registered action has been completed. The internal control flow of an audio path will be blocked when an occasion (see <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga47e273e740ff749390f020ee9133af06">T_AUDIO_PLUGIN_OCCASION</a>) occurs, waiting for external device to execute its registered action. When the action is completed, this API shall be invoked so that the internal control flow of the audio path can be continued.</p>
<p>As mentioned before, the <b>context</b> parameter shall be the same as that in <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gafcb2e73c3faca2ea4e9281d6a69bc5de">P_AUDIO_PLUGIN_ACTION_HANDLER</a>.</p>
<p>See a sample code snippet as below: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_amp_poweron(<a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gaf5b174b6d7b8764cd9c90d9b29becec8">T_AUDIO_PLUGIN_HANDLE</a> handle, <a class="code" href="structt__audio__plugin__param.html">T_AUDIO_PLUGIN_PARAM</a> param, <span class="keywordtype">void</span> *context)</div><div class="line">{</div><div class="line">    app_amp_db.ref_cnt++;</div><div class="line">    <span class="keywordflow">if</span> (app_amp_db.state == APP_AMP_STATE_ON)</div><div class="line">    {</div><div class="line">        <span class="comment">// already powered on, send the context back immediatelly</span></div><div class="line">        <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga23075fea6afa94912ff29c4428a1e4d5">audio_plugin_msg_send</a>(app_amp_db.plugin_handle, context);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="comment">// save the context parameter</span></div><div class="line">        app_amp_db.poweron_context = context;</div><div class="line"></div><div class="line">        <span class="comment">// start the AMP private power on flow</span></div><div class="line">        power_on_step_1();</div><div class="line">        power_on_step_2();</div><div class="line">        ...</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_amp_power_on_finished_callback()</div><div class="line">{</div><div class="line">    <span class="comment">// send the context back when the power on flow is finished</span></div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga23075fea6afa94912ff29c4428a1e4d5">audio_plugin_msg_send</a>(app_amp_db.plugin_handle, app_amp_db.poweron_context);</div><div class="line">}</div></div><!-- fragment --><p> <br />
 </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gacd89bcea4db9dcfac83554da8ea7e608">audio_plugin_release</a>(<a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gaf5b174b6d7b8764cd9c90d9b29becec8">T_AUDIO_PLUGIN_HANDLE</a> handle)</div></div><!-- fragment --><p> Release the plugin instance for external device when the external device is no longer in need.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Sample_Plugin_Instance"></a>
4 Sample Plugin Instance</h2>
<p>The sdk/src/sample/rws/app_amp.c implements an external analog amplifier (AMP) as a sample plugin instance using the Audio Plugin module. The AMP can be controlled via a GPIO switch. It shall be powered on before playing any audio stream and be powered off when no audio stream is to play. Due to some restricts from hardware side, it is required that there is some delay during the power on and power off procedure. In software side, this delay requirement is implemented via 2 timers for power on procedure and 1 timer for power off procedure.</p>
<h3><a class="anchor" id="AMP_Policy"></a>
4.1 AMP Policy</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structt__audio__plugin__policy.html">T_AUDIO_PLUGIN_POLICY</a> app_amp_policies[] =</div><div class="line">{</div><div class="line">    <span class="comment">/* category */</span>          <span class="comment">/* occasion */</span>                           <span class="comment">/* action handler */</span></div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aeca4bbe9e7764f82eab4de6cdef426f5">AUDIO_CATEGORY_AUDIO</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853ade5c1710831738190b0f68997660607c">AUDIO_CATEGORY_VOICE</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a8d9bd79371a962a610f6d83fb1bed012">AUDIO_CATEGORY_ANALOG</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853ae9f9a86f48a62f86a395b47a9e0fbd18">AUDIO_CATEGORY_TONE</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aa923322de586f1a0d9722e4c685e2198">AUDIO_CATEGORY_VP</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a30659073d87906f7194f378f3648b30b">AUDIO_CATEGORY_LLAPT</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a0d98bd2293d896fc33a3a3b842d465fd">AUDIO_CATEGORY_ANC</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a>, app_amp_poweron },</div><div class="line"></div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aeca4bbe9e7764f82eab4de6cdef426f5">AUDIO_CATEGORY_AUDIO</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853ade5c1710831738190b0f68997660607c">AUDIO_CATEGORY_VOICE</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a8d9bd79371a962a610f6d83fb1bed012">AUDIO_CATEGORY_ANALOG</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853ae9f9a86f48a62f86a395b47a9e0fbd18">AUDIO_CATEGORY_TONE</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aa923322de586f1a0d9722e4c685e2198">AUDIO_CATEGORY_VP</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a30659073d87906f7194f378f3648b30b">AUDIO_CATEGORY_LLAPT</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a0d98bd2293d896fc33a3a3b842d465fd">AUDIO_CATEGORY_ANC</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a>, app_amp_run },</div><div class="line"></div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aeca4bbe9e7764f82eab4de6cdef426f5">AUDIO_CATEGORY_AUDIO</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853ade5c1710831738190b0f68997660607c">AUDIO_CATEGORY_VOICE</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a8d9bd79371a962a610f6d83fb1bed012">AUDIO_CATEGORY_ANALOG</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853ae9f9a86f48a62f86a395b47a9e0fbd18">AUDIO_CATEGORY_TONE</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aa923322de586f1a0d9722e4c685e2198">AUDIO_CATEGORY_VP</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a30659073d87906f7194f378f3648b30b">AUDIO_CATEGORY_LLAPT</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">    { <a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a0d98bd2293d896fc33a3a3b842d465fd">AUDIO_CATEGORY_ANC</a>, <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a>, app_amp_poweroff },</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_amp_run(<a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gaf5b174b6d7b8764cd9c90d9b29becec8">T_AUDIO_PLUGIN_HANDLE</a> handle, <a class="code" href="structt__audio__plugin__param.html">T_AUDIO_PLUGIN_PARAM</a> param, <span class="keywordtype">void</span> *context)</div><div class="line">{</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_l_u_g_i_n.html#ga23075fea6afa94912ff29c4428a1e4d5">audio_plugin_msg_send</a>(handle, context);</div><div class="line">}</div></div><!-- fragment --><p>As the code snippet shows, the AMP shall be powered on at the <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adba94a6e1f66d5dd757aca005f815e2ecd6">AUDIO_PLUGIN_OCCASION_ANALOG_DOMAIN_ON</a> occasion, and be powered off at the <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbad5efba1fff174c4e05d44bb749ff31fe">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_OFF</a> occasion. This rule applies for all the listed categories from <a class="el" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853aeca4bbe9e7764f82eab4de6cdef426f5">AUDIO_CATEGORY_AUDIO</a> to <a class="el" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a0d98bd2293d896fc33a3a3b842d465fd">AUDIO_CATEGORY_ANC</a>.</p>
<p>The <a class="el" href="group___a_u_d_i_o___p_l_u_g_i_n.html#gga112b710543cbe4f9a88c22f34b5d8adbafbcc3bcadc83ba67e306d282462fed96">AUDIO_PLUGIN_OCCASION_DIGITAL_DOMAIN_ON</a> is also registered because it is mandatory, even though there is no actual work to do except completing the handshake.</p>
<div style="page-break-after: always;"></div> <h3><a class="anchor" id="AMP_Power_On"></a>
4.2 AMP Power On Procedure</h3>
<p>The Figure 4-1 shows the power on procedure of AMP. Note that it shall save the context if it was in OFF state originally.</p>
<div class="image">
<img src="audio_plugin_amp_poweron_flow.png" alt="audio_plugin_amp_poweron_flow.png"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 AMP Power On Procedure </b></div></center><h3><a class="anchor" id="AMP_Power_Off"></a>
4.3 AMP Power Off Procedure</h3>
<p>The Figure 4-2 shows the power off procedure of AMP. Note that it shall save the context if it was in ON state originally.</p>
<div class="image">
<img src="audio_plugin_amp_poweroff_flow.png" alt="audio_plugin_amp_poweroff_flow.png"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 AMP Power Off Procedure </b></div></center> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
