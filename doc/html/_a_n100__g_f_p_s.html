<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="GFPS_Page"></a>
GFPS Application Note    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/06/30 </b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_REV"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/05/30  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/06/30  </td><td class="markdownTableBodyCenter">Modify Doc Structure   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_REV">Revision History</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Table_List">Table List</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Configuration">2 Enable GFPS Feature</a><ul>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_ENABLE_GFPS_CFG_TOOL">2.1 How To Enable GFPS in Mcu Config Tool</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_Add_file">2.2 How To add GFPS Files into rws Project</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_CFG_Keil">2.3 How To Set up GFPS Environment in Keil Project</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_ADD_GFPS_LIB">2.4 How To Add gfps lib into rws Project</a></li>
</ul>
</li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Initialization_process">3 Initialization Process</a><ul>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_Pair_Mode">3.1 In Paring Mode</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_NON_PAIR_Mode">3.2 Not In Pairing Mode</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_CB">3.3 APP Callback</a></li>
</ul>
</li>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_user_interaction">4 User Interaction</a><ul>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_Initial_Pair">4.1 Initial Pairing</a></li>
<li><a class="el" href="_a_n100__g_f_p_s.html#AN100_Subsequent_Pair">4.2 Subsequent Pairing</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 Mcu Config Tool Enable GFPS</a></li>
<li><a href="#figure_2_2">Figure 2-2 GFPS Lib Add Include Files</a></li>
<li><a href="#figure_2_3">Figure 2-3 App GFPS Add Files</a></li>
<li><a href="#figure_2_4">Figure 2-4 Build GFPS Lib in Keil</a></li>
<li><a href="#figure_2_5">Figure 2-5 Build GFPS in Keil</a></li>
<li><a href="#figure_2_6">Figure 2-6 Add gfps.lib into RTL87x3e</a></li>
<li><a href="#figure_2_7">Figure 2-7 Add gfps.lib into RTL87x3d</a></li>
<li><a href="#figure_2_8">Figure 2-8 Add gfps.lib into RTL87x3g</a></li>
<li><a href="#figure_3_1">Figure 3-1 GFPS Flow</a></li>
<li><a href="#figure_4_1">Figure 4-1 Initial Pairing</a></li>
<li><a href="#figure_4_2">Figure 4-2 Subsequent Pairing</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BLE  </td><td class="markdownTableBodyCenter">Bluetooth Low Energy   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GAP  </td><td class="markdownTableBodyCenter">Generic Access Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">GATT  </td><td class="markdownTableBodyCenter">Generic Attribute Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GFPS  </td><td class="markdownTableBodyCenter">Google Fast Pair Service   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_Introduction"></a>
1 Introduction</h2>
<p>GFPS is initially aimed to facilitate pairing of bluetooth devices, such as speakers, headphones and car kits, with as little user interaction required as possible. GFPS profile defines two roles:</p><ul>
<li>Fast Pair Seeker<br />
 The Seeker is normally a phone, looking for a device to pair with. <br />
<br />
</li>
<li>Fast Pair Provider<br />
 The Provider is a device that is advertising its presence and readiness to pair (e.g. a discoverable pair of headphones). To facilitate device discovery, the Fast Pair Provider shall advertise a payload indicating support for the Google Fast Pair Service (with data as described below). The Fast Pair Seeker shall periodically scan for and observe the presence of Fast Pair Provider advertising frames, and take action if interested.</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_Configuration"></a>
2 Enable GFPS Feature</h2>
<h3><a class="anchor" id="AN100_ENABLE_GFPS_CFG_TOOL"></a>
2.1 How To Enable GFPS in Mcu Config Tool</h3>
<p>GFPS feature should be enabled by MCU Config tool. The steps are as follows: </p><div class="image">
<img src="mcu_cfg_tool_enable_gfps.jpg" alt="mcu_cfg_tool_enable_gfps.jpg"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Mcu Config Tool Enable GFPS </b></div></center><ol type="1">
<li>Transport:<ul>
<li>LE: must be checked, otherwise the GFPS advertising will not be advertised, and there will be no GFPS function, which is equivalent to the enable/disable GFPS function.</li>
<li>RFCOMM: It needs to be checked when passing the certification test. In actual application, it is decided by whether the customer needs functions like "Find me" or "Retroactive with account key" or "report the battery function through RFCOMM". More strictly speaking, as long as the customer wants to use the function of GFPS Extensions, RFCOMM should be checked. If device supports only initial pairing and subsequent pairing, there is no need to check it. <br />
<br />
</li>
</ul>
</li>
<li>Module ID / Anti-spoofing public key/ Anti-spoofing private key (Hex):<br />
 The registered model id, public key and private key must be filled in. These parameters shall not be all zero. Customers need to register these parameters by themselves. The registration address is <a href="https://developers.google.com/nearby/devices/">https://developers.google.com/nearby/devices/</a> <br />
<br />
</li>
<li>Battery info enable: <br />
If this option is checked, the battery reporting function will be enabled, the battery information will be included in the GFPS advertising data, and the mobile phone will display the battery level of the headset by scanning the GFPS advertising data.<ul>
<li>Battery show ui: Display battery information on the mobile phone interface, checked by default</li>
<li>Battery remain time enable: Currently this function is not supported, no need to check</li>
<li>Left ear / Right ear/ Case battery support: The left ear, right ear and battery box battery information is reported. If Battery info enable is checked, Left ear battery support, Right ear battery support, and Case battery support must be checked. <br />
<br />
</li>
</ul>
</li>
<li>Enable TX power data in adv: <br />
Mobile phone refers the TX power data to measure the distance between mobile phone and device. If the distance exceeds, the GFPS notification window will not pop up. It must be filled in. If the TX power data is already filled when register model id in Google nearby device console page, this value will be ignored by mobile phone. So we recommend not to set tx power when registering model id. <br />
<br />
</li>
<li>Discoverable/Not Discoverable advertising interval (0.625 ms/per unit): <br />
GFPS advertising interval setting, must be filled in.<ul>
<li>Discoverable advertising interval:<br />
 The default value is 32, if this value is set too large, it may affect the efficiency of the initial pairing.</li>
<li>Not Discoverable advertising interval:<br />
 The default value is 100, if want to minimize the power consumption in device idle, you can set the maxmium value to 400, however, it may affect the efficiency of the subsequent pairing. <br />
<br />
</li>
</ul>
</li>
<li>Account Key number: <br />
The maximum number of GFPS account key set which device could store in the FTL, which must be filled in.</li>
</ol>
<h3><a class="anchor" id="AN100_Add_file"></a>
2.2 How To add GFPS Files into rws Project</h3>
<p>Copy gfps files provided in '3rd_service_gfps' to 'sdk/'. </p><div class="image">
<img src="gfps_lib_add_include_files.jpg" alt="gfps_lib_add_include_files.jpg"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 GFPS Lib Add Include Files </b></div></center><div class="image">
<img src="app_gfps_add_files.jpg" alt="app_gfps_add_files.jpg"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 App GFPS Add Files </b></div></center><h3><a class="anchor" id="AN100_CFG_Keil"></a>
2.3 How To Set up GFPS Environment in Keil Project</h3>
<p>app_flags.h set GFPS_FEATURE_SUPPORT to 1: </p><div class="fragment"><div class="line"><span class="preprocessor">#define GFPS_FEATURE_SUPPORT            1</span></div></div><!-- fragment --><p> <br />
<br />
 Enable build gfps_lib in keil project: <br />
 find gfps_lib in keil project &ndash;&gt; right click &ndash;&gt; Options for File 'gfps_lib' &ndash;&gt; Tick in front of include in Target Build </p><div class="image">
<img src="build_gfps_lib.jpg" alt="build_gfps_lib.jpg"/>
<div class="caption">
.</div></div>
 <center><div id="figure_2_4"><b>Figure 2-4 Build GFPS Lib in Keil </b></div></center><p> <br />
<br />
 Enable build gfps in keil project: <br />
 find gfps in keil project &ndash;&gt; right click &ndash;&gt; Options for Group 'gfps' &ndash;&gt; Tick in front of include in Target Build </p><div class="image">
<img src="build_gfps.jpg" alt="build_gfps.jpg"/>
</div>
 <center><div id="figure_2_5"><b>Figure 2-5 Build GFPS in Keil </b></div></center><h3><a class="anchor" id="AN100_ADD_GFPS_LIB"></a>
2.4 How To Add gfps lib into rws Project</h3>
<p>RTL87x3e: <br />
 add gfps.lib into the following path <br />
 </p><div class="image">
<img src="gfps_lib_rtl87x3e.jpg" alt="gfps_lib_rtl87x3e.jpg"/>
</div>
 <center><div id="figure_2_6"><b>Figure 2-6 Add gfps.lib into RTL87x3e </b></div></center><p>RTL87x3d: <br />
 add gfps.lib into the following path <br />
 </p><div class="image">
<img src="gfps_lib_rtl87x3d.jpg" alt="gfps_lib_rtl87x3d.jpg"/>
</div>
 <center><div id="figure_2_7"><b>Figure 2-7 Add gfps.lib into RTL87x3d </b></div></center><p>RTL87x3g: <br />
 add gfps.lib into the following path <br />
 </p><div class="image">
<img src="gfps_lib_rtl87x3g.jpg" alt="gfps_lib_rtl87x3g.jpg"/>
</div>
 <center><div id="figure_2_8"><b>Figure 2-8 Add gfps.lib into RTL87x3g </b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_Initialization_process"></a>
3 Initialization Process</h2>
<div class="image">
<img src="gfps_init_flow.jpg" alt="gfps_init_flow.jpg"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 GFPS Flow </b></div></center><h3><a class="anchor" id="AN100_Pair_Mode"></a>
3.1 In Paring Mode</h3>
<p>when radio_mode == BT_DEVICE_MODE_DISCOVERABLE_CONNECTABLE, the provider will call app_gfps_next_action(GFPS_ACTION_ADV_DISCOVERABLE_MODE_WITH_MODEL_ID) to start discoverable advertisement. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_gfps_check_state(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.device_state == <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga15b39534ff1f5dd5236b4bcb615d24cda0deaa491ef64769f29a516604e2f29eb">APP_DEVICE_STATE_ON</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___b_t___b_t_m.html#ga1818d1a704113dd1b95741dd60754e77">T_BT_DEVICE_MODE</a> radio_mode = <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga41891eacf185bad62c7cf37cae78fc32">app_bt_policy_get_radio_mode</a>();</div><div class="line">        <a class="code" href="group__x3d___t_r_a_c_e.html#gacede19f539147e375272a511869b7a77">APP_PRINT_INFO2</a>(<span class="stringliteral">&quot;app_gfps_check_state: radio_mode %d, bud_role %d&quot;</span>, radio_mode,</div><div class="line">                        <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a>);</div><div class="line">        <span class="keywordflow">if</span> (radio_mode == <a class="code" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31ab1e48ea0abec2793a2af9d89a7232ff2">BT_DEVICE_MODE_DISCOVERABLE_CONNECTABLE</a>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">            {</div><div class="line">                app_gfps_next_action(GFPS_ACTION_ADV_DISCOVERABLE_MODE_WITH_MODEL_ID);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">            {</div><div class="line">                app_gfps_enter_nondiscoverable_mode();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="AN100_NON_PAIR_Mode"></a>
3.2 Not In Pairing Mode</h3>
<p>Provider will call app_gfps_enter_nondiscoverable_mode() to start non-discoverable advertisement. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_gfps_check_state(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.device_state == <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga15b39534ff1f5dd5236b4bcb615d24cda0deaa491ef64769f29a516604e2f29eb">APP_DEVICE_STATE_ON</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___b_t___b_t_m.html#ga1818d1a704113dd1b95741dd60754e77">T_BT_DEVICE_MODE</a> radio_mode = <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga41891eacf185bad62c7cf37cae78fc32">app_bt_policy_get_radio_mode</a>();</div><div class="line">        <a class="code" href="group__x3d___t_r_a_c_e.html#gacede19f539147e375272a511869b7a77">APP_PRINT_INFO2</a>(<span class="stringliteral">&quot;app_gfps_check_state: radio_mode %d, bud_role %d&quot;</span>, radio_mode,</div><div class="line">                        <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a>);</div><div class="line">        <span class="keywordflow">if</span> (radio_mode == <a class="code" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31ab1e48ea0abec2793a2af9d89a7232ff2">BT_DEVICE_MODE_DISCOVERABLE_CONNECTABLE</a>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">            {</div><div class="line">                app_gfps_next_action(GFPS_ACTION_ADV_DISCOVERABLE_MODE_WITH_MODEL_ID);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">            {</div><div class="line">                app_gfps_enter_nondiscoverable_mode();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="AN100_CB"></a>
3.3 APP Callback</h3>
<p>app_gfps_cb function indicates gfps_lib status to app. <br />
1.If app receives GFPS_CALLBACK_TYPE_NOTIFICATION_ENABLE, it means the seeker want to enable cccd.<br />
 <br />
2.If app receives GFPS_CALLBACK_TYPE_KBP_WRITE_REQ, it means the seeker write key based pairing request to provider.<br />
 <br />
3.If app receives GFPS_CALLBACK_TYPE_ACTION_REQ, it means the seeker write action request to provider.<br />
 <br />
4.If app receives GFPS_CALLBACK_TYPE_PASSKEY, it means the seeker write pass key to provider.<br />
 <br />
5.If app receives GFPS_CALLBACK_TYPE_ACCOUNT_KEY, it means the seeker write account key to provider.<br />
 <br />
6.If app receives GFPS_CALLBACK_TYPE_ADDITIONAL_DATA, it means the seeker write personalized name to provider.<br />
</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group___g_a_p___common___exported___types.html#ga90b0c39404615bbdf0fc222483ed3fb9">T_APP_RESULT</a> app_gfps_cb(<a class="code" href="group___g_a_t_t___s_e_r_v_e_r___c_o_m_m_o_n___exported___types.html#gada7cb21908790f5a0751f80b733f5287">T_SERVER_ID</a> service_id, <span class="keywordtype">void</span> *p_data)</div><div class="line">{</div><div class="line">    uint8_t ret = 0;</div><div class="line">    <a class="code" href="group___g_a_p___common___exported___types.html#ga90b0c39404615bbdf0fc222483ed3fb9">T_APP_RESULT</a> app_result = <a class="code" href="group___g_a_p___common___exported___types.html#gga90b0c39404615bbdf0fc222483ed3fb9a909f010ff315d17ec44d25243492a366">APP_RESULT_SUCCESS</a>;</div><div class="line">    T_GFPS_CALLBACK_DATA *<a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a> = (T_GFPS_CALLBACK_DATA *)p_data;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>-&gt;msg_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> GFPS_CALLBACK_TYPE_NOTIFICATION_ENABLE:</div><div class="line">        {</div><div class="line">            <a class="code" href="group__x3d___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_gfps_cb: GFPS_CALLBACK_TYPE_NOTIFICATION_ENABLE, T_GFPS_NOTIFICATION_TYPE %d&quot;</span>,</div><div class="line">                            <a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>-&gt;msg_data.notify_type);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> GFPS_CALLBACK_TYPE_KBP_WRITE_REQ:</div><div class="line">        {</div><div class="line">            app_result = app_gfps_cb_handle_kbp_write_req(service_id, <a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> GFPS_CALLBACK_TYPE_ACTION_REQ:</div><div class="line">        {</div><div class="line">            app_result = app_gfps_cb_handle_action_req(<a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> GFPS_CALLBACK_TYPE_PASSKEY:</div><div class="line">        {</div><div class="line">            app_result = app_gfps_cb_handle_passkey(<a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> GFPS_CALLBACK_TYPE_ACCOUNT_KEY:</div><div class="line">        {</div><div class="line">            app_result = app_gfps_cb_handle_accountkey(<a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#if GFPS_ADDTIONAL_DATA_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> GFPS_CALLBACK_TYPE_ADDITIONAL_DATA:</div><div class="line">        {</div><div class="line">            app_result = app_gfps_cb_handle_additional_data(<a class="code" href="structt__cli__cmd.html#a5dd909473e463e6203cf34d5f16df17d">p_callback</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> app_result;</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="GFPS_user_interaction"></a>
4 User Interaction</h2>
<h3><a class="anchor" id="AN100_Initial_Pair"></a>
4.1 Initial Pairing</h3>
<p>Initial pairing is the pairing between a Fast Pair compliant device and a phone where user's Google account is logged-in at the very first time, and the phone detects the advertisement from the device and recognizes model ID of the device. Then the user follows the instructions shown in the popup notification to connect the device. (In this guideline, 'device' means the Bluetooth headset or speaker instead of a reference phone) </p><div class="image">
<img src="initial_pairing.jpg" alt="initial_pairing.jpg"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 Initial Pairing </b></div></center><h3><a class="anchor" id="AN100_Subsequent_Pair"></a>
4.2 Subsequent Pairing</h3>
<p>Subsequent pairing is the later pairing between this previously initial-paired device and the other phone where the same Google account is logged-in, and the phone detects the advertisement and recognizes the account key from the device. Then the user follows the instructions shown in the popup notification to connect the device. </p><div class="image">
<img src="subsequent_pairing.jpg" alt="subsequent_pairing.jpg"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 Subsequent Pairing </b></div></center> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
