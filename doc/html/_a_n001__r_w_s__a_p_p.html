<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="RWS_App_Page"></a>
Rws App User Manual    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.0.0.1</b></center><p><br />
 </p><center><b>2023/04/18</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="RWS_App_Page_rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2023/04/18  </td><td class="markdownTableBodyCenter">Modify some format   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#RWS_App_Page_rev">Revision History</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#RWS_App_Page_Table_List">Table List</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#RWS_App_Page_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#RWS_App_Page_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-1-system-analyse">1 System Analyse</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-11-end-user-requirements">1.1 End User Requirements</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-12-public-version-user-requirements">1.2 Public Version User Requirements</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-13-sdk-user-requirements">1.3 SDK User Requirements</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-14-system-border-system-responsibility-actor">1.4 System Border, System Responsibility, Actor</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-15-chip-system-overview">1.5 Chip System Overview</a></li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2-software-design">2 Software Design</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-21-overview">2.1 Overview</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-211-image-layout">2.1.1 Image Layout</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-212-software-layer">2.1.2 Software Layer</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-213-data-stream">2.1.3 Data Stream</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-214-app-function-sample">2.1.4 App Function Sample</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-215-app-module-split-theory">2.1.5 App Module Split Theory</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-216-app-source-code-note">2.1.6 App Source Code Note</a></li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-22-main-process">2.2 Main Process</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-221-reboot-init">2.2.1 Reboot Init</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-222-app-task-message-loop">2.2.2 App Task Message Loop</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-223-device-event-handle">2.2.3 Device Event Handle</a></li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-23-framework-simple-introduce">2.3 Framework Simple Introduce</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-24-base-business-logic">2.4 Base Business Logic</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-241-long-key-power-onpairing-modefactory-reset">2.4.1 Long Key Power On/Pairing Mode/Factory Reset</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-242-long-key-power-off">2.4.2 Long Key Power Off</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-243-auto-power-on">2.4.3 Auto Power On</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-244-auto-power-off">2.4.4 Auto Power Off</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-245-3pin-power-onoff">2.4.5 3pin Power On/Off</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-246-slide-switch-power-onoff">2.4.6 Slide Switch Power On/Off</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-247-5v-power-onoff">2.4.7 5v Power On/Off</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-248-5v-cmd-power-onoff">2.4.8 5v Cmd Power On/Off</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-249-bt-policy">2.4.9 Bt Policy</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2410-enter-pairing-mode-method">2.4.10 Enter Pairing Mode Method</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2411-exit-pairing-mode-method">2.4.11 Exit Pairing Mode Method</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2412-enter-linkback-method">2.4.12 Enter Linkback Method</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2413-audio-a2dpavrcp">2.4.13 Audio [a2dp+avrcp]</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2414-call-hfpscopbap">2.4.14 Call [hfp+sco+pbap]</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2415-charging">2.4.15 Charging</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2416-ota">2.4.16 OTA</a></li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-25-base-support-module">2.5 Base Support Module</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-251-dirver">2.5.1 Dirver</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-252-utility">2.5.2 Utility</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-253-storage">2.5.3 Storage</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-254-event">2.5.4 Input Event</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-255-command">2.5.5 Command</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-256-mmi">2.5.6 MMI</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-257-output">2.5.7 Output</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-258-sdp">2.5.8 SDP</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-259-relay">2.5.9 Relay</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2510-roleswap">2.5.10 Roleswap</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2511-multilink">2.5.11 Multilink</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2512-sniffing-link">2.5.12 Sniffing Link</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2513-low-power">2.5.13 Low Power</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2514-wdt-reset">2.5.14 Wdt Reset</a></li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-26-advanced-feature">2.6 Advanced Feature</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-261-smart-charger-box">2.6.1 Smart Charger Box</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-262-air-plane-mode">2.6.2 Air Plane Mode</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-263-gaming-mode">2.6.3 Gaming Mode</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-264-sound-effect">2.6.4 Sound Effect</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-265-voice-assistant">2.6.5 Voice Assistant</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-266-tts">2.6.6 TTS</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-267-gfps">2.6.7 GFPS</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-268-swift-pair">2.6.8 Swift Pair</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-269-line-in">2.6.9 Line In</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-2610-nfc">2.6.10 NFC</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-3-sdk-development">3 SDK Development</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-31-easy-to-entry">3.1 Easy Entry</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-311-download-bin-toolmppgtool">3.1.1 Download Bin [Tool/MPPGTool]</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-312-print-log-tooldebuganalyzer">3.1.2 Print Log [Tool/DebugAnalyzer]</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-313-modify-config-file-toolmcuconfigtool">3.1.3 Modify Config File [Tool/McuConfigTool]</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-314-modify-source-code-keil-uvision5">3.1.4 Modify Source Code [Keil uVision5]</a></li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-315-how-to-use-the-rws">3.1.5 How To Use The RWS</a></li>
</ul>
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-32-deep-development">3.2 Deep Development</a><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-321-analyse-log-file">3.2.1 Analyse Log File</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="RWS_App_Page_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_1_1_1">Table 1-1-1 End User Requirements</a></li>
<li><a href="#table_2_1_1">Table 2-1-1 App Source Code Note</a></li>
<li><a href="#table_2_4_1">Table 2-4-1 A2dp Event From Framework</a></li>
<li><a href="#table_2_4_2">Table 2-4-2 Avrcp Event From Framework</a></li>
<li><a href="#table_2_4_3">Table 2-4-3 Hfp Main Event From Framework</a></li>
<li><a href="#table_2_4_4">Table 2-4-4 Sco Main Event From Framework</a></li>
<li><a href="#table_2_4_5">Table 2-4-5 Pbap Main Event From Framework</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="RWS_App_Page_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_4_1">Figure 1-4-1 System Border</a></li>
<li><a href="#figure_1_5_1">Figure 1-5-1 Chip System Overview</a></li>
<li><a href="#figure_2_1_1">Figure 2-1-1 Image Layout</a></li>
<li><a href="#figure_2_1_2">Figure 2-1-2 Software Layer</a></li>
<li><a href="#figure_2_1_3">Figure 2-1-3 App Framework Interaction</a></li>
<li><a href="#figure_2_1_4">Figure 2-1-4 Data Stream</a></li>
<li><a href="#figure_2_1_5">Figure 2-1-5 Audio Stream</a></li>
<li><a href="#figure_2_1_6">Figure 2-1-6 App Function Sample</a></li>
<li><a href="#figure_2_2_1">Figure 2-2-1 Reboot Init</a></li>
<li><a href="#figure_2_4_1">Figure 2-4-1 Long Key Power On</a></li>
<li><a href="#figure_2_4_2">Figure 2-4-2 Key Button</a></li>
<li><a href="#figure_2_4_3">Figure 2-4-3 Long Key Power Off</a></li>
<li><a href="#figure_2_4_4">Figure 2-4-4 3pin Power On Off</a></li>
<li><a href="#figure_2_4_5">Figure 2-4-5 Bt Policy Internal Implementation</a></li>
<li><a href="#figure_3_1_1">Figure 3-1-1 Log Tags</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="RWS_App_Page_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">OTA  </td><td class="markdownTableBodyCenter">Over The Air   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="R-1-system-analyse"></a>
1 System Analyse</h2>
<h3><a class="anchor" id="R-11-end-user-requirements"></a>
1.1 End User Requirements</h3>
<p>This is a simple sample of end user requirements, include function and non-function requirement:</p>
<center><div id="table_1_1_1"><b>Table 1-1-1 End User Requirements</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Function Requirement  </th><th class="markdownTableHeadLeft">Non-function Requirement   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">power on  </td><td class="markdownTableBodyLeft">good taste   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">pairing mode  </td><td class="markdownTableBodyLeft">high function   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">factory reset  </td><td class="markdownTableBodyLeft">high security   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">power off  </td><td class="markdownTableBodyLeft">low power consumption   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">b2b engage  </td><td class="markdownTableBodyLeft">low lantency   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">b2s pairing, connect  </td><td class="markdownTableBodyLeft">low price   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">audio  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">call  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">charging  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">smart charger box  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">voice assistant  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">anc/apt mode  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">gaming/normal mode  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">air plane mode  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">key  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">led  </td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">tone  </td><td class="markdownTableBodyLeft"></td></tr>
</table>
<p>Always, the end user requirements is our design target, the software should follow it.</p>
<h3><a class="anchor" id="R-12-public-version-user-requirements"></a>
1.2 Public Version User Requirements</h3>
<p>The public version user requirements is base on the end user requirements. <br />
 In addition, user request simple to gen the target, just by do some config. <br />
 So, the config tool should full fit all the customer. <br />
 Simple is beautiful to customer, but it is hard to the solution, and let it be complex. <br />
 How to do it? please reference: <br />
</p><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-31-easy-to-entry">3.1 Easy Entry</a> <br />
</li>
</ul>
<h3><a class="anchor" id="R-13-sdk-user-requirements"></a>
1.3 SDK User Requirements</h3>
<p>The SDK user requirements is base on the public version user requirements. <br />
 In addition, user request could modify the source code by themself. <br />
 So, the SDK should: easy to entry and deep development, please reference: <br />
</p><ul>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-31-easy-to-entry">3.1 Easy Entry</a> <br />
</li>
<li><a class="el" href="_a_n001__r_w_s__a_p_p.html#R-32-deep-development">3.2 Deep Development</a> <br />
</li>
</ul>
<h3><a class="anchor" id="R-14-system-border-system-responsibility-actor"></a>
1.4 System Border, System Responsibility, Actor</h3>
<p>Base the end user requirements, public version user requirements, SDK user requirements, we go to think the system. <br />
 First, we think of the primary of the rws, which it will face, then gen the system border. <br />
 Out of the system border, there are the actor, they interactive with the system, wen can gen the use case and interaction chart. <br />
 In the system border, it is the system, when we know what responsibility it should take on, we can do the system analyse. <br />
 Split the system to several subsystem, find out every object and the relation among the objects. <br />
</p>
<div class="image">
<img src="system_border.png" alt="system_border.png"/>
</div>
 <center><div id="figure_1_4_1"><b>Figure 1-4-1 System Border</b></div></center><h3><a class="anchor" id="R-15-chip-system-overview"></a>
1.5 Chip System Overview</h3>
<div class="image">
<img src="chip-system-overview.png" alt="chip-system-overview.png"/>
</div>
 <center><div id="figure_1_5_1"><b>Figure 1-5-1 Chip System Overview</b></div></center><p>The system analyse would help us to design the system and test the system.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="R-2-software-design"></a>
2 Software Design</h2>
<h3><a class="anchor" id="R-21-overview"></a>
2.1 Overview</h3>
<p>The developer will touch 3 domain's technology knowledge when develop the system:</p><ol type="1">
<li>Embedded System (mcu + os + io + platform + hal)</li>
<li>Bluetooth (legacy + ble)</li>
<li>Audio (dsp + codec)</li>
</ol>
<p>The developer will also touch the business logic which we called "UI(user interface)"</p>
<ul>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_USER_GUIDE">SDK User Guide </a></li>
</ul>
<h4><a class="anchor" id="R-211-image-layout"></a>
2.1.1 Image Layout</h4>
<p>There are many image in the system, include mcu's and dsp's: <br />
</p>
<div class="image">
<img src="image_layout.png" alt="image_layout.png"/>
</div>
 <center><div id="figure_2_1_1"><b>Figure 2-1-1 Image Layout</b></div></center><p>The app is only care of CFG_XXX.bin, APP_YYY.bin and rws_ZZZ.bin: <br />
 The CFG_XXX.bin is the system config, such as "bluetooth address", <br />
 The APP_YYY.bin is the app config, it is so much, such as "enable_power_on_linkback", <br />
 The rws_ZZZ.bin is the rws app bin. <br />
</p>
<p>Other way, when app run, it use app_cfg_nv to save the information, such as "bluetooth name". <br />
</p>
<ul>
<li>FLASH_LAYOUT</li>
</ul>
<h4><a class="anchor" id="R-212-software-layer"></a>
2.1.2 Software Layer</h4>
<p>The software storage in rom and flash, run in ROM, flash and RAM.</p>
<div class="image">
<img src="software_layer.png" alt="software_layer.png"/>
</div>
 <center><div id="figure_2_1_2"><b>Figure 2-1-2 Software Layer</b></div></center><p>You can simple regard as rws app call framework and framework call rom.lib. <br />
 <br />
 The app and framework interaction is app call framework's api and framework callback to app: <br />
</p>
<div class="image">
<img src="app_framework_interaction.png" alt="app_framework_interaction.png"/>
</div>
 <center><div id="figure_2_1_3"><b>Figure 2-1-3 App Framework Interaction</b></div></center><h4><a class="anchor" id="R-213-data-stream"></a>
2.1.3 Data Stream</h4>
<p>You can think of the system from the data stream, there are diff class data stream in the system: <br />
</p><ol type="1">
<li>BT data stream <br />
</li>
<li>IO data stream <br />
</li>
<li>Storage data stream <br />
</li>
<li>DSP audio/voice data stream <br />
</li>
</ol>
<div class="image">
<img src="data_stream.png" alt="data_stream.png"/>
</div>
 <center><div id="figure_2_1_4"><b>Figure 2-1-4 Data Stream</b></div></center><div class="image">
<img src="audio_stream.png" alt="audio_stream.png"/>
</div>
 <center><div id="figure_2_1_5"><b>Figure 2-1-5 Audio Stream</b></div></center><h4><a class="anchor" id="R-214-app-function-sample"></a>
2.1.4 App Function Sample</h4>
<div class="image">
<img src="app_function_sample.png" alt="app_function_sample.png"/>
</div>
 <center><div id="figure_2_1_6"><b>Figure 2-1-6 App Function Sample</b></div></center><h4><a class="anchor" id="R-215-app-module-split-theory"></a>
2.1.5 App Module Split Theory</h4>
<ol type="1">
<li>App all module respective call gap timer api and reg callback by <b>gap_reg_timer_cb</b> <br />
 <br />
</li>
<li>App all module respective call framework's sys mgr api and reg callback by <b>sys_mgr_cback_register</b> <br />
</li>
<li>App all module respective call framework's bt mgr api and reg callback by <b>bt_mgr_cback_register</b> <br />
</li>
<li>App all module respective call framework's audio mgr api and reg callback by <b>audio_mgr_cback_register</b> <br />
 <br />
</li>
<li>App all module share the only database <b>app_db</b></li>
<li>App all module share the only const config <b>app_cfg_const</b></li>
<li>App all module share the only nv config <b>app_cfg_nv</b></li>
</ol>
<h4><a class="anchor" id="R-216-app-source-code-note"></a>
2.1.6 App Source Code Note</h4>
<center><div id="table_2_1_1"><b>Table 2-1-1 App Source Code Note</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">C file  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_main.c  </td><td class="markdownTableBodyLeft">main entry   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_util.c  </td><td class="markdownTableBodyLeft">utility   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_cfg.c  </td><td class="markdownTableBodyLeft">const config and NV config   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_io_msg.c  </td><td class="markdownTableBodyLeft">io message to action map   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_console_msg.c  </td><td class="markdownTableBodyLeft">data uart receive cmd to action map   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_pwm.c  </td><td class="markdownTableBodyLeft">pwm driver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_hw_timer.c  </td><td class="markdownTableBodyLeft">hardware driver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_led.c  </td><td class="markdownTableBodyLeft">led UI   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_gpio.c  </td><td class="markdownTableBodyLeft">gpio driver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_key_gpio.c  </td><td class="markdownTableBodyLeft">gpio_key driver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_key_process.c  </td><td class="markdownTableBodyLeft">key UI   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_charger.c  </td><td class="markdownTableBodyLeft">5v charger detect, charger state, state of charger   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_usb_audio.c  </td><td class="markdownTableBodyLeft">usb audio[have nothing to do with rws, ingore]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_transfer.c  </td><td class="markdownTableBodyLeft">send data by diff path[data uart, ble, spp]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_report.c  </td><td class="markdownTableBodyLeft">package event and data, call app_transfer to send   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_gap.c  </td><td class="markdownTableBodyLeft">legacy gap message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_ble_gap.c  </td><td class="markdownTableBodyLeft">ble gap message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_ble_device.c  </td><td class="markdownTableBodyLeft">ble handle device event   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_ble_client.c  </td><td class="markdownTableBodyLeft">ble client [nothing]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_ble_service.c  </td><td class="markdownTableBodyLeft">ble service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_ble_tts_ota.c  </td><td class="markdownTableBodyLeft">ble adv[common]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_sdp.c  </td><td class="markdownTableBodyLeft">[local sdp service]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_hfp.c  </td><td class="markdownTableBodyLeft">hfp message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_avrcp.c  </td><td class="markdownTableBodyLeft">avrcp message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_a2dp.c  </td><td class="markdownTableBodyLeft">a2dp message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_pbap.c  </td><td class="markdownTableBodyLeft">pbap message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_spp.c  </td><td class="markdownTableBodyLeft">spp message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_iap.c  </td><td class="markdownTableBodyLeft">iap message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_roleswap.c  </td><td class="markdownTableBodyLeft">roleswap[in-out ear, in-out case, open-close case,   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">voice/audio change, battery change]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_relay.c  </td><td class="markdownTableBodyLeft">relay message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_device.c  </td><td class="markdownTableBodyLeft">sys message handle as power on and power off   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_mmi.c  </td><td class="markdownTableBodyLeft">mmi handle [local or cmd triger]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_cmd.c  </td><td class="markdownTableBodyLeft">cmd handle[from diff path: data uart, ble, spp]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_dlps.c  </td><td class="markdownTableBodyLeft">low power manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_link_util.c  </td><td class="markdownTableBodyLeft">bred and ble link utility   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_linkback.c  </td><td class="markdownTableBodyLeft">b2s linkback interface   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_multilink.c  </td><td class="markdownTableBodyLeft">multi link manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_bt_policy.c  </td><td class="markdownTableBodyLeft">b2b and b2s connecting manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_policy.c  </td><td class="markdownTableBodyLeft">audio track manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_gpio_on_off.c  </td><td class="markdownTableBodyLeft">3pin in-out case detect   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_rdtp.c  </td><td class="markdownTableBodyLeft">b2b profile message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_test.c  </td><td class="markdownTableBodyLeft">for QC test   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_anc.c  </td><td class="markdownTableBodyLeft">anc manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_eq.c  </td><td class="markdownTableBodyLeft">audio eq manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_nfc.c  </td><td class="markdownTableBodyLeft">nfc detect   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_sensor.c  </td><td class="markdownTableBodyLeft">in-out ear handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_ota.c  </td><td class="markdownTableBodyLeft">ota manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_bt_policy_api.c  </td><td class="markdownTableBodyLeft">bt policy api   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_in_out_box.c  </td><td class="markdownTableBodyLeft">in-out box handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_vad.c  </td><td class="markdownTableBodyLeft">vad control   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_iap_rtk.c  </td><td class="markdownTableBodyLeft">recv iap data and handle command   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_ble_tts.c  </td><td class="markdownTableBodyLeft">control tts adv by a2dp and hfp event   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_buzeer.c  </td><td class="markdownTableBodyLeft">buzzer api   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_bond.c  </td><td class="markdownTableBodyLeft">bond info manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_third_party_srv.c  </td><td class="markdownTableBodyLeft">third party server[gfps]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_bt_sniffing.c  </td><td class="markdownTableBodyLeft">sniffing link manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_audio_passthrough.c  </td><td class="markdownTableBodyLeft">apt handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_adp.c  </td><td class="markdownTableBodyLeft">smart charger manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_le_bond.c  </td><td class="markdownTableBodyLeft">ble bond info manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_io_output.c  </td><td class="markdownTableBodyLeft">10HZ gpio output   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_listening_mode.c  </td><td class="markdownTableBodyLeft">listening mode manager[apt, anc]   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_sensor_px318j.c  </td><td class="markdownTableBodyLeft">px318j in-out ear detect sensor dirver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_auto_power_off.c  </td><td class="markdownTableBodyLeft">auto power off manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_line_in.c  </td><td class="markdownTableBodyLeft">line in handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_sensor_jsa1225.c  </td><td class="markdownTableBodyLeft">jsa1225 in-out ear detect sensor dirver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_airplane.c  </td><td class="markdownTableBodyLeft">air plane mode   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app_dsp_cfg.c  </td><td class="markdownTableBodyLeft">dsp config   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_adc.c  </td><td class="markdownTableBodyLeft">smart charger voltage collect   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">eq_utils.c  </td><td class="markdownTableBodyLeft">dsp eq utility   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">app_ble_swift_pair.c  </td><td class="markdownTableBodyLeft">ms speed pairing adv   </td></tr>
</table>
<h3><a class="anchor" id="R-22-main-process"></a>
2.2 Main Process</h3>
<h4><a class="anchor" id="R-221-reboot-init"></a>
2.2.1 Reboot Init</h4>
<p>Reboot Cause:</p><ol type="1">
<li>Hardware reset</li>
<li>Power down wakeup</li>
<li>Wdt reset</li>
</ol>
<div class="image">
<img src="reboot_init.png" alt="reboot_init.png"/>
</div>
 <center><div id="figure_2_2_1"><b>Figure 2-2-1 Reboot Init</b></div></center><h4><a class="anchor" id="R-222-app-task-message-loop"></a>
2.2.2 App Task Message Loop</h4>
<ol type="1">
<li>App task start bt stack <br />
 <br />
</li>
<li>App task receive messages from other modules: IO module, BT stack, framework <br />
 <b>App task not handle the message from BT stack and framework</b> <br />
 <b>It just call BT stack and framework own's handle</b> <br />
 <b>App task just call framework and framework callback app when use bt function</b> <br />
 <br />
</li>
<li>The loop also check led_check_charging_mode and led_check_repeat_mode <br />
</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> app_task(<span class="keywordtype">void</span> *pvParameters)</div><div class="line">{</div><div class="line">  <a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#ga431d3b5cbaad02e4dba35c48dc7bd161">driver_init</a>();</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga6c1380f48710ff1d93665766397285d2">charger_support</a>)</div><div class="line">  {</div><div class="line">    <a class="code" href="group___a_p_p___a_d_p.html#ga902e6d2eaee6108da0310055be86ab3b">app_adp_detect</a>();</div><div class="line">  }</div><div class="line">  <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga337f0e91aaa1af727c165620e64d91af">gap_start_bt_stack</a>(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#ga1dc336635d2a407d06df2101d4208c43">audio_evt_queue_handle</a>, <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gae608acf4da9aeedaf885f18e8b91eefc">audio_io_queue_handle</a>, <a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#gaaf45be3842e5882f90db4267ffbfe036">MAX_NUMBER_OF_GAP_MESSAGE</a>);</div><div class="line"></div><div class="line">  ......</div><div class="line"></div><div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___o_s__87x3d___message.html#ga10998e34fdfdd3297af840e60d03b09b">os_msg_recv</a>(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#ga1dc336635d2a407d06df2101d4208c43">audio_evt_queue_handle</a>, &amp;event, 0xFFFFFFFF) == <span class="keyword">true</span>)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___m_s_g___exported___types.html#gabe0f8f9b88e43b5899548e9b1247cbfb">EVENT_GROUP</a>(event) == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga43f50ce527e4dfb45fec14124060cd48a0cdd31cbb0e50228edad06b4a1d1adfd">EVENT_GROUP_IO</a>)</div><div class="line">      {</div><div class="line">        <a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> io_msg;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___o_s__87x3d___message.html#ga10998e34fdfdd3297af840e60d03b09b">os_msg_recv</a>(<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gae608acf4da9aeedaf885f18e8b91eefc">audio_io_queue_handle</a>, &amp;io_msg, 0) == <span class="keyword">true</span>)</div><div class="line">        {</div><div class="line">          <span class="keywordflow">if</span> (event == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggae013f504d288fa3c19ec0f1af745975ca54fa1d4504aab64b0e290572ad56a13e">EVENT_IO_TO_APP</a>)</div><div class="line">          {</div><div class="line">            <a class="code" href="group___a_p_p___i_o___m_s_g.html#gab3416cc2898ca3f036749335997d4841">app_io_handle_msg</a>(io_msg);</div><div class="line">          }</div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event == EVENT_CONSOLE)</div><div class="line">          {</div><div class="line">            <a class="code" href="group___a_p_p___c_o_n_s_o_l_e___m_s_g___exported___functions.html#gae0ceda26bea7060d4a7a391fdec15ab3">app_console_handle_msg</a>(io_msg);</div><div class="line">          }</div><div class="line">        }</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___m_s_g___exported___types.html#gabe0f8f9b88e43b5899548e9b1247cbfb">EVENT_GROUP</a>(event) == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga43f50ce527e4dfb45fec14124060cd48a68015f69fe03c89bfab96d75c108d0e9">EVENT_GROUP_STACK</a>)</div><div class="line">      {</div><div class="line">        <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#gadc91ccdf8fda07b12ab307882d2b8b7d">gap_handle_msg</a>(event);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___m_s_g___exported___types.html#gabe0f8f9b88e43b5899548e9b1247cbfb">EVENT_GROUP</a>(event) == <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga43f50ce527e4dfb45fec14124060cd48a09543b3091008504c7bad75d70d0d168">EVENT_GROUP_FRAMEWORK</a>)</div><div class="line">      {</div><div class="line">        <a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#ga25d19b4ba80245203fc7db6a8be1e6c3">sys_mgr_event_handle</a>(event);</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga17c5da6d7f80fad8c237ea290c34b4a4">led_support</a>)</div><div class="line">      {</div><div class="line">        led_check_charging_mode(0); <span class="comment">//LED mode has higher priority</span></div><div class="line">        led_check_repeat_mode();</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><h4><a class="anchor" id="R-223-device-event-handle"></a>
2.2.3 Device Event Handle</h4>
<ul>
<li><a class="el" href="_a_n004__device__application__note.html#Device_Page">Device Function Application Note </a></li>
</ul>
<h3><a class="anchor" id="R-23-framework-simple-introduce"></a>
2.3 Framework Simple Introduce</h3>
<ol type="1">
<li>Framework provide manage api for app</li>
<li>App call framwork api and register callback to get concerned event</li>
<li>Framework api include: a. System b. Audio c. Bt d. Remote</li>
</ol>
<ul>
<li><a class="el" href="_u_m014__f_r_a_m_e_w_o_r_k__i_n_t_e_r_f_a_c_e.html#Framework_Page">Framework Interfaces User Manual </a></li>
</ul>
<h3><a class="anchor" id="R-24-base-business-logic"></a>
2.4 Base Business Logic</h3>
<h4><a class="anchor" id="R-241-long-key-power-onpairing-modefactory-reset"></a>
2.4.1 Long Key Power On/Pairing Mode/Factory Reset</h4>
<div class="image">
<img src="long_key_power_on.png" alt="long_key_power_on.png"/>
</div>
 <center><div id="figure_2_4_1"><b>Figure 2-4-1 Long Key Power On</b></div></center><p>MMI Action: </p><div class="image">
<img src="key_button.jpg" alt="key_button.jpg"/>
</div>
 <center><div id="figure_2_4_2"><b>Figure 2-4-2 Key Button</b></div></center><h4><a class="anchor" id="R-242-long-key-power-off"></a>
2.4.2 Long Key Power Off</h4>
<div class="image">
<img src="long_key_power_off.png" alt="long_key_power_off.png"/>
</div>
 <center><div id="figure_2_4_3"><b>Figure 2-4-3 Long Key Power Off</b></div></center><h4><a class="anchor" id="R-243-auto-power-on"></a>
2.4.3 Auto Power On</h4>
<ol type="1">
<li>When app is power on, then wdt reset or hardware reset</li>
<li>Smart charging box factory reset to power on</li>
</ol>
<h4><a class="anchor" id="R-244-auto-power-off"></a>
2.4.4 Auto Power Off</h4>
<ol type="1">
<li>Secondary rws linklost tiemout [BUD_LINKLOST_TIMEOUT]</li>
<li>Charging adaptor unplug and low battery [STATE_CHARGER_END + BAT_CAPACITY_0]</li>
<li>Pairing timeout power off [app_cfg_const.enable_pairing_timeout_to_power_off]</li>
<li>Power off timer timeout [poweroff_timer], none of bellow condition will start the poweroff_timer: <div class="fragment"><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfad57ecb96f33e9545ddb7d86a739ee71c">AUTO_POWER_OFF_MASK_POWER_ON</a>                          </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa8e9566d2d199dbb99a4764f191168c39">AUTO_POWER_OFF_MASK_SOURCE_LINK</a>                       </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfaa2ae87f0ab71494c29cecf538da0b241">AUTO_POWER_OFF_MASK_IN_BOX</a>                            </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa01a6496cd031211626b08e5f5ca7df92">AUTO_POWER_OFF_MASK_BUD_COUPLING</a>                      </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa8a9c90b7f944802c6f41a71c9f39c1b7">AUTO_POWER_OFF_MASK_KEY</a>                               </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfad02f7522f3d51cd78d9c9fa12b9a3d30">AUTO_POWER_OFF_MASK_ALREADY_POWER_OFF</a>                 </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa3baa32c30b66d75a91f0090ba83de075">AUTO_POWER_OFF_MASK_PAIRING_MODE</a>                      </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa75b0d4493381a0dbb120be68b290fa17">AUTO_POWER_OFF_MASK_ANC_APT_MODE</a>                      </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa271635d4c4a0e48f36ad1d62d14cc93e">AUTO_POWER_OFF_MASK_BLE_LINK_EXIST</a>                    </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa9948dff3d1175c16081565d6420e197c">AUTO_POWER_OFF_MASK_PLAYBACK_MODE</a>                     </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa2f657b88f624fb0898768c96892311b5">AUTO_POWER_OFF_MASK_LINE_IN</a>                           </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa845bb3f7c399ba1a64ccb22cb8bf02f6">AUTO_POWER_OFF_MASK_ANC_APT_MODE_WITH_PHONE_CONNECTED</a> </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa84aafd38b0f9c1c38dd83f50a54cd0e0">AUTO_POWER_OFF_MASK_AIRPLANE_MODE</a>                     </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa241cf6ac4ad578bb4dfde94e80d3e3b2">AUTO_POWER_OFF_MASK_LINKBACK</a>                          </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa0eda46441ca3aec8dadead9ddc14c269">AUTO_POWER_OFF_MASK_DUT_MODE</a>                          </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa6b4fa01a3c8368598b9bcebc70be909f">AUTO_POWER_OFF_MASK_USB_AUDIO_MODE</a>                    </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa748789f9e00c57139d3060fbc1840732">AUTO_POWER_OFF_MASK_XIAOAI_OTA</a>                        </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfaa33a6b451daf0506504b2bcc7c72e09c">AUTO_POWER_OFF_MASK_OTA_TOOLING</a>                       </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa48dbb5b045e189a1583e21205a598926">AUTO_POWER_OFF_MASK_BLE_AUDIO</a>                         </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa44186cf78a67c125e61e308289d966a3">AUTO_POWER_OFF_MASK_TUYA_OTA</a>                          </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa6f24f7e88ebc8cec5f3d6f253bf32c76">AUTO_POWER_OFF_MASK_CONSOLE_CMD</a>                       </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa0e680f0968b0f9daf4c89be1211d3f17">AUTO_POWER_OFF_MASK_VOICE</a>                             </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa2bf926d5274d827c4c2a494015617ea7">AUTO_POWER_OFF_MASK_AUDIO</a>                             </div><div class="line"><a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa27c5e06fc88ce9feb523b07360d2fb19">AUTO_POWER_OFF_MASK_DATA_CAPTURE</a>                             </div></div><!-- fragment --></li>
</ol>
<h4><a class="anchor" id="R-245-3pin-power-onoff"></a>
2.4.5 3pin Power On/Off</h4>
<ol type="1">
<li>If system is in power down: a. 3pin out-case wakeup it, will direct power on b. 3pin in-case wakeup it, will just do charging</li>
<li>If system is running: a. 3pin in-case and out-case action as this:</li>
</ol>
<div class="image">
<img src="3pin_power_on_off.png" alt="3pin_power_on_off.png"/>
</div>
 <center><div id="figure_2_4_4"><b>Figure 2-4-4 3pin Power On Off</b></div></center><h4><a class="anchor" id="R-246-slide-switch-power-onoff"></a>
2.4.6 Slide Switch Power On/Off</h4>
<ol type="1">
<li>Slide switch power on/off is same as 3pin power on/off</li>
</ol>
<h4><a class="anchor" id="R-247-5v-power-onoff"></a>
2.4.7 5v Power On/Off</h4>
<ol type="1">
<li>"5v Power On/Off" is almost same as "3pin Power On/Off"</li>
<li>Its debounce time is 1s(3pin is 0.5s)</li>
</ol>
<h4><a class="anchor" id="R-248-5v-cmd-power-onoff"></a>
2.4.8 5v Cmd Power On/Off</h4>
<ol type="1">
<li>"5v Cmd Power On/Off" diff with "5v Power On/Off"</li>
<li>It use uart cmd to control power on/off but not in-out case event</li>
</ol>
<h4><a class="anchor" id="R-249-bt-policy"></a>
2.4.9 Bt Policy</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.4.9.1 Bt Policy External Interface</h5>
<div class="fragment"><div class="line">Function:</div><div class="line">    Bt policy is a very important moudle, it manage the [first]engage, linkback, stable state,</div><div class="line">    and it is the only one who manage the radio mode.</div><div class="line"></div><div class="line">    Stable state include b2b and b2s state:</div><div class="line">    1. b2b stastable state is: mack role shaking, forever shaking, engage done</div><div class="line">    2. b2s stastable state is: pairing mode, standby, connected</div><div class="line"></div><div class="line">API:</div><div class="line">    System reboot call <span class="keyword">this</span> init:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gaf010549775eafa36b3e6d99a46a8f4c1">app_bt_policy_init</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    Startup the bt policy, the <span class="stringliteral">&quot;T_BP_IND_FUN fun&quot;</span> is the <span class="keyword">event</span> indication callback:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga26ee4bfa6bc6384d87ae1dd7a0e6f5e9">app_bt_policy_startup</a>(<a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga171bfea915a4ced27f6882b42728d07e">T_BP_IND_FUN</a> fun, <span class="keywordtype">bool</span> at_once_trigger);</div><div class="line"></div><div class="line">    Shutdown the bt policy:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga15c15429dae5cb688de8c5500ec4de90">app_bt_policy_shutdown</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    When bud in to <span class="keywordflow">case</span>, before roleswap, we call it to stop engage and linkback:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga76437177e58b77558358775b39f40813">app_bt_policy_stop</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    When bud out to <span class="keywordflow">case</span>, we call it to restore engage and linkback:</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga994d49db37a0e91717fc2a22bf9d76d0">app_bt_policy_restore</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    For roleswap:</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gaf5d884896403547d3d392b66225e5dd7">app_bt_policy_prepare_for_roleswap</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    3rd prof indication bt policy the connect event:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gafcbcbbe8760c8e07c82eb750d8fff9e3">app_bt_policy_msg_prof_conn</a>(uint8_t *bd_addr, uint32_t prof);</div><div class="line"></div><div class="line">    3rd prof indication bt policy the disconnect event:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga23822ce49b69c290b4842e8670cf1194">app_bt_policy_msg_prof_disconn</a>(uint8_t *bd_addr, uint32_t prof, uint16_t cause);</div><div class="line"></div><div class="line">    Connect any b2s profs in <span class="keywordflow">default</span> methed:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga710581cde9ef93584cf7417144bb752d">app_bt_policy_default_connect</a>(uint8_t *bd_addr, uint32_t plan_profs, <span class="keywordtype">bool</span> check_bond_flag);</div><div class="line"></div><div class="line">    Connect any b2s profs in special methed:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga76e8374befdac098e3bfd22ae75ad31c">app_bt_policy_special_connect</a>(uint8_t *bd_addr, uint32_t plan_prof, <a class="code" href="union_t___l_i_n_k_b_a_c_k___s_e_a_r_c_h___p_a_r_a_m.html">T_LINKBACK_SEARCH_PARAM</a> *search_param);</div><div class="line"></div><div class="line">    Disconnect any b2s profs:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga28294ace2df9f947939c4231dbdbef94">app_bt_policy_disconnect</a>(uint8_t *bd_addr, uint32_t plan_profs);</div><div class="line"></div><div class="line">    Disconnect all b2b/b2s profs and link:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga2f36047171acfd52976d695e0dcd0fa8">app_bt_policy_disconnect_all_link</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    Manual enter pairing mode, ex. press key:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga11a58f5e7813e225bba038260ab0e2a4">app_bt_policy_enter_pairing_mode</a>(<span class="keywordtype">bool</span> force, <span class="keywordtype">bool</span> visiable);</div><div class="line"></div><div class="line">    Manual exit pairing mode, ex. press key:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga9f1ae18142260239687d54b28304fc4b">app_bt_policy_exit_pairing_mode</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    For dut test mode:</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gafeb9beefd7a4be1005cb0af6944742e4">app_bt_policy_enter_dut_test_mode</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    This 2 api used <span class="keywordflow">for</span> ota:</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga77bf580e3b2808efc254d03648b458da">app_bt_policy_start_ota_shaking</a>(<span class="keywordtype">void</span>);</div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga2d2b875169430e9c16e58fcfa63b6cd9">app_bt_policy_enter_ota_mode</a>(<span class="keywordtype">bool</span> connectable);</div><div class="line"></div><div class="line">    Get state:</div><div class="line">        <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga29297b79a646476e338f57e643af09de">T_BP_STATE</a> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga3bd2f2a2ca2cdf6d2d3a42f8335e9620">app_bt_policy_get_state</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    Get radio mode:</div><div class="line">        <a class="code" href="group___b_t___b_t_m.html#ga1818d1a704113dd1b95741dd60754e77">T_BT_DEVICE_MODE</a> <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga41891eacf185bad62c7cf37cae78fc32">app_bt_policy_get_radio_mode</a>(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    Check <span class="keywordflow">if</span> b2b connected:</div><div class="line">        <span class="keywordtype">bool</span> app_bt_policy_get_b2b_connected(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line">    Get b2s connected num:</div><div class="line">        uint8_t app_bt_policy_get_b2s_connected_num(<span class="keywordtype">void</span>);</div></div><!-- fragment --><p><a class="anchor" id="invalid"></a></p><h5>2.4.9.2 Bt Policy Internal Implementation</h5>
<div class="image">
<img src="2-bt_policy_internal_implementation.png" alt="2-bt_policy_internal_implementation.png"/>
</div>
 <center><div id="figure_2_4_5"><b>Figure 2-4-5 Bt Policy Internal Implementation</b></div></center><ol type="1">
<li>If the bud has not paired with peer, when it power on, will execute first engage to bind with peer <br />
 After shaking and coupling, the first engage maybe success <br />
 If time out, the first engage will fail or use (if has) last peer to success <br />
 <br />
</li>
<li>If the bud has paired with peer, when it power on, will execute engage to connect with peer <br />
 After max 2.5s timeout shaking and coupling, the engage will finish, <br />
 Then the primary (check linkback enable flag and b2s bond list) go to linkback, <br />
 Finally, it will enter stable state(connected state, standby state or pairing mode state) <br />
</li>
</ol>
<div class="fragment"><div class="line">Reference Function:</div><div class="line">    <span class="keywordtype">void</span> app_bt_policy_engage_sched(<span class="keywordtype">void</span>);</div><div class="line">    <span class="keywordtype">void</span> app_bt_policy_linkback_sched(<span class="keywordtype">void</span>);</div><div class="line">    <span class="keywordtype">void</span> app_bt_policy_stable_sched(T_STABLE_ENTER_MODE mode);</div></div><!-- fragment --><h4><a class="anchor" id="R-2410-enter-pairing-mode-method"></a>
2.4.10 Enter Pairing Mode Method</h4>
<ol type="1">
<li>Long key enter pairing mode</li>
<li>First engage done enter pairing mode</li>
<li>No source bond list enter pairing mode</li>
<li>Linkback fail enter pairing mode</li>
<li>Source disconnect enter pairing mode</li>
<li>Short key enter pairing mode</li>
<li>Short key force enter pairing mode</li>
</ol>
<h4><a class="anchor" id="R-2411-exit-pairing-mode-method"></a>
2.4.11 Exit Pairing Mode Method</h4>
<ol type="1">
<li>B2s connected exit pairing mode</li>
<li>Timeout exit pairing mode</li>
<li>Short key exit pairing mode</li>
</ol>
<h4><a class="anchor" id="R-2412-enter-linkback-method"></a>
2.4.12 Enter Linkback Method</h4>
<ol type="1">
<li>Power on enter linkback</li>
<li>Link lost enter linkback</li>
<li>Key enter linkback</li>
</ol>
<h4><a class="anchor" id="R-2413-audio-a2dpavrcp"></a>
2.4.13 Audio [a2dp+avrcp]</h4>
<center><div id="table_2_4_1"><b>Table 2-4-1 A2dp Event From Framework</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_CONN_IND  </td><td class="markdownTableBodyLeft">Indicate A2DP connection indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_CONFIG_CMPL  </td><td class="markdownTableBodyLeft">Indicate A2DP set configuration complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_OPEN  </td><td class="markdownTableBodyLeft">Indicate A2DP stream open   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_START_IND  </td><td class="markdownTableBodyLeft">Indicate A2DP stream start indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_START_RSP  </td><td class="markdownTableBodyLeft">Indicate A2DP stream start response   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_STOP  </td><td class="markdownTableBodyLeft">Indicate A2DP stream stop   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_A2DP_STREAM_CLOSE  </td><td class="markdownTableBodyLeft">Indicate A2DP stream close   </td></tr>
</table>
<ul>
<li><a class="el" href="_a2_d_p.html#A2DP_USER_MANU">A2DP Application Note </a></li>
</ul>
<center><div id="table_2_4_2"><b>Table 2-4-2 Avrcp Event From Framework</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_CONN_IND  </td><td class="markdownTableBodyLeft">Indicate AVRCP connection indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_CONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate AVRCP connection complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_VOLUME_CHANGED  </td><td class="markdownTableBodyLeft">Indicate AVRCP volume changed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_VOLUME_UP  </td><td class="markdownTableBodyLeft">Indicate AVRCP volume up   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_VOLUME_DOWN  </td><td class="markdownTableBodyLeft">Indicate AVRCP volume down   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_REG_VOLUME_CHANGED  </td><td class="markdownTableBodyLeft">Indicate AVRCP register volume changed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_AVRCP_PLAY_STATUS_CHANGED  </td><td class="markdownTableBodyLeft">Indicate AVRCP play status changed   </td></tr>
</table>
<ul>
<li><a class="el" href="_a_v_r_c_p.html#AVRCP_USER_MANU">AVRCP Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-2414-call-hfpscopbap"></a>
2.4.14 Call [hfp+sco+pbap]</h4>
<center><div id="table_2_4_3"><b>Table 2-4-3 Hfp Main Event From Framework</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_CONN_IND  </td><td class="markdownTableBodyLeft">Indicate HFP connection indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_CONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate HFP connection complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_DISCONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate HFP disconnected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_CALL_STATUS  </td><td class="markdownTableBodyLeft">Indicate HFP call status change   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_SERVICE_STATUS  </td><td class="markdownTableBodyLeft">Indicate HFP service status change   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_CALL_WAITING_IND  </td><td class="markdownTableBodyLeft">Indicate the call waiting   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_CALLER_ID_IND  </td><td class="markdownTableBodyLeft">Indicate the incoming caller phone number   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_RING_ALERT  </td><td class="markdownTableBodyLeft">Indicate an incoming call   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_SPK_VOLUME_CHANGED  </td><td class="markdownTableBodyLeft">Indicate HFP speaker volume changed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_HFP_MIC_VOLUME_CHANGED  </td><td class="markdownTableBodyLeft">Indicate HFP microphone volume changed   </td></tr>
</table>
<ul>
<li>HFP_HFP_HSP_USER_Page</li>
</ul>
<center><div id="table_2_4_4"><b>Table 2-4-4 Sco Main Event From Framework</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_CONN_IND  </td><td class="markdownTableBodyLeft">Indicate SCO connection indication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_CONN_RSP  </td><td class="markdownTableBodyLeft">Indicate SCO connection response   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_CONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate SCO connection complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_DISCONNECTED  </td><td class="markdownTableBodyLeft">Indicate SCO disconnected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_LINK_SWITCH  </td><td class="markdownTableBodyLeft">Indicate active SCO link changed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_SNIFFING_CONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate SCO sniffing connection complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_SNIFFING_STARTED  </td><td class="markdownTableBodyLeft">Indicate SCO sniffing started   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_SNIFFING_STOPPED  </td><td class="markdownTableBodyLeft">Indicate SCO sniffing stopped   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_SCO_SNIFFING_DISCONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate SCO sniffing disconnection complete   </td></tr>
</table>
<center><div id="table_2_4_5"><b>Table 2-4-5 Pbap Main Event From Framework</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Event  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_PBAP_CONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate PBAP connection complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT_EVENT_PBAP_DISCONN_CMPL  </td><td class="markdownTableBodyLeft">Indicate PBAP disconnected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT_EVENT_PBAP_CALLER_ID_NAME  </td><td class="markdownTableBodyLeft">Indicate the incoming caller phone number   </td></tr>
</table>
<ul>
<li><a class="el" href="_a_n020__pbap__application__note.html#Pbap_Page">Pbap Function Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-2415-charging"></a>
2.4.15 Charging</h4>
<p>Two important message: 1- charger state; 2- state of charge <br />
</p><ol type="1">
<li>CHG_MSG_CHARGER_STATE_CHANGE //charger state message</li>
<li>CHG_MSG_STATE_OF_CHARGE_CHANGE //Battery percentage message</li>
</ol>
<h4><a class="anchor" id="R-2416-ota"></a>
2.4.16 OTA</h4>
<ul>
<li><a class="el" href="_a_n0119__r_w_s__o_t_a.html#RWS_OTA_Page">RWS OTA Application Note </a></li>
</ul>
<h3><a class="anchor" id="R-25-base-support-module"></a>
2.5 Base Support Module</h3>
<h4><a class="anchor" id="R-251-dirver"></a>
2.5.1 Dirver</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.1 PWM</h5>
<ul>
<li><a class="el" href="_a_n021__p_w_m__application__note.html#PWM_Page">PWM Function Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.2 HW Timer</h5>
<p>HW timer used to precision timing, such as ear sensor, smart charging box command and so on</p>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.3 GPIO</h5>
<ul>
<li><a class="el" href="_u_m012__i_o__d_e_m_o.html#IO_Demo_App_Page">IO User Manual </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.4 Key GPIO</h5>
<ul>
<li>KEY_GPIO_Page</li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.5 Buzzer</h5>
<ul>
<li><a class="el" href="_a_n007__buzzer__application__note.html#Buzzer_Page">Buzzer Function Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.6 IO Output</h5>
<p>Use gpio output 10HZ pulse</p>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.7 Sensor_px318j</h5>
<ul>
<li><a class="el" href="_a_n053__a_p_p__s_e_n_s_o_r__p_x318_j__m_o_d_u_l_e.html#Sensor_PX318J_Manual">APP SENSOR PX318J Module Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.8 Sensor_iqs773</h5>
<ul>
<li><a class="el" href="_a_n051__a_p_p__s_e_n_s_o_r__i_q_s773__m_o_d_u_l_e.html#APP_SENSOR_IQS773_Module_Page">APP SENSOR IQS773 Module Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.9 ADC</h5>
<ul>
<li>APP_ADC_Module_Page</li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.1.10 NFC</h5>
<ul>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Page">APP NFC Function Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-252-utility"></a>
2.5.2 Utility</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.2.1 Util</h5>
<p>Algorithm uitility such as check sum</p>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.2.2 EQ Utils</h5>
<ul>
<li><a class="el" href="_a_n023__e_q.html#EQ_Page">EQ Module User Manual </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.2.3 Link Util</h5>
<ul>
<li><a class="el" href="_a_n016__link__util__manual.html#Link_Util_Page">Link Util Function Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-253-storage"></a>
2.5.3 Storage</h4>
<ul>
<li>FTL_Page</li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.3.1 Config</h5>
<ul>
<li><a class="el" href="_a_n002__a_p_p__c_f_g.html#APP_Cfg_Page">APP Cfg Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.3.2 Bond</h5>
<ul>
<li>GAPStorage_Page</li>
</ul>
<h4><a class="anchor" id="R-254-event"></a>
2.5.4 Input Event</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.4.1 Key Process</h5>
<ul>
<li><a class="el" href="_a_n014__k_e_y__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#KEY_Page">KEY Function Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.4.2 Charger Box</h5>
<ul>
<li><a class="el" href="_u_m011__c_h_a_r_g_e_r.html#Charger_Page">Charger Module User Manual </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.4.3 Ear Sensor</h5>
<ul>
<li><a class="el" href="_a_n050__a_p_p__s_e_n_s_o_r__m_o_d_u_l_e.html#Sensor_Manual">APP SENSOR Module Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.4.4 Slide Switch</h5>
<p>Use the slide switch, can easily power on and power off.</p>
<h4><a class="anchor" id="R-255-command"></a>
2.5.5 Command</h4>
<ul>
<li>UserCmd_Page</li>
</ul>
<h4><a class="anchor" id="R-256-mmi"></a>
2.5.6 MMI</h4>
<div class="fragment"><div class="line">Power On/Power Off:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1babc5c64c8724149c79fa5ad7da4ab036e">MMI_DEV_POWER_ON</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae50ab1dc33d3f1323c6500f2e6576b8c">MMI_DEV_POWER_OFF</a></div><div class="line"></div><div class="line">Factory Reset:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9ce43d4ae4c16c6535a64da09729ef7b">MMI_DEV_TOOLING_FACTORY_RESET</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1badd86ff496bafb372785def82a4419473">MMI_DEV_CFG_FACTORY_RESET</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba404fda284d383848d2b8337e0d9f0fe5">MMI_DEV_FACTORY_RESET</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bacf759bca61156d10aa6ae696cc55b4fd">MMI_DEV_PHONE_RECORD_RESET</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba4dbf56fd129d361aa826891cb13ead11">MMI_DEV_FACTORY_RESET_BY_SPP</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba94ff0a3640ae7c2e16bb874bfb7189d5">MMI_DEV_PHONE_RECORD_RESET_BY_SPP</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baeb3d4f4527287d8ee2dbf2f1b2b13ea3">MMI_DEV_RESET_TO_UNINITIAL_STATE</a></div><div class="line"></div><div class="line">Linkback:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae1fe1166c4b1a70129fe316b0c55f784">MMI_DEV_LINK_LAST_DEVICE</a></div><div class="line"></div><div class="line">Pairing Mode/Force Pairing Mode:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba546963e592758ff73a09cd8bdd27bf41">MMI_DEV_ENTER_PAIRING_MODE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba40518e1541950c36635d8a35a0178f46">MMI_DEV_FORCE_ENTER_PAIRING_MODE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba6289d532f12d8d953fd749bbac604f7b">MMI_DEV_EXIT_PAIRING_MODE</a></div><div class="line"></div><div class="line">Volume:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9058c0c09cb16b1b1f218908de33f354">MMI_DEV_MIC_MUTE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3a86f9c5cbfc1a1759372de3ad81af0b">MMI_DEV_MIC_UNMUTE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba094e029becdf613fb220d30acf261964">MMI_DEV_MIC_VOL_UP</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3786562221f2d2954e219177a1f72d09">MMI_DEV_MIC_VOL_DOWN</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baa2aa7346b984a78e1f52e450791aa4a3">MMI_DEV_MIC_SWITCH</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1f013eaca019506a8a5a4297771eb33f">MMI_DEV_SPK_MUTE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1badadeab50bfa9ef8391698dc1fff5ea22">MMI_DEV_SPK_UNMUTE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae56062b30503adb2295ae991da5521a3">MMI_DEV_SPK_VOL_UP</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3ea2c8afda57bdcea1867727bdb764da">MMI_DEV_SPK_VOL_DOWN</a></div><div class="line"></div><div class="line">Audio:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba42030520a0b53f92ff4ad28a2b5a8565">MMI_AV_PLAY_PAUSE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba4fb14d4fa50fb3128cc77aed93da927d">MMI_AV_STOP</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba54b72f81c7ebfa4a5c1248f53c46a817">MMI_AV_FWD</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba30d4054f0b51be45e2d2b81363a8e00f">MMI_AV_BWD</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba17d2e23faa85c464bff216ba6f147cd9">MMI_AV_FASTFORWARD</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba00838c104efd588eebf4ebf5a42a8c75">MMI_AV_REWIND</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bac75fb989e7249ef00b35bd4af8a023eb">MMI_AV_FASTFORWARD_STOP</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baf3f5aafe9507f5641e21abb4d29d1050">MMI_AV_REWIND_STOP</a></div><div class="line"></div><div class="line">Call:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9171e3f9381adc52200b6fe785a9d453">MMI_HF_ANSWER_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba6fd0d50e9bd5f9aa1cef2605165e44a0">MMI_HF_END_ACTIVE_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3581574278deabf284d171bffebab37a">MMI_HF_REJECT_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba2e06bcbc584e78f9d9e245641b85a9ba">MMI_HF_END_OUTGOING_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae2475fb09cbbfe0b84079c249492b02c">MMI_HF_TRANSFER_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1e1889f16c50e5f8cf950deba16fea5f">MMI_HF_LAST_NUMBER_REDIAL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba4d420af6b712e0a334ee16c74f57fc59">MMI_HF_RELEASE_HELD_OR_WAITING_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae5985b43183394d1bb2050464eb409c4">MMI_HF_RELEASE_ACTIVE_CALL_ACCEPT_HELD_OR_WAITING_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baf3fcad26010b8ef4716ccf21383712f0">MMI_HF_SWITCH_TO_SECOND_CALL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3b4c60f21ef58a22d48e341ca931aa4a">MMI_HF_JOIN_TWO_CALLS</a></div><div class="line"></div><div class="line">Voice Assistant:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba784c056b6cdab8a1c26c21472468be1e">MMI_HF_INITIATE_VOICE_DIAL</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1534aba0358d86e6e039712e7c7311a3">MMI_HF_CANCEL_VOICE_DIAL</a></div><div class="line"></div><div class="line">ANC/APT Mode:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba546009ab2856ad3a2a90f279f4096e4f">MMI_AUDIO_ANC_ON</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bab0186cccccd83df0c2860b6568b207d9">MMI_AUDIO_APT_ON</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba90f3a362ed4cc4031ed53a0287c20cc3">MMI_AUDIO_ANC_APT_ALL_OFF</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba45a1f4ad4af8c98b35b285043b918af5">MMI_LISTENING_MODE_CYCLE</a></div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba7340bf127f4332694b26c59d29e0c7b2">MMI_ANC_CYCLE</a></div><div class="line"></div><div class="line">Gaming/Normal Mode:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba0d961af8998d57889c9a7c4b29a5a197">MMI_DEV_GAMING_MODE_SWITCH</a></div><div class="line"></div><div class="line">Air Plane Mode:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba78e1a6ea10a3fa3401fdd453d4cf076f">MMI_AIRPLANE_MODE</a></div><div class="line"></div><div class="line">OTA:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba218be5affc9dac75e61a72fd652fe418">MMI_OTA_OVER_BLE_START</a></div><div class="line"></div><div class="line">Dut Test Mode:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba8d1b9a3260b55095c0c0195fb862966a">MMI_DUT_TEST_MODE</a></div><div class="line"></div><div class="line">Local Playback:</div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba383ffbfb03a2f1bc22dbb07542f5bbb3">MMI_SD_PLAYBACK_SWITCH</a>         </div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba5550594db3530dc3dd64f62bb0a90031">MMI_SD_PLAYPACK_PAUSE</a>          </div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba5a246ebc82705c2431f3162a62225b90">MMI_SD_PLAYBACK_FWD</a>            </div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baf7f332d443a7f5e9dc9e40b2448d80db">MMI_SD_PLAYBACK_BWD</a>            </div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9cd706c8ca9686521fe25c39e0cb930b">MMI_SD_PLAYBACK_FWD_PLAYLIST</a>   </div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3fdd1e2044496ed36f4a4b2b3a2a965a">MMI_SD_PLAYBACK_BWD_PLAYLIST</a>   </div><div class="line">    <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba5f2eb6aee2d8f2e877699a6d06bd0542">MMI_SAVE_WHILE_LISTENING_ON_OFF</a></div></div><!-- fragment --><ul>
<li><a class="el" href="_a_n003__m_m_i__application__note.html#MMI_Page">MMI Function Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-257-output"></a>
2.5.7 Output</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.7.1 LED</h5>
<div class="fragment"><div class="line">Charging:</div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa688ac00891719353bf166128fb3b43f1">LED_MODE_CHARGING</a></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa62ff0bacaa72aac9e1491f89aff5e26e">LED_MODE_CHARGING_COMPLETE</a></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aacc89c32e4bb7d69b37062d015ef65e52">LED_MODE_CHARGING_ERROR</a></div><div class="line"></div><div class="line">Power Off:</div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aabb535ffe34c37e979b2163952ff8ed95">LED_MODE_ALL_OFF</a></div><div class="line"></div><div class="line">Call:</div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aad2ddb4e2f499421cfd78ae9f8720f033">LED_MODE_INCOMING_CALL</a></div><div class="line">    LED_MODE_OUTCOMING_CALL</div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aad35a18e994dd91bec85243ba0b1337a4">LED_MODE_TALKING</a></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaea7d2218f5781cd15ccd9736ddc72016">LED_MODE_MIC_MUTE</a></div><div class="line"></div><div class="line">Pairing Mode:</div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa6df1fcf18fff854a48f537b386cfce4b">LED_MODE_PAIRING</a></div><div class="line"></div><div class="line">B2s Connected:</div><div class="line">    Audio Playing:</div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa53823706ddf4ee44b3d02ab0e506db2c">LED_MODE_AUDIO_PLAYING</a></div><div class="line">    B2b Connected:</div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aacbcfb629b63efa21af845f0b896dc6c8">LED_MODE_BUD_ROLE_PRIMARY</a></div><div class="line">    Non B2b Connected:</div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa180e457ef186f89b8d1104fd29f4f6ef">LED_MODE_CONNECTED_SINGLE_LINK</a></div><div class="line"></div><div class="line">Non B2s Connected:</div><div class="line">    B2b Connected:</div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aab9d55eade8d5ca1dbcac2017ada6dcc5">LED_MODE_LINK_BACK</a></div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa67a94a30b0a7b0d25b7771ea8ba18750">LED_MODE_STANDBY</a></div><div class="line">    Non B2b Connected:</div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aac6b082b97f014c427d0abee923dab0ec">LED_MODE_BUD_FIRST_ENGAGE_CREATION</a></div><div class="line">        LED_MODE_BUD_COUPLING</div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aab9d55eade8d5ca1dbcac2017ada6dcc5">LED_MODE_LINK_BACK</a></div><div class="line">        <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa67a94a30b0a7b0d25b7771ea8ba18750">LED_MODE_STANDBY</a>    </div></div><!-- fragment --><ul>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Page">LED Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.7.2 Tone</h5>
<div class="fragment"><div class="line">Power On/Power Off:</div><div class="line">    tone_power_on</div><div class="line">    tone_power_off</div><div class="line"></div><div class="line">Factory Reset:</div><div class="line">    tone_factory_reset</div><div class="line"></div><div class="line">Linkback:</div><div class="line">    tone_link_connected</div><div class="line">    tone_link_disconnect</div><div class="line">    tone_link_loss</div><div class="line"></div><div class="line">Engage:</div><div class="line">    tone_remote_role_secondary</div><div class="line">    tone_remote_role_primary</div><div class="line">    tone_remote_disconnect</div><div class="line">    tone_remote_loss</div><div class="line"></div><div class="line">Pairing Mode/Force Pairing Mode:</div><div class="line">    tone_pairing</div><div class="line">    tone_pairing_fail</div><div class="line">    tone_pairing_timeout</div><div class="line"></div><div class="line">Volume:</div><div class="line">    tone_mic_mute_on</div><div class="line">    tone_mic_mute_off</div><div class="line">    tone_vol_max</div><div class="line">    tone_vol_min</div><div class="line">    tone_vol_changed</div><div class="line"></div><div class="line">Audio:</div><div class="line">    tone_audio_playing</div><div class="line">    tone_audio_paused</div><div class="line">    tone_audio_forward</div><div class="line">    tone_audio_backward</div><div class="line"></div><div class="line">Call:</div><div class="line">    tone_hf_call_active</div><div class="line">    tone_hf_call_end</div><div class="line">    tone_hf_call_reject</div><div class="line">    tone_hf_transfer_to_phone</div><div class="line">    tone_hf_call_redial</div><div class="line">    tone_hf_outgoing_call</div><div class="line">    tone_hf_no_service</div><div class="line"></div><div class="line">Voice Assistant:</div><div class="line">    tone_hf_call_voice_dial</div><div class="line"></div><div class="line">Gaming/Normal Mode:</div><div class="line">    tone_enter_gaming_mode</div><div class="line">    tone_exit_gaming_mode</div><div class="line"></div><div class="line">Air Plane Mode:</div><div class="line">    tone_enter_airplane</div><div class="line">    tone_exit_airplane</div><div class="line"></div><div class="line">OTA:</div><div class="line">    tone_ota_over_ble_start</div></div><!-- fragment --><p><a class="anchor" id="invalid"></a></p><h5>2.5.7.3 Audio Policy</h5>
<ul>
<li>Audio_policy_Page</li>
</ul>
<h4><a class="anchor" id="R-258-sdp"></a>
2.5.8 SDP</h4>
<p>Sdp Server:</p><ol type="1">
<li>DID</li>
<li>A2DP/AVRCP</li>
<li>HSP/HFP/PBAP</li>
<li>SPP/IAP</li>
<li>GFPS</li>
<li>HID</li>
</ol>
<h4><a class="anchor" id="R-259-relay"></a>
2.5.9 Relay</h4>
<p>TBD</p>
<h4><a class="anchor" id="R-2510-roleswap"></a>
2.5.10 Roleswap</h4>
<ul>
<li><a class="el" href="_a_n017__r_o_l_e_s_w_a_p.html#ROLESWAP_Page">ROLESWAP Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-2511-multilink"></a>
2.5.11 Multilink</h4>
<p>TBD</p>
<h4><a class="anchor" id="R-2512-sniffing-link"></a>
2.5.12 Sniffing Link</h4>
<ul>
<li><a class="el" href="_a_n006__b_t__s_n_i_f_f_i_n_g__application__note.html#Sniffing_Page">eRWS Sniffing Introduction </a></li>
</ul>
<h4><a class="anchor" id="R-2513-low-power"></a>
2.5.13 Low Power</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.13.1 Sniff Mode</h5>
<p>When bt acl link is idle, it will enter sniff mode to reduce power, <br />
 It will exit sniff mode when the acl link is active. <br />
</p>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.13.2 DLPS</h5>
<ul>
<li><a class="el" href="_u_m010__l_o_w__p_o_w_e_r__m_o_d_e.html#DlpsPage">Low Power Mode User Manual </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.5.13.3 Power Down</h5>
<ul>
<li><a class="el" href="_u_m010__l_o_w__p_o_w_e_r__m_o_d_e.html#DlpsPage">Low Power Mode User Manual </a></li>
</ul>
<h4><a class="anchor" id="R-2514-wdt-reset"></a>
2.5.14 Wdt Reset</h4>
<ol type="1">
<li>Hard fault wdt reset</li>
<li>Software wdt reset</li>
<li>Timeout wdt reset</li>
</ol>
<h3><a class="anchor" id="R-26-advanced-feature"></a>
2.6 Advanced Feature</h3>
<h4><a class="anchor" id="R-261-smart-charger-box"></a>
2.6.1 Smart Charger Box</h4>
<p>TBD</p>
<h4><a class="anchor" id="R-262-air-plane-mode"></a>
2.6.2 Air Plane Mode</h4>
<p>When you go by plane, you can shut down the rws, <br />
 Other way, you can let the rws enter the air plane mode. <br />
</p>
<h4><a class="anchor" id="R-263-gaming-mode"></a>
2.6.3 Gaming Mode</h4>
<p>When you want to play game, you can go to gaming mode, it is low lantency</p>
<h4><a class="anchor" id="R-264-sound-effect"></a>
2.6.4 Sound Effect</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.6.4.1 NREC</h5>
<ol type="1">
<li>Noice Reduction</li>
<li>Echo Canceling</li>
</ol>
<p><a class="anchor" id="invalid"></a></p><h5>2.6.4.2 ANC</h5>
<ul>
<li><a class="el" href="_a_n045__a_p_p__a_n_c__m_o_d_u_l_e.html#APP_ANC_Module_Page">APP ANC Module Application Note </a></li>
</ul>
<p><a class="anchor" id="invalid"></a></p><h5>2.6.4.3 APT</h5>
<ul>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#Normal_APT_Page">Normal APT Function Application Note </a></li>
<li><a class="el" href="_a_n040__l_l_a_p_t__application__note.html#LLAPT_Page">LLAPT Function Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-265-voice-assistant"></a>
2.6.5 Voice Assistant</h4>
<p><a class="anchor" id="invalid"></a></p><h5>2.6.5.1 VAD</h5>
<p>When want to use voice assistant easily, you could open voice activity detection at first.</p>
<h4><a class="anchor" id="R-266-tts"></a>
2.6.6 TTS</h4>
<ul>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Page">TTS Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-267-gfps"></a>
2.6.7 GFPS</h4>
<ul>
<li><a class="el" href="_a_n100__g_f_p_s.html#GFPS_Page">GFPS Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-268-swift-pair"></a>
2.6.8 Swift Pair</h4>
<ul>
<li><a class="el" href="_a_n101__a_p_p__s_w_i_f_t__p_a_i_r.html#APP_SWIFT_PAIR_Page">APP SWIFT PAIR Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-269-line-in"></a>
2.6.9 Line In</h4>
<ul>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Page">Line In Function Application Note </a></li>
</ul>
<h4><a class="anchor" id="R-2610-nfc"></a>
2.6.10 NFC</h4>
<ul>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Page">APP NFC Function Application Note </a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="R-3-sdk-development"></a>
3 SDK Development</h2>
<h3><a class="anchor" id="R-31-easy-to-entry"></a>
3.1 Easy Entry</h3>
<h4><a class="anchor" id="R-311-download-bin-toolmppgtool"></a>
3.1.1 Download Bin [Tool/MPPGTool]</h4>
<ul>
<li>MPPGTool</li>
</ul>
<h4><a class="anchor" id="R-312-print-log-tooldebuganalyzer"></a>
3.1.2 Print Log [Tool/DebugAnalyzer]</h4>
<div class="fragment"><div class="line">Settings:</div><div class="line">    Output Directory:</div><div class="line"></div><div class="line">    ROM Trace File: Trace/ROMI.trace</div><div class="line">    ROM Index File: Trace/LOG1.h</div><div class="line"></div><div class="line">    App Trace File: Trace/Bank0_Trace/rws_bank0.trace</div><div class="line"></div><div class="line">    Patch Trace File: Trace/Bank0_Trace/patch.trace</div><div class="line">    Patch Index File: Trace/Bank0_Trace/patch_log.h</div></div><!-- fragment --><div class="image">
<img src="log.png" alt="log.png"/>
</div>
 <center><div id="figure_3_1_1"><b>Figure 3-1-1 Log Tags</b></div></center><ul>
<li>DebugAnalyser</li>
</ul>
<h4><a class="anchor" id="R-313-modify-config-file-toolmcuconfigtool"></a>
3.1.3 Modify Config File [Tool/McuConfigTool]</h4>
<div class="fragment"><div class="line">Do some simple modify, <span class="keywordflow">for</span> example: System Configuration / BD Address</div><div class="line">Note: must Refresh and Update Ringtone</div><div class="line"></div><div class="line">Download the config file and run, in DebugAnalyzer,</div><div class="line">Search <span class="stringliteral">&quot;set_bd_addr&quot;</span>, to see <span class="keywordflow">if</span> it is as your modify.</div></div><!-- fragment --><ul>
<li>MCUConfigTool</li>
</ul>
<h4><a class="anchor" id="R-314-modify-source-code-keil-uvision5"></a>
3.1.4 Modify Source Code [Keil uVision5]</h4>
<div class="fragment"><div class="line">Open the project: sdk\board\evb\rws\rws.uvprojx, Rebuild all target files,</div><div class="line"></div><div class="line">Gen: sdk\board\evb\rws\bin\dualbank\bank0\rws_bank0_MP-xxx.bin</div><div class="line">Sign: sdk\board\evb\rws\bin\dualbank\bank0\rws_bank0_MP-xxx_Sign-yyy.bin</div><div class="line"></div><div class="line">Download the app bin and run, in DebugAnalyzer,</div><div class="line">Search <span class="stringliteral">&quot;[APP] !**APP COMPILE TIME:&quot;</span>, to see <span class="keywordflow">if</span> it is the right time.</div><div class="line"></div><div class="line">Then, you can add some log, to see <span class="keywordflow">if</span> it is as your modify.</div></div><!-- fragment --><h4><a class="anchor" id="R-315-how-to-use-the-rws"></a>
3.1.5 How To Use The RWS</h4>
<ol type="1">
<li>Two bud all do factory reset, when done, they will power off</li>
<li>Two bud closely power on at the same time, then they will engaged and enter pairing mode</li>
<li>Use a phone inquire and connect the rws</li>
<li>Play a song</li>
<li>Do a call</li>
<li>Power off</li>
<li>Power on again</li>
<li>It will auto linkback to the phone and do the engage</li>
</ol>
<h3><a class="anchor" id="R-32-deep-development"></a>
3.2 Deep Development</h3>
<h4><a class="anchor" id="R-321-analyse-log-file"></a>
3.2.1 Analyse Log File</h4>
<div class="fragment"><div class="line">In common use log is:</div><div class="line"></div><div class="line">1. [APP]</div><div class="line">key_check_press</div><div class="line">app_in_out_box_handle</div><div class="line"><a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a></div><div class="line">led_set_mode</div><div class="line"><a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a></div><div class="line">app_device_bt_cback</div><div class="line">app_audio_policy_cback</div><div class="line"></div><div class="line">2. [ENGAGE]</div><div class="line">include reboot, startup, shutdown, engage, linkback, stable</div><div class="line">it is a very good log to understand the app</div><div class="line"></div><div class="line">3. [OS]</div><div class="line">create timer</div><div class="line"><span class="keyword">delete</span> timer</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
