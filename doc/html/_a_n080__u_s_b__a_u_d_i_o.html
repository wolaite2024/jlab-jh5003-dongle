<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="USB_Audio_Page"></a>
USB Audio Application Note    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/07/10</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/07/10  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Rev">Revision History</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Table_List">Table List</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Configuration">2 USB Audio Configuration</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_App_Scenario">3 USB Audio Application Scenario</a></li>
<li><a class="el" href="_a_n080__u_s_b__a_u_d_i_o.html#USB_Audio_Source_Code">4 Source Code Overview</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 Enable USB Audio and HID</a></li>
<li><a href="#figure_2_2">Figure 2-2 Enable Adaptor</a></li>
<li><a href="#figure_2_3">Figure 2-3 Allow Power On When Charging</a></li>
<li><a href="#figure_2_4">Figure 2-4 LDOUSB Setting</a></li>
<li><a href="#figure_3_1">Figure 3-1 USB Work on Device Power On State</a></li>
<li><a href="#figure_3_2">Figure 3-2 USB Audio Work Scenario</a></li>
<li><a href="#figure_2_3">Figure 4-1 Structure of USB</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">USB  </td><td class="markdownTableBodyCenter">Universal Serial Bus   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">HID  </td><td class="markdownTableBodyCenter">Human Interface Devices   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Introduction"></a>
1 Introduction</h2>
<p>The purpose of this document is to introduce USB audio configuration and USB audio API. This document gives a tutorial of USB audio configuration by MCUConfig Tool. What's more, it describes the usage scenario of USB audio, it would help to familiar with USB audio. Lastly, it describes how to use USB audio API.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Configuration"></a>
2 USB Audio Configuration</h2>
<p>The section elaborates configuration process by MCU Config Tool to make USB audio function work.<br />
 MCU Config Tool is provided in directory as illustrated below.<br />
 Firstly, enable USB audio and HID, and then choose USB speed as illustrated in Figure 2-1:<br />
 </p><div class="image">
<img src="enable_usb_audio_and_hid.png" alt="enable_usb_audio_and_hid.png"/>
</div>
 <center><div id="figure_2_1"><b> Figure 2-1 Enable USB Audio and HID </b></div></center><p>Because USB start/stop is triggered by ADP IN/OUT, the second thing is to enable adaptor (as illustrated in Figure 2);<br />
 </p><div class="image">
<img src="enable_adaptor.png" alt="enable_adaptor.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 Enable Adaptor </b></div></center><p>In addition, choose "Allow" from "Allow power on function when charging" combobox, as illustrated in Figure 2-3.<br />
 </p><div class="image">
<img src="usb_enable_power_on_when_charging.png" alt="usb_enable_power_on_when_charging.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Allow Power On When Charging </b></div></center><p>For RTL87X3D, in system configuration, <b>LDOUSB</b> should be set as 3.3V as Figure 2-4.<br />
 </p><div class="image">
<img src="LDOUSB.png" alt="LDOUSB.png"/>
<div class="caption">
Figure 2-4 LDOUSB Setting</div></div>
 <div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_App_Scenario"></a>
3 USB Audio Application Scenario</h2>
<p>This section describes USB audio Application scenario and gives an example. When USB audio device is plugged in PC/phone by USB, it will active some function. <br />
 If device is power off state, plug in PC, device will power on. The flow is shown in Figure 3-1. <br />
 </p><div class="image">
<img src="power_on_off_usb_audio_work_flow.png" alt="power_on_off_usb_audio_work_flow.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 USB Work on Device Power On State </b></div></center> <div class="image">
<img src="usb_audio_work_scenario.png" alt="usb_audio_work_scenario.png"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 USB Audio Work Scenario </b></div></center><p> In Figure 3-2, firstly, device finds USB and executes a process known as bus enumeration. In multilink scenario, USB audio is playing music and a2dp, which is playing state, the device play it;<br />
 Secondly, if hoster is playing, the device audio will be played by USB audio, then BT HFP work, usb audio will stop and hfp is working. <br />
 Then, when end of the call, USB audio will resume. <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="USB_Audio_Source_Code"></a>
4 Source Code Overview</h2>
<p>The section describes how to use USB audio API. USB code introduction is shown as below: </p><div class="image">
<img src="USB_code_introduction.png" alt="USB_code_introduction.png"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 Structure of USB </b></div></center><ul>
<li>USB core provides apis to register descriptor, data tranfer, device manage .etc.</li>
<li>USB Audio Interface/HID Interface is used to realize user-defined interface descriptors. optional vendor request, .etc.</li>
<li>USB Audio Stream and HID Pipe are abstract data transmission path for application.</li>
<li>Application layer is used for user-defined scenario, such as using USB Audio to play music.</li>
<li>Device Manager is used to manage USB start/stop and ohter user-defined flow.</li>
</ul>
<p>User must configure USB audio, define <a class="el" href="group___a_p_p___f_l_a_g_s.html#gad1c3c87d421a3ee6b2df1733f1708e2b">F_APP_USB_AUDIO_SUPPORT</a> and <a class="el" href="group___a_p_p___f_l_a_g_s.html#ga7ed1ea35a0e45c923dd02baec588424f">F_APP_MUTLILINK_SOURCE_PRIORITY_UI</a> in app_flags.h.<br />
</p>
<p>User can modify USB Audio descriptors in usb_audio1.c. For example:<br />
 </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct__uac1__input__terminal__descriptor.html">T_UAC1_IT_DESC</a>     input_terminal_desc0 =</div><div class="line">{</div><div class="line">    .<a class="code" href="struct__uac1__input__terminal__descriptor.html#a1deca1f1d6e5815b290e6e1015bce5b8">bLength</a>            = <span class="keyword">sizeof</span>(<a class="code" href="struct__uac1__input__terminal__descriptor.html">T_UAC1_IT_DESC</a>),</div><div class="line">    .bDescriptorType    = UAC1_DT_CS_INTERFACE,</div><div class="line">    .bDescriptorSubtype = UAC1_INPUT_TERMINAL,</div><div class="line">    .bTerminalID        = ID_INPUT_TERMINAL1,</div><div class="line">    .wTerminalType      = UAC1_INPUT_TERMINAL_MICROPHONE,</div><div class="line">    .bAssocTerminal     = 0,</div><div class="line">    .bNrChannels        = 1,</div><div class="line">    .wChannelConfig     = 1,</div><div class="line">    .iChannelNames      = 0,</div><div class="line">    .iTerminal          = 0,</div><div class="line">};</div></div><!-- fragment --><p> User can modify USB device manager , such as when to start/stop in app_usb.c. For example macro as follows means USB will start only if USB init/plug/evb power on process are done. </p><div class="fragment"><div class="line"><span class="preprocessor">#define READY_BIT_ALL        (READY_BIT_POWER_ON|READY_BIT_PLUGGED|READY_BIT_INIT)</span></div></div><!-- fragment --><p> When power_on_when_usb_plug is set to 1, EVB will power on when USB plug in. </p>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
