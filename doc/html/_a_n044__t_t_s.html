<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="TTS_Page"></a>
TTS Application Note    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.1</b></center><p><br />
 </p><center><b>2023/06/25</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/06/25  </td><td class="markdownTableBodyCenter">Modify TTS Structure   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Rev">Revision History</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Table_List">Table List</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Configuration">2 Configuration</a><ul>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_CFG_Keil">2.1 How To Set up TTS Environment</a></li>
</ul>
</li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_Initialization_process">3 Initialization process</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_APP_CB">4 APP Callback</a><ul>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_STATUS_APP">4.1 Indicates TTS Status to APP</a></li>
<li><a class="el" href="_a_n044__t_t_s.html#TTS_ADV_STATUS">4.2 Indicates TTS Advertisement Status to APP</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_1">Figure 1-1 Configure TTS Control Flow</a></li>
<li><a href="#figure_2_1">Figure 2-1 Configure TTS Through LE</a></li>
<li><a href="#figure_2_2">Figure 2-2 Configure TTS Through SPP</a></li>
<li><a href="#figure_2_3">Figure 2-3 Configure TTS Audio Information</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TTS  </td><td class="markdownTableBodyCenter">Text to Speech   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Introduction"></a>
1 Introduction</h2>
<p>TTS technology is the abbreviation of Text To Speech, It can transforms equipment generated or externally written text information into audio format that be fluent audible language. TTS can be connected by SPP or LE link. </p><div class="image">
<img src="tts_control_flow.png" alt="tts_control_flow.png"/>
</div>
 <center><div id="figure_1_1"><b>Figure 1-1 TTS Control Flow</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Configuration"></a>
2 Configuration</h2>
<h3><a class="anchor" id="TTS_CFG_Keil"></a>
2.1 How To Set up TTS Environment</h3>
<p>In app_flags.h set F_APP_TTS_SUPPORT to 1 to support TTS: </p><div class="fragment"><div class="line"><span class="preprocessor">#define F_APP_TTS_SUPPORT            1</span></div></div><!-- fragment --><p>In mcu cfg tool:</p><ul>
<li>Enable TTS through BLE <div class="image">
<img src="TTS_mcu_cfg_LE.png" alt="TTS_mcu_cfg_LE.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Configure TTS Through LE </b></div></center></li>
<li>Enable TTS through SPP <div class="image">
<img src="TTS_mcu_cfg_BR.png" alt="TTS_mcu_cfg_BR.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 Configure TTS Through SPP </b></div></center></li>
<li>Configure audio route <div class="image">
<img src="TTS_mcu_cfg_audio.png" alt="TTS_mcu_cfg_audio.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Configure TTS Audio Information </b></div></center></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_Initialization_process"></a>
3 Initialization process</h2>
<p>Register tts callback app_tts_bt_cback(): </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___a_p_p___b_l_e___t_t_s___exported___functions.html#gaf928f1b2626f3ed55286682a182c01c8">app_tts_init</a>();</div><div class="line">    }</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___exported___functions.html#gaf928f1b2626f3ed55286682a182c01c8">app_tts_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gada22d2516f046d7c0abd150512e25fae">app_ble_common_adv_cb_reg</a>(app_tts_common_adv_cb);</div><div class="line">    <a class="code" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>(app_tts_bt_cback);</div><div class="line">}</div></div><!-- fragment --><p>Init tts advertisement: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga9cc1b5f72081250b45c8fe4d675334f3">app_ble_common_adv_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___l_e___e_x_t_e_n_d_e_d___a_d_v___exported___functions.html#ga7b8bcbea5cf112ca7c19ce757a89eeb0">ble_ext_adv_mgr_init_adv_params</a>(&amp;le_common_adv.adv_handle, adv_event_prop, adv_interval_min,</div><div class="line">                                    adv_interval_max, own_address_type, peer_address_type, peer_address,</div><div class="line">                                    filter_policy, 23 + data_len, app_ble_common_adv_data,</div><div class="line">                                    <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>, <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>, le_random_addr);</div><div class="line"></div><div class="line">    <a class="code" href="group___l_e___e_x_t_e_n_d_e_d___a_d_v___exported___functions.html#ga21de10157b31a9041d2e7e7dc862e912">ble_ext_adv_mgr_register_callback</a>(app_ble_common_adv_callback, le_common_adv.adv_handle);</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="TTS_APP_CB"></a>
4 APP Callback</h2>
<h3><a class="anchor" id="TTS_STATUS_APP"></a>
4.1 Indicates TTS Status to APP</h3>
<p>app_tts_bt_cback() function indicates tts status to app:</p><ul>
<li>when event BT_EVENT_HFP_CONN_CMPL or BT_EVENT_A2DP_CONN_CMPL was received, use app_trigger_ble_adv() to start tts advertisement.</li>
<li>when event BT_EVENT_HFP_DISCONN_CMPL or BT_EVENT_A2DP_DISCONN_CMPL was received, use app_trigger_stop_ble_link_and_adv() to stop tts advertisement.</li>
<li>when bt_hfp_call_status is BT_HFP_INCOMING_CALL_ONGOING, it means tts start.</li>
<li>when bt_hfp_call_status is BT_HFP_CALL_ACTIVE, it means tts end.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_tts_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">   ......</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a260fb5fa6196b0cca640a30c21b80e73">BT_EVENT_HFP_CONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#gaa4edc91b3201c58e16569194ee8d3e2b">app_link_find_br_link</a>(param-&gt;hfp_conn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___l_i_n_k.html#ga565f4ea09776244c88b0d664e70f8c51">SPP_PROFILE_MASK</a> &amp; p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a087e2f6dc5d9eaf16961f3984f062df6">connected_profile</a>) == 0)</div><div class="line">                {</div><div class="line">                    app_tts_start_ble_adv(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a83f311765467eaa0250070fa4095045e">BT_EVENT_A2DP_CONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#gaa4edc91b3201c58e16569194ee8d3e2b">app_link_find_br_link</a>(param-&gt;a2dp_conn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___l_i_n_k.html#ga565f4ea09776244c88b0d664e70f8c51">SPP_PROFILE_MASK</a> &amp; p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a087e2f6dc5d9eaf16961f3984f062df6">connected_profile</a>) == 0)</div><div class="line">                {</div><div class="line">                    app_tts_start_ble_adv(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac490286996a17bd8fb85ea8f7e0172ae">BT_EVENT_SPP_CONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#gaa4edc91b3201c58e16569194ee8d3e2b">app_link_find_br_link</a>(param-&gt;spp_conn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.device_state != <a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#gga15b39534ff1f5dd5236b4bcb615d24cdaa9b783b81aeeba7ece64ab47b4d25221">APP_DEVICE_STATE_OFF</a> &amp;&amp;</div><div class="line">                    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a3a435c9f3adb75b4362a3122066505d7">rtk_app_adv_support</a> &amp;&amp; (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ada4f59b1542be16951f054fa3e72cbd1">timer_ota_adv_timeout</a> != 0)</div><div class="line">                        &amp;&amp; !<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#aacfb343fcc0139d45f494335fd443d1f">enable_power_on_adv_with_timeout</a>)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gadfb56e1041536a7cf0d74e3048d33f88">app_ble_common_adv_get_state</a>() != <a class="code" href="group___l_e___e_x_t_e_n_d_e_d___a_d_v___exported___types.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3acf6402209e91954f506dfeaf6f040123">BLE_EXT_ADV_MGR_ADV_DISABLED</a>)</div><div class="line">                        {</div><div class="line">                            <a class="code" href="group__x3d___t_r_a_c_e.html#ga3865df28228d19d7a9c874cddfada3c4">APP_PRINT_TRACE0</a>(<span class="stringliteral">&quot;app_tts_bt_cback: spp connect, stop common adv&quot;</span>);</div><div class="line">                            <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga71ee4d3eb43ff1f665e4b43bbb36e7c1">app_ble_common_adv_stop</a>(APP_STOP_ADV_CAUSE_COMMON_FOR_SPP_CONN);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a9724a83efcc548be532cf105940434f5">BT_EVENT_HFP_DISCONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#gaa4edc91b3201c58e16569194ee8d3e2b">app_link_find_br_link</a>(param-&gt;hfp_disconn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">                {</div><div class="line">                    uint8_t remain_profile = (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.<a class="code" href="struct_t___a_p_p___b_t___p_a_n___d_e_m_o___a_p_p___d_b.html#a626d0674adf98cdfd57ee45c011c1971">br_link</a>[p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1e6927fa1486224044e568f9c370519b">id</a>].connected_profile &amp;</div><div class="line">                                              (~(<a class="code" href="group___a_p_p___l_i_n_k.html#ga9350dc5450acd9e6076db7f0335eed81">HFP_PROFILE_MASK</a> | <a class="code" href="group___a_p_p___l_i_n_k.html#ga94f008dab48d6c04e67c336effad9519">HSP_PROFILE_MASK</a>)));</div><div class="line">                    <span class="keywordflow">if</span> (!(remain_profile &amp; <a class="code" href="group___a_p_p___l_i_n_k.html#gaad765ad29cb83f3abedb49901d855c3d">A2DP_PROFILE_MASK</a>))</div><div class="line">                    {</div><div class="line">                        app_tts_stop_ble_link_and_adv(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aa0f06a739544f814d6fedab714dc97d6">BT_EVENT_A2DP_DISCONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#gaa4edc91b3201c58e16569194ee8d3e2b">app_link_find_br_link</a>(param-&gt;a2dp_disconn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">                {</div><div class="line">                    uint8_t remain_profile = (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.<a class="code" href="struct_t___a_p_p___b_t___p_a_n___d_e_m_o___a_p_p___d_b.html#a626d0674adf98cdfd57ee45c011c1971">br_link</a>[p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1e6927fa1486224044e568f9c370519b">id</a>].connected_profile &amp; (~<a class="code" href="group___a_p_p___l_i_n_k.html#gaad765ad29cb83f3abedb49901d855c3d">A2DP_PROFILE_MASK</a>));</div><div class="line">                    <span class="keywordflow">if</span> (!(remain_profile &amp; (<a class="code" href="group___a_p_p___l_i_n_k.html#ga9350dc5450acd9e6076db7f0335eed81">HFP_PROFILE_MASK</a> | <a class="code" href="group___a_p_p___l_i_n_k.html#ga94f008dab48d6c04e67c336effad9519">HSP_PROFILE_MASK</a>)))</div><div class="line">                    {</div><div class="line">                        app_tts_stop_ble_link_and_adv(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a2e4e92442dda7112614cc76d14f7ee5b">BT_EVENT_HFP_CALL_STATUS</a>:</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___l_e___l_i_n_k.html">T_APP_LE_LINK</a> *p_le_link;</div><div class="line">            p_le_link = <a class="code" href="group___a_p_p___l_i_n_k.html#ga9b47398fa8631b6013774267daa1297c">app_link_find_le_link_by_addr</a>(param-&gt;hfp_call_status.bd_addr);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> ((p_le_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (p_le_link-&gt;<a class="code" href="struct_t___a_p_p___l_e___l_i_n_k.html#a0b57aa10271a66f3dc936bba1d2f3830">state</a> == <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gga8e32165862758d82cb9c6dfc689b4e58a231bf631b34c319de30b424ea3807885">LE_LINK_STATE_CONNECTED</a>))</div><div class="line">            {</div><div class="line">                <span class="comment">//BT_HFP_CALL_INCOMING:tts start, BT_HFP_CALL_ACTIVE:tts end, BT_HFP_CALL_IDLE: call end.</span></div><div class="line">                <span class="keywordflow">if</span> (param-&gt;hfp_call_status.curr_status == <a class="code" href="group___b_t___h_f_p.html#gga71dc8535e88cd8ea60bdf8f574317841a43a587aa8a6b8e4ce79990c52b6e432e">BT_HFP_CALL_INCOMING</a>)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___l_e___c_o_n_n___exported___functions.html#gaa3c11f923c645baef42eaffaa1d6f96f">ble_set_prefer_conn_param</a>(p_le_link-&gt;<a class="code" href="struct_t___a_p_p___l_e___l_i_n_k.html#a6f2749c213f11ad9a16583079a554b39">conn_id</a>,</div><div class="line">                                              <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga68805d936c2066de60d8ab34feee0683">RWS_LE_DEFAULT_MIN_CONN_INTERVAL</a>,</div><div class="line">                                              <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga6fa2239ef0b3c8e411ae1d42a1329791">RWS_LE_DEFAULT_MAX_CONN_INTERVAL</a>,</div><div class="line">                                              <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gac6d6d6d808cd920b5dce097c5d7457b9">RWS_LE_DEFAULT_SLAVE_LATENCY</a>,</div><div class="line">                                              <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga80d260665b60d66b3a1672d308fea223">RWS_LE_DEFAULT_SUPERVISION_TIMEOUT</a>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div><div class="line">    }</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="TTS_ADV_STATUS"></a>
4.2 Indicates TTS Advertisement Status to APP</h3>
<p>app_ble_common_adv_callback() will indicates tts advertisement status to app. </p>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
