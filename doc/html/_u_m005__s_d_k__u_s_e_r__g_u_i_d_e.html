<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p>
<h1><a class="anchor" id="SDK_USER_GUIDE"></a>
SDK User Guide </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.3</b></center><p><br />
 </p><center><b>2023/12/21</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="SDK_UM_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2021/11/10  </td><td class="markdownTableBodyCenter">Add RTL87X3D support   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.1.0  </td><td class="markdownTableBodyCenter">2022/09/09  </td><td class="markdownTableBodyCenter">Optimize typography   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.1.1  </td><td class="markdownTableBodyCenter">2023/03/20  </td><td class="markdownTableBodyCenter">Optimized typography and content   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/05/19  </td><td class="markdownTableBodyCenter">Optimized typography   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/11/07  </td><td class="markdownTableBodyCenter">Optimized content   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.3  </td><td class="markdownTableBodyCenter">2023/12/21  </td><td class="markdownTableBodyCenter">Modify figures   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Rev">Revision History</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Table_List">Table List</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Overview">1 Overview</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Getting_Started">2 Getting Started</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_HW_Block">3 Hardware Architecture</a><ul>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_HW_Block_RTL87X3E">3.1 RTL87X3E</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_HW_Block_RTL87X3D">3.2 RTL87X3D</a></li>
</ul>
</li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_SW_Arch">4 Software Architecture</a><ul>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_SYS_Arch">4.1 System Architecture</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_OPERATION_SYSTEM">4.2 Real Time Operating System</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_OS_Interface">4.3 OS Interfaces</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Task_View">4.4 Task and Priority</a></li>
</ul>
</li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_APP">5 Application</a><ul>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_SDK_Dir">5.1 SDK Directory</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_Sample_projects">5.2 Sample Projects</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_APP_Flow">5.3 Application Process Flow</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_MSG_AND_EVT_HANDLE_FLOW">5.4 MSG and Event Handling Flow</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_IO_MSG">5.5 IO MSG</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDK_UM_DLPS_SETTINGS">5.6 DLPS Settings</a></li>
</ul>
</li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#Memory">6 Memory</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#POWER_MANAGEMENT">7 Power Management</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#Download">8 Download</a></li>
<li><a class="el" href="_u_m005__s_d_k__u_s_e_r__g_u_i_d_e.html#SDKDebug">9 Debug</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_4_1">Table 4-1 Task and Prioroty Description</a></li>
<li><a href="#table_5_1">Table 5-1 SDK Directory Description</a></li>
<li><a href="#table_5_2">Table 5-2 Application Process Flow Description</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_3_1">Figure 3-1 RTL87X3E Hardware Block</a></li>
<li><a href="#figure_3_2">Figure 3-2 RTL87X3D Hardware Block</a></li>
<li><a href="#figure_4_1">Figure 4-1 Software Architecture</a></li>
<li><a href="#figure_4_2">Figure 4-2 OSIF Overview</a></li>
<li><a href="#figure_4_3">Figure 4-3 Tasks</a></li>
<li><a href="#figure_5_1">Figure 5-1 SDK Directory</a></li>
<li><a href="#figure_5_2">Figure 5-2 Demo App in Dongle SDK</a></li>
<li><a href="#figure_5_3">Figure 5-3 ble_peripheral sample project</a></li>
<li><a href="#figure_5_4">Figure 5-4 APP Flow</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SDK  </td><td class="markdownTableBodyCenter">Software Development Kits   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">OSIF  </td><td class="markdownTableBodyCenter">Operating System Interface   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">DSP1  </td><td class="markdownTableBodyCenter">Hifi Mini DSP   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">DSP2  </td><td class="markdownTableBodyCenter">Hifi 4 DSP   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_Overview"></a>
1 Overview</h2>
<p>The Realtek MCU Software Development Kits (SDK) contain software development tools, documents and sample projects that enable engineers to develop applications on a range of Realtek BT Audio SoCs, such as RTL87X3E and RTL87X3D. The SDK is provided as separate installations optimized for each Realtek BT Audio SoCs family. The SDK includes drivers for hardware abstraction layer, peripherals, connectivity, such as Bluetooth/Bluetooth Low Energy, audio and other third party features. It also provides power and battery management, Firmware update Over-The-Air (FOTA) and FreeRTOS. SDK provide a cohesive and consistent software experience by packaging essential software components and easy-to-use examples in one easy-to-use software package.</p>
<p>This document shows you how to develop BT audio applications using RTL87X3 Software Development Kit (SDK) and the following topics are included:</p>
<ul>
<li>Getting started</li>
<li>Simple introduction of hardware architecture</li>
<li>Detailed introduction of software architecture</li>
<li>Sample projects introduction</li>
<li>Memory, Power management, Download and Debug introduction</li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_Getting_Started"></a>
2 Getting Started</h2>
<p>The SDK provides example applications that you can run on your development kit to ensure that everything is set up correctly. After these tests, you can use the examples as starting point to develop your own applications.</p>
<p>To get started using the SDK, <a class="el" href="_u_m001__q_u_i_c_k__s_t_a_r_t.html#Quick_Start">Quick Start User Guide </a> are provided, and you need to study this user guide firstly.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_HW_Block"></a>
3 Hardware Architecture</h2>
<p>This chapter gives you a simple description of the hardware architecture of RTL87X3E and RTL87X3D. More detailed information about the hardware, please refer to the HW datasheet for details.</p>
<h3><a class="anchor" id="SDK_UM_HW_Block_RTL87X3E"></a>
3.1 RTL87X3E</h3>
<p>Hardware block of RTL87X3E is shown in Figure 3-1, and the main features are as follows:</p><ul>
<li>Dual core process<ul>
<li>Real-M300 Processor</li>
<li>DSP</li>
</ul>
</li>
<li>Rich peripherals</li>
<li>Flexible RAM configuration</li>
<li>Power Management Unit</li>
<li>Clock Management Unit</li>
<li>Dual mode Bluetooth radio</li>
</ul>
<div class="image">
<img src="hw_block_rtl87x3e.jpg" alt="hw_block_rtl87x3e.jpg"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 RTL87X3E Hardware Block</b></div></center><h3><a class="anchor" id="SDK_UM_HW_Block_RTL87X3D"></a>
3.2 RTL87X3D</h3>
<p>Hardware block of RTL87X3D is shown in Figure 3-2, and the main features are as follows:</p><ul>
<li>Three Core process for RTL87X3D<ul>
<li>Cortex-M4F Processor</li>
<li>DSP1 (Hifi Mini)</li>
<li>DSP2 (Hifi 4)</li>
</ul>
</li>
<li>Rich peripherals</li>
<li>Flexible RAM configuration</li>
<li>Power Management Unit</li>
<li>Clock Management Unit</li>
<li>Dual mode Bluetooth radio</li>
</ul>
<p><b>Note:</b></p><ul>
<li>There are some peripherals could be accessed by DSP, such as I2S, audio codec, log UART, etc.</li>
<li>DSP shares RAM with MCU, and more memory information could be found in <a class="el" href="_m_e_m_o_r_y__h_i_e_r_a_r_c_h_y__r_t_l87_x3_d.html#Mem_Hierarchy_D">Memory Hierarchy User Manual RTL87X3D </a>.</li>
</ul>
<div class="image">
<img src="hw_block_rtl87x3d.jpg" alt="hw_block_rtl87x3d.jpg"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 RTL87X3D Hardware Block</b></div></center><div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_SW_Arch"></a>
4 Software Architecture</h2>
<h3><a class="anchor" id="SDK_UM_SYS_Arch"></a>
4.1 System Architecture</h3>
<p>The Architecture of system is show as Figure 4-1: </p><div class="image">
<img src="sw_arch.jpg" alt="sw_arch.jpg"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 System Architecture</b></div></center><p>As shown in Figure 4-1, system architecture consists of several major components:</p>
<ul>
<li><b>GAP</b> : It is the abstraction layer in which user application communicates with dual mode stack. Details could be found in <a class="el" href="_u_m018__b_l_e__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BLE_STACK_Page">BLE Stack User Manual </a>.</li>
<li><b>Framework Library</b> : It includes the latest Bluetooth classic protocols/profiles and Realtek proprietary protocols, such as A2DP/HFP, etc. Details could be found in <a class="el" href="_u_m014__f_r_a_m_e_w_o_r_k__i_n_t_e_r_f_a_c_e.html#Framework_Page">Framework Interfaces User Manual </a>.</li>
<li><b>Audio Subsystem</b> : It provides audio related functions. See <a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Page">Audio Subsystem Introduction </a> for details.</li>
<li><b>Leaudio Library</b> : It includes Le audio profiles.</li>
<li><b>DSP SDK</b> : DSP communicate with MCU via IPC, refer to DSP SDK for details of DSP modules.</li>
<li><b>Platform</b> : It includes OTA, USB, flash, ftl, charger, etc.</li>
<li><b>IO Drivers</b> : It provides APIs for user application to interface with BT Audio SOC on-board peripherals without accessing registers.</li>
<li><b>OSIF</b>: It is abstraction of real time OS interfaces for user application.</li>
</ul>
<h3><a class="anchor" id="SDK_UM_OPERATION_SYSTEM"></a>
4.2 Real Time Operating System</h3>
<p>A Real Time Operating System(RTOS) is an operating system that is optimised for use in embedded/real time applications. Their primary objective is to ensure a timely and deterministic response to events. An event can be external, like a interrupt being triggered, or internal like a message being received. FreeRTOS is a market-leading real-time operating system (RTOS) for microcontrollers and small microprocessors. Distributed freely under the MIT open source license, FreeRTOS includes a kernel and a growing set of IoT libraries suitable for use across all industry sectors. FreeRTOS is built with an emphasis on reliability and ease of use.</p>
<p>FreeRTOS V8.2.3 is used in RTL87X3D and RTL87X3E; it is integrated in ROM code and consists of the following components:</p><ol type="1">
<li>Task Management</li>
<li>Queue Management</li>
<li>Interrupt Management</li>
<li>Resource Management</li>
<li>Memory Management</li>
<li>Time Management</li>
</ol>
<p>We will not go into details about FreeRTOS, please refer to <a href="https://www.freertos.org/">https://www.freertos.org/</a> for details.</p>
<h3><a class="anchor" id="SDK_UM_OS_Interface"></a>
4.3 OS Interfaces</h3>
<p>This chapter describes the OS Interface API definition and its reference implementation. It is quite possible to update the specific RTOS version and even use a different RTOS, so all the incompatiblility issues related to the specific RTOS interfaces could be cleared if the OSIF layer is presented. As shown in the following Figure 4-2, the <b>OSIF layer</b> aims to provide a consistent and uniformed RTOS API set by wrapping the specific RTOS interfaces. Other software components that use the OSIF would be ported OS-independently. Vendors could also provide their own RTOS implementation inside OSIF layer, but without any modification from upper layer software components.</p>
<p>So, it is strongly recommended to use <b>OSIF API</b> in software development instead of accessing the specific RTOS interfaces. <b>OSIF API</b> are located in directory "sdk\inc\rtl87x3e\os".</p>
<div class="image">
<img src="osif_overview.jpg" alt="osif_overview.jpg" width="496px" height="361px"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 OSIF Overview</b></div></center><h3><a class="anchor" id="SDK_UM_Task_View"></a>
4.4 Task and Priority</h3>
<p>As is shown in Figure 4-3, seven tasks have been created for user application: </p><div class="image">
<img src="tasks.jpg" alt="tasks.jpg"/>
</div>
 <center><div id="figure_4_3"><b>Figure 4-3 Tasks</b></div></center><p>The description of each task and it's priority is show in Table 4-1: </p><center><div id="table_4_1"><b>Table 4-1 Task and Priority Description</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Task  </th><th class="markdownTableHeadLeft">Description  </th><th class="markdownTableHeadCenter">Priority   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Timer  </td><td class="markdownTableBodyLeft">Implement software timer required by FreeRTOS  </td><td class="markdownTableBodyCenter">6   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">BT Controller Stack  </td><td class="markdownTableBodyLeft">Implement BT stack protocols below HCI  </td><td class="markdownTableBodyCenter">6   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BT Host Stack  </td><td class="markdownTableBodyLeft">Implement BT stack protocols above HCI  </td><td class="markdownTableBodyCenter">3   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Application  </td><td class="markdownTableBodyLeft">Handle user application requirement and interacts with stack  </td><td class="markdownTableBodyCenter">2   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Flash  </td><td class="markdownTableBodyLeft">Handle asynchronous flash request  </td><td class="markdownTableBodyCenter">1   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Idle  </td><td class="markdownTableBodyLeft">Run background tasks including DLPS  </td><td class="markdownTableBodyCenter">0   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">IPC  </td><td class="markdownTableBodyLeft">Used to process communications between mcu and DSP2  </td><td class="markdownTableBodyCenter">2   </td></tr>
</table>
<p><b>Note:</b></p><ul>
<li>Multiple app tasks could be created and memory resource will be then allocated.</li>
<li>Idle task and timer task are provided by FreeRTOS.</li>
<li>Tasks have been configured as preemptive based on its priority by SysTick interrupt.</li>
<li>Interrupt service routines(ISR) are implemented by vendor.</li>
<li>IPC task only exist in RTL87X3D.</li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDK_UM_APP"></a>
5 Application</h2>
<p>SDK provides several example projects to demonstrate features and APIs that will help you familar with SDK. After familiar with the SDK, you can do some customized modification and develop your own applications.</p>
<p>This chapter contains the following information:</p><ul>
<li>SDK directory structure</li>
<li>Sample projects</li>
<li>Application process flow</li>
<li>Messages and event handle in application</li>
</ul>
<h3><a class="anchor" id="SDK_UM_SDK_Dir"></a>
5.1 SDK Directory</h3>
<p>SDK directory is shown as in Figure 5-1: </p><div class="image">
<img src="sdk_dir.jpg" alt="sdk_dir.jpg"/>
</div>
 <center><div id="figure_5_1"><b>Figure 5-1 SDK Directory</b></div></center><p> The SDK directory is show as in Figure 5-1, and the description of each directory is show in Table 5-1. </p><center><div id="table_5_1"><b>Table 5-1 SDK Directory Description</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Directory  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">board  </td><td class="markdownTableBodyLeft">Sample keil project files which have been already well-configured to start with   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">doc  </td><td class="markdownTableBodyLeft">Contains all the documentation files for the SDK   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">inc  </td><td class="markdownTableBodyLeft">Header files which provide API definitions exported from ROM   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">bin  </td><td class="markdownTableBodyLeft">Binary files for user application to link   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">src  </td><td class="markdownTableBodyLeft">Source files for sample applications   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">tool  </td><td class="markdownTableBodyLeft">Host tools set for add-on features   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">trace  </td><td class="markdownTableBodyLeft">Trace files for default app binary files provided in SDK   </td></tr>
</table>
<p><b>Note:</b></p><ul>
<li>App demo bin is provided additionally in RTL87X3E-MCU-SDK-v3.a.b.c as shown in the following Figure 5-2. <div class="image">
<img src="dongle_app_demo_bin.jpg" alt="dongle_app_demo_bin.jpg"/>
</div>
 <center><div id="figure_5_2"><b>Figure 5-2 Demo App in RTL87X3E-MCU-SDK-v3.a.b.c SDK</b></div></center></li>
<li>The default dongle app is dongle controlled by Spark tool, which provides more configurations to user, to scan and connect LE earbuds.</li>
<li>The general demo app is dongle controlled by key, which can switch mode in Legacy mode, CIS mode and BIS mode:<ul>
<li>in Legacy mode, dongle encode USB audio data with SBC Codec and transfer encoded data to earbuds by A2DP</li>
<li>in CIS mode, dongle encode USB audio data with LC3 Codec and transfer encoded data to earbuds by CIS</li>
<li>in BIS mode, dongle encode USB audio data with LC3 Codec and broadcast encoded data out by BIS</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="SDK_UM_Sample_projects"></a>
5.2 Sample Projects</h3>
<p>To help create user application, many sample projects in SDK have been created to start with, such as io demo and some ble related demo sample projects. Through studying sample projects, customers can easily get familar with SDK. All sample projects have been configured and memory layout in scatter file is also modified to comply with RTL87X3E SOC. Taking ble_peripheral application as an example below, it shows how to start developing the customized user application by the sample project. The snapshots are captured with current SDK, and may subject to change due to SDK upgrade.</p>
<div style="page-break-after: always;"></div><div class="image">
<img src="app_sample_project_ble_peripheral.jpg" alt="app_sample_project_ble_peripheral.jpg"/>
</div>
 <center><div id="figure_5_3"><b>Figure 5-3 ble_peripheral sample project</b></div></center><p>Source files in ble_peripheral project are currently categorized into several groups as below:</p>
<ul>
<li><b>include</b> directory is used to export the UUID which is mandatory for any application built for RTL87X3D/E. No modification is permitted by any 3rd party.</li>
<li><b>lib</b> directory includes all binary symbol files that user application is built on.</li>
<li><b>cmsis</b> directory is used for boot up code.</li>
<li><b>app</b> directory includes the ble_peripheral user application implementation.</li>
<li><b>ble</b> directory includes BLE profiles or services used by the sample application.</li>
</ul>
<p>The sample project may upgrade together with the SDK, and to better utilize the upgraded sample code, newly added user code is suggested to being organized and modularized. More detail information on each sample project could be found in its user manual.</p>
<h3><a class="anchor" id="SDK_UM_APP_Flow"></a>
5.3 Application Process Flow</h3>
<div class="image">
<img src="app_flow.jpg" alt="app_flow.jpg"/>
</div>
 <center><div id="figure_5_4"><b>Figure 5-4 APP Flow</b></div></center><p>The description of each action is show in Table 5-2.</p>
<div style="page-break-after: always;"></div> <center><div id="table_5_2"><b>Table 5-2 Application Process Flow Description</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Action  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">configuration init  </td><td class="markdownTableBodyLeft">Contains initialization of app and framework configuration   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">board init  </td><td class="markdownTableBodyLeft">Contains initialization of pinmux settings and pad settings   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">gap init  </td><td class="markdownTableBodyLeft">Contains initialization of GAP related parameters   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">driver init  </td><td class="markdownTableBodyLeft">Contains initialization of peripherals   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">profile init  </td><td class="markdownTableBodyLeft">Contains initialization of dual mode profiles   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">pow mgr init  </td><td class="markdownTableBodyLeft">Contains initialization of power management related   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">other modules init  </td><td class="markdownTableBodyLeft">Contains initialization of other modules such as roleswap, mmi, dlps, etc   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app parameter init  </td><td class="markdownTableBodyLeft">Contains initialization of user application related   </td></tr>
</table>
<h3><a class="anchor" id="SDK_UM_MSG_AND_EVT_HANDLE_FLOW"></a>
5.4 MSG and Event Handling Flow</h3>
<p>An original MSG is sent from universal Peripherals' ISR or BT Stack, and is handled through the following flow:</p><ol type="1">
<li>MSG from Peripherals is forwarded by MSG Distributer to IO MSG Handler for handling;</li>
<li>MSG from BT Stack is forwarded by MSG Distributer to BT State Machine. BT State Machine handles MSG and sends a BT IO MSG. MSG Distributer receives the BT IO MSG and then forwards it to IO MSG Handler for handling ;</li>
<li>After a Message is received, IO MSG Handler shall make judgment and call the related Event Handler.</li>
</ol>
<p>Developer programs shall:</p><ol type="1">
<li>Implement Peripheral ISR and fulfil initial handling in ISR. If further handling is required, a message will be sent.</li>
<li>Maintain IO MSG Handler to receive and handle MSGs defined by developer.</li>
<li>Implement Event Handler about application. A lower layer notifies an upper layer with MSG and Event mechanism, while an upper layer calls a lower layer functions by APIs.</li>
</ol>
<h3><a class="anchor" id="SDK_UM_IO_MSG"></a>
5.5 IO MSG</h3>
<h4>5.5.1 Message Format</h4>
<div class="fragment"><div class="line">{</div><div class="line">    uint16_t type;</div><div class="line">    uint16_t subtype;</div><div class="line">    <span class="keyword">union</span></div><div class="line">    {</div><div class="line">        uint32_t  param;</div><div class="line">        <span class="keywordtype">void</span>     *buf;</div><div class="line">    } u;</div><div class="line">} <a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a>;</div></div><!-- fragment --><h4>5.5.2 Message Type Definition</h4>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074a79100fd91a7425e96a85a7db3a7f308e">IO_MSG_TYPE_BT_STATUS</a>,  </div><div class="line">    <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074a85dbaa70be4f8a01a7758e77c2952f79">IO_MSG_TYPE_KEYSCAN</a>,    </div><div class="line">    <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074ad992a8f5bffca804ea27e5f46c5945ac">IO_MSG_TYPE_QDECODE</a>,    </div><div class="line">    <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074a46ed3255f00d4883a56c5a7304d6f505">IO_MSG_TYPE_UART</a>,       </div><div class="line">    ...</div><div class="line"></div><div class="line">} <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ga468a59751cf5bb96e120b43fea01e074">T_IO_MSG_TYPE</a>;</div></div><!-- fragment --><h4>5.5.3 Message Subtype Definition</h4>
<p>Taking subtype of UART for example, developer can define subtypes of UART.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggac2c41d68ce4555e6d5dd85315aa33f9ba3e92a9bac87e2c399c8700fa9ef01f30">IO_MSG_UART_RX</a>              = 0x10, </div><div class="line">    <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggac2c41d68ce4555e6d5dd85315aa33f9ba8cea79732acf334f6df9818eb3fed666">IO_MSG_UART_TX</a>              = 0x20, </div><div class="line">} <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gac2c41d68ce4555e6d5dd85315aa33f9b">T_IO_MSG_UART</a>;</div></div><!-- fragment --><h4>5.5.4 Define User Message</h4>
<p>Developer can expand message types and customize message subtypes if needed.</p>
<h3><a class="anchor" id="SDK_UM_DLPS_SETTINGS"></a>
5.6 DLPS Settings</h3>
<p>You can enable DLPS by APIs below, and the code is controlled by flag F_BT_DLPS_EN which is defined in app_peripheral_flags.h.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> pwr_mgr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if F_BT_DLPS_EN</span></div><div class="line">    <a class="code" href="group___p_m___exported___functions.html#ga65794bb7e8e0c39831b412a3a6deb06d">bt_power_mode_set</a>(<a class="code" href="group___h_a_l__87x3_d___p_m___exported___variables.html#gga973442724abf827f29d83a4b2f9369e2acc50404a0e14859034d4d8d7643e6977">BTPOWER_DEEP_SLEEP</a>);</div><div class="line">    <a class="code" href="group___p_m___exported___functions.html#ga50c3964a5b07d2caa9e9390d0fd9f7e9">power_mode_set</a>(<a class="code" href="group___h_a_l__87x3_d___p_m___exported___variables.html#gga9a2caa2eb06b399f0b06bc9a7efdb2ddafefe15dc6f9b2184fb58be2274d5bb4e">POWER_DLPS_MODE</a>);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">}</span></div></div><!-- fragment --><p>Please refer to <a class="el" href="_u_m010__l_o_w__p_o_w_e_r__m_o_d_e.html#DlpsPage">Low Power Mode User Manual </a> for more details.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Memory"></a>
6 Memory</h2>
<p>You can adjust global and heap memory size by modify "APP_GLOBAL_SIZE" in "sdk\board\evb\ble_peripheral\inc\rtl87x3e\mem_config.h"</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define APP_GLOBAL_SIZE             (22*1024)</span></div></div><!-- fragment --><p>Please refer to <a class="el" href="_m_e_m_o_r_y__h_i_e_r_a_r_c_h_y__r_t_l87_x3_e.html#Mem_Hierarchy_E">Memory Hierarchy User Manual RTL87X3E </a> for more details.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="POWER_MANAGEMENT"></a>
7 Power Management</h2>
<p>RTL87X3 will enter DLPS mode when certain conditions met and be woken up when it needs to work normally. Refer to <a class="el" href="_u_m010__l_o_w__p_o_w_e_r__m_o_d_e.html#DlpsPage">Low Power Mode User Manual </a> for more details.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="Download"></a>
8 Download</h2>
<p>Please refer to <a class="el" href="_u_m001__q_u_i_c_k__s_t_a_r_t.html#Download_files">4.2 Download files</a> in <a class="el" href="_u_m001__q_u_i_c_k__s_t_a_r_t.html#Quick_Start">Quick Start User Guide </a> and <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSet_BTMPTool">13 RealtekBTMPTool</a> in <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSetIntro">Tool Set User Manual </a> for more details.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="SDKDebug"></a>
9 Debug</h2>
<p>Please refer to <a class="el" href="_u_m004__d_e_b_u_g__s_y_s_t_e_m.html#DbgSys">Debugging System </a> for more details. </p>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
