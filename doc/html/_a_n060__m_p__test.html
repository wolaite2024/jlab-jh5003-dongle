<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="MP_TEST_Page"></a>
MP Test Application Note    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/08/15</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_DOC_rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2022/08/15  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/08/15  </td><td class="markdownTableBodyCenter">Add More Details   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n060__m_p__test.html#MP_DOC_rev">Revision History</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#MP_Table_List">Table List</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#MP_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#MP_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#MP_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#MP_Configuration_of_MCU_Config_Tool">2 Configuration</a><ul>
<li><a class="el" href="_a_n060__m_p__test.html#CLI_MP_MCU">2.1 CLI MP</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#DUT_MCU">2.2 DUT</a></li>
</ul>
</li>
<li><a class="el" href="_a_n060__m_p__test.html#MP_Test_procedure">3 Test procedure</a><ul>
<li><a class="el" href="_a_n060__m_p__test.html#CLI_MP">3.1 CLI MP</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#BINARY_CMD_MP">3.2 Binary Command MP</a></li>
<li><a class="el" href="_a_n060__m_p__test.html#DUT_TEST">3.3 DUT MP</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_1_1">Table 1-1 Files Related to Test Module</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 UART Configuration (Step 1)</a></li>
<li><a href="#figure_2_2">Figure 2-2 UART Configuration (Step 2)</a></li>
<li><a href="#figure_2_3">Figure 2-3 Baud Rate Setting</a></li>
<li><a href="#figure_2_4">Figure 2-4 DUT Configuration</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MP  </td><td class="markdownTableBodyCenter">Mass Production   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_Introduction"></a>
1 Introduction</h2>
<p>MP (Mass Production) module is used for mp test. SDK supports three ways for testing, including CLI(Command Line Interface) MP, Binary Command MP and DUT (Device Under Test). The files related to the three methods involved are delineated in Table 1-1.</p>
<center><div id="table_1_1"><b>Table 1-1 Files Related to Test Module</b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Test Method  </th><th class="markdownTableHeadCenter">Files   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CLI MP  </td><td class="markdownTableBodyCenter">cli_mp_main.c   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Binary Command MP  </td><td class="markdownTableBodyCenter">mp_test.c <br />
 mp_test_vendor.c   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">DUT  </td><td class="markdownTableBodyCenter">single_tone.c   </td></tr>
</table>
<p>CLI MP tests by string commands through UART. Binary Command MP relies on the CMD SET Module(<a class="el" href="_a_n027__a_p_p__v_e_n_d_o_r__c_m_d__s_e_t__m_o_d_u_l_e.html">AN027_APP_VENDOR_CMD_SET_MODULE</a>) and the commands can be transmitted through UART, SPP, BLE and other methods. DUT Mode can be accessed either by manual key entry or automatically upon establishing a connection with the specific devcie.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_Configuration_of_MCU_Config_Tool"></a>
2 Configuration</h2>
<h3><a class="anchor" id="CLI_MP_MCU"></a>
2.1 CLI MP</h3>
<p>CLI MP requires a UART connection between the device and the computer. Users should enable UART by MCU Config Tool. On the HW Feature page, check the "Enable DATA UART" option and map the DATA_UART_TX and DATA_UART_RX to pins respectively (Figure 2-1 and Figure 2-2).</p>
<div class="image">
<img src="CLI_MP_MCU_CONFIG_1.png" alt="CLI_MP_MCU_CONFIG_1.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 UART Configuration (Step 1)</b></div></center><div class="image">
<img src="CLI_MP_MCU_CONFIG_2.png" alt="CLI_MP_MCU_CONFIG_2.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 UART Configuration (Step 2)</b></div></center><p>Also, the baud rate can be configured by "UART Baud Rate for External MCU" on page of "Peripheral" (Figure 2-3). Make sure the baud rate is consistant with that on serial communication software (Figure 2-4).</p>
<div class="image">
<img src="baudrate_and_console_mode.png" alt="baudrate_and_console_mode.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Baud Rate Setting</b></div></center><h3><a class="anchor" id="DUT_MCU"></a>
2.2 DUT</h3>
<p>There are two ways to enter DUT mode. One is to map the DUT mode function to a key on the page of KEY in MCU Config Tool (Figure 2-4). Besides, entering DUT mode automatically is also supported when alc link created and the remote device's name is confirmed in the test equipment list.</p>
<div class="image">
<img src="DUT_mode.png" alt="DUT_mode.png"/>
</div>
 <center><div id="figure_2_4"><b>Figure 2-4 DUT Configuration</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="MP_Test_procedure"></a>
3 Test procedure</h2>
<h3><a class="anchor" id="CLI_MP"></a>
3.1 CLI MP</h3>
<p>CLI MP is commonly used during the PCBA stage. Conncet the device to a computer via UART and use command operations to enable the device switch into HCI mode. The supported commands are outlined below. To enter the test mode, execute the command "hci" followed by "hci_mode". This sequence of commands will trigger the invocation of the "switch_into_hci_mode()" function, facilitating the device's transition into HCI mode.</p>
<div class="fragment"><div class="line">mp      <span class="comment">//Enter cli mp module</span></div><div class="line">help    <span class="comment">//List all the registered commands</span></div><div class="line">exit    <span class="comment">//Exit from cli mp mode</span></div><div class="line">hci_mode<span class="comment">//Enter HCI mode</span></div></div><!-- fragment --><div class="fragment"><div class="line">switch_into_hci_mode()</div><div class="line">    |------set_hci_mode_flag()</div><div class="line"></div><div class="line">void set_hci_mode_flag(<span class="keywordtype">bool</span> enable)</div><div class="line">{</div><div class="line">    <a class="code" href="union___a_o_n___f_a_s_t___r_e_b_o_o_t___s_w___i_n_f_o0___t_y_p_e.html">AON_FAST_REBOOT_SW_INFO0_TYPE</a> aon = {.<a class="code" href="union___a_o_n___f_a_s_t___r_e_b_o_o_t___s_w___i_n_f_o0___t_y_p_e.html#aca0fe5ad0c9d4dc7ef725c94f2c6460b">d16</a> = <a class="code" href="group__x3d___r_t_l876_x___exported___functions.html#gab06f7dcaa342d4678444d0decb0f6ef0">btaon_fast_read_safe</a>(AON_FAST_REBOOT_SW_INFO0)};</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (enable)</div><div class="line">    {</div><div class="line">        aon.<a class="code" href="union___a_o_n___f_a_s_t___r_e_b_o_o_t___s_w___i_n_f_o0___t_y_p_e.html#a77ace2e95ca479a4d2fcf2a1d28f8cf7">is_hci_mode</a> = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        aon.<a class="code" href="union___a_o_n___f_a_s_t___r_e_b_o_o_t___s_w___i_n_f_o0___t_y_p_e.html#a77ace2e95ca479a4d2fcf2a1d28f8cf7">is_hci_mode</a> = 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__x3d___r_t_l876_x___exported___functions.html#gaf55e802421403d41e8a60e901af79a13">btaon_fast_write_safe</a>(AON_FAST_REBOOT_SW_INFO0, aon.<a class="code" href="union___a_o_n___f_a_s_t___r_e_b_o_o_t___s_w___i_n_f_o0___t_y_p_e.html#aca0fe5ad0c9d4dc7ef725c94f2c6460b">d16</a>);</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="BINARY_CMD_MP"></a>
3.2 Binary Command MP</h3>
<p>When the command "CMD_MP_TEST" is receved in CMD SET module(<a class="el" href="_a_n027__a_p_p__v_e_n_d_o_r__c_m_d__s_e_t__m_o_d_u_l_e.html">AN027_APP_VENDOR_CMD_SET_MODULE</a>), the Binary Command MP module proceeds to precess the opcodes carried by this command.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_cmd_other_cmd_handle(uint8_t *cmd_ptr, uint16_t cmd_len, uint8_t cmd_path,</div><div class="line">    uint8_t app_idx, uint8_t *ack_pkt)</div><div class="line">{</div><div class="line">    uint16_t cmd_id = (uint16_t)(cmd_ptr[0] | (cmd_ptr[1] &lt;&lt; 8));</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (cmd_id)</div><div class="line">    {</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___c_m_d___exported___types.html#gga5cabd9d04994bbb9d426fa74f32b7157a724ee2b142cb262a60d44364b8af3bbd">CMD_MP_TEST</a>:</div><div class="line">        {</div><div class="line"><span class="preprocessor">#if F_APP_CLI_BINARY_MP_SUPPORT</span></div><div class="line">            <a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gab68a0f6aaed4553d0c5bad7608f434dc">app_report_event</a>(cmd_path, <a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gga7726a52eb69945b78d3a5a1463a839c7a224b309b64b9729b2ce0b57bc39a84a4">EVENT_ACK</a>, app_idx, ack_pkt, 3);</div><div class="line">            <a class="code" href="group___a_p_p___r_w_s___m_p.html#ga155f08e2926235cede845df611f2246a">mp_test_handle_cmd</a>(app_idx, cmd_path, cmd_ptr[2], cmd_ptr[3], &amp;cmd_ptr[4], cmd_len - 4);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The opcodes are categorized into "MP_TEST_OPCODE_RTK" and "MP_TEST_OPCODE_VENDOR_BINARY", accompanied by various additional sub opcodes.</p>
<p><b>Opcode categories:</b></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacb949f9fc6b4b09549ee9101a6f21aafa0b7b9c9295dedb178cfae8035416e3f1">MP_TEST_OPCODE_RTK</a> = 0,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacb949f9fc6b4b09549ee9101a6f21aafa06668f2e74c3a83a3329aa7a8540b218">MP_TEST_OPCODE_VENDOR_BINARY</a> = 1,</div><div class="line">} <a class="code" href="group___a_p_p___r_w_s___m_p.html#gacb949f9fc6b4b09549ee9101a6f21aaf">MP_TEST_OP_CODE</a>;</div></div><!-- fragment --><p><b>RTK sub opcodes</b>:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a91ffe1492fafd039783939255d711989">MP_TEST_RTK_SUB_OPCODE_ENTER_TEST_MODE</a>      = 0x00,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9ab479027f664cc819933f60458c2508f7">MP_TEST_RTK_SUB_OPCODE_EXIT_TEST_MODE</a>       = 0x01,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9adc244c13d91b4270866219afb8aa6385">MP_TEST_RTK_SUB_OPCODE_SWITCH_TO_HCI_MODE</a>   = 0x02,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a9a3248563112f679231c3346d429b00f">MP_TEST_RTK_SUB_OPCODE_SWITCH_TO_SINGLE_TONE_MODE</a>     = 0x03,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9ab7cb0961331e991b0e2ddd915f9b37ca">MP_TEST_RTK_SUB_OPCODE_FACTORY_RESET</a>        = 0x04,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a74e634fb33e881c4684105d1f2be7280">MP_TEST_RTK_SUB_OPCODE_CHANGE_BAUD_RATE</a>     = 0x05,</div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a2dad9e96ba97be77f73e249290e3148a">MP_TEST_RTK_SUB_OPCODE_FLASH_READ_BUFFER</a>    = 0x10,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9ab9d2e69d7e8e677302d6a96613e76f78">MP_TEST_RTK_SUB_OPCODE_FLASH_WRITE_BUFFER</a>   = 0x11,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a3d7e87850cc9fdad18a7bb8df125dc2c">MP_TEST_RTK_SUB_OPCODE_FLASH_ERASE_SECTOR</a>   = 0x12,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9ad36eed3b7c80449822f950bb1fb4a144">MP_TEST_RTK_SUB_OPCODE_FLASH_IOCTL</a>          = 0x13,</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9ad4ba9cc64bce0542015709ac7416fded">MP_TEST_RTK_SUB_OPCODE_AUDIO_TEST</a>           = 0x20,</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a880b9eef7a1e97e5ff41019bea21a6b8">MP_TEST_RTK_SUB_OPCODE_VENDOR_CMD</a>           = 0x30,</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacf1f6cea93af52ffc81ffe5d6c46d6c9a812d25b0cf3f7e7e0524f627d9ce048c">MP_TEST_RTK_SUB_OPCODE_CHANGE_DEVICE_NAME</a>   = 0x40,</div><div class="line">} <a class="code" href="group___a_p_p___r_w_s___m_p.html#gacf1f6cea93af52ffc81ffe5d6c46d6c9">MP_TEST_RTK_SUB_OPCODE</a>;</div></div><!-- fragment --><p>Vendor sub opcodes: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacc5cf10fde7d880601951fe398bb9ecea986a4b7012f4d7e84e1dee0d344b2ff9">MP_TEST_VENDOR_SUB_OPCODE_LED</a> = 0,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacc5cf10fde7d880601951fe398bb9eceab851537de1e5959079acc22737eb5171">MP_TEST_VENDOR_SUB_OPCODE_KEY</a> = 1,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacc5cf10fde7d880601951fe398bb9ecea3230911eaa6826a950ccbb951fa894d9">MP_TEST_VENDOR_SUB_OPCODE_ENTER_NORMAL_APT</a>  = 2,</div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ggacc5cf10fde7d880601951fe398bb9ecea95a25d1c9c93b0282e4c402169794a4e">MP_TEST_VENDOR_SUB_OPCODE_EXIT_NORMAL_APT</a>   = 3,</div><div class="line">} <a class="code" href="group___a_p_p___r_w_s___m_p.html#gacc5cf10fde7d880601951fe398bb9ece">MP_TEST_VENDOR_BINARY_SUB_OPCODE</a>;</div></div><!-- fragment --><h3><a class="anchor" id="DUT_TEST"></a>
3.3 DUT MP</h3>
<ul>
<li>1. Enter DUT mode automatically</li>
</ul>
<p>When acl link is connected, and receiving the remote device's name, some confirmation actions will be done in app_device_is_test_equipment() to judge if it is a test equipment. Once the remote device is identified, force_enter_dut_mode_when_acl_connected would be set to true and enter dut mode by calling MMI function.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_device_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line">    <span class="keywordtype">bool</span> handle = <span class="keyword">true</span>;</div><div class="line">    <span class="keywordtype">bool</span> power_on_flg = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aaf7bc9852c9d36ea59208457d70f7dd6">BT_EVENT_REMOTE_NAME_RSP</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (app_device_is_test_equipment(param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#af5d6afb866c989ff4bae48b7b416c7f7">remote_name_rsp</a>.<a class="code" href="structt__bt__event__param__remote__name__rsp.html#af8489b951d11304c90e75519a6d08d1a">name</a>,</div><div class="line">                                             param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#af5d6afb866c989ff4bae48b7b416c7f7">remote_name_rsp</a>.<a class="code" href="structt__bt__event__param__remote__name__rsp.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>))</div><div class="line">            {</div><div class="line">                <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gacfc09f2731e227125edccf8bcf944926">app_db</a>.<a class="code" href="struct_t___a_p_p___d_b.html#af574e0a99dd0604d2e1a2a897e970b1d">force_enter_dut_mode_when_acl_connected</a> = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (!app_bt_policy_get_b2b_connected())</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___b_t___b_t_m.html#ga98845f3f0972439eafa3dd8861de2ede">bt_sniff_mode_disable</a>(param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#af5d6afb866c989ff4bae48b7b416c7f7">remote_name_rsp</a>.<a class="code" href="structt__bt__event__param__remote__name__rsp.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>);</div><div class="line">                }</div><div class="line"></div><div class="line">                <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(<a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba8d1b9a3260b55095c0c0195fb862966a">MMI_DUT_TEST_MODE</a>);</div><div class="line">                <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gacfc09f2731e227125edccf8bcf944926">app_db</a>.<a class="code" href="struct_t___a_p_p___d_b.html#af574e0a99dd0604d2e1a2a897e970b1d">force_enter_dut_mode_when_acl_connected</a> = <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        ...</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(uint8_t action)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba8d1b9a3260b55095c0c0195fb862966a">MMI_DUT_TEST_MODE</a>:</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gacfc09f2731e227125edccf8bcf944926">app_db</a>.<a class="code" href="struct_t___a_p_p___d_b.html#af574e0a99dd0604d2e1a2a897e970b1d">force_enter_dut_mode_when_acl_connected</a>) &amp;&amp; (!app_bt_policy_get_b2b_connected()))</div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gafeb9beefd7a4be1005cb0af6944742e4">app_bt_policy_enter_dut_test_mode</a>();</div><div class="line"></div><div class="line">            <a class="code" href="group___g_a_p___l_e___e_x_t_e_n_d_e_d___s_c_a_n___exported___functions.html#ga38cc8ec3e3abbcb7f272bb7086907d55">le_ext_scan_stop</a>();</div><div class="line">            <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga561441a0d82b11030cd6229489bd44c0">ble_ext_adv_mgr_disable_all</a>(APP_STOP_ADV_CAUSE_DUT_TEST);</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#a1f7527f58f0a6c4ee38bce2f1c20b612">is_dut_test_mode</a> = 1;</div><div class="line">            <a class="code" href="group___a_p_p___c_f_g___exported___functions.html#gab297c89769dd5a96e5d0e10c194869bc">app_cfg_store</a>(&amp;<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#a580baafaeca634e2b993790b37f0196c">offset_notification_vol</a>, 8);</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___l_e_d___exported___functions.html#ga9fa33a843fc0cba5e8ccdd25919c5901">app_led_change_mode</a>(<a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaea3382892c45a6c97120fc4c294021dc">LED_MODE_DUT_TEST_MODE</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___r_w_s___m_p.html#ga592d888003598ced009f6b99da37540a">mp_hci_test_auto_enter_dut_init</a>();</div><div class="line">            <a class="code" href="group___a_p_p___r_w_s___m_p.html#gaa2e20cd73581a3f7401845efc4ebacf9">mp_hci_test_set_mode</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">            app_sniff_mode_b2s_disable_all(SNIFF_DISABLE_MASK_DUT_TEST_MODE);</div><div class="line">            app_auto_power_off_disable(<a class="code" href="group___a_p_p___d_e_v_i_c_e___exported___types.html#ga6d9608b85300372efdf22c89bce5abdfa0eda46441ca3aec8dadead9ddc14c269">AUTO_POWER_OFF_MASK_DUT_MODE</a>);</div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_DUT_MODE_AUTO_POWER_OFF</span></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a35fb73debf3e70624e8f6ddc7c97583b">enable_5_mins_auto_power_off_under_dut_test_mode</a>)</div><div class="line">            {</div><div class="line">                dut_test_start_auto_power_off_timer();</div><div class="line">            }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">            <span class="comment">//Enable Device Under Test mode</span></div><div class="line">            <a class="code" href="group___g_a_p___v_e_n_d_o_r___exported___functions.html#ga767d6470df4cb7062577c7d8a66338eb">gap_vendor_cmd_req</a>(0x1803, 0, <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga41891eacf185bad62c7cf37cae78fc32">app_bt_policy_get_radio_mode</a>() == <a class="code" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31ab1e48ea0abec2793a2af9d89a7232ff2">BT_DEVICE_MODE_DISCOVERABLE_CONNECTABLE</a>) &amp;&amp;</div><div class="line">                    (<a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#ga3bd2f2a2ca2cdf6d2d3a42f8335e9620">app_bt_policy_get_state</a>() != <a class="code" href="group___a_p_p___b_t___p_o_l_i_c_y.html#gga29297b79a646476e338f57e643af09dea6252c4157bf83be0f16f688786ed6e6f">BP_STATE_LINKBACK</a>) &amp;&amp;</div><div class="line">                    (!app_bt_policy_get_b2b_connected()) &amp;&amp; (app_bt_policy_get_b2s_connected_num() == 0)</div><div class="line">                    &amp;&amp; (<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gacfc09f2731e227125edccf8bcf944926">app_db</a>.<a class="code" href="struct_t___a_p_p___d_b.html#afd3eb4ae2abac37a11e81b73b4a7282b">remote_session_state</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9a0d477163c2943e4e2aa3059ac6f26db4">REMOTE_SESSION_STATE_DISCONNECTED</a>) ||</div><div class="line">                    (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#aa7639ea01886a59fe79d85d948a4d4bf">trigger_dut_mode_from_power_off</a>) ||</div><div class="line">                    (<a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gacfc09f2731e227125edccf8bcf944926">app_db</a>.<a class="code" href="struct_t___a_p_p___d_b.html#a8a4aae2f2def895c7d24787dcd9dac0f">ad2b_enter_dut_mode</a>))</div><div class="line">        {</div><div class="line">            switch_into_single_tone_test_mode();</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><ul>
<li>2. Enter by key pressing</li>
</ul>
<p>By pressing the key mapped in MCU Config Tool, users can enter the DUT mode.</p>
<ul>
<li>3. Reboot and initiate app</li>
</ul>
<p>The device will reboot and initiate dut test resources.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">if</span> (is_single_tone_test_mode()) <span class="comment">//DUT test mode</span></div><div class="line">    {</div><div class="line">        reset_single_tone_test_mode();</div><div class="line">        <a class="code" href="group___a_p_p___r_w_s___m_p.html#gadb274a720c4353791923bd4575624ade">mp_hci_test_init</a>(<a class="code" href="group___a_p_p___r_w_s___m_p.html#gga35a2736c0fa4b94214818bb0b72c862fa79384f55cac723f031f9535b7d92a9e9">MP_HCI_TEST_DUT_MODE</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="comment">//Normal mode</span></div><div class="line">    {</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><ul>
<li>4. Task initiation</li>
</ul>
<p>Some related callback function will be registered and the task called mp_hci_test_task will be created.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gadb274a720c4353791923bd4575624ade">mp_hci_test_init</a>(<a class="code" href="group___a_p_p___r_w_s___m_p.html#ga35a2736c0fa4b94214818bb0b72c862f">T_MP_HCI_TEST_ITEM</a> mp_hci_test_item)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;mp_hci_test_init: mp_hci_test_item %d&quot;</span>, mp_hci_test_item);</div><div class="line"></div><div class="line">    mp_hci_test_mode_running = <span class="keyword">true</span>;</div><div class="line">    mp_hci_cur_test_item = mp_hci_test_item;</div><div class="line">    lps_mode_set(LPM_ACTIVE_MODE);</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (mp_hci_test_item)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga35a2736c0fa4b94214818bb0b72c862fa79384f55cac723f031f9535b7d92a9e9">MP_HCI_TEST_DUT_MODE</a>:</div><div class="line">        {</div><div class="line">            dut_test_init();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga35a2736c0fa4b94214818bb0b72c862fa1941a7b6178ffb432225b0d0881290d7">MP_HCI_TEST_SINGLE_TONE</a>:</div><div class="line">        {</div><div class="line">            single_tone_test_init();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#ga6b27ecfe7b3dfa93341db098f907a839">sys_mgr_cback_register</a>(mp_hci_test_dm_cback);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ga67189dab89dfb141cf0ada6529f057bd">audio_mgr_cback_register</a>(dut_audio_cback);</div><div class="line">    <a class="code" href="group___g_a_p___t_i_m_e_r.html#gaa69e621535dae6a916772dd46193a68c">gap_reg_timer_cb</a>(dut_timer_callback, &amp;dut_timer_queue_id);</div><div class="line"></div><div class="line">    <a class="code" href="group___o_s__87x3e___task.html#gac6d28adc4486c67c033dcce58ca3f1d2">os_task_create</a>(&amp;mp_hci_test_task_handle, <span class="stringliteral">&quot;mp_hci_test&quot;</span>, mp_hci_test_task, 0, 2048, 1);</div><div class="line">}</div></div><!-- fragment --><ul>
<li>5. DUT task</li>
</ul>
<p>In the mp_hci_test_task, the hci interface will be opened and the hci callback will be registered. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> mp_hci_test_task(<span class="keywordtype">void</span> *p_param)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;mp_hci_test_task&quot;</span>);</div><div class="line"></div><div class="line">    uint8_t event;</div><div class="line"></div><div class="line">    <a class="code" href="group___o_s__87x3d___message.html#ga78583ff4df155099dbb1592bd71dedfb">os_msg_queue_create</a>(&amp;mp_hci_test_msg_queue_handle, <span class="stringliteral">&quot;mp_hci_msgQ&quot;</span>, 10, <span class="keyword">sizeof</span>(<a class="code" href="struct_t___m_p___h_c_i___m_s_g___p_a_r_a_m.html">T_MP_HCI_MSG_PARAM</a>));</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___r_w_s___m_p.html#ga194a1b9d3ed2afcc65ab0a0fbbf6d6d8">hci_if_open</a>(mp_test_handle_hci_cb);</div><div class="line"></div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>When the hci interface is opened, dut module will send the message "SINGLE_TONE_EVENT_LOWER_STACK_READY", which will be handled in dut_hci_cmd_reset() and send the HCI command of "HCI_RESET_OPCODE".</p>
<p>Upon sending an HCI command, the host will receive an HCI event, subsequently prompting the reception of "SINGLE_TONE_EVT_DATA_IND" by the app. In the "dut_test_handle_hci_evt_data_ind()" function, predetermined HCI commands are sequentially dispatched, facilitating iterative interactions until the entire process is completed.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> mp_test_handle_hci_cb(<a class="code" href="group___a_p_p___r_w_s___m_p.html#ga83f1a8ea0fd565c6cb77b25eb391c11d">T_SINGLE_TONE_EVT</a> evt, <span class="keywordtype">bool</span> status, uint8_t *p_buf, uint32_t len)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (evt)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga83f1a8ea0fd565c6cb77b25eb391c11da353475149500ff25c99ae2ad7e271edb">SINGLE_TONE_EVT_OPENED</a>:</div><div class="line">        {</div><div class="line">            mp_hci_send_msg(SINGLE_TONE_EVENT_LOWER_STACK_READY);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga83f1a8ea0fd565c6cb77b25eb391c11dac7f3f06c3dccba225c20ed53e90e151a">SINGLE_TONE_EVT_CLOSED</a>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga83f1a8ea0fd565c6cb77b25eb391c11da4f3229e327884306cad1cc9e332bfb86">SINGLE_TONE_EVT_DATA_IND</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">switch</span> (mp_hci_cur_test_item)</div><div class="line">            {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga35a2736c0fa4b94214818bb0b72c862fa79384f55cac723f031f9535b7d92a9e9">MP_HCI_TEST_DUT_MODE</a>:</div><div class="line">                {</div><div class="line">                    dut_test_handle_hci_evt_data_ind(status, p_buf, len);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga35a2736c0fa4b94214818bb0b72c862fa1941a7b6178ffb432225b0d0881290d7">MP_HCI_TEST_SINGLE_TONE</a>:</div><div class="line">                {</div><div class="line">                    single_tone_handle_hci_evt_data_ind(status, p_buf, len);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <a class="code" href="group___a_p_p___r_w_s___m_p.html#ga8740e57232b79e241f1843ee82a9da67">hci_if_confirm</a>(p_buf);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___r_w_s___m_p.html#gga83f1a8ea0fd565c6cb77b25eb391c11dae52e7dcc6c152beb6d75e4a932817cea">SINGLE_TONE_EVT_DATA_XMIT</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (hci_local)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___o_s__87x3d___memory.html#ga9f49944885e39c41ea8232fba92cc5f3">os_mem_free</a>(p_buf);</div><div class="line">                hci_local = <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ...</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dut_test_handle_hci_evt_data_ind(<span class="keywordtype">bool</span> status, uint8_t *p_buf, uint32_t len)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;dut_test_handle_hci_evt_data_ind: hci_init_status %d&quot;</span>, hci_init_status);</div><div class="line">    <span class="keywordflow">switch</span> (hci_init_status)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_VENDOR_LPS_SETTING:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_vendor_lps_setting();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_WRITE_SCAN_ENABLE:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_write_scan_enable(3);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_SET_EVENT_FILTER:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_set_event_filter();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_WRITE_LOCAL_NAME:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_write_local_name(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gaf2dbb266dec477095d156ae715f53014">device_name_legacy</a>, <span class="keyword">sizeof</span>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gaf2dbb266dec477095d156ae715f53014">device_name_legacy</a>));</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_WRITE_PAGE_SCAN_ACTIVITY:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_write_page_scan_activity(0x0200, 0x0012);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_ENABLE_DUT_MODE:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_enable_dut_mode();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_WRITE_SCAN_TYPE:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_write_inquiry_scan_type(0);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_WRITE_INQUIRY_SCAN_ACTIVITY:</div><div class="line">        {</div><div class="line">            dut_hci_cmd_write_inquiry_scan_activity(0x0200, 0x0012);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> HCI_INIT_STATE_COMPLETED:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    hci_init_status++;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
