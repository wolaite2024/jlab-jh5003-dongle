<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="CFU_Page"></a>
CFU User Manual    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.0</b></center><p><br />
 </p><center><b>2024/01/05</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="CFU_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0  </td><td class="markdownTableBodyCenter">2024/01/05  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Rev">Revision History</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Table_List">Table List</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFUIntro">1 CFU Introduction</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Flow">2 CFU Flow</a><ul>
<li><a class="el" href="_u_m024__c_f_u.html#Dual_Bank_CFU_Mode">2.1 Dual Bank CFU Mode</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#Dual_Bank_CFU_Mode_Flow">2.2 Dual Bank CFU Mode Flow</a></li>
</ul>
</li>
<li><a class="el" href="_u_m024__c_f_u.html#HID_Interface">3 HID Interface</a><ul>
<li><a class="el" href="_u_m024__c_f_u.html#HID_Introduction">3.1 HID Introduction</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#HID_Utility_TOP_LEVEL_collection">3.2 HID Utility TOP-LEVEL collection</a></li>
</ul>
</li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Protocol">4 CFU Protocol</a><ul>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Firmware_Version_Request">4.1 CFU Firmware Version Request(Ex) Report</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Firmware_Offer_Reports">4.2 CFU Firmware Offer Reports</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Firmware_Offer_Response">4.3 CFU Firmware Offer Response</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Data_Report">4.4 CFU Data Report</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Data_Response">4.5 CFU Data Response</a></li>
</ul>
</li>
<li><a class="el" href="_u_m024__c_f_u.html#How_to_Port_Code">5 How to Port Code</a><ul>
<li><a class="el" href="_u_m024__c_f_u.html#Include_files">5.1 Include files</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#Handle_CFU_Firmware_Version">5.2 Handle CFU Firmware Version Request(Ex) Report</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#Handle_CFU_Firmware_Offer">5.3 Handle CFU Firmware Offer Response</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#Handle_CFU_Data_Response">5.4 Handle CFU Data Response</a></li>
</ul>
</li>
<li><a class="el" href="_u_m024__c_f_u.html#How_to_Use_Tool">6 How to Use Tool</a><ul>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Prepare_the_image_to_update">6.1 Prepare the image to update</a><ul>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Generate_OTA_Header">6.1.1 Generate OTA Header</a></li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Pack_whole_Images">6.1.2 Pack Whole Images</a></li>
</ul>
</li>
<li><a class="el" href="_u_m024__c_f_u.html#CFU_Download_Tool_User_Guide">6.2 CFU Download Tool User Guide</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="CFU_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_3_1">Table 3-1 HID Utility Top-Level Collection</a></li>
<li><a href="#table_4_1">Table 4-1 CFU Firmware Version Request Report</a></li>
<li><a href="#table_4_2">Table 4-2 Standard Offer Report</a></li>
<li><a href="#table_4_3">Table 4-3 Standard Offer Response</a></li>
<li><a href="#table_4_4">Table 4-4 CFU Data Report</a></li>
<li><a href="#table_4_5">Table 4-5 CFU Data Response</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="CFU_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 Flow of Dual Bank CFU</a></li>
<li><a href="#figure_6_1">Figure 6-1 MP Programing Tool</a></li>
<li><a href="#figure_6_2">Figure 6-2 Generate OTA Header</a></li>
<li><a href="#figure_6_3">Figure 6-3 Pack Images</a></li>
<li><a href="#figure_6_4">Figure 6-4 Choose IC Type and CFU Type</a></li>
<li><a href="#figure_6_5">Figure 6-5 Get Device Info and Download</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="CFU_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CFU  </td><td class="markdownTableBodyCenter">Component Firmware Update   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="CFUIntro"></a>
1 CFU Introduction</h2>
<p>Component Firmware Update (CFU) provides Original Equipment Manufacturers (OEMs) and Independent Hardware Vendors (IHVs) a reliable and authenticated method for updating firmware on devices that have shipped to customers. Sdk supports the CFU protocol defined by Microsoft. As shown in <a class="el" href="_u_m007__f_l_a_s_h.html#FLASH">Flash User Guide </a>, there are two bank areas allocated (bank0 and bank1) to save the images. But only one bank is active at a time. The images in the two banks will be authenticated when the soc boots up. If images in both banks are all legal, the bank with the larger version(ver_val or git_ver)(refer to <a class="el" href="_u_m008__i_m_a_g_e__l_a_y_o_u_t.html#IMAGE_LAYOUT">Image Layout User Guide </a>) will be selected to run in. The versions of images in two banks will be compared as a specific sequence until the versions of a certain image are different. If only one bank images are all legal, then this bank will be selected to run. Detailed instructions on bank switch can be found in <a class="el" href="_u_m013__o_t_a.html#OTA_Page">OTA User Manual </a>. For CFU, all the images in two banks should be packed together, and the CFU tool will select the images to transfer to inactive bank automatically.</p>
<p>This application note describes CFU related information. The following topics are included to help users to establish CFU environment.</p>
<ul>
<li>CFU Flow</li>
<li>HID Interface</li>
<li>CFU Protocol</li>
<li>How to Port Code</li>
<li>How to Use Tool <div style="page-break-after: always;"></div></li>
</ul>
<h2><a class="anchor" id="CFU_Flow"></a>
2 CFU Flow</h2>
<h3><a class="anchor" id="Dual_Bank_CFU_Mode"></a>
2.1 Dual Bank CFU Mode</h3>
<p>Images pushed by the CFU tool will always be saved in the inactive bank in CFU progress. The MCU will reboot after all images have been pushed and validated successfully. The advantage of Dual Bank CFU is that there is always a backup bank. Users do not need to worry about MCU crashing if CFU fails. Because the bank with all legal images and higher versions will be selected to be actived by the bootloader, the upgraded images should have a higher version and be integrated. Otherwise, the images will not be activated when the chip reboots. Users should ensure images in the inactive bank are integrated and with a higher version.</p>
<h3><a class="anchor" id="Dual_Bank_CFU_Mode_Flow"></a>
2.2 Dual Bank CFU Mode Flow</h3>
<p>The dual bank CFU flow is shown in the following chart. </p><div class="image">
<img src="Flow_of_Dual_Bank_CFU.png" alt="Flow_of_Dual_Bank_CFU.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Flow of Dual Bank CFU</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="HID_Interface"></a>
3 HID Interface</h2>
<h3><a class="anchor" id="HID_Introduction"></a>
3.1 HID Introduction</h3>
<p>Surface devices that support CFU implement a set of reports contained in a vendor-specific Top-Level Collection. A Top-Level Collection comprises a set of reports. This set of HID reports is abstracted into a set of Collections and Main Items (controls) with their corresponding attributes such as Usage, valid value ranges, and sizes. Windows enumerates each TLC separately in its own Physical Device Object (PDO) that drivers can attach to. Software then addresses Collections and Main Items, and the HID stack takes care of translating those into reports sent to and received from the HID Class device.</p>
<p>A HID Interface may have one or more peer TLCs. The TLCs of a HID Interface are described by a read-only structure delivered during enumeration called a Report Descriptor, in which the attributes of the sub-collections and their Main Items are described and assigned to reports.</p>
<h3><a class="anchor" id="HID_Utility_TOP_LEVEL_collection"></a>
3.2 HID Utility TOP-LEVEL collection</h3>
<p>Surface devices that support CFU implement a set of fixed-size reports contained in a vendor-specific Top-Level Collection called the Utility TLC. The Utility TLC defines several reports, not all of which are always implemented in a device. Unused reports are intended for future expansion. All reports are defined in the Utility TLC are always defined even if they are not implemented. This permits future firmware updates to enable new reports without changing the HID Report Descriptor. Changing the Report Descriptor for an enumerated HID device after an update causes interoperability issues due to operating systems that cache information in the Report Descriptor between enumerations. Every report on a HID interface that contains more than 1 report must have a Report ID, and the Report ID is defined to be the first byte of all reports on the interface.</p>
<center><div id="table_3_1"><b>Table 3-1 HID Utility Top-Level Collection</b></div></center> <table class="doxtable">
<tr>
<th>SFUA <br />
TLC </th><th colspan="3">Input Report </th><th colspan="3">Output Report </th><th colspan="3">Feature Report  </th></tr>
<tr>
<td style="text-align: center;">Page <br />
ID </td><td style="text-align: center;">Usage </td><td style="text-align: center;"><div style="width:60px">Report <br />
ID</div> </td><td style="text-align: center;">Desc </td><td style="text-align: center;">Usage </td><td style="text-align: center;"><div style="width:60px">Report <br />
ID</div> </td><td style="text-align: center;">Desc </td><td style="text-align: center;">Usage </td><td style="text-align: center;"><div style="width:60px">Report <br />
ID</div> </td><td style="text-align: center;">Desc  </td></tr>
<tr>
<td style="text-align: center;" rowspan="10"><div style="width:80px">0xFF0B:<br />
0x0104</div> </td><td style="text-align: center;">0x60 </td><td style="text-align: center;">0x2A </td><td style="text-align: center;">FW <br />
Version <br />
Response </td><td style="text-align: center;">0x61 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x62 </td><td style="text-align: center;">0x2A </td><td style="text-align: center;">FW <br />
Version <br />
Request  </td></tr>
<tr>
<td style="text-align: center;">0x63 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x64 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x65 </td><td style="text-align: center;">0x2B </td><td style="text-align: center;">FW <br />
Version <br />
Request<br />
Ex  </td></tr>
<tr>
<td style="text-align: center;">0x66-0x69 </td><td style="text-align: center;">0x2C </td><td style="text-align: center;">Fw <br />
Update <br />
Response </td><td style="text-align: center;">0x6A-0x6D </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x6E-0x71 </td><td style="text-align: center;"></td><td style="text-align: center;"></td></tr>
<tr>
<td style="text-align: center;">0x72-0x75 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x76-0x79 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x7A-0x7D </td><td style="text-align: center;"></td><td style="text-align: center;"></td></tr>
<tr>
<td style="text-align: center;">0x7E-0x81 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x82-0x85 </td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">0x86-0x89 </td><td style="text-align: center;"></td><td style="text-align: center;"></td></tr>
<tr>
<td style="text-align: center;">0x8A-0x8D </td><td style="text-align: center;">0x2D </td><td style="text-align: center;">Fw <br />
Offer <br />
Response </td><td style="text-align: center;">0x8E-0x91 </td><td style="text-align: center;">0x2D </td><td style="text-align: center;">Fw <br />
Update <br />
Offer </td><td style="text-align: center;">0x92-0x95 </td><td style="text-align: center;"></td><td style="text-align: center;"></td></tr>
</table>
<p>Detailed instructions on USB HID can be found in USB_HID_Demo_Page. Detailed instructions on BT HID can be found in BT_HID_DEMO_USER_MANU.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="CFU_Protocol"></a>
4 CFU Protocol</h2>
<p>The CFU protocol is implemented as set of commands and responses. The protocol is sequential in nature. For each command that the host sends to a component, the component is expected to respond (unless explicitly stated otherwise in this specification). The host doesn't send the next command, until a valid response is received for the previous command it sent. In case the component doesn't respond within a period, or sends an invalid response, the host resends the command. There are commands to get the version information of current firmware on the component; to send the offer and to send the firmware image.</p>
<h3><a class="anchor" id="CFU_Firmware_Version_Request"></a>
4.1 CFU Firmware Version Request(Ex) Report</h3>
<p>The report is explicitly requested by the HID Get Report Request with Report Type set to Feature and the Report ID set to the appropriate Report ID per the Report Descriptor.The CFU Firmware Version Request Feature Report contains a Header and space for version info for up to 7 Components. The CFU Firmware Version Request is a feature report defined as follows: </p><center><div id="table_4_1"><b>Table 4-1 CFU Firmware Version Request Report</b></div></center> <table class="doxtable">
<tr>
<th>FW Version </th><th>Bit 7 </th><th>Bit 6 </th><th>Bit 5 </th><th>Bit 4 </th><th>Bit 3 </th><th>Bit 2 </th><th>Bit 1 </th><th>Bit 0  </th></tr>
<tr>
<td style="text-align: center;">Byte 0 </td><td style="text-align: center;" colspan="8">Report ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 1 </td><td style="text-align: center;" colspan="8">Component Count  </td></tr>
<tr>
<td style="text-align: center;">Byte 2 </td><td style="text-align: center;" colspan="8">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 3 </td><td style="text-align: center;" colspan="8">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 4 </td><td style="text-align: center;">Extension </td><td style="text-align: center;" colspan="3">Reserved </td><td style="text-align: center;" colspan="4">CFU Version (= 0x04)  </td></tr>
<tr>
<td style="text-align: center;">Byte 5~8 </td><td style="text-align: center;" colspan="8">Version  </td></tr>
<tr>
<td style="text-align: center;">Byte 9 </td><td style="text-align: center;" colspan="4">Milestone </td><td style="text-align: center;" colspan="2">Reserved </td><td style="text-align: center;" colspan="2">Bank  </td></tr>
<tr>
<td style="text-align: center;">Byte 10 </td><td style="text-align: center;" colspan="8">Component ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 11 </td><td style="text-align: center;" colspan="8" rowspan="2">Platform ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 12  </td></tr>
<tr>
<td style="text-align: center;">Byte 13~20 </td><td style="text-align: center;" colspan="8">(Version Information for 2th Component)  </td></tr>
<tr>
<td style="text-align: center;">Byte 21~28 </td><td style="text-align: center;" colspan="8">(Version Information for 3th Component)  </td></tr>
<tr>
<td style="text-align: center;">Byte 29~36 </td><td style="text-align: center;" colspan="8">(Version Information for 4th Component)  </td></tr>
<tr>
<td style="text-align: center;">Byte 37~44 </td><td style="text-align: center;" colspan="8">(Version Information for 5th Component)  </td></tr>
<tr>
<td style="text-align: center;">Byte 45~52 </td><td style="text-align: center;" colspan="8">(Version Information for 6th Component)  </td></tr>
<tr>
<td style="text-align: center;">Byte 53~60 </td><td style="text-align: center;" colspan="8">(Version Information for 7th Component)  </td></tr>
</table>
<ul>
<li><b>Component Count</b> indicates the number of components that are valid in this report, with a maximum of 7 and the default value is 1. Note that the report is always the same size. If Component Count is less than 7 Components, no gaps in the table are permitted, and all subsequent bytes after the last are reserved. If the Primary Component is itself updateable via CFU, it shall be the first component in the subsequent table of version information entries.</li>
<li><b>CFU Version</b> indicates the version of the CFU protocol supported. For this specification, the supported CFU Version is 0x4 or greater.</li>
<li><b>Extension</b> indicates support for the Firmware Version RequestEx report. Version is the version of OTA header image.</li>
<li><b>Platform ID</b> identifies the Platform ID of a Component hardware and can be set when generating OTA header image.</li>
<li><b>Component ID</b> identifies Primary Component hardware and Secondary Component hardware.</li>
<li><b>Milestone</b> identifies the E2E Process milestone of the hardware.</li>
</ul>
<h3><a class="anchor" id="CFU_Firmware_Offer_Reports"></a>
4.2 CFU Firmware Offer Reports</h3>
<p>The purpose of an Offer is to give the Primary Component enough information to decide if a Package is supported. It does not indicate whether the Package will be properly authenticated or validated. The Package must be downloaded and then separately authenticated and validated based solely on information and data in the Package and not based on information in the Offer. By offering a Package, the system can avoid unnecessarily downloading a Package that will be summarily rejected because it is not appropriate for the system.</p>
<p>The standard Offer Report is an output report defined as follows: </p><center><div id="table_4_2"><b>Table 4-2 Standard Offer Report</b></div></center> <table class="doxtable">
<tr>
<th>Offer </th><th>Bit 7 </th><th>Bit 6 </th><th>Bit 5 </th><th>Bit 4 </th><th>Bit 3 </th><th>Bit 2 </th><th>Bit 1 </th><th>Bit 0  </th></tr>
<tr>
<td style="text-align: center;">Byte 0 </td><td style="text-align: center;" colspan="8">Report ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 1 </td><td style="text-align: center;" colspan="8">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 2 </td><td style="text-align: center;">Force Ignore </td><td style="text-align: center;">Force Reset </td><td style="text-align: center;" colspan="6">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 3 </td><td style="text-align: center;" colspan="8">Component ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 4 </td><td style="text-align: center;" colspan="8">CFU Token  </td></tr>
<tr>
<td style="text-align: center;">Byte 5~8 </td><td style="text-align: center;" colspan="8">Version  </td></tr>
<tr>
<td style="text-align: center;">Byte 9~10 </td><td style="text-align: center;" colspan="8">Last Image ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 11 </td><td style="text-align: center;" colspan="6">Reserved </td><td style="text-align: center;" colspan="2">Dongle/Single_Pri_Sec  </td></tr>
<tr>
<td style="text-align: center;">Byte 12 </td><td style="text-align: center;" colspan="8">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 13 </td><td style="text-align: center;" colspan="2">Reserved </td><td style="text-align: center;" colspan="2">Bank </td><td style="text-align: center;" colspan="4">CFU Version (= 0x04)  </td></tr>
<tr>
<td style="text-align: center;">Byte 14 </td><td style="text-align: center;" colspan="4">Reserved </td><td style="text-align: center;" colspan="4">Milestone  </td></tr>
<tr>
<td style="text-align: center;">Byte 15 </td><td style="text-align: center;" colspan="8" rowspan="2">Platform ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 16  </td></tr>
</table>
<ul>
<li><b>Force Reset</b> allows the update driver or tool to request an immediate reset after completion of an update, as opposed to rules that may exist in the device that protect a user from disruption due to an unexpected function reset. In essence it informs the Primary Component that an immediate reset is acceptable and expected in the current context.</li>
<li><b>Force Ignore</b> indicates that the Primary Component shall ignore bytes 5-8, the Version Information.</li>
<li><b>Component ID</b> is a supported Component ID returned in a CFU FW Version Request(Ex) Report.</li>
<li><b>Version fields</b> from <b>bytes 3, 5-8 and 15-16</b>, Milestone and <b>CFU Version</b> are identical to the corresponding fields of the CFU FW Version Request report for the specified Component ID.</li>
<li><b>Bank</b> - For Components that have multiple banks and whose images are bank-dependent, this indicates which bank to which this update is to be applied.</li>
<li><b>SFUA Version</b> indicates the version of the SFUA specification protocol supported. For this specification, the supported SFUA Version is 0x00.</li>
</ul>
<h3><a class="anchor" id="CFU_Firmware_Offer_Response"></a>
4.3 CFU Firmware Offer Response</h3>
<p>Offer triggers a CFU Firmware Offer Response report to indicate the result of the Offer. The CFU Offer Response accepts or rejects the Offer sent. The CFU Offer Response report is defined below: </p><center><div id="table_4_3"><b>Table 4-3 Standard Offer Response</b></div></center> <table class="doxtable">
<tr>
<th>Offer <br />
Resp </th><th>Bit 7 </th><th>Bit 6 </th><th>Bit 5 </th><th>Bit 4 </th><th>Bit 3 </th><th>Bit 2 </th><th>Bit 1 </th><th>Bit 0  </th></tr>
<tr>
<td style="text-align: center;">Byte 0 </td><td style="text-align: center;" colspan="8">Report ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 1 </td><td style="text-align: center;" colspan="8" rowspan="3">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 2  </td></tr>
<tr>
<td style="text-align: center;">Byte 3  </td></tr>
<tr>
<td style="text-align: center;">Byte 4 </td><td style="text-align: center;" colspan="8">CFU Token  </td></tr>
<tr>
<td style="text-align: center;">Byte 5 </td><td style="text-align: center;" colspan="8" rowspan="4">Challenge (In response to OFFER_GET_CHALLENGE only, else Reserved)  </td></tr>
<tr>
<td style="text-align: center;">Byte 6  </td></tr>
<tr>
<td style="text-align: center;">Byte 7  </td></tr>
<tr>
<td style="text-align: center;">Byte 8  </td></tr>
<tr>
<td style="text-align: center;">Byte 9 </td><td style="text-align: center;" colspan="8">Reject Reason Code (Valid when Offer Status Code = FIRMARE_UPDATE_OFFER_REJECT, <br />
else Reserved)  </td></tr>
<tr>
<td style="text-align: center;"><div style="width:80px">Byte 10</div> </td><td style="text-align: center;" colspan="8" rowspan="3">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 11  </td></tr>
<tr>
<td style="text-align: center;">Byte 12  </td></tr>
<tr>
<td style="text-align: center;">Byte 13 </td><td style="text-align: center;" colspan="8">Offer Status Code  </td></tr>
<tr>
<td style="text-align: center;">Byte 14 </td><td style="text-align: center;" colspan="8" rowspan="3">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 15  </td></tr>
<tr>
<td style="text-align: center;">Byte 16  </td></tr>
</table>
<ul>
<li><b>Offer Status Code</b> can be one of the following values: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Offer Status Code  </th><th class="markdownTableHeadLeft">Name   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x00  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_OFFER_SKIP   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x01  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_OFFER_ACCEPT   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x02  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_OFFER_REJECT   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x03  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_OFFER_BUSY   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x04  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_OFFER_COMMAND_READY   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0xFF  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_CMD_NOT_SUPPORTED   </td></tr>
</table>
</li>
<li><b>Reject Reason</b> Code is valid only when the Offer Status Code FIRMWARE_UPDATE_OFFER_REJECT. Otherwise it is Reserved. Reject Reason Code can be one of the following values: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Offer Status Code  </th><th class="markdownTableHeadLeft">Name   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x00  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_OLD_FW   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x01  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_INV_COMPONENT   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x02  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_OFFER_SWAP_PENDING   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x03  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_MISMATCH   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x04  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_BANK   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x05  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_PLATFORM   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x06  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_MILESTONE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x07  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_INV_PCOL_REV   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x08  </td><td class="markdownTableBodyLeft">FIRMWARE_OFFER_REJECT_VARIANT   </td></tr>
</table>
</li>
</ul>
<h3><a class="anchor" id="CFU_Data_Report"></a>
4.4 CFU Data Report</h3>
<p>Once an offer is accepted, the host will issue a series of reports containing the CFU data. These reports use the Large Report format as follows: </p><center><div id="table_4_4"><b>Table 4-4 CFU Data Report</b></div></center> <table class="doxtable">
<tr>
<th>CFU Data </th><th>Bit 7 </th><th>Bit 6 </th><th>Bit 5 </th><th>Bit 4 </th><th>Bit 3 </th><th>Bit 2 </th><th>Bit 1 </th><th>Bit 0  </th></tr>
<tr>
<td style="text-align: center;">Byte 0 </td><td style="text-align: center;" colspan="8">Report ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 1 </td><td style="text-align: center;" colspan="8">Flags  </td></tr>
<tr>
<td style="text-align: center;">Byte 2 </td><td style="text-align: center;" colspan="8">Length  </td></tr>
<tr>
<td style="text-align: center;">Byte 3 </td><td style="text-align: center;" colspan="8" rowspan="2">Sequence Number  </td></tr>
<tr>
<td style="text-align: center;">Byte 4  </td></tr>
<tr>
<td style="text-align: center;">Byte 5 </td><td style="text-align: center;" colspan="8" rowspan="4">Target Address  </td></tr>
<tr>
<td style="text-align: center;">Byte 6  </td></tr>
<tr>
<td style="text-align: center;">Byte 7  </td></tr>
<tr>
<td style="text-align: center;">Byte 8  </td></tr>
<tr>
<td style="text-align: center;">Byte 9 </td><td style="text-align: center;" colspan="8" rowspan="3">CFU Data (Up to 52)  </td></tr>
<tr>
<td style="text-align: center;">...  </td></tr>
<tr>
<td style="text-align: center;">Byte 60  </td></tr>
</table>
<ul>
<li><b>Flags</b> is a bitmap of flags to control the download state that inform the target of the first and last blocks transferred, and whether verify the bytes being sent. The flags are not mutually-exclusive. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Flag Value  </th><th class="markdownTableHeadLeft">Flag Name   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x80  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_FLAG_FIRST_BLOCK   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x40  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_FLAG_LAST_BLOCK   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x08  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_FLAG_VERIFY   </td></tr>
</table>
</li>
<li><b>Sequence Number</b> is created by the host and is unique for each CFU Data Report issued. It is returned in the CFU Data Response Report to pair the CFU Data Report with the CFU Data Response Report.</li>
<li><b>Target Address</b> is a 32-bit absolute address in the address space of the target.</li>
<li><b>CFU Data</b> is an array of bytes to place at the destination address. It is not Little-Endian but an ordered array of bytes.</li>
</ul>
<h3><a class="anchor" id="CFU_Data_Response"></a>
4.5 CFU Data Response</h3>
<p>Each CFU Data Report will trigger a CFU Data Response Report. These reports use the Small Report format as follows: </p><center><div id="table_4_5"><b>Table 4-5 CFU Data Response</b></div></center> <table class="doxtable">
<tr>
<th>Data Rsp </th><th>Bit 7 </th><th>Bit 6 </th><th>Bit 5 </th><th>Bit 4 </th><th>Bit 3 </th><th>Bit 2 </th><th>Bit 1 </th><th>Bit 0  </th></tr>
<tr>
<td style="text-align: center;">Byte 0 </td><td style="text-align: center;" colspan="8">Report ID  </td></tr>
<tr>
<td style="text-align: center;">Byte 1 </td><td style="text-align: center;" colspan="8" rowspan="2">Sequence Number  </td></tr>
<tr>
<td style="text-align: center;">Byte 2  </td></tr>
<tr>
<td style="text-align: center;">Byte 3 </td><td style="text-align: center;" colspan="8" rowspan="2">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 4  </td></tr>
<tr>
<td style="text-align: center;">Byte 5 </td><td style="text-align: center;" colspan="8">Status Code  </td></tr>
<tr>
<td style="text-align: center;">Byte 6 </td><td style="text-align: center;" colspan="8" rowspan="11">Reserved  </td></tr>
<tr>
<td style="text-align: center;">Byte 7  </td></tr>
<tr>
<td style="text-align: center;">Byte 8  </td></tr>
<tr>
<td style="text-align: center;">Byte 9  </td></tr>
<tr>
<td style="text-align: center;">Byte 10  </td></tr>
<tr>
<td style="text-align: center;">Byte 11  </td></tr>
<tr>
<td style="text-align: center;">Byte 12  </td></tr>
<tr>
<td style="text-align: center;">Byte 13  </td></tr>
<tr>
<td style="text-align: center;">Byte 14  </td></tr>
<tr>
<td style="text-align: center;">Byte 15  </td></tr>
<tr>
<td style="text-align: center;">Byte 16  </td></tr>
</table>
<ul>
<li><b>Sequence Number</b> is the number in the same field of the CFU Data Report to which this report is responding.</li>
<li><b>Status Code</b> is one of the following values: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Status Code  </th><th class="markdownTableHeadLeft">Name   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x00  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_SUCCESS   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x01  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_PREPARE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x02  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_WRITE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x03  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_COMPLETE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x04  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_VERIFY   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x05  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_CRC   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x06  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_SIGNATURE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x07  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_VERSION   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x08  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_SWAP_PENDING   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x09  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_INVALID_ADDR   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0x0A  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_NO_OFFER   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0x0B  </td><td class="markdownTableBodyLeft">FIRMWARE_UPDATE_ERROR_INVALID   </td></tr>
</table>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="How_to_Port_Code"></a>
5 How to Port Code</h2>
<h3><a class="anchor" id="Include_files"></a>
5.1 Include files</h3>
<p>Include files (app_common_cfu.c/h and app_cfu_transfer.c/h) to the directory of your project. Directory: sdk</p>
<h3><a class="anchor" id="Handle_CFU_Firmware_Version"></a>
5.2 Handle CFU Firmware Version Request(Ex) Report</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html">_FW_UPDATE_VER_RESPONSE</a></div><div class="line">{</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#a5c4a7a2f9df0ff6d4f967627d9d5c49f">component_count</a>;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#ab8b12c36b6125cecffb30395ddbb0814">rsvd0</a>[2];</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#a0bf3405aea77d9d3021ce5571b001eb6">cfu_ver</a>: 4;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#ac4d50114b697301d74584a6564ffc2ca">rsvd1</a>: 3;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#a91c592cf70c61ba0788394767185be4c">extension</a>: 1;</div><div class="line"></div><div class="line">    <span class="keyword">struct</span></div><div class="line">    {</div><div class="line">        uint32_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#acd99bb05ca015e7d74448acb1deba7ca">version</a>;</div><div class="line">        uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#aaccbfb752723bf7af1abb8b0fe9858bc">bank</a>: 2;</div><div class="line">        uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#abfb0c86126653790eb2fe7390d660496">bud_role</a>: 2; <span class="comment">//bud role:0x00 single,0x01 pri, 0x02 sec</span></div><div class="line">        uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#afab9e5329a047b772b2733badcb2b08e">milestone</a>: 4;</div><div class="line">        uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#adc84285d5da2c4fa9721d0a32d5e41a7">component_id</a>;</div><div class="line">        uint16_t <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#a2301ba1a775ad9048d4f754444df95ad">platform_id</a>;</div><div class="line">    } <a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html#a35e91bcf335510769c8cdadecda89325">component_info</a>[7];</div><div class="line">} <a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u.html#gac51beaa0e77aaab1eacfd456c42572a6">FW_UPDATE_VER_RESPONSE</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u___exported___functions.html#gacb53a6f66554c96b24d3fbbf32677af9">app_cfu_get_version_parse</a>(<a class="code" href="struct___f_w___u_p_d_a_t_e___v_e_r___r_e_s_p_o_n_s_e.html">FW_UPDATE_VER_RESPONSE</a> *ver_rsp)</div><div class="line">{</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="Handle_CFU_Firmware_Offer"></a>
5.3 Handle CFU Firmware Offer Response</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html">_FW_UPDATE_OFFER_RESPONSE</a></div><div class="line">{</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#ad87f304bde9cbcd5f9e12a31484b398a">rsvd0</a>[3];</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#afb6cdb8d697f6e4b925161d99a2daa3c">token</a>;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#a7739bc410de0ae8e3987ea084e3fc7bb">challenge</a>[4];</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#ac7277990a7333898a34754f0824330bd">rejectReason</a>;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#a2b93999df21d097cd80fda5c608439d5">rsvd1</a>[3];</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#ade818037fd6c985038ff29656089758d">status</a>;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html#a514a31f0a46ea2c9d1676ce674abf8f1">rsvd2</a>[3];</div><div class="line">} <a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u.html#ga3c0dbd14020db73bc461312ed71236f8">FW_UPDATE_OFFER_RESPONSE</a>;</div><div class="line"></div><div class="line"><a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u.html#ga6913907d551bba0c96ef9ecb0b0bd01f">T_CFU_RSP_TYPE</a> <a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u___exported___functions.html#ga9aeea8f47f54a7e2d3f33d373bc3a2d6">app_cfu_offer_parse</a>(uint8_t *data, uint16_t length,</div><div class="line">                                   <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html">FW_UPDATE_OFFER_RESPONSE</a> *offer_rsp)</div><div class="line">{</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="Handle_CFU_Data_Response"></a>
5.4 Handle CFU Data Response</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___f_w___u_p_d_a_t_e___c_o_n_t_e_n_t___r_e_s_p_o_n_s_e.html">_FW_UPDATE_CONTENT_RESPONSE</a></div><div class="line">{</div><div class="line">    uint16_t <a class="code" href="struct___f_w___u_p_d_a_t_e___c_o_n_t_e_n_t___r_e_s_p_o_n_s_e.html#a98d07458cfe1557cbc2a1b1b2310b428">seq_num</a>;</div><div class="line">    uint16_t <a class="code" href="struct___f_w___u_p_d_a_t_e___c_o_n_t_e_n_t___r_e_s_p_o_n_s_e.html#a9c8ac1cfef06d5f08b5c3f8b135accc0">rsvd0</a>;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___c_o_n_t_e_n_t___r_e_s_p_o_n_s_e.html#ade818037fd6c985038ff29656089758d">status</a>;</div><div class="line">    uint8_t <a class="code" href="struct___f_w___u_p_d_a_t_e___c_o_n_t_e_n_t___r_e_s_p_o_n_s_e.html#a4bc7d6fd9eaa2457f110d40f8211785c">rsvd1</a>[11];</div><div class="line">} <a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u.html#gaef1361de601a8affdbe5410e63fc1b34">FW_UPDATE_CONTENT_RESPONSE</a>;</div><div class="line"></div><div class="line"><a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u.html#ga6913907d551bba0c96ef9ecb0b0bd01f">T_CFU_RSP_TYPE</a> <a class="code" href="group___a_p_p___c_o_m_m_o_n___c_f_u___exported___functions.html#ga9aeea8f47f54a7e2d3f33d373bc3a2d6">app_cfu_offer_parse</a>(uint8_t *data, uint16_t length,</div><div class="line">                                   <a class="code" href="struct___f_w___u_p_d_a_t_e___o_f_f_e_r___r_e_s_p_o_n_s_e.html">FW_UPDATE_OFFER_RESPONSE</a> *offer_rsp)</div><div class="line">{</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="How_to_Use_Tool"></a>
6 How to Use Tool</h2>
<h3><a class="anchor" id="CFU_Prepare_the_image_to_update"></a>
6.1 Prepare the image to update</h3>
<p>The OTA header generate tool and image pack tool are all integrated into the MP Programming Tool </p><div class="image">
<img src="CFU_MP_Programing_Tool.png" alt="CFU_MP_Programing_Tool.png"/>
</div>
 <center><div id="figure_6_1"><b>Figure 6-1 MP Programing Tool</b></div></center><h4><a class="anchor" id="CFU_Generate_OTA_Header"></a>
6.1.1 Generate OTA Header</h4>
<p>Load flash_map.ini(e.g. RTL87X3E-SDK-VX.X.X.X.ini) and RSA key (e.g. RTL87X3E-SDK-VX.X.X.X.pem). Select bank0 or bank1 and fill in the version(ver_val) manually to generate the OTA header bin. </p><div class="image">
<img src="CFU_Generate_OTA_Header.png" alt="CFU_Generate_OTA_Header.png"/>
</div>
 <center><div id="figure_6_2"><b>Figure 6-2 Generate OTA Header</b></div></center><h4><a class="anchor" id="CFU_Pack_whole_Images"></a>
6.1.2 Pack Whole Images</h4>
<p>Load flash_map.ini (e.g. RTL87X3E-SDK-VX.X.X.X.ini). Select bank0 images and optional VP image to add files for packing bank0 images and select bank1 images and optional VP image to add files for packing bank1 images. </p><div class="image">
<img src="CFU_Pack_Images.png" alt="CFU_Pack_Images.png"/>
</div>
 <center><div id="figure_6_3"><b>Figure 6-3 Pack Images</b></div></center><h3><a class="anchor" id="CFU_Download_Tool_User_Guide"></a>
6.2 CFU Download Tool User Guide</h3>
<p>Step 1 Choose IC type and CFU type. </p><div class="image">
<img src="Choose_IC_Type_and_CFU_Type.png" alt="Choose_IC_Type_and_CFU_Type.png"/>
</div>
 <center><div id="figure_6_4"><b>Figure 6-4 Choose IC Type and CFU Type</b></div></center><p>Step 2 Set force reset, ignore version, ignore platform id or not and CFU image patch. Step 3 Get device info and download. </p><div class="image">
<img src="Get_Device_Info_and_Download.png" alt="Get_Device_Info_and_Download.png"/>
</div>
 <center><div id="figure_6_5"><b>Figure 6-5 Get Device Info and Download</b></div></center> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
