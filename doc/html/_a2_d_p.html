<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="A2DP_USER_MANU"></a>
A2DP Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/06/20</b></center><div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/05/24  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/06/20  </td><td class="markdownTableBodyCenter">Content supplement   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_a2_d_p.html#A2DP_Rev">Revision History</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_Table_List">Table List</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_Figure_List">Figure List</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_Glossary">Glossary</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_Intro">1 Introduction</a><ul>
<li><a class="el" href="_a2_d_p.html#A2DP_Role">1.1 A2DP Roles</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_SDP_RECORD">1.2 A2DP SDP Record</a></li>
</ul>
</li>
<li><a class="el" href="_a2_d_p.html#A2DP_Init">2 A2DP Init</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_Connect">3 A2DP Connect</a></li>
<li><a class="el" href="_a2_d_p.html#A2DP_Streaming">4 A2DP Streaming</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_3_1">Figure 3-1 A2DP Connect Request</a></li>
<li><a href="#figure_3_2">Figure 3-2 A2DP Disconnect Request</a></li>
<li><a href="#figure_3_3">Figure 3-3 A2DP Connect Confirm</a></li>
<li><a href="#figure_4_1">Figure 4-1 A2DP Stream Open Request</a></li>
<li><a href="#figure_4_2">Figure 4-2 A2DP Stream Start Request</a></li>
<li><a href="#figure_4_3">Figure 4-3 A2DP Stream Start Confirm</a></li>
<li><a href="#figure_4_4">Figure 4-4 A2DP Stream Close Request</a></li>
<li><a href="#figure_4_5">Figure 4-5 A2DP Stream Suspend Request</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">A2DP  </td><td class="markdownTableBodyCenter">Advanced Audio Distribution Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SRC  </td><td class="markdownTableBodyCenter">A device acts as a source of a digital audio stream that is delivered to the SNK of the piconet.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SNK  </td><td class="markdownTableBodyCenter">A device acts as a sink of a digital audio stream delivered from the SRC on the same piconet.   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Intro"></a>
1 Introduction</h2>
<p>This manual describes the <b>Advanced Audio Distribution Profile (A2DP) API definition</b>. A2DP defines the protocols and procedures that realize distribution of audio content of high-quality in mono or stereo on ACL channels.</p>
<h3><a class="anchor" id="A2DP_Role"></a>
1.1 A2DP Roles</h3>
<p>The following roles are defined for devices that implement this profile:</p><ul>
<li><b>Source (SRC)</b> - A device is the SRC when it acts as a source of a digital audio stream that is delivered to the SNK of the piconet.</li>
<li><b>Sink (SNK)</b> - A device is the SNK when it acts as a sink of a digital audio stream delivered from the SRC on the same piconet.</li>
</ul>
<h3><a class="anchor" id="A2DP_SDP_RECORD"></a>
1.2 A2DP SDP Record</h3>
<p>A2DP local record <b>a2dp_sdp_record</b> should be registered by <a class="el" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef" title="Add an SDP record to BT stack. ">bt_sdp_record_add()</a>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t a2dp_sdp_record[] =</div><div class="line">{</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x39,<span class="comment">//0x55,</span></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_CLASS_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga54b9fa1bd5126b6e5070873e1d1187ab">UUID_AUDIO_SINK</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga54b9fa1bd5126b6e5070873e1d1187ab">UUID_AUDIO_SINK</a>),</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROTO_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x10,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a>),</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga6db75c9162ffb534c855804327fea0ea">PSM_AVDTP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga6db75c9162ffb534c855804327fea0ea">PSM_AVDTP</a>),</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga757abe5de4d297c7fb59e294b3647667">UUID_AVDTP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga757abe5de4d297c7fb59e294b3647667">UUID_AVDTP</a>),</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x01,</div><div class="line">    0x03,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_BROWSE_GROUP_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a>),</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">        //attribute SDP_ATTR_LANG_BASE_ATTR_ID_LIST</span></div><div class="line"><span class="comment">        SDP_UNSIGNED_TWO_BYTE,</span></div><div class="line"><span class="comment">        (uint8_t)(SDP_ATTR_LANG_BASE_ATTR_ID_LIST &gt;&gt; 8),</span></div><div class="line"><span class="comment">        (uint8_t)SDP_ATTR_LANG_BASE_ATTR_ID_LIST,</span></div><div class="line"><span class="comment">        SDP_DATA_ELEM_SEQ_HDR,</span></div><div class="line"><span class="comment">        0x09,</span></div><div class="line"><span class="comment">        SDP_UNSIGNED_TWO_BYTE,</span></div><div class="line"><span class="comment">        (uint8_t)(SDP_LANG_ENGLISH &gt;&gt; 8),</span></div><div class="line"><span class="comment">        (uint8_t)SDP_LANG_ENGLISH,</span></div><div class="line"><span class="comment">        SDP_UNSIGNED_TWO_BYTE,</span></div><div class="line"><span class="comment">        (uint8_t)(SDP_CHARACTER_UTF8 &gt;&gt; 8),</span></div><div class="line"><span class="comment">        (uint8_t)SDP_CHARACTER_UTF8,</span></div><div class="line"><span class="comment">        SDP_UNSIGNED_TWO_BYTE,</span></div><div class="line"><span class="comment">        (uint8_t)(SDP_BASE_LANG_OFFSET &gt;&gt; 8),</span></div><div class="line"><span class="comment">        (uint8_t)SDP_BASE_LANG_OFFSET,</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROFILE_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x08,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gad8bc231e47cb3858e71a1b9aa44a8e91">UUID_ADVANCED_AUDIO_DISTRIBUTION</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gad8bc231e47cb3858e71a1b9aa44a8e91">UUID_ADVANCED_AUDIO_DISTRIBUTION</a>),</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x01,<span class="comment">//version 1.4</span></div><div class="line">    0x04,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SUPPORTED_FEATURES</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga1d91531d2bd55bfc1bd089e36ad45816">SDP_ATTR_SUPPORTED_FEATURES</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga1d91531d2bd55bfc1bd089e36ad45816">SDP_ATTR_SUPPORTED_FEATURES</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x00,</div><div class="line">    0x03</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">        //attribute SDP_ATTR_SRV_NAME</span></div><div class="line"><span class="comment">        SDP_UNSIGNED_TWO_BYTE,</span></div><div class="line"><span class="comment">        (uint8_t)((SDP_ATTR_SRV_NAME + SDP_BASE_LANG_OFFSET) &gt;&gt; 8),</span></div><div class="line"><span class="comment">        (uint8_t)(SDP_ATTR_SRV_NAME + SDP_BASE_LANG_OFFSET),</span></div><div class="line"><span class="comment">        SDP_STRING_HDR,</span></div><div class="line"><span class="comment">        0x09,</span></div><div class="line"><span class="comment">        0x61, 0x32, 0x64, 0x70, 0x5f, 0x73, 0x69, 0x6e, 0x6b //a2dp_sink</span></div><div class="line"><span class="comment">    */</span></div><div class="line">};</div></div><!-- fragment --><div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Init"></a>
2 A2DP Init</h2>
<p>A2DP initialization procedure involves profile initialization, role setting and stream endpoint registration.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#ga8e77071818d9c67d07f2e6dd665e516f" title="Initialize A2DP profile. ">bt_a2dp_init()</a> <br />
 Initialize A2DP profile, and configure the maximum number of remote devices and A2DP latency. A2DP latency is used to enable synchronization of audio and video playback by reporting of SNK delay values caused by buffering, decoding and rendering.</p>
<p>bool bt_a2dp_role_set() <br />
 Set Sink or Source of A2DP role.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#ga4c0b9fe2c39fee38e79df1874d10bfb4" title="Add A2DP stream endpoint. ">bt_a2dp_stream_endpoint_add()</a> <br />
 Add A2DP stream end point. An A/V stream on a Bluetooth link is sent or received by Bluetooth devices via an abstract Stream End Point (SEP). A device can discover the SEPs of the remote device by the Stream End Point Discovery procedure, which is done by framework. The Application registers its SEPs in order to allow other devices to discover and connect to them. The SEP with sbc codec shall always be registered.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#gaa93f39f7b0cb8266abd298def98d2b40" title="Delete A2DP stream endpoint. ">bt_a2dp_stream_endpoint_delete()</a> <br />
 Delete A2DP stream endpoint. Stream endpoint must be deleted when all a2dp profile links were disconnected.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a2_d_p___exported___functions.html#gac3f386b114aec272668771ef6e53e059">app_a2dp_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga22ec8032c8e4b8b7843c186572dbc1c6">supported_profile_mask</a> &amp; <a class="code" href="group___a_p_p___l_i_n_k.html#gaad765ad29cb83f3abedb49901d855c3d">A2DP_PROFILE_MASK</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef">bt_sdp_record_add</a>((<span class="keywordtype">void</span> *)a2dp_sdp_record);</div><div class="line"></div><div class="line">        <a class="code" href="group___b_t___a2_d_p.html#ga8e77071818d9c67d07f2e6dd665e516f">bt_a2dp_init</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga84c18eca0026bac68c9a1631871c957f">a2dp_link_number</a>, A2DP_LATENCY_MS);</div><div class="line">        bt_a2dp_role_set(<a class="code" href="group___b_t___a2_d_p.html#gga0ec96e99f02978246dbccf6dc9800eaeadc63540961ecb6b63bdd5200597d9af1">BT_A2DP_ROLE_SNK</a>);</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ac87521e41377be51e63c30e27e01d9f6">a2dp_codec_type_sbc</a>)</div><div class="line">        {</div><div class="line">            T_BT_A2DP_STREAM_END_POINT sep;</div><div class="line"></div><div class="line">            sep.codec_type = <a class="code" href="group___b_t___a2_d_p___c_o_d_e_c___t_y_p_e.html#ga988d7c5a23cf86517bfa37e5f346d6d9">BT_A2DP_CODEC_TYPE_SBC</a>;</div><div class="line">            sep.u.codec_sbc.sampling_frequency_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a0a81448b9a897cc7284ee81d6ba9cac1">sbc_sampling_frequency</a>;</div><div class="line">            sep.u.codec_sbc.channel_mode_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#af38d34d5275b82a0b61198e88520b19c">sbc_channel_mode</a>;</div><div class="line">            sep.u.codec_sbc.block_length_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ab5dc21a53555b9f28998badd0c62e6ee">sbc_block_length</a>;</div><div class="line">            sep.u.codec_sbc.subbands_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a726b5516424fe2b9fd4ecd541f7552d2">sbc_subbands</a>;</div><div class="line">            sep.u.codec_sbc.allocation_method_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#aa1743b44399bfc0e4b1642a681ae15ad">sbc_allocation_method</a>;</div><div class="line">            sep.u.codec_sbc.min_bitpool = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a74a61a188ce55fa6b4e25e9b59d1cfb6">sbc_min_bitpool</a>;</div><div class="line">            sep.u.codec_sbc.max_bitpool = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a5ead32e3f1bffed18b94e41e7490bdc1">sbc_max_bitpool</a>;</div><div class="line">            <a class="code" href="group___b_t___a2_d_p.html#ga4c0b9fe2c39fee38e79df1874d10bfb4">bt_a2dp_stream_endpoint_add</a>(sep);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ab0ae39e3190cfa214747ab920e5f78c1">a2dp_codec_type_aac</a>)</div><div class="line">        {</div><div class="line">            T_BT_A2DP_STREAM_END_POINT sep;</div><div class="line"></div><div class="line">            sep.codec_type = <a class="code" href="group___b_t___a2_d_p___c_o_d_e_c___t_y_p_e.html#ga510718c14e37978729b7529db1bf4a50">BT_A2DP_CODEC_TYPE_AAC</a>;</div><div class="line">            sep.u.codec_aac.object_type_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a30814e378f335eecb80297263cd4cf3d">aac_object_type</a>;</div><div class="line">            sep.u.codec_aac.sampling_frequency_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#af07c887a56f2bfbb69be9b0496010673">aac_sampling_frequency</a>;</div><div class="line">            sep.u.codec_aac.channel_number_mask = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae9d49dcb7a390176b4aba2aa2968b1d1">aac_channel_number</a>;</div><div class="line">            sep.u.codec_aac.vbr_supported = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ab476d1d9defdfd3b34fe091c15d26b51">aac_vbr_supported</a>;</div><div class="line">            sep.u.codec_aac.bit_rate = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#afefd5086529cb648aaba595f4fbdb1a5">aac_bit_rate</a>;</div><div class="line">            <a class="code" href="group___b_t___a2_d_p.html#ga4c0b9fe2c39fee38e79df1874d10bfb4">bt_a2dp_stream_endpoint_add</a>(sep);</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>(app_a2dp_bt_cback);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Connect"></a>
3 A2DP Connect</h2>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#ga5ca65cf789cadd7c81e157b9ac15e325" title="Send an A2DP connection request. ">bt_a2dp_connect_req()</a> <br />
 Initiate an A2DP connection to a remote device, as shown in Figure 3-1. </p><div class="image">
<img src="A2DP_connect_request.PNG" alt="A2DP_connect_request.PNG"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 A2DP Connect Request </b></div></center><p>bool <a class="el" href="group___b_t___a2_d_p.html#ga896637e21cd4f28cc3079c5bffd7fee1" title="Send an A2DP disconnection request. ">bt_a2dp_disconnect_req()</a> <br />
 Request an A2DP disconnection, as shown in Figure 3-2. </p><div class="image">
<img src="A2DP_disconnect_request.PNG" alt="A2DP_disconnect_request.PNG"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 A2DP Disconnect Request </b></div></center><p>bool <a class="el" href="group___b_t___a2_d_p.html#gab9b524b8b13dfe907aa33da5ae219c9b" title="Send an A2DP connection confirmation. ">bt_a2dp_connect_cfm()</a> <br />
 Accept or reject the incoming connection from the remote device, as shown in Figure 3-3. </p><div class="image">
<img src="A2DP_connect_confirm.PNG" alt="A2DP_connect_confirm.PNG"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 A2DP Connect Confirm </b></div></center><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_a2dp_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line">    <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ae309c600d80991de0e044e6c33479e49">BT_EVENT_A2DP_CONN_IND</a>:</div><div class="line">        {</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#ga02c6038934a5cd3f4a0cf6ddabc090a0">app_find_br_link</a>(param-&gt;bt_a2dp_conn_ind.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___b_t___a2_d_p.html#gab9b524b8b13dfe907aa33da5ae219c9b">bt_a2dp_connect_cfm</a>(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>, <span class="keyword">true</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a83f311765467eaa0250070fa4095045e">BT_EVENT_A2DP_CONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a16540234258b984116a49beff7f22af4">BT_EVENT_A2DP_CONN_FAIL</a>:</div><div class="line">        <span class="comment">/*If both devices initiate a connection at the same time, both channels shall be closed and BT_EVENT_A2DP_CONN_FAIL will be received.</span></div><div class="line"><span class="comment">          Each device shall wait a random time (not more than 1s and not less than 100ms) and then try to initiate the A2DP connection again. */</span></div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ad263cca2661f58f49323f898ad0ba4dd">BT_EVENT_A2DP_CONFIG_CMPL</a>:</div><div class="line">        {</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#ga02c6038934a5cd3f4a0cf6ddabc090a0">app_find_br_link</a>(param-&gt;bt_a2dp_config_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html">T_BT_EVENT_PARAM_A2DP_CONFIG_CMPL</a> *cfg = &amp;param-&gt;bt_a2dp_config_cmpl;</div><div class="line">                p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a761b82d826174644e7b20497a1042a8c">a2dp_codec_type</a> = param-&gt;bt_a2dp_config_cmpl.codec_type;</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a761b82d826174644e7b20497a1042a8c">a2dp_codec_type</a> == <a class="code" href="group___b_t___a2_d_p___c_o_d_e_c___t_y_p_e.html#ga988d7c5a23cf86517bfa37e5f346d6d9">BT_A2DP_CODEC_TYPE_SBC</a>)</div><div class="line">                {</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.sampling_frequency = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.sampling_frequency;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.channel_mode = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.channel_mode;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.block_length = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.block_length;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.subbands = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.subbands;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.allocation_method = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.allocation_method;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.min_bitpool = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.min_bitpool;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#aaf5dcb9706bfdcb3bc21cd9ebad77c15">sbc</a>.max_bitpool = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a409ae4cb0563cd50e6ab98602bfc4ecf">sbc</a>.max_bitpool;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a761b82d826174644e7b20497a1042a8c">a2dp_codec_type</a> == <a class="code" href="group___b_t___a2_d_p___c_o_d_e_c___t_y_p_e.html#ga510718c14e37978729b7529db1bf4a50">BT_A2DP_CODEC_TYPE_AAC</a>)</div><div class="line">                {</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#ab9d6566d6207b36a804f8cce03a5ca06">aac</a>.object_type = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#adb8253c71b72331449dff7211a6e08fb">aac</a>.object_type;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#ab9d6566d6207b36a804f8cce03a5ca06">aac</a>.sampling_frequency = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#adb8253c71b72331449dff7211a6e08fb">aac</a>.sampling_frequency;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#ab9d6566d6207b36a804f8cce03a5ca06">aac</a>.channel_number = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#adb8253c71b72331449dff7211a6e08fb">aac</a>.channel_number;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#ab9d6566d6207b36a804f8cce03a5ca06">aac</a>.vbr_supported = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#adb8253c71b72331449dff7211a6e08fb">aac</a>.vbr_supported;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#ab9d6566d6207b36a804f8cce03a5ca06">aac</a>.allocation_method = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#adb8253c71b72331449dff7211a6e08fb">aac</a>.allocation_method;</div><div class="line">                    p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#ab9d6566d6207b36a804f8cce03a5ca06">aac</a>.bit_rate = cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#adb8253c71b72331449dff7211a6e08fb">aac</a>.bit_rate;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    memcpy(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a1c1773d5a0e60aff753a98ece640e3c3">a2dp_codec_info</a>.<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a43be121ad974a8c77d22d71d3cf19b2c">vendor</a>.info, cfg-&gt;<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#a751dd1c7d203108761bf214d854eec64">codec_info</a>.<a class="code" href="structt__bt__event__param__a2dp__config__cmpl.html#ade209372da3e42e839032e4bcf52d57d">vendor</a>.info, 12);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aa0f06a739544f814d6fedab714dc97d6">BT_EVENT_A2DP_DISCONN_CMPL</a>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div> <h2><a class="anchor" id="A2DP_Streaming"></a>
4 A2DP Streaming</h2>
<p>After A2DP signal channel been connected, framework will complete discover, set configuration and open operation.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#ga99ca0ff671a116dcbc8bebc17abc7f5f" title="Send an A2DP stream channel open request. ">bt_a2dp_stream_open_req()</a> <br />
 Connect a streaming channel to the remote device, as shown in Figure 4-1. </p><div class="image">
<img src="A2DP_stream_open_request.PNG" alt="A2DP_stream_open_request.PNG"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 A2DP Stream Open Request </b></div></center><p>bool <a class="el" href="group___b_t___a2_d_p.html#ga71b183570facb44313f5133050383319" title="Send an A2DP stream channel start request. ">bt_a2dp_stream_start_req()</a> <br />
 Request to start streaming audio data over a streaming channel, as shown in Figure 4-2. <b>Note:</b><a class="el" href="group___b_t___a_v_r_c_p.html#gaec1cd5aedeea03a16f6bd9dc8be3174d" title="Send a command that simulates keystrokes to start playing an item on remote device. ">bt_avrcp_play()</a> is recommended to start music. </p><div class="image">
<img src="A2DP_stream_start_request.PNG" alt="A2DP_stream_start_request.PNG"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 A2DP Stream Start Request </b></div></center><p>bool <a class="el" href="group___b_t___a2_d_p.html#ga85d88291d001b7a13317ad66cbb12758" title="Send an A2DP stream start confirmation. ">bt_a2dp_stream_start_cfm()</a> <br />
 Accept or reject the incoming start streaming request from a remote device, as shown in Figure 4-3. </p><div class="image">
<img src="A2DP_stream_start_confirm.PNG" alt="A2DP_stream_start_confirm.PNG"/>
</div>
 <center><div id="figure_4_3"><b>Figure 4-3 A2DP Stream Start Confirm </b></div></center><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_a2dp_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line">    <a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html">T_APP_BR_LINK</a> *p_link;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a053e183f4f4125c3be422bf2682a6445">BT_EVENT_A2DP_STREAM_OPEN</a>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ab1b5495c4b4660a92f09c70a8f9f2841">BT_EVENT_A2DP_STREAM_START_IND</a>:</div><div class="line">        {</div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#ga02c6038934a5cd3f4a0cf6ddabc090a0">app_find_br_link</a>(param-&gt;bt_a2dp_stream_start_ind.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___b_t___a2_d_p.html#gab9b524b8b13dfe907aa33da5ae219c9b">bt_a2dp_connect_cfm</a>(p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>, <span class="keyword">true</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aeaef16348650b2abb8ac94c1bdcfc0b4">BT_EVENT_A2DP_STREAM_STOP</a>:</div><div class="line">        <span class="comment">//release resources</span></div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a1bdd577320e7d169f8cf921efc735cee">BT_EVENT_A2DP_STREAM_CLOSE</a>:</div><div class="line">        <span class="comment">//release resources</span></div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ab7be1fa9388787c6519af21e976f557e">BT_EVENT_A2DP_STREAM_DATA_IND</a>:</div><div class="line">        <span class="comment">//deal with audio data</span></div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><br />
 bool <a class="el" href="group___b_t___a2_d_p.html#gab72288202a8f0ffed7aae319ca2368c0" title="Send an A2DP stream channel close request. ">bt_a2dp_stream_close_req()</a> <br />
 Request to close a streaming channel from the remote device, as shown in Figure 4-4. </p><div class="image">
<img src="A2DP_stream_close_request.PNG" alt="A2DP_stream_close_request.PNG"/>
</div>
 <center><div id="figure_4_4"><b>Figure 4-4 A2DP Stream Close Request </b></div></center><p>bool <a class="el" href="group___b_t___a2_d_p.html#ga407650fd33fc064a4c8c911de7b3edc2" title="Send an A2DP stream channel suspend request. ">bt_a2dp_stream_suspend_req()</a> <br />
 Request to cease the streaming of audio data over a streaming channel, as shown in Figure 4-5. <b>Note:</b><a class="el" href="group___b_t___a_v_r_c_p.html#ga4d945994677031f70199fc6f5fd9b50a" title="Send a command that simulates keystrokes to pause an item on remote device. ">bt_avrcp_pause()</a> is recommended to stop music. </p><div class="image">
<img src="A2DP_stream_susupend_request.PNG" alt="A2DP_stream_susupend_request.PNG"/>
</div>
 <center><div id="figure_4_5"><b>Figure 4-5 A2DP Stream Suspend Request </b></div></center><p>bool <a class="el" href="group___b_t___a2_d_p.html#ga2abbabeee5c1aea5443d174e44af6495" title="Send an A2DP stream channel abort request. ">bt_a2dp_stream_abort_req()</a> <br />
 Request to abort the streaming channel.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#gaf591742dc27d240732342e83a1403c2b" title="Set A2DP stream latency. ">bt_a2dp_stream_delay_report_request()</a> <br />
 Request to Set A2DP stream latency. This enables synchronous playback of audio and video.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#gad38162d47d9e8f8d590e9eb52a42cdaf" title="Set an active A2DP stream link for A2DP multi-links. ">bt_a2dp_active_link_set()</a> <br />
 Set an active A2DP stream link for A2DP multi-links.</p>
<p>bool <a class="el" href="group___b_t___a2_d_p.html#ga86c549515a09e4a1c8b2868f9a97fd77" title="Send A2DP stream data. ">bt_a2dp_stream_data_send()</a> <br />
 Send A2DP stream data when role is Source. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_a2dp_src_send_data(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">//get media data</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (a2dp_credits &gt; 0)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___b_t___a2_d_p.html#ga86c549515a09e4a1c8b2868f9a97fd77">bt_a2dp_stream_data_send</a>(a2dp_sink_addr, frame_num, p_data, length))</div><div class="line">        {</div><div class="line">            a2dp_credits--;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <a class="code" href="group___t_r_a_c_e.html#gaf20aac2fd019420214bcab2eadd15156">APP_PRINT_ERROR0</a>(<span class="stringliteral">&quot;app_a2dp_src_send_data: send a2dp media pkt failed&quot;</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
