<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="Normal_APT_Page"></a>
Normal APT Function Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.1</b></center><p><br />
 </p><center><b>2023/07/12</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/07/12  </td><td class="markdownTableBodyCenter">Optimize content   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_Rev">Revision History</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_Table_List">Table List</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_DSPConfigTool_Configuration">2 DSPConfigTool Configuration</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_McuConfigTool_Configuration">3 McuConfigTool Configuration</a></li>
<li><a class="el" href="_a_n041__normal__a_p_t__application__note.html#APT_Source_Code_Overview">4 Source Code Overview</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 Enable Normal APT in DSP Configure Tool</a></li>
<li><a href="#figure_2_2">Figure 2-2 Normal APT ADC Boost Gain</a></li>
<li><a href="#figure_2_3">Figure 2-3 Normal APT ADC Digital Gain</a></li>
<li><a href="#figure_2_4">Figure 2-4 Normal APT DAC Gain</a></li>
<li><a href="#figure_2_5">Figure 2-5 A2DP Suppress Gain</a></li>
<li><a href="#figure_2_6">Figure 2-6 Normal APT SW EQ</a></li>
<li><a href="#figure_2_7">Figure 2-7 Normal APT Processing</a></li>
<li><a href="#figure_3_1">Figure 3-1 Normal APT Enable</a></li>
<li><a href="#figure_3_2">Figure 3-2 Normal APT Mic Setting</a></li>
<li><a href="#figure_3_3">Figure 3-3 Key Setting for normal APT</a></li>
<li><a href="#figure_3_4">Figure 3-4 APT Power On Status</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT  </td><td class="markdownTableBodyCenter">Audio Passthrough   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_Introduction"></a>
1 Introduction</h2>
<p>The purpose of this document is to give an overview of Normal APT function.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_DSPConfigTool_Configuration"></a>
2 DSPConfigTool Configuration</h2>
<p>"Enable APT" and "Normal APT" should be selected if Normal APT is required in the product. </p><div class="image">
<img src="Enable_Normal_APT_in_DSP_Configure_Tool.jpg" alt="Enable_Normal_APT_in_DSP_Configure_Tool.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Enable Normal APT in DSP Configure Tool</b></div></center><p> <br />
 <br />
 Normal APT shares the same input boost gain with voice. </p><div class="image">
<img src="Normal_APT_ADC_Boost_Gain.jpg" alt="Normal_APT_ADC_Boost_Gain.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 Normal APT ADC Boost Gain</b></div></center><p> <br />
 <br />
 Normal APT input digital gain is set as shown in following figure. </p><div class="image">
<img src="Normal_APT_ADC_digital_gain.jpg" alt="Normal_APT_ADC_digital_gain.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Normal APT ADC Digital Gain</b></div></center><p> <br />
 <br />
 Normal APT output gain is set as shown in following figure. </p><div class="image">
<img src="Normal_APT_DAC_Gain.jpg" alt="Normal_APT_DAC_Gain.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_2_4"><b>Figure 2-4 Normal APT DAC Gain</b></div></center><p> <br />
 <br />
 When audio is mixed with Normal APT, audio gain will be suppressed by do following setting which will make APT effect more clear. </p><div class="image">
<img src="A2DP_Suppress_Gain.jpg" alt="A2DP_Suppress_Gain.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_2_5"><b>Figure 2-5 A2DP Suppress Gain</b></div></center><p> <br />
 <br />
 Multiple group of Software Effect for Normal APT can be configured so the user can switch different APT effect. </p><div class="image">
<img src="Normal_APT_SW_EQ.jpg" alt="Normal_APT_SW_EQ.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_2_6"><b>Figure 2-6 Normal APT SW EQ</b></div></center><p> <br />
 <br />
 DSP will do noise controling according to the configuration as shown in the following figure. If "Bypass APT Processing" is selected, DSP will not do any noise process and software EQ process. </p><div class="image">
<img src="Normal_APT_Processing.jpg" alt="Normal_APT_Processing.jpg"/>
</div>
 <center><div id="figure_2_7"><b>Figure 2-7 Normal APT Processing</b></div></center><p><br />
 <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_McuConfigTool_Configuration"></a>
3 McuConfigTool Configuration</h2>
<p>Normal APT mode can be enabled in "HW Feature" page as shown in figure 8. </p><div class="image">
<img src="Normal_APT_Enable.jpg" alt="Normal_APT_Enable.jpg"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 Normal APT Enable</b></div></center><p> <br />
 <br />
 Physical Mic and Mic type can be selected in "Audio Route" page as shown in figure 9. </p><div class="image">
<img src="Normal_APT_Mic_Setting.jpg" alt="Normal_APT_Mic_Setting.jpg"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 Normal APT Mic Setting</b></div></center><p> <br />
 <br />
 Select trigger method and action in "KEY" page. </p><div class="image">
<img src="Key_Setting.jpg" alt="Key_Setting.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 Key Setting for normal APT</b></div></center><p> <br />
 <br />
 Select APT behavior when system power on in "AUDIO" page. For example, if you want to open APT automatically after power on, select "APT on" in the following check box. </p><div class="image">
<img src="APT_Power_On_Status.jpg" alt="APT_Power_On_Status.jpg" width="90%" height="90%"/>
</div>
 <center><div id="figure_3_4"><b>Figure 3-4 APT Power On Status</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="APT_Source_Code_Overview"></a>
4 Source Code Overview</h2>
<p>This section discribes the main parts of Normal APT source code.</p>
<h3>Defines for APT</h3>
<p>APT volume type. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAIN_TYPE_LEVEL         0</span></div><div class="line"><span class="preprocessor">#define SUB_TYPE_LEVEL          1</span></div></div><!-- fragment --><p>Max/min value of APT main level and sub level. </p><div class="fragment"><div class="line"><span class="preprocessor">#define APT_MAIN_VOLUME_LEVEL_MAX        app_cfg_const.apt_volume_out_max</span></div><div class="line"><span class="preprocessor">#define APT_SUB_VOLUME_LEVEL_MAX         100</span></div><div class="line"><span class="preprocessor">#define APT_SUB_VOLUME_LEVEL_MIN         0</span></div></div><!-- fragment --><p>Is APT volume synced for both buds or not. </p><div class="fragment"><div class="line"><span class="preprocessor">#define RWS_SYNC_APT_VOLUME     (app_cfg_nv.rws_disallow_sync_apt_volume ^ 1)</span></div></div><!-- fragment --><h3>Enums for APT</h3>
<h4>T_APT_SM_STATE</h4>
<p>Enum for state transition of APT open/close state. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga59e561a05a827670a34230afdc573f48">t_apt_state</a></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a8873ca947361f2fc15113e1d8b3bf959">APT_STOPPED</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48ac3838fb4c676401e3c8a220b569d68a1">APT_STARTING</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a87bc367aa88dff7ec2c1907651749837">APT_STARTED</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a9ec7ffc0e17ba1cb7e5b13b2c68ae03e">APT_STOPPING</a>,</div><div class="line">} <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaef1c0ca43593656a2fdb8e49864835b6">T_APT_SM_STATE</a>;</div></div><!-- fragment --><h4>T_APT_REMOTE_MSG</h4>
<p>Enum for all kinds of remote messages of APT. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7a3fa3f2886d0b4db59ef7e79263efa51b">APP_REMOTE_MSG_APT_VOLUME_OUT_LEVEL</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7aa6c2ef5bb538cdd762851e0e659884de">APP_REMOTE_MSG_APT_EQ_INDEX_SYNC</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7a37577cda59031d58941aa62687a9079a">APP_REMOTE_MSG_APT_VOLUME_SYNC</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7ae557bb15b9e135ab9338e8f5641174b1">APP_REMOTE_MSG_RELAY_APT_CMD</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7a50aaaa6a18e5e97cb4dac8b4be3d21a8">APP_REMOTE_MSG_RELAY_APT_EVENT</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7a5e59902d9d7fcde319749a554c097a9a">APP_REMOTE_MSG_EXIT_LLAPT_CHOOSE_MODE</a>,</div><div class="line">    APP_REMOTE_MSG_SECONDARY_APT_STATUS,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7a8ba4d9c373e333e3355abdeca237fa21">APP_REMOTE_MSG_APT_EQ_DEFAULT_INDEX_SYNC</a>,</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7ab0fab1a8c062d0c522cdcf64259389f9">APP_REMOTE_MSG_APT_TOTAL</a></div><div class="line">} <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gafaa81adbfd941fa0a49ef7b14663f9c7">T_APT_REMOTE_MSG</a>;</div></div><!-- fragment --><h4>T_APT_EQ_DATA_UPDATE_EVENT</h4>
<p>Enum of APT EQ's update information. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga0914fd05c251e27bc1a3cceffbcaf568a39bd980f1cfce28ce3ec5da00e2d77f3">EQ_INDEX_REPORT_BY_APT_ENABLE</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga0914fd05c251e27bc1a3cceffbcaf568a55e55ff9b88564ab1d084b6dbb29d34f">EQ_INDEX_REPORT_BY_RWS_CONNECTED</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga0914fd05c251e27bc1a3cceffbcaf568a0d78b5a5e952ebe06e9d3b6e7ec9bc3e">EQ_INDEX_REPORT_BY_SWITCH_APT_EQ_INDEX</a>,</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga0914fd05c251e27bc1a3cceffbcaf568aca3bb2014923b0575a2339e01c302de5">EQ_INDEX_REPORT_BY_GET_APT_EQ_INDEX</a>,</div><div class="line">} <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga0914fd05c251e27bc1a3cceffbcaf568">T_APT_EQ_DATA_UPDATE_EVENT</a>;</div></div><!-- fragment --><h3>APIs for APT module</h3>
<h4>Initialization</h4>
<p>Volume in/out level is set when system does initialization. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#ga8f704deced6f62b0494721cab9b6399f">app_audio_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga33a94caec07404b761478395c26d966b">audio_passthrough_volume_out_min_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga3cb0e0b5fba15c0ee7aa66bbf02f9efa">audio_passthrough_volume_out_max_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga604f6c253bfe9d022d45540c07162bdf">audio_passthrough_volume_out_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga69302d26b8d6717b6c356741c60380d9">audio_passthrough_volume_in_min_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_in_min);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaa8267aa47e6136a048ad2c2f99e7fb92">audio_passthrough_volume_in_max_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_in_max);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gad07261a69e1d60ff38a5c661b86a53ea">audio_passthrough_volume_in_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_in_default);</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p> The input parameters for the following APIs should be decided accoring to the configuration in DSPConfig Tool(as shown in Figure 3: Normal APT ADC Digital Gain and Figure 4: Normal APT DAC Gain) or level gain tables maitained in app layer. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga3cb0e0b5fba15c0ee7aa66bbf02f9efa">audio_passthrough_volume_out_max_set</a>(uint8_t level);</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga33a94caec07404b761478395c26d966b">audio_passthrough_volume_out_min_set</a>(uint8_t level);</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaa8267aa47e6136a048ad2c2f99e7fb92">audio_passthrough_volume_in_max_set</a>(uint8_t level);</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga69302d26b8d6717b6c356741c60380d9">audio_passthrough_volume_in_min_set</a>(uint8_t level);</div></div><!-- fragment --><h4>APT-related commands handling</h4>
<p>Handle APT-related commands sent from SPP/UART/LE. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gae49c5767f3e7dbf2541f3652bc6982b0">app_apt_cmd_pre_handle</a>(uint16_t apt_cmd, uint8_t *param_ptr, uint16_t param_len, uint8_t path,</div><div class="line">                            uint8_t app_idx, uint8_t *ack_pkt);</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga0c5f26594b079c81c682fc5c2ebe4a75">app_apt_cmd_handle</a>(uint16_t apt_cmd, uint8_t *param_ptr, uint16_t param_len, uint8_t path,</div><div class="line">                        uint8_t app_idx);</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga0bccf79b5c7e2e814bb51ff011b02082">app_apt_report</a>(uint16_t apt_report_event, uint8_t *event_data, uint16_t event_len);</div></div><!-- fragment --><h4>APT checking API</h4>
<p>Check if APT is on or not. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga542f01701b2a2a6972e1460bbf3033f7">app_apt_is_apt_on_state</a>(<a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gaf545c8348aedcb7205b361bf378af341">T_ANC_APT_STATE</a> state)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (state)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341af3526a536e7ef28ee080c288636e4385">ANC_OFF_NORMAL_APT_ON</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341ab3ef8ce58a4d5dba02de4c12a29763d4">ANC_OFF_LLAPT_ON_SCENARIO_1</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341a702b4782a726d190a5067a2688619a8e">ANC_OFF_LLAPT_ON_SCENARIO_2</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341a652e5528b6695d59ea26f91d6cd15519">ANC_OFF_LLAPT_ON_SCENARIO_3</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341a66458aa88d1d1749ff168667237cd908">ANC_OFF_LLAPT_ON_SCENARIO_4</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341af784d76a914278ef30a456bb0fe0bc19">ANC_OFF_LLAPT_ON_SCENARIO_5</a>:</div><div class="line">        {</div><div class="line">            ret = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> ret;</div><div class="line">}</div></div><!-- fragment --><p>Check the event is related to APT or not. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> app_apt_related_event(<a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ga1f67a027bf5550cc90d38c8fd68cab76">T_ANC_APT_EVENT</a> event)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76a2fc288b23739973216d7a0c4cab29dd7">EVENT_NORMAL_APT_ON</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76af14d25cff80b4e9bb427cc05ca942858">EVENT_LLAPT_ON_SCENARIO_1</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76ab89887f54b8741f860c50a0039c09667">EVENT_LLAPT_ON_SCENARIO_2</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76ab107e5d623dd4b0f3e034c9b4cb7f9ca">EVENT_LLAPT_ON_SCENARIO_3</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76a631be364c8726eb54c6984097791702f">EVENT_LLAPT_ON_SCENARIO_4</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76ac530f5ccbd587788d49011418d98f4db">EVENT_LLAPT_ON_SCENARIO_5</a>:</div><div class="line">        {</div><div class="line">            ret = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> ret;</div><div class="line">}</div></div><!-- fragment --><h4>Normal APT checking API</h4>
<p>Check if Normal APT can be on or not. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga7cdbe65c15f41791e8ecca99d4700b9c">app_apt_open_condition_check</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* check SCO condition to open APT */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga96745158f09414cb2e6370759202cb09">normal_apt_support</a>)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if F_APP_SINGLE_MUTLILINK_SCENERIO_1</span></div><div class="line">        <span class="keywordflow">if</span> (app_teams_multilink_get_voice_status() != <a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggaf2f8fc888bbf7f82bcfc5706b8edf1fdac8a8473bf674a3c7b5d5eabaa82ca24b">APP_CALL_IDLE</a>)</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___h_f_p___exported___functions.html#gaef415e5a1bb0cf3dab1a460d3f48cf6b">app_hfp_get_call_status</a>() != <a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ggaf2f8fc888bbf7f82bcfc5706b8edf1fdac8a8473bf674a3c7b5d5eabaa82ca24b">APP_CALL_IDLE</a>)</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___g_s_e_n_s_o_r___p_r_o_c_e_s_s___exported___macros.html#ga667e43446e8246b214bdbe96809e7d62">LIGHT_SENSOR_ENABLED</a> &amp;&amp;</div><div class="line">                 (!<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a5a4f391f4e026ff06fa21d8bf5472dad">listening_mode_does_not_depend_on_in_ear_status</a>))</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a673a27baaad47fd731a4458b2250a6a6">REMOTE_SESSION_ROLE_SINGLE</a>) &amp;&amp;</div><div class="line">                 ((<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_loc != <a class="code" href="group___a_p_p___m_a_i_n___exported___types.html#ga295a9e70616e975f6adeddb49dc23e7bafe90ad8bdfa1798d1bf2b221695c3b95">BUD_LOC_IN_EAR</a>)</div><div class="line">#<span class="keywordflow">if</span> <a class="code" href="group___a_p_p___f_l_a_g_s.html#gaf7dd5ccfb7e3a6df17b70357347b743c">F_APP_AIRPLANE_SUPPORT</a></div><div class="line">                  &amp;&amp; (!app_airplane_mode_get())</div><div class="line">#endif</div><div class="line">                 ) &amp;&amp;</div><div class="line">                 (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.local_loc != <a class="code" href="group___a_p_p___m_a_i_n___exported___types.html#ga295a9e70616e975f6adeddb49dc23e7bafe90ad8bdfa1798d1bf2b221695c3b95">BUD_LOC_IN_EAR</a>)) ||</div><div class="line">                ((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a673a27baaad47fd731a4458b2250a6a6">REMOTE_SESSION_ROLE_SINGLE</a>) &amp;&amp;</div><div class="line">                 (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.local_loc != <a class="code" href="group___a_p_p___m_a_i_n___exported___types.html#ga295a9e70616e975f6adeddb49dc23e7bafe90ad8bdfa1798d1bf2b221695c3b95">BUD_LOC_IN_EAR</a>)))</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"><span class="preprocessor">#if (F_APP_LINEIN_SUPPORT == 1)</span></div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (app_line_in_plug_state_get())</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if (F_APP_SLIDE_SWITCH_LISTENING_MODE == 1)</span></div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (app_slide_switch_anc_apt_state_get() == APP_SLIDE_SWITCH_ANC_ON)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga18f06e9921bfcb48b53dca1fac55756e">llapt_support</a>)</div><div class="line">    {</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="comment">//If don&#39;t support any kinds of APT, return false</span></div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.gaming_mode)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#acf2ce4d924ad90b855b3713705780a23">disallow_listening_mode_on_when_gaming_mode</a>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a5c806bfd1a0b378b6c36e01831f026fb">apt_auto_on_off_while_music_playing</a>)</div><div class="line">        &amp;&amp; (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.avrcp_play_status == <a class="code" href="group___b_t___a_v_r_c_p.html#gga8e2e0b7ab9eac804f17ddf0368abf464a3ca654b9af586dd9bb5e2d4bad635b80">BT_AVRCP_PLAY_STATUS_PLAYING</a>))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --><h4>APT state transition APIs</h4>
<p>Indicate listening mode status start switching to Normal APT on and send command to turn on Normal APT. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga53add1b00676ac4d725acdf50db7145f">app_apt_normal_apt_enable</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (apt_state != <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a87bc367aa88dff7ec2c1907651749837">APT_STARTED</a>)</div><div class="line">    {</div><div class="line">        apt_state = <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48ac3838fb4c676401e3c8a220b569d68a1">APT_STARTING</a>;</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga8cf0dcfab49e7dabe54320a3ac464000">audio_passthrough_enable</a>(<a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga454c7887539be07add7c5f315b3e9072a735d4f710421cff03c0566a414a68e9d">AUDIO_PASSTHROUGH_MODE_NORMAL</a>, 0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div></div><!-- fragment --><p>Check if listening mode status is during switching APT on/off or not. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga8af1f9fc1e22347f982aaaefbf52f886">app_apt_is_busy</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (apt_state == <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a9ec7ffc0e17ba1cb7e5b13b2c68ae03e">APT_STOPPING</a> ||</div><div class="line">        apt_state == <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48ac3838fb4c676401e3c8a220b569d68a1">APT_STARTING</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Indicate listening mode status start switching to APT off and send command to turn off APT. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga39430e309d8a2d5ffe28116931faaa95">app_apt_disable</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (apt_state != <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a8873ca947361f2fc15113e1d8b3bf959">APT_STOPPED</a>)</div><div class="line">    {</div><div class="line">        apt_state = <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gga59e561a05a827670a34230afdc573f48a9ec7ffc0e17ba1cb7e5b13b2c68ae03e">APT_STOPPING</a>;</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaa935b44ebcb63d397522d4be0ae6f75e">audio_passthrough_disable</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div></div><!-- fragment --><h4>APT volume related APIs</h4>
<p>Set APT main volume level. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga2e97fe7a24e52d025299f89d5ca235ea">app_apt_main_volume_set</a>(uint8_t level)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.apt_volume_type == <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gab5c507cf1c9fc2b86ba23d567e9fee07">SUB_TYPE_LEVEL</a>)</div><div class="line">    {</div><div class="line">        uint8_t index;</div><div class="line"></div><div class="line">        <span class="comment">//restore original APT DAC gain table</span></div><div class="line">        <span class="keywordflow">for</span> (index = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min; index &lt;= <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max; index++)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___r_o_u_t_e.html#gae5df043e700edaf5cc41d8ab54e466a5">app_audio_route_dac_gain_set</a>(<a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a5a8bad969b952d8f6e8ac0d2ff22de77">AUDIO_CATEGORY_APT</a>, index,</div><div class="line">                                         app_dsp_cfg_data-&gt;<a class="code" href="structt__app__dsp__cfg__data.html#a5bcc79d0fe129c8e457637c3d79fa088">apt_dac_gain_table</a>[index]);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> = level;</div><div class="line"></div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga604f6c253bfe9d022d45540c07162bdf">audio_passthrough_volume_out_set</a>(level);</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga00d2379f1c5e8634f5d2b5db9775f1d5">app_apt_volume_update_sub_level</a>();</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.apt_volume_type = <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga5c1869d21dc874884e38f46bc313660d">MAIN_TYPE_LEVEL</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group__x3d___t_r_a_c_e.html#ga517945d492f75547264f521def378025">APP_PRINT_TRACE2</a>(<span class="stringliteral">&quot;app_apt_main_volume_set main_level = 0x%x, sub_level = 0x%x&quot;</span>, level,</div><div class="line">                     <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a>);</div><div class="line">}</div></div><!-- fragment --><p>Set APT sub volume level. Setting in sub volume can provide user to control APT volume level in more refined scale. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gafa96d91791c73a5291c0c8d9259f6027">app_apt_sub_volume_set</a>(uint16_t level)</div><div class="line">{</div><div class="line">    uint16_t min_gain;</div><div class="line">    uint16_t max_gain;</div><div class="line"></div><div class="line">    uint16_t mapping_gain;</div><div class="line">    uint8_t  mapping_main_level;</div><div class="line">    <span class="keywordtype">float</span> percentage;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (level == 0)</div><div class="line">    {</div><div class="line">        mapping_main_level = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min;</div><div class="line">        mapping_gain = app_dsp_cfg_data-&gt;<a class="code" href="structt__app__dsp__cfg__data.html#a5bcc79d0fe129c8e457637c3d79fa088">apt_dac_gain_table</a>[<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min];</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        min_gain = app_dsp_cfg_data-&gt;<a class="code" href="structt__app__dsp__cfg__data.html#a5bcc79d0fe129c8e457637c3d79fa088">apt_dac_gain_table</a>[<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min];</div><div class="line">        max_gain = app_dsp_cfg_data-&gt;<a class="code" href="structt__app__dsp__cfg__data.html#a5bcc79d0fe129c8e457637c3d79fa088">apt_dac_gain_table</a>[<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max];</div><div class="line"></div><div class="line">        min_gain = (min_gain &lt;= GAIN_MUTE_LINEAR_VALUE) ?</div><div class="line">                   app_dsp_cfg_data-&gt;<a class="code" href="structt__app__dsp__cfg__data.html#a5bcc79d0fe129c8e457637c3d79fa088">apt_dac_gain_table</a>[<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min + 1] :</div><div class="line">                   min_gain;</div><div class="line">        max_gain = (max_gain == GAIN_0DB_LINEAR_VALUE)  ? 0xFFFF : max_gain;</div><div class="line"></div><div class="line">        percentage = (float)level / (<span class="keywordtype">float</span>)<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga1a34539c3b305f40e17244675ec1d379">APT_SUB_VOLUME_LEVEL_MAX</a>;</div><div class="line"></div><div class="line">        mapping_main_level = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min + (uint8_t)((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max</div><div class="line">                                                                           - <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min) * percentage);</div><div class="line"></div><div class="line">        mapping_gain = min_gain + (uint16_t)((max_gain - min_gain) * percentage);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___r_o_u_t_e.html#gae5df043e700edaf5cc41d8ab54e466a5">app_audio_route_dac_gain_set</a>(<a class="code" href="group___a_u_d_i_o___t_y_p_e.html#gga06d5dddaf1339ff622d21ed1f7185853a5a8bad969b952d8f6e8ac0d2ff22de77">AUDIO_CATEGORY_APT</a>, mapping_main_level,</div><div class="line">                                 mapping_gain);  <span class="comment">//step 1, update table</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga604f6c253bfe9d022d45540c07162bdf">audio_passthrough_volume_out_set</a>(mapping_main_level); <span class="comment">//step 2, set level again</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a> = level;</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> = mapping_main_level;</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.apt_volume_type = <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gab5c507cf1c9fc2b86ba23d567e9fee07">SUB_TYPE_LEVEL</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group__x3d___t_r_a_c_e.html#ga517945d492f75547264f521def378025">APP_PRINT_TRACE2</a>(<span class="stringliteral">&quot;app_apt_sub_volume_set sub_level = 0x%x, main_level = 0x%x&quot;</span>,</div><div class="line">                     <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a>, <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line">}</div></div><!-- fragment --><p>Calculate APT sub volume level based on APT main volume level. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga00d2379f1c5e8634f5d2b5db9775f1d5">app_apt_volume_update_sub_level</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint16_t mapping_sub_level;</div><div class="line">    <span class="keywordtype">float</span> percentage;</div><div class="line"></div><div class="line">    percentage = (float)<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> / (<span class="keywordtype">float</span>)(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max -</div><div class="line">                                                                  <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min);</div><div class="line"></div><div class="line">    mapping_sub_level = <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga92d9cd689b1db417ad577da329d63c3a">APT_SUB_VOLUME_LEVEL_MIN</a> + (uint16_t)((<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga1a34539c3b305f40e17244675ec1d379">APT_SUB_VOLUME_LEVEL_MAX</a> -</div><div class="line">                                                               <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga92d9cd689b1db417ad577da329d63c3a">APT_SUB_VOLUME_LEVEL_MIN</a>) * percentage);</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a> = mapping_sub_level;</div><div class="line">}</div></div><!-- fragment --><p>Store remote bud's APT volume level in local bud. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga6d3e11479e4038b78a5381b192811e9f">app_apt_volume_set_remote_level</a>(uint8_t main_level, uint16_t sub_level)</div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_apt_volume_out_level = main_level;</div><div class="line">    <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_apt_sub_volume_out_level = sub_level;</div><div class="line">}</div></div><!-- fragment --><p>Relay APT volume level info to peer bud. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga1f1166f5a93026bf5bf5c1e43c21c0a0">app_apt_volume_relay</a>(<span class="keywordtype">bool</span> first_time_sync, <span class="keywordtype">bool</span> primary_report_phone)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_session_state != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9afbcee5b9edd81f34b499c2d811a8c2f3">REMOTE_SESSION_STATE_CONNECTED</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="structt__apt__volume__relay__msg.html">T_APT_VOLUME_RELAY_MSG</a> send_msg;</div><div class="line"></div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#a98c3f2550491a7c80926d9ab0ad41d1d">report_phone</a> = primary_report_phone;</div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#a92e1aedefc039f2c458f3cf646357f3c">first_sync</a> = first_time_sync;</div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#a8b5722131b01b44af8510a5c8ea2b0df">volume_type</a> = <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.apt_volume_type;</div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#ae7a5a2828b146d446b945dacf586cbbf">main_volume_level</a> = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>;</div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#af720d5506956e2c9521e45d8a32b0c15">sub_volume_level</a> = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a>;</div><div class="line"><span class="preprocessor">#if F_APP_SEPARATE_ADJUST_APT_VOLUME_SUPPORT</span></div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a> = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">    send_msg.<a class="code" href="structt__apt__volume__relay__msg.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a> = 0;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group___a_p_p___r_e_l_a_y.html#ga6413b2e9fd31055e1305419884f36042">app_relay_async_single_with_raw_msg</a>(<a class="code" href="group___a_p_p___r_e_l_a_y.html#gga8fe3ea47e0bf7256d6bca08cb28eeedea538082a98d248ec6dd7d7c857facf47c">APP_MODULE_TYPE_APT</a>, <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ggafaa81adbfd941fa0a49ef7b14663f9c7a37577cda59031d58941aa62687a9079a">APP_REMOTE_MSG_APT_VOLUME_SYNC</a>,</div><div class="line">                                               (uint8_t *)&amp;send_msg, <span class="keyword">sizeof</span>(<a class="code" href="structt__apt__volume__relay__msg.html">T_APT_VOLUME_RELAY_MSG</a>));</div><div class="line">}</div></div><!-- fragment --><p>Secondary bud applies APT volume level after it receives from primary bud. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gac80e43321eeb0426c3f7855f88b3bfe5">app_apt_volume_sync_handle</a>(<a class="code" href="structt__apt__volume__relay__msg.html">T_APT_VOLUME_RELAY_MSG</a> *rev_msg)</div><div class="line">{</div><div class="line">    <a class="code" href="group__x3d___t_r_a_c_e.html#ga56829314bea353851fa9e5bbaf8d3fa7">APP_PRINT_TRACE4</a>(<span class="stringliteral">&quot;app_apt_volume_sync_handle first_sync = %x, remote_main = %x, remote_sub = %x, disallow_sync = %x&quot;</span>,</div><div class="line">                     rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#a92e1aedefc039f2c458f3cf646357f3c">first_sync</a>, rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ae7a5a2828b146d446b945dacf586cbbf">main_volume_level</a>, rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#af720d5506956e2c9521e45d8a32b0c15">sub_volume_level</a>,</div><div class="line">                     rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>);</div><div class="line"></div><div class="line">    <span class="comment">//first time sync, volume of primary is applied to secondary</span></div><div class="line">    <span class="keywordflow">if</span> (rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#a92e1aedefc039f2c458f3cf646357f3c">first_sync</a>)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if F_APP_SEPARATE_ADJUST_APT_VOLUME_SUPPORT</span></div><div class="line">        <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a> = rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        {</div><div class="line"><span class="preprocessor">#if APT_SUB_VOLUME_LEVEL_SUPPORT</span></div><div class="line">            <span class="keywordflow">if</span> (rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#a8b5722131b01b44af8510a5c8ea2b0df">volume_type</a> == <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga5c1869d21dc874884e38f46bc313660d">MAIN_TYPE_LEVEL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga2e97fe7a24e52d025299f89d5ca235ea">app_apt_main_volume_set</a>(rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ae7a5a2828b146d446b945dacf586cbbf">main_volume_level</a>);</div><div class="line">                <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a> = rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#af720d5506956e2c9521e45d8a32b0c15">sub_volume_level</a>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="comment">// SUB_TYPE_LEVEL</span></div><div class="line">            {</div><div class="line">                <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gafa96d91791c73a5291c0c8d9259f6027">app_apt_sub_volume_set</a>(rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#af720d5506956e2c9521e45d8a32b0c15">sub_volume_level</a>);</div><div class="line">                <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> = rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ae7a5a2828b146d446b945dacf586cbbf">main_volume_level</a>;</div><div class="line">            }</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">            <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> = rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ae7a5a2828b146d446b945dacf586cbbf">main_volume_level</a>;</div><div class="line">            <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga604f6c253bfe9d022d45540c07162bdf">audio_passthrough_volume_out_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga6d3e11479e4038b78a5381b192811e9f">app_apt_volume_set_remote_level</a>(rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#ae7a5a2828b146d446b945dacf586cbbf">main_volume_level</a>, rev_msg-&gt;<a class="code" href="structt__apt__volume__relay__msg.html#af720d5506956e2c9521e45d8a32b0c15">sub_volume_level</a>);</div><div class="line">}</div></div><!-- fragment --><p>Report APT volume level info to phone. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaae524a55303a3a1a48f4fee8e35b0674">app_apt_volume_relay_report_handle</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a> &amp;&amp;</div><div class="line">        <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_session_state == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9afbcee5b9edd81f34b499c2d811a8c2f3">REMOTE_SESSION_STATE_CONNECTED</a>)</div><div class="line">    {</div><div class="line">        <span class="comment">//this mechanism is going to avoid report phone twice</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>)</div><div class="line">        {</div><div class="line">            <span class="comment">//secondary do nothing, waiting for primary sync data</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga1f1166f5a93026bf5bf5c1e43c21c0a0">app_apt_volume_relay</a>(<span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga6d3e11479e4038b78a5381b192811e9f">app_apt_volume_set_remote_level</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>,</div><div class="line">                                            <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af54160eaeec3862b12b30531b991d447">apt_sub_volume_out_level</a>);</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga0bccf79b5c7e2e814bb51ff011b02082">app_apt_report</a>(<a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gga7726a52eb69945b78d3a5a1463a839c7aafd0d5e1f1b3ac664c06f17bb9d3ec37">EVENT_APT_VOLUME_STATUS</a>, <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga1f1166f5a93026bf5bf5c1e43c21c0a0">app_apt_volume_relay</a>(<span class="keyword">false</span>, <span class="keyword">true</span>) == <span class="keyword">false</span>)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga0bccf79b5c7e2e814bb51ff011b02082">app_apt_report</a>(<a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gga7726a52eb69945b78d3a5a1463a839c7aafd0d5e1f1b3ac664c06f17bb9d3ec37">EVENT_APT_VOLUME_STATUS</a>, <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Play APT volume level tone. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga88902fe9844b4dba6c437ade64220fd9">app_apt_play_apt_volume_tone</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#ga2ef56a924a54e335197b7d83d6a29403">T_APP_AUDIO_TONE_TYPE</a> apt_vol_tone = TONE_TYPE_INVALID;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> &lt; 3)</div><div class="line">    {</div><div class="line">        apt_vol_tone = (<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#ga2ef56a924a54e335197b7d83d6a29403">T_APP_AUDIO_TONE_TYPE</a>)((<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403a023f8e2173052281f5f1832ab62589a5">TONE_APT_VOL_0</a>) + (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>));</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> &gt;= 3) &amp;&amp; (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> &lt; 10))</div><div class="line">    {</div><div class="line">        apt_vol_tone = (<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#ga2ef56a924a54e335197b7d83d6a29403">T_APP_AUDIO_TONE_TYPE</a>)((<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403ad1e52361b43a84886b2086785313cd33">TONE_APT_VOL_3</a>) + (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> - 3));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (apt_vol_tone != TONE_TYPE_INVALID)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if F_APP_SEPARATE_ADJUST_APT_VOLUME_SUPPORT</span></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(apt_vol_tone, <span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        {</div><div class="line">            <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(apt_vol_tone, <span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h4>APT Enable/Disable Event CallBack</h4>
<p>Framework will send event to APP after APT successfully enabled or disabled. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_apt_audio_cback(<a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ga5aac7f389fef58a6669380c38cf7f6e4">T_AUDIO_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ggacb643b6c4a4b0a6bf5fef74c489d5465a189f845fbe9b3110648e173c2e0b0ad8">AUDIO_EVENT_PASSTHROUGH_ENABLED</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ggacb643b6c4a4b0a6bf5fef74c489d5465ac75d1ac9e1f2f42196ea6330411eddd0">AUDIO_EVENT_PASSTHROUGH_DISABLED</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div></div><!-- fragment --><h4>Power On Status</h4>
<p>The APP will auto open APT or follow last APT status after power on. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_listening_apply_when_power_on(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a4f541d141e25629885ec529cc58144b6">listening_mode_power_on_status</a>)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaa3964f2bf1d8dae8e2760ed87adb1142a0607916d135cfbe18ea89461453bce45">POWER_ON_LISTENING_MODE_FOLLOW_LAST</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaa3964f2bf1d8dae8e2760ed87adb1142ad6cdc2529f2bd39490b3b6437b17155a">POWER_ON_LISTENING_MODE_APT_ON</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        {</div><div class="line">            power_on_init_state = <a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#ggaf545c8348aedcb7205b361bf378af341a268d213a73b337e5ad084bfcc337b10a">ANC_OFF_APT_OFF</a>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h4>APT ON/OFF Control MMI</h4>
<p>Handle APT ON/OFF action here. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(uint8_t action)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (action)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba93611f9a39338c7f5ea560f4ececfd53">MMI_AUDIO_APT</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga542f01701b2a2a6972e1460bbf3033f7">app_apt_is_apt_on_state</a>((<a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gaf545c8348aedcb7205b361bf378af341">T_ANC_APT_STATE</a>)judge_state))</div><div class="line">            {</div><div class="line">                app_listening_state_machine(<a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76afd179e7154f368738a3f7e5a939a0e18">EVENT_APT_OFF</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga7cdbe65c15f41791e8ecca99d4700b9c">app_apt_open_condition_check</a>())</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga96745158f09414cb2e6370759202cb09">normal_apt_support</a>)</div><div class="line">                    {</div><div class="line">                        app_listening_state_machine(EVENT_APT_ON, <span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga18f06e9921bfcb48b53dca1fac55756e">llapt_support</a>)</div><div class="line">                    {</div><div class="line">                        app_listening_state_machine(<a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gga1f67a027bf5550cc90d38c8fd68cab76af14d25cff80b4e9bb427cc05ca942858">EVENT_LLAPT_ON_SCENARIO_1</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h4>APT Volume Control MMI</h4>
<p>Handle APT volume up action here. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(uint8_t action)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (action)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9b5e06343898543625fcf70fb277f1af">MMI_AUDIO_APT_VOL_UP</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga542f01701b2a2a6972e1460bbf3033f7">app_apt_is_apt_on_state</a>(<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.current_listening_state))</div><div class="line">            {</div><div class="line">                <span class="keywordtype">bool</span> is_need_tone_relay = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_SEPARATE_ADJUST_APT_VOLUME_SUPPORT</span></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">                {</div><div class="line">                    is_need_tone_relay = <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> == <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___l_e_d___exported___functions.html#ga9fa33a843fc0cba5e8ccdd25919c5901">app_led_change_mode</a>(<a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aafa3a1badb7488a9ea239e1a603ab2e9a">LED_MODE_VOL_MAX_MIN</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___l_e_d___exported___functions.html#ga9fa33a843fc0cba5e8ccdd25919c5901">app_led_change_mode</a>(<a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa8c227b9beeb4ea509efae4ec2dfc704c">LED_MODE_VOL_ADJUST</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a1373b6ba3dc4540135da8da404332ba1">enable_apt_circular_vol_up</a>)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> = (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> &lt;</div><div class="line">                                                       <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max) ? (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> + 1) : 0;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> &lt; <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>++;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a52f9edca7136cdeaabe8942e059fa05e">REMOTE_SESSION_ROLE_PRIMARY</a> ||</div><div class="line">                            <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_session_state == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9a0d477163c2943e4e2aa3059ac6f26db4">REMOTE_SESSION_STATE_DISCONNECTED</a> ||</div><div class="line">                            <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">                        {</div><div class="line">                            <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403a371f35ed5f0257884e8a2392bf28ad64">TONE_APT_VOL_MAX</a>, <span class="keyword">false</span>, is_need_tone_relay);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line"><span class="preprocessor">#if APT_SUB_VOLUME_LEVEL_SUPPORT</span></div><div class="line">                <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga2e97fe7a24e52d025299f89d5ca235ea">app_apt_main_volume_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">                <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga604f6c253bfe9d022d45540c07162bdf">audio_passthrough_volume_out_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">                <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaae524a55303a3a1a48f4fee8e35b0674">app_apt_volume_relay_report_handle</a>();</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a52f9edca7136cdeaabe8942e059fa05e">REMOTE_SESSION_ROLE_PRIMARY</a> ||</div><div class="line">                    <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_session_state == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9a0d477163c2943e4e2aa3059ac6f26db4">REMOTE_SESSION_STATE_DISCONNECTED</a> ||</div><div class="line">                    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a1373b6ba3dc4540135da8da404332ba1">enable_apt_circular_vol_up</a>) &amp;&amp;</div><div class="line">                        (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> == <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_max))</div><div class="line">                    {</div><div class="line">                        <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403a371f35ed5f0257884e8a2392bf28ad64">TONE_APT_VOL_MAX</a>, <span class="keyword">false</span>, is_need_tone_relay);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403a0c17d7906dadd47d82be3bb17f5ae9b4">TONE_APT_VOLUME_UP</a>, <span class="keyword">false</span>, is_need_tone_relay);</div><div class="line">                    }</div><div class="line">                    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga88902fe9844b4dba6c437ade64220fd9">app_apt_play_apt_volume_tone</a>();</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>Handle APT volume down action here. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(uint8_t action)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (action)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae7bc2856df2b36d2995373c240d9407e">MMI_AUDIO_APT_VOL_DOWN</a>:</div><div class="line">       {</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a1373b6ba3dc4540135da8da404332ba1">enable_apt_circular_vol_up</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga542f01701b2a2a6972e1460bbf3033f7">app_apt_is_apt_on_state</a>(<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.current_listening_state))</div><div class="line">            {</div><div class="line">                <span class="keywordtype">bool</span> is_need_tone_relay = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_SEPARATE_ADJUST_APT_VOLUME_SUPPORT</span></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">                {</div><div class="line">                    is_need_tone_relay = <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> == <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___l_e_d___exported___functions.html#ga9fa33a843fc0cba5e8ccdd25919c5901">app_led_change_mode</a>(<a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aafa3a1badb7488a9ea239e1a603ab2e9a">LED_MODE_VOL_MAX_MIN</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___l_e_d___exported___functions.html#ga9fa33a843fc0cba5e8ccdd25919c5901">app_led_change_mode</a>(<a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa8c227b9beeb4ea509efae4ec2dfc704c">LED_MODE_VOL_ADJUST</a>, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a> &gt; <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.apt_volume_out_min)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>--;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a52f9edca7136cdeaabe8942e059fa05e">REMOTE_SESSION_ROLE_PRIMARY</a> ||</div><div class="line">                        <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_session_state == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9a0d477163c2943e4e2aa3059ac6f26db4">REMOTE_SESSION_STATE_DISCONNECTED</a> ||</div><div class="line">                        <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">                    {</div><div class="line">                        <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403a2acbc8e1d4fa45b8a7bc1e6b8d15da02">TONE_APT_VOL_MIN</a>, <span class="keyword">false</span>, is_need_tone_relay);</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line"><span class="preprocessor">#if APT_SUB_VOLUME_LEVEL_SUPPORT</span></div><div class="line">                <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga2e97fe7a24e52d025299f89d5ca235ea">app_apt_main_volume_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">                <a class="code" href="group___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga604f6c253bfe9d022d45540c07162bdf">audio_passthrough_volume_out_set</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#af03e6b55779a335d2bf59457c06cdbbd">apt_volume_out_level</a>);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">                <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#gaae524a55303a3a1a48f4fee8e35b0674">app_apt_volume_relay_report_handle</a>();</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a52f9edca7136cdeaabe8942e059fa05e">REMOTE_SESSION_ROLE_PRIMARY</a> ||</div><div class="line">                    <a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.remote_session_state == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gga3fafc6057a393641404e5040d6f0aca9a0d477163c2943e4e2aa3059ac6f26db4">REMOTE_SESSION_STATE_DISCONNECTED</a> ||</div><div class="line">                    <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac931a992e28f931b1b893b43679e4d71">rws_disallow_sync_apt_volume</a>)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gafa3455d6700ac763d5d91284cee2907c">app_audio_tone_type_play</a>(<a class="code" href="group___a_p_p___a_u_d_i_o___exported___functions.html#gga2ef56a924a54e335197b7d83d6a29403a57071b6e6bcf5403db96af65f0eac8a5">TONE_APT_VOLUME_DOWN</a>, <span class="keyword">false</span>, is_need_tone_relay);</div><div class="line">                    <a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga88902fe9844b4dba6c437ade64220fd9">app_apt_play_apt_volume_tone</a>();</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h4>APT EQ Switch MMI</h4>
<p>Handle APT effect switch action here. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___m_m_i.html#ga052f779c9e19fc32946d63b132fcae09">app_mmi_handle_action</a>(uint8_t action)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">switch</span> (action)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baaabaf7d4b1617f52e1d53a70bc48d908">MMI_AUDIO_APT_EQ_SWITCH</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___a_u_d_i_o___p_a_s_s_t_h_r_o_u_g_h.html#ga542f01701b2a2a6972e1460bbf3033f7">app_apt_is_apt_on_state</a>((<a class="code" href="group___a_p_p___l_i_s_t_e_n_i_n_g___m_o_d_e.html#gaf545c8348aedcb7205b361bf378af341">T_ANC_APT_STATE</a>)<a class="code" href="group___a_p_p___b_t___p_a_n___d_e_m_o___l_i_n_k.html#gac563cf0f8ddf7768f3da4ab95cdd884e">app_db</a>.current_listening_state))</div><div class="line">            {</div><div class="line">                ...</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
