<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="BLEExtAdvertisingManager_Page"></a>
BLE Extended Advertising Manager User Manual    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/07/21</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="BLE_EXT_ADV_REV"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/05/30  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/07/21  </td><td class="markdownTableBodyCenter">Modify Structure   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLE_EXT_ADV_REV">Revision History</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLE_EXT_ADV_Table_List">Table List</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLE_EXT_ADV_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLE_EXT_ADV_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLEExtAdvertisingManager_Intro">1 Introduction</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLEExtAdvertisingManager_Manager">2 BLE Extended Advertising Manager</a><ul>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_MODULE_INIT">2.1 Extend Adv Manage Module Init</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_Advertising_parameter_initialize">2.2 Adv Parameter Init</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_ENABLE_DISABLE_ADV">2.3 Enable or Disable Advertising by Adv Handle</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_ADV_CB">2.4 Handle Callbacks of Advertising</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_UPDATE_ADV_PARAM_AFTER_STACK_READY">2.5 Adv Parameter Update</a></li>
</ul>
</li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLEExtAdvertisingManager_DataManager">3 BLE Extended Advertising Data Manager</a><ul>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_INIT_ADV_DATA_MODULE">3.1 Init BLE Advertising Data Module</a></li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_ENABLE_DISABLE_ADV_DATA">3.2 Enable/Disable Adv Data in BLE Advertising Data Module</a></li>
</ul>
</li>
<li><a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLEExtAdvertisingManager_Dump">4 BLE Extended Advertising Information Dump</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BLE_EXT_ADV_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BLE_EXT_ADV_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 BLE Adv Module</a></li>
<li><a href="#figure_3_1">Figure 3-1 BLE Adv Data Module Framework</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BLE_EXT_ADV_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Adv  </td><td class="markdownTableBodyCenter">Advertising   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">init  </td><td class="markdownTableBodyCenter">Initialize   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">param  </td><td class="markdownTableBodyCenter">Parameter   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BLEExtAdvertisingManager_Intro"></a>
1 Introduction</h2>
<p>This user manual describes the <b>BLE Extended Advertising Manager Module</b> which is a new feature introduced in BT Core spec 5.0. The constants and functions prototype are defined in <a class="el" href="ble__ext__adv_8h_source.html">ble_ext_adv.h</a>. This module is designed to make it easy for applications to manage the operation of multiple advertisements. This module is encapsulated on the basis of <a class="el" href="gap__adv_8h_source.html">gap_adv.h</a> and gap_extended_adv.h. When using this module, in order to prevent some unnecessary conflicts, it is recommended that applications <b>do not</b> directly call the interface in gap_extended_adv.h and <a class="el" href="gap__adv_8h_source.html">gap_adv.h</a>.</p>
<p>BLE Extended Advertising Manager Module will be introduced according to the following several parts:<br />
</p><ol type="1">
<li>BLE Extended Advertising Manager will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLEExtAdvertisingManager_Manager">2 BLE Extended Advertising Manager</a>.<br />
</li>
<li>BLE Extended Advertising Data Manager will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#BLEExtAdvertisingManager_DataManager">3 BLE Extended Advertising Data Manager</a>.<br />
</li>
</ol>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BLEExtAdvertisingManager_Manager"></a>
2 BLE Extended Advertising Manager</h2>
<p>This chapter will be introduced according to the following several parts:<br />
</p><ol type="1">
<li>Extend adv manage module init will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_MODULE_INIT">2.1 Extend Adv Manage Module Init</a>.<br />
</li>
<li>Adv parameter init will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_Advertising_parameter_initialize">2.2 Adv Parameter Init</a>.<br />
</li>
<li>Enable or Disable advertising by adv handle will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_ENABLE_DISABLE_ADV">2.3 Enable or Disable Advertising by Adv Handle</a>.<br />
</li>
<li>Handle Callbacks of advertising will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_ADV_CB">2.4 Handle Callbacks of Advertising</a>.<br />
</li>
<li>adv parameter update after stack ready will be introduced in chapter <a class="el" href="_u_m020__b_l_e__e_x_t_e_n_d_e_d__a_d_v_e_r_t_i_s_i_n_g__m_a_n_a_g_e_r.html#UM024_UPDATE_ADV_PARAM_AFTER_STACK_READY">2.5 Adv Parameter Update</a>.<br />
</li>
</ol>
<div class="image">
<img src="ble_adv_module_framework.png" alt="ble_adv_module_framework.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 BLE Adv Module</b></div></center><p> The dotted box in figure 2-1 is implemented by BLE mgr lib, the APP may not care about it. <br />
 Each advertisement has its own adv handle and is assigned a separate advertising set to manage its own broadcast related parameters:</p><ul>
<li>First call ble_mgr_init() to allocate storage for different broadcasts.</li>
<li>Then create advertising handle and set advertising parameters advertising data for your broadcast.</li>
<li>Then you can enable or disable your broadcast.</li>
</ul>
<h3><a class="anchor" id="UM024_MODULE_INIT"></a>
2.1 Extend Adv Manage Module Init</h3>
<p>This module shall be initialized before it can be used. The initialization steps are as follows: <br />
</p>
<p><b>app_ble_gap_ble_mgr_init</b> <br />
</p>
<p>please call app_ble_gap_ble_mgr_init to initialize ble advertising manager module.<br />
</p>
<p>for example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_ble_gap_ble_mgr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html">BLE_MGR_PARAMS</a> param = {0};</div><div class="line"></div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bd7683baadc3ca1ca7ae8c1b895611a">ble_ext_adv</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bd7683baadc3ca1ca7ae8c1b895611a">ble_ext_adv</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a719280eb2fedb81d95d276e2addd979a">adv_num</a> = app_ble_gap_get_ext_adv_num();</div><div class="line"></div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bf99cce3fab31103463a96bd3f2d034">ble_conn</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">    uint8_t supported_max_le_link_num = <a class="code" href="group___g_a_p___l_e___c_o_m_m_o_n___exported___functions.html#ga13f6449e757dab08b87c3f08a855d1a5">le_get_max_link_num</a>();</div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bf99cce3fab31103463a96bd3f2d034">ble_conn</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ae45d5bbf79348f323a96f15e6a7c26f4">link_num</a> = ((<a class="code" href="group___a_p_p___l_i_n_k.html#ga9875ca18a9c76318637e0df3774093ed">MAX_BLE_LINK_NUM</a> &lt;= supported_max_le_link_num) ? <a class="code" href="group___a_p_p___l_i_n_k.html#ga9875ca18a9c76318637e0df3774093ed">MAX_BLE_LINK_NUM</a> :</div><div class="line">                               supported_max_le_link_num);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#ae13eaf15d63f91b6a3f7eaaa54c05ce6">ama_support</a> || <a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a7997528396bc811509ec031629c310b0">xiaowei_support</a> ||</div><div class="line">        <a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a149d732d348fe9a626ef5cdac754aaa8">bisto_support</a> || <a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a46117c521390d0cab29f57edcc6eb706">xiaoai_support</a>)</div><div class="line">    {</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a89e7053f40bb46ab81fcb5eaed345fac">update_scan_data</a> = <span class="keyword">true</span>;</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a001f6f3457ad4e7d39cea0304ca7e526">adv_interval</a> = (<a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a861c22f939171fc139300ae98e7eaab9">multi_adv_interval</a> * 8) / 5;</div><div class="line">        <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga22fc5e8ca6953eb544ecedd25a90bca8">app_ble_gap_gen_scan_rsp_data</a>(&amp;<a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>, <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>);</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ae87719bc22acb973ba7f6a8e8fddf656">scan_rsp_len</a> = <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>;</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a814cd509f9ce643e8b3e828227f62ea8">scan_rsp_data</a> = <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a50e84e72fc87e7f0652f7519248d96ab">ble_scan</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    ble_mgr_init(&amp;param);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga5e597c87be17364dd4b7225dfa597861">app_ble_gap_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    app_ble_gap_ble_mgr_init();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga5e597c87be17364dd4b7225dfa597861">app_ble_gap_init</a>();</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><ol type="1">
<li><b>'param.ble_ext_adv.enable = true;'</b> <br />
 means enable ble_ext_adv</li>
<li><b>"param.ble_ext_adv.adv_num = app_ble_gap_get_ext_adv_num();"</b> <br />
 means get advertising handle number</li>
<li><b> Note</b> <br />
 if you want to add a new advertising, adv_handle_number in app_ble_gap_get_ext_adv_num() shall be +1.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">static</span> uint32_t app_ble_gap_get_ext_adv_num(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint8_t adv_handle_number = 0;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a56449f18c41b2001b38d61ad5ae7d681">swift_pair_support</a>)</div><div class="line">    {</div><div class="line">        adv_handle_number++;<span class="comment">//for swift pair adv</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a3a435c9f3adb75b4362a3122066505d7">rtk_app_adv_support</a>)</div><div class="line">    {</div><div class="line">        adv_handle_number++;<span class="comment">//for common adv</span></div><div class="line">    }</div><div class="line">    ......</div><div class="line"><span class="preprocessor">#if F_APP_TMAP_BMR_SUPPORT</span></div><div class="line">    adv_handle_number++;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="comment">// if you want to add a new advertising, adv_handle_number in app_ble_gap_get_ext_adv_num shall be +1.</span></div><div class="line">    <span class="keywordflow">return</span> adv_handle_number;</div><div class="line">}</div></div><!-- fragment --><p><b>ble_mgr_handle_gap_cb</b> <br />
 please call ble_mgr_handle_gap_cb() to handle gap callback massage. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group___g_a_p___common___exported___types.html#ga90b0c39404615bbdf0fc222483ed3fb9">T_APP_RESULT</a> app_ble_gap_cb(uint8_t cb_type, <span class="keywordtype">void</span> *p_cb_data)</div><div class="line">{</div><div class="line">    <a class="code" href="group___g_a_p___common___exported___types.html#ga90b0c39404615bbdf0fc222483ed3fb9">T_APP_RESULT</a> result = <a class="code" href="group___g_a_p___common___exported___types.html#gga90b0c39404615bbdf0fc222483ed3fb9a909f010ff315d17ec44d25243492a366">APP_RESULT_SUCCESS</a>;</div><div class="line">    <a class="code" href="union_t___l_e___c_b___d_a_t_a.html">T_LE_CB_DATA</a> cb_data;</div><div class="line"></div><div class="line">    memcpy(&amp;cb_data, p_cb_data, <span class="keyword">sizeof</span>(<a class="code" href="union_t___l_e___c_b___d_a_t_a.html">T_LE_CB_DATA</a>));</div><div class="line">    ......</div><div class="line">    ble_mgr_handle_gap_cb(cb_type, p_cb_data);</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><p><b>ble_mgr_handle_gap_msg</b> <br />
 please call ble_mgr_handle_gap_msg() to handle gap callback massage. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga74db254007c7fbbe873ed69ab0fdd61b">app_ble_gap_handle_gap_msg</a>(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> *p_io_msg)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_t___l_e___g_a_p___m_s_g.html">T_LE_GAP_MSG</a> stack_msg;</div><div class="line">    memcpy(&amp;stack_msg, &amp;p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a>, <span class="keyword">sizeof</span>(p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a>));</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#gadbd6667019aa1db0ec6456ec90268f4f">APP_PRINT_TRACE1</a>(<span class="stringliteral">&quot;app_ble_gap_handle_gap_msg: subtype %d&quot;</span>, p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a>);</div><div class="line">    ......</div><div class="line">    ble_mgr_handle_gap_msg(p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a>, &amp;stack_msg);</div><div class="line">    ......</div></div><!-- fragment --><h3><a class="anchor" id="UM024_Advertising_parameter_initialize"></a>
2.2 Adv Parameter Init</h3>
<p>APP can use API <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga7b8bcbea5cf112ca7c19ce757a89eeb0">ble_ext_adv_mgr_init_adv_params()</a> to initialize advertising parameters. This API is used to create adv handle and initialize adv param, adv data, scan response data and random address before gap stack ready. so this API shall be called before BLE protocol stack initialize is ready.<br />
 for example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga9cc1b5f72081250b45c8fe4d675334f3">app_ble_common_adv_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___g_a_p___l_e___e_x_t_e_n_d_e_d___a_d_v___exported___types.html#gaac37315eefb7c0b74fb9daad93b5fd2b">T_LE_EXT_ADV_LEGACY_ADV_PROPERTY</a> adv_event_prop = <a class="code" href="group___g_a_p___l_e___e_x_t_e_n_d_e_d___a_d_v___exported___types.html#ggaac37315eefb7c0b74fb9daad93b5fd2ba221e1dd75ec84b8536143e2e2b9245ac">LE_EXT_ADV_LEGACY_ADV_CONN_SCAN_UNDIRECTED</a>;</div><div class="line">    uint16_t adv_interval_min = 0xA0;</div><div class="line">    uint16_t adv_interval_max = 0xB0;</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#ga6a4a22188186cb0102eafa5628d4cb98">T_GAP_LOCAL_ADDR_TYPE</a> own_address_type = <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gga6a4a22188186cb0102eafa5628d4cb98ab751d2722a1890be60daf72ca879555a">GAP_LOCAL_ADDR_LE_RANDOM</a>;</div><div class="line">    <span class="keywordflow">if</span> (le_common_adv.use_static_addr_type)</div><div class="line">    {</div><div class="line">        own_address_type = <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gga6a4a22188186cb0102eafa5628d4cb98ab751d2722a1890be60daf72ca879555a">GAP_LOCAL_ADDR_LE_RANDOM</a>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        own_address_type = <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gga6a4a22188186cb0102eafa5628d4cb98a16656bc5ea16dce38877bf13f2d49a79">GAP_LOCAL_ADDR_LE_PUBLIC</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___common___exported___types.html#ga41dd9d848e985c7c492f8f43e1da9249">T_GAP_REMOTE_ADDR_TYPE</a> peer_address_type = <a class="code" href="group___g_a_p___common___exported___types.html#gga41dd9d848e985c7c492f8f43e1da9249a0f8c733d0498ba8895498a882385afb1">GAP_REMOTE_ADDR_LE_PUBLIC</a>;</div><div class="line">    uint8_t  peer_address[6] = {0, 0, 0, 0, 0, 0};</div><div class="line">    <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gac0433c68ddb7484621ec659b7f8edd76">T_GAP_ADV_FILTER_POLICY</a> filter_policy = <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#ggac0433c68ddb7484621ec659b7f8edd76a610241ea5e48e993bbf893c19e1b2794">GAP_ADV_FILTER_ANY</a>;</div><div class="line"></div><div class="line">    uint8_t data_len = <span class="keyword">sizeof</span>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga17b6d1eb8e8d2202a76a297c94b338ff">bud_local_addr</a>) + <span class="keyword">sizeof</span>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga9ab366b1e959fedb95907ecbf3daa8bb">company_id</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga22fc5e8ca6953eb544ecedd25a90bca8">app_ble_gap_gen_scan_rsp_data</a>(&amp;<a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>, <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>);</div><div class="line"></div><div class="line">    uint8_t le_random_addr[6] = {0};</div><div class="line">    app_ble_rand_addr_get(le_random_addr);</div><div class="line"></div><div class="line">    <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga7b8bcbea5cf112ca7c19ce757a89eeb0">ble_ext_adv_mgr_init_adv_params</a>(&amp;le_common_adv.adv_handle, adv_event_prop, adv_interval_min,</div><div class="line">                                    adv_interval_max, own_address_type, peer_address_type, peer_address,</div><div class="line">                                    filter_policy, 23 + data_len, app_ble_common_adv_data,</div><div class="line">                                    <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>, <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>, le_random_addr);</div><div class="line"></div><div class="line">    <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga21de10157b31a9041d2e7e7dc862e912">ble_ext_adv_mgr_register_callback</a>(app_ble_common_adv_callback, le_common_adv.adv_handle);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_ble_gap_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a9320e2b7e774c93377720bf3327f7b5e">BT_EVENT_READY</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a3a435c9f3adb75b4362a3122066505d7">rtk_app_adv_support</a> || <a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a7c9456a3acae54ac7fd4fc3c43c8ec76">tts_support</a>)</div><div class="line">            {</div><div class="line">                <span class="comment">/* init here to avoid app_cfg_nv.bud_local_addr no mac info (due to factory reset) */</span></div><div class="line">                <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga9cc1b5f72081250b45c8fe4d675334f3">app_ble_common_adv_init</a>();</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>1.<b>"T_LE_EXT_ADV_LEGACY_ADV_PROPERTY adv_event_prop = LE_EXT_ADV_LEGACY_ADV_CONN_SCAN_UNDIRECTED;"</b> <br />
 set adv_event_prop <a class="el" href="group___g_a_p___l_e___e_x_t_e_n_d_e_d___a_d_v___exported___types.html#gaac37315eefb7c0b74fb9daad93b5fd2b">T_LE_EXT_ADV_LEGACY_ADV_PROPERTY</a></p>
<p>2.<b>"uint16_t adv_interval_min = 0xA0; uint16_t adv_interval_max = 0xB0;"</b> <br />
 set advertising interval: <br />
 adv_interval_min: Minimum advertising interval for undirected and low duty directed advertising.In units of 0.625ms, range: 0x000020 to 0xFFFFFF. <br />
 adv_interval_max: Maximum advertising interval for undirected and low duty directed advertising.In units of 0.625ms, range: 0x000020 to 0xFFFFFF. <br />
</p>
<p>3.<b>"T_GAP_LOCAL_ADDR_TYPE own_address_type = GAP_LOCAL_ADDR_LE_RANDOM;"</b> <br />
 set own_address_type <a class="el" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#ga6a4a22188186cb0102eafa5628d4cb98">T_GAP_LOCAL_ADDR_TYPE</a></p>
<p>4.<b>" T_GAP_REMOTE_ADDR_TYPE peer_address_type = GAP_REMOTE_ADDR_LE_PUBLIC;"</b> <br />
 set peer_address_type(only used for directed advertising).</p>
<p>5.<b>"T_GAP_ADV_FILTER_POLICY filter_policy = GAP_ADV_FILTER_ANY;"</b> <br />
 set filter_policy <a class="el" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gac0433c68ddb7484621ec659b7f8edd76">T_GAP_ADV_FILTER_POLICY</a></p>
<p>6.<b>"ble_ext_adv_mgr_init_adv_params()"</b> <br />
 set advertising parameters into upper stack and create advertising handle.</p>
<p>7.<b>"ble_ext_adv_mgr_register_callback"</b> <br />
 register advertising callback, each advertising has it own advertising callback. advertising state and connection state will be reported by this callback.</p>
<h3><a class="anchor" id="UM024_ENABLE_DISABLE_ADV"></a>
2.3 Enable or Disable Advertising by Adv Handle</h3>
<p><a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga067f5b6b7afd1eb38cf2897c889177fb" title="enable an advertising set. ">ble_ext_adv_mgr_enable()</a>: used to enable advertising. <br />
 for example: <br />
 application call <a class="el" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gaa1bcac5c326843a1110c8fc2fa16106b">app_ble_common_adv_start()</a> to start advertising. <br />
 if <a class="el" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gaa1bcac5c326843a1110c8fc2fa16106b">app_ble_common_adv_start()</a> return true, it means BLE protocol stack has already receive this command and ready to execute, when this command execution complete, BLE protocol stack will send <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3a3ad5f9978c6861ed2042360cef5e5186">BLE_EXT_ADV_MGR_ADV_ENABLED</a> to app_ble_common_adv_callback(). <br />
 </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gaa1bcac5c326843a1110c8fc2fa16106b">app_ble_common_adv_start</a>(uint16_t duration_10ms)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (le_common_adv.state == <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3acf6402209e91954f506dfeaf6f040123">BLE_EXT_ADV_MGR_ADV_DISABLED</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga067f5b6b7afd1eb38cf2897c889177fb">ble_ext_adv_mgr_enable</a>(le_common_adv.adv_handle, duration_10ms) == <a class="code" href="group___g_a_p___common___exported___types.html#gga99268bc0507cd918edbd1c9d12c802aba517ae23e2fc4ffb7a6128b63e43a5afc">GAP_CAUSE_SUCCESS</a>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <a class="code" href="group___t_r_a_c_e.html#ga3865df28228d19d7a9c874cddfada3c4">APP_PRINT_TRACE0</a>(<span class="stringliteral">&quot;app_ble_common_adv_start: Already started&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p> <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gaec65ef9f72086bd98fd6dfd83fe4a60a" title="disable an advertising set. ">ble_ext_adv_mgr_disable()</a>: used to disable advertising. <br />
 application call <a class="el" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga71ee4d3eb43ff1f665e4b43bbb36e7c1">app_ble_common_adv_stop()</a> to stop advertising. <br />
 if <a class="el" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga71ee4d3eb43ff1f665e4b43bbb36e7c1">app_ble_common_adv_stop()</a> return true, it means BLE protocol stack has already receive this command and ready to execute, when this command execution complete, BLE protocol stack will send <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3acf6402209e91954f506dfeaf6f040123">BLE_EXT_ADV_MGR_ADV_DISABLED</a> to app_ble_common_adv_callback(). <br />
 </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#ga71ee4d3eb43ff1f665e4b43bbb36e7c1">app_ble_common_adv_stop</a>(int8_t app_cause)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;app_ble_common_adv_stop&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gaec65ef9f72086bd98fd6dfd83fe4a60a">ble_ext_adv_mgr_disable</a>(le_common_adv.adv_handle, app_cause) == <a class="code" href="group___g_a_p___common___exported___types.html#gga99268bc0507cd918edbd1c9d12c802aba517ae23e2fc4ffb7a6128b63e43a5afc">GAP_CAUSE_SUCCESS</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="UM024_ADV_CB"></a>
2.4 Handle Callbacks of Advertising</h3>
<p>Two Events will be notified <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gad2dc0692029ca3df07b95326745fcddd">BLE_EXT_ADV_STATE_CHANGE</a> and <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga2dd2f17ba3ae875441107f1c21f8d994">BLE_EXT_ADV_SET_CONN_INFO</a>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_ble_common_adv_callback(uint8_t cb_type, <span class="keywordtype">void</span> *p_cb_data)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html">T_BLE_EXT_ADV_CB_DATA</a> cb_data;</div><div class="line">    memcpy(&amp;cb_data, p_cb_data, <span class="keyword">sizeof</span>(<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html">T_BLE_EXT_ADV_CB_DATA</a>));</div><div class="line">    <span class="keywordflow">switch</span> (cb_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gad2dc0692029ca3df07b95326745fcddd">BLE_EXT_ADV_STATE_CHANGE</a>:</div><div class="line">        {</div><div class="line">            le_common_adv.state = cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#a28834c69236a8dd84a2cb8cd96bd5679">p_ble_state_change</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_t_a_t_e___c_h_a_n_g_e.html#a4ba96644db04ef399056f6717d5666fa">state</a>;</div><div class="line">            <span class="keywordflow">if</span> (le_common_adv.state == <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3a3ad5f9978c6861ed2042360cef5e5186">BLE_EXT_ADV_MGR_ADV_ENABLED</a>)</div><div class="line">            {</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (le_common_adv.state == <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3acf6402209e91954f506dfeaf6f040123">BLE_EXT_ADV_MGR_ADV_DISABLED</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">switch</span> (cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#a28834c69236a8dd84a2cb8cd96bd5679">p_ble_state_change</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_t_a_t_e___c_h_a_n_g_e.html#ad3d8bfc3b831e3263f0877dc3f5a1457">stop_cause</a>)</div><div class="line">                {</div><div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggab396c9a4b54ee7b3ea205128030dc94baeb976cff376dc38e2553dd8199139aa3">BLE_EXT_ADV_STOP_CAUSE_APP</a>:</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggab396c9a4b54ee7b3ea205128030dc94ba23881d3656b475aef3ca0db362452964">BLE_EXT_ADV_STOP_CAUSE_CONN</a>:</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggab396c9a4b54ee7b3ea205128030dc94ba23cbe8577be16b94ddb2e3b182da839f">BLE_EXT_ADV_STOP_CAUSE_TIMEOUT</a>:</div><div class="line">                    <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#abfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4acb29f360a1e5a69b4c8541f24b929343">REMOTE_SESSION_ROLE_SECONDARY</a>) &amp;&amp; le_common_adv.use_static_addr_type)</div><div class="line">                    {</div><div class="line">                        <span class="comment">/*secondary ear ota need modify the random address and start advertising,</span></div><div class="line"><span class="comment">                        when advertising timeout, the random address shall be set back to le_rws_random_addr*/</span></div><div class="line">                        uint8_t rand_addr[6] = {0};</div><div class="line">                        app_ble_rand_addr_get(rand_addr);</div><div class="line">                        <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gad4f6ef524ec8c51a4b159a2b605c7335">app_ble_common_adv_set_random</a>(rand_addr);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga2dd2f17ba3ae875441107f1c21f8d994">BLE_EXT_ADV_SET_CONN_INFO</a>:</div><div class="line">        <a class="code" href="group___t_r_a_c_e.html#ga56829314bea353851fa9e5bbaf8d3fa7">APP_PRINT_TRACE4</a>(<span class="stringliteral">&quot;app_ble_common_adv_callback: BLE_EXT_ADV_SET_CONN_INFO conn_id 0x%x, adv_handle %d, local_addr_type %d, local_bd %b&quot;</span>,</div><div class="line">                         cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#aaf7574159a4584c55e5e470de76aee5c">p_ble_conn_info</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_e_t___c_o_n_n___i_n_f_o.html#a6f2749c213f11ad9a16583079a554b39">conn_id</a>,</div><div class="line">                         cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#aaf7574159a4584c55e5e470de76aee5c">p_ble_conn_info</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_e_t___c_o_n_n___i_n_f_o.html#a96dc09ff81c490ab93ccf8145b2f9429">adv_handle</a>,</div><div class="line">                         cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#aaf7574159a4584c55e5e470de76aee5c">p_ble_conn_info</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_e_t___c_o_n_n___i_n_f_o.html#a934448cbeae77308f981eb4adc6d1efe">local_addr_type</a>,</div><div class="line">                         <a class="code" href="group___t_r_a_c_e.html#ga21deae8960b0d6088c2d18b04a151e66">TRACE_BDADDR</a>(cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#aaf7574159a4584c55e5e470de76aee5c">p_ble_conn_info</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_e_t___c_o_n_n___i_n_f_o.html#a6886901988cf6ab2f3fbb0bb6b22c8ec">local_addr</a>));</div><div class="line"></div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="UM024_UPDATE_ADV_PARAM_AFTER_STACK_READY"></a>
2.5 Adv Parameter Update</h3>
<p><a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga622a25fde393572f22a7db82345488f8" title="used to update adv data this api shall be used after ble_ext_adv_mgr_init_adv_params_all() or ble_ext...">ble_ext_adv_mgr_set_adv_data()</a>: used to update adv data <br />
 </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_ble_common_adv_bud_role_update(<a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gad48900c988433e8bd9e07b08a225fdf4">T_REMOTE_SESSION_ROLE</a> role)</div><div class="line">{</div><div class="line">    <span class="comment">/*app_ble_common_adv_data update bud role*/</span></div><div class="line">    <span class="keywordflow">if</span> (app_ble_common_adv_data[20] != role)</div><div class="line">    {</div><div class="line">        app_ble_common_adv_data[20] = role;</div><div class="line">        <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga622a25fde393572f22a7db82345488f8">ble_ext_adv_mgr_set_adv_data</a>(le_common_adv.adv_handle, <span class="keyword">sizeof</span>(app_ble_common_adv_data),</div><div class="line">                                     app_ble_common_adv_data);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="comment">//bud role not change</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga6756396eee77befbe5bbc0d34cf9f1eb" title="used to update random address this api shall be used after ble_ext_adv_mgr_init_adv_params_all() or b...">ble_ext_adv_mgr_set_random()</a>:used to update random addr<br />
 </p><div class="fragment"><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> app_adv_update_randomaddr(uint8_t *random_address)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga6756396eee77befbe5bbc0d34cf9f1eb">ble_ext_adv_mgr_set_random</a>(adv_handle, random_address);</div><div class="line">}</div></div><!-- fragment --><p> <a class="el" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gaec19668934fdd3e83655b4caea624670" title="used to update scan response data this api shall be used after ble_ext_adv_mgr_init_adv_params_all() ...">ble_ext_adv_mgr_set_scan_response_data()</a>: used to update scan response data<br />
 </p><div class="fragment"><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> app_adv_update_scanrspdata(uint8_t *p_scan_data, uint16_t scan_data_len)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gaec19668934fdd3e83655b4caea624670">ble_ext_adv_mgr_set_scan_response_data</a>(adv_handle, scan_data_len, p_scan_data);</div><div class="line">}</div></div><!-- fragment --><p>update advertising parameters: <br />
 </p><div class="fragment"><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gaedc9bf24a6420c104ad0267bc5d179d6">ble_ext_adv_mgr_change_adv_interval</a>(uint8_t adv_handle, uint16_t adv_interval);</div><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga26894d7fcfe7a7c530038fc325fa59ae">ble_ext_adv_mgr_change_adv_tx_power</a>(uint8_t adv_handle, int8_t adv_tx_power);</div><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gaa8a844e9e77d7097f468917c9b1cf913">ble_ext_adv_mgr_change_adv_event_prop</a>(uint8_t adv_handle, uint16_t adv_event_prop);</div><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga7a7260ca0c8c4322524fb9c1e52a5e17">ble_ext_adv_mgr_change_adv_phy</a>(uint8_t adv_handle,</div><div class="line">                                           <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#ga207ac05c13e9ceaa5724eda068dcf5ab">T_GAP_PHYS_PRIM_ADV_TYPE</a> primary_adv_phy, <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#ga76ee08d96b6fe454d78c7098da491aa3">T_GAP_PHYS_TYPE</a> secondary_adv_phy);</div><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gabc1e7d9d8b30cb762e7a9128b15edcab">ble_ext_adv_mgr_change_peer_addr</a>(uint8_t adv_handle,</div><div class="line">                                             <a class="code" href="group___g_a_p___common___exported___types.html#ga41dd9d848e985c7c492f8f43e1da9249">T_GAP_REMOTE_ADDR_TYPE</a> peer_addr_type, uint8_t *peer_addr);</div><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gacc2240d34d85079e7c4e542725e55425">ble_ext_adv_mgr_change_channel_map</a>(uint8_t adv_handle, uint8_t primary_adv_channel_map);</div><div class="line"></div><div class="line"><a class="code" href="group___g_a_p___common___exported___types.html#ga99268bc0507cd918edbd1c9d12c802ab">T_GAP_CAUSE</a> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga1ef0a07e68c11cdab8e5faeaba30bf7f">ble_ext_adv_mgr_change_filter_policy</a>(uint8_t adv_handle,</div><div class="line">                                                 <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gac0433c68ddb7484621ec659b7f8edd76">T_GAP_ADV_FILTER_POLICY</a> filter_policy);</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="BLEExtAdvertisingManager_DataManager"></a>
3 BLE Extended Advertising Data Manager</h2>
<p>If you expect to use the public address to advertise multiple connectable advertising. It is recommended to use the ble adv data module. <br />
 This module only starts advertising with one advertising handle, and this module will adding new advertising data to the queue and regularly update advertising data to achieve different advertisements. </p><div class="image">
<img src="ble_adv_data_module.png" alt="ble_adv_data_module.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 BLE Adv Data Module Framework</b></div></center><p> The dotted box in figure 3-1 is implemented by BLE mgr lib, APP may not care about it. <br />
</p>
<p>Limitations:<br />
</p><ol type="1">
<li>Only one adv interval can be set, shared by multiple adv data. For example, if the adv interval is 50ms, only one kind of adv data needs to be sent, the interval is 50ms. If two kinds of adv data need to be sent, the interval is 100ms, and so on.</li>
<li>adv_event_prop cannot be specified, the default is LE_EXT_ADV_LEGACY_ADV_CONN_SCAN_UNDIRECTED.</li>
<li>Advertising address can only set public address, other address type is invalided.</li>
</ol>
<h3><a class="anchor" id="UM024_INIT_ADV_DATA_MODULE"></a>
3.1 Init BLE Advertising Data Module</h3>
<p>Call ble_mgr_init() to initialization ble advertising data module. for example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_ble_gap_ble_mgr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html">BLE_MGR_PARAMS</a> param = {0};</div><div class="line"></div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bd7683baadc3ca1ca7ae8c1b895611a">ble_ext_adv</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bd7683baadc3ca1ca7ae8c1b895611a">ble_ext_adv</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a719280eb2fedb81d95d276e2addd979a">adv_num</a> = app_ble_gap_get_ext_adv_num();</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#ae13eaf15d63f91b6a3f7eaaa54c05ce6">ama_support</a> || <a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a7997528396bc811509ec031629c310b0">xiaowei_support</a> ||</div><div class="line">        <a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a149d732d348fe9a626ef5cdac754aaa8">bisto_support</a> || <a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a46117c521390d0cab29f57edcc6eb706">xiaoai_support</a>)</div><div class="line">    {</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a89e7053f40bb46ab81fcb5eaed345fac">update_scan_data</a> = <span class="keyword">true</span>;</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a001f6f3457ad4e7d39cea0304ca7e526">adv_interval</a> = (<a class="code" href="group___a_p_p___c_f_g.html#ga615ce55cdb35d36a2b0227908060801d">extend_app_cfg_const</a>.<a class="code" href="struct_t___e_x_t_e_n_d___a_p_p___c_f_g___c_o_n_s_t.html#a861c22f939171fc139300ae98e7eaab9">multi_adv_interval</a> * 8) / 5;</div><div class="line">        <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga22fc5e8ca6953eb544ecedd25a90bca8">app_ble_gap_gen_scan_rsp_data</a>(&amp;<a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>, <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>);</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ae87719bc22acb973ba7f6a8e8fddf656">scan_rsp_len</a> = <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#gaf79d883b90bf38f70f8787d9bd2b34b1">scan_rsp_data_len</a>;</div><div class="line">        param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#aaed7998d9da85c0df702a3b0aff82b99">ble_adv_data</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a814cd509f9ce643e8b3e828227f62ea8">scan_rsp_data</a> = <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga70462e89d6a5310e9ac4a03e25b7b5e3">scan_rsp_data</a>;</div><div class="line">    }</div><div class="line">    ......</div><div class="line">    ble_mgr_init(&amp;param);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga5e597c87be17364dd4b7225dfa597861">app_ble_gap_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    app_ble_gap_ble_mgr_init();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga5e597c87be17364dd4b7225dfa597861">app_ble_gap_init</a>();</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><ol type="1">
<li><b>'param.ble_adv_data.enable = true;'</b> <br />
 means enable ble adv data module.</li>
<li><b>'param.ble_adv_data.update_scan_data = true;'</b> <br />
 means ble adv data module update scan response data.</li>
<li><b>'param.ble_adv_data.adv_interval = (extend_app_cfg_const.multi_adv_interval * 8) / 5;'</b> <br />
 means ble adv data module set advertising interval.</li>
</ol>
<h3><a class="anchor" id="UM024_ENABLE_DISABLE_ADV_DATA"></a>
3.2 Enable/Disable Adv Data in BLE Advertising Data Module</h3>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> le_ama_adv_start(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;le_ama_adv_start&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___b_l_e___a_d_v___d_a_t_a.html#ga920a2bc5811853c3742461db81d2233f">ble_adv_data_add</a>(&amp;ble_mgr.p_le_ama_adv_handle, <span class="keyword">sizeof</span>(ama_adv_data), ama_adv_data, 0, <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))</div><div class="line">    {</div><div class="line">        ......</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    ......</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gadba16018e781bd95876c89d8f097e00d">le_xm_xiaoai_adv_start</a>(uint16_t timeout_sec)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___b_l_e___a_d_v___d_a_t_a.html#ga920a2bc5811853c3742461db81d2233f">ble_adv_data_add</a>(&amp;p_le_xm_xiaoai_adv_handle, <span class="keyword">sizeof</span>(xm_xiaoai_adv_data),</div><div class="line">                         (uint8_t *)&amp;xm_xiaoai_adv_data,</div><div class="line">                         <span class="keyword">sizeof</span>(xm_xiaoai_scan_rsp_data), (uint8_t *)&amp;xm_xiaoai_scan_rsp_data))</div><div class="line">    {</div><div class="line">        app_xiaoai_device_start_adv_timer(timeout_sec);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><p>App can stop adv data if needed. Tips: if ble connection on this advertising handle established, advertising will will not stop, app shall stop adv by themselves. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group___a_p_p___b_l_e___t_t_s___o_t_a___exported___functions.html#gad96886cc0bd01dca8b0f0e3402a3341d">le_xm_xiaoai_adv_stop</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___b_l_e___a_d_v___d_a_t_a.html#ga85ef66529242658736d5a7eb19bbe951">ble_adv_data_del</a>(p_le_xm_xiaoai_adv_handle))</div><div class="line">    {</div><div class="line">        p_le_xm_xiaoai_adv_handle = <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="BLEExtAdvertisingManager_Dump"></a>
4 BLE Extended Advertising Information Dump</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> app_ble_handle_power_on(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> is_pairing = <a class="code" href="group___a_p_p___k_e_y___p_r_o_c_e_s_s.html#gab37bf869848e1958db7372beb1c5de20">app_key_is_enter_pairing</a>();</div><div class="line"></div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;app_ble_handle_power_on&quot;</span>);</div><div class="line">    <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga1b2176b866eb186bb78ae82148fc093b">ble_ext_adv_print_info</a>();</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
