<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="AudioSubsystem_Page"></a>
Audio Subsystem Introduction </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2024/02/26</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0  </td><td class="markdownTableBodyCenter">2023/05/24  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/06/30  </td><td class="markdownTableBodyCenter">Add Stream and Notification chapters   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2024/02/26  </td><td class="markdownTableBodyCenter">Revise grammar and sentence structure   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Rev">Revision History</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Table_List">Table List</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Overview">1 Overview</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_HAL">2 Audio HAL</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#Audio_HAL_Driver_Modeling">2.1 Driver Modeling</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#Audio_HAL_Configuration_Files">2.2 Configuration Files</a></li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Path">3 Audio Path</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#Audio_Path_Domain">3.1 Path Domain</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#Audio_Path_Lifecycle">3.2 Path Lifecycle</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#Audio_Path_Plugin">3.3 Audio Plugin</a></li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route">4 Audio Route</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Path">4.1 Physical Path</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Logical_IO">4.2 Logical IO</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Gateway">4.3 IO Gateway</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Endpoint">4.4 IO Endpoint</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Physical_IO">4.5 Physical IO</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Configurations">4.6 Configurations</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_API_Configurations">4.6.1 API Configurations</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Tool_Configurations">4.6.2 Tool Configurations</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream">5 Audio Stream</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Track">5.1 Audio Track</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Track_Modeling">5.1.1 Track Modeling</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Track_Lifecycle">5.1.2 Track Lifecycle</a></li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Line">5.2 Audio Line</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Line_Modeling">5.2.1 Line Modeling</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Line_Lifecycle">5.2.2 Line Lifecycle</a></li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Pipe">5.3 Audio Pipe</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Pipe_Modeling">5.3.1 Pipe Modeling</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Stream_Pipe_Lifecycle">5.3.2 Pipe Lifecycle</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Notification">6 Notification</a><ul>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Notification_Ringtone">6.1 Ringtone</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Notification_VoicePrompt">6.2 Voice Prompt</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Notification_TTS">6.3 TTS</a></li>
</ul>
</li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Signal">7 Audio Signal</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Volume">8 Audio Volume</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Effect">9 Audio Effect</a></li>
<li><a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Probe">10 Audio Probe</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_2_1">Table 2-1 Audio HAL Component Location</a></li>
<li><a href="#table_3_1">Table 3-1 Audio Category Enumerations</a></li>
<li><a href="#table_3_2">Table 3-2 Audio Path Domain Enumerations</a></li>
<li><a href="#table_3_3">Table 3-3 Audio Path State Enumerations</a></li>
<li><a href="#table_4_1">Table 4-1 Logical IO Enumerations</a></li>
<li><a href="#table_4_2">Table 4-2 IO Gateway Types</a></li>
<li><a href="#table_4_3">Table 4-3 IO Gateway Directions</a></li>
<li><a href="#table_4_4">Table 4-4 IO Gateway Channels</a></li>
<li><a href="#table_4_5">Table 4-5 IO Gateway Channel Polarities</a></li>
<li><a href="#table_4_6">Table 4-6 IO Endpoint Enumerations</a></li>
<li><a href="#table_4_7">Table 4-7 Physical MIC Enumerations</a></li>
<li><a href="#table_4_8">Table 4-8 Physical SPK Enumerations</a></li>
<li><a href="#table_4_9">Table 4-9 Physical AUX Enumerations</a></li>
<li><a href="#table_4_10">Table 4-10 Physical SPDIF Enumerations</a></li>
<li><a href="#table_5_1">Table 5-1 Audio Track Stream Types</a></li>
<li><a href="#table_5_2">Table 5-2 Audio Track Endpoints</a></li>
<li><a href="#table_5_3">Table 5-3 Audio Track State Enumerations</a></li>
<li><a href="#table_5_4">Table 5-4 Audio Line State Enumerations</a></li>
<li><a href="#table_5_5">Table 5-5 Codec Type Enumerations</a></li>
<li><a href="#table_5_6">Table 5-6 Audio Pipe State Enumerations</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_1">Figure 1-1 Audio Subsystem Architecture</a></li>
<li><a href="#figure_2_1">Figure 2-1 Audio HAL Modeling</a></li>
<li><a href="#figure_3_1">Figure 3-1 Audio Path Domain</a></li>
<li><a href="#figure_3_2">Figure 3-2 Audio Path Gateway Pattern</a></li>
<li><a href="#figure_3_3">Figure 3-3 Audio Path State Machine</a></li>
<li><a href="#figure_3_4">Figure 3-4 Audio Plugin Overview</a></li>
<li><a href="#figure_4_1">Figure 4-1 Audio Route Topology</a></li>
<li><a href="#figure_4_2">Figure 4-2 Audio Route Construction</a></li>
<li><a href="#figure_5_1">Figure 5-1 Audio Track Overview</a></li>
<li><a href="#figure_5_2">Figure 5-2 Audio Track Modeling</a></li>
<li><a href="#figure_5_3">Figure 5-3 Audio Track Lifecycle</a></li>
<li><a href="#figure_5_4">Figure 5-4 Audio Line Overview</a></li>
<li><a href="#figure_5_5">Figure 5-5 Audio Line Modeling</a></li>
<li><a href="#figure_5_6">Figure 5-6 Audio Line Lifecycle</a></li>
<li><a href="#figure_5_7">Figure 5-7 Audio Pipe Overview</a></li>
<li><a href="#figure_5_8">Figure 5-8 Audio Pipe Modeling</a></li>
<li><a href="#figure_5_9">Figure 5-9 Audio Pipe Lifecycle</a></li>
<li><a href="#figure_6_1">Figure 6-1 Notification Architecture</a></li>
<li><a href="#figure_6_2">Figure 6-2 Ringtone Control Flow</a></li>
<li><a href="#figure_6_3">Figure 6-3 Voice Prompt Control Flow</a></li>
<li><a href="#figure_6_4">Figure 6-4 TTS Control Flow</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC  </td><td class="markdownTableBodyCenter">Active Noise Cancellation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">DAC  </td><td class="markdownTableBodyCenter">Digital to Analog Converter   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">DSP  </td><td class="markdownTableBodyCenter">Digital Signal Processing   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">FM  </td><td class="markdownTableBodyCenter">Frequency Modulation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">HAL  </td><td class="markdownTableBodyCenter">Hardware Abstraction Layer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SHM  </td><td class="markdownTableBodyCenter">Share Memory   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SPDIF  </td><td class="markdownTableBodyCenter">Sony/Philips Digital Interface   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SPORT  </td><td class="markdownTableBodyCenter">Serial Port   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TTS  </td><td class="markdownTableBodyCenter">Text-to-Speech   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VoIP  </td><td class="markdownTableBodyCenter">Voice over Internet Phone   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Overview"></a>
1 Overview</h2>
<p>This document provides information about the design philosophy and operating principle of the Audio Subsystem. The Audio Subsystem is an audio-specific domain architecture that standardizes the audio driver abstraction interfaces, virtualizes the audio stream routing mechanism, and provides various high-level modularized components.</p>
<p>Figure 1-1 illustrates the architecture of the major elements of the Audio Subsystem. The entire Audio Subsystem is divided by a solid black line - below it is the Audio HAL, and above it is the Audio Framework. The Audio Framework depends on the Audio HAL and is designed to be a platform-independent software component. It can be briefly divided into the Audio Path, the Audio Core, and high-level function modules. The details of all these components will be disclosed in the following chapters.</p>
<div class="image">
<img src="Audio-Subsystem-Architecture.jpg" alt="Audio-Subsystem-Architecture.jpg"/>
</div>
 <center><div id="figure_1_1"><b>Figure 1-1 Audio Subsystem Architecture</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Audio_HAL"></a>
2 Audio HAL</h2>
<p>The Audio HAL defines the standard interfaces of the underlying audio hardware, providing two main benefits:</p><ol type="1">
<li>Easy iteration, updates, or migration of audio hardware devices and platforms, with minimal costs of maintaining the upper Audio Framework.</li>
<li>Constant connection of the lower-level audio hardware modules by the Audio Framework, allowing for independent development.</li>
</ol>
<p>The Audio HAL is composed of driver codes and configurations. Figure 2-1 provides an overview of the Audio HAL and depicts the relations between its interface prototype and implementation.</p>
<div class="image">
<img src="Audio-Subsystem-HAL-Modeling.jpg" alt="Audio-Subsystem-HAL-Modeling.jpg"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Audio HAL Modeling</b></div></center><h3><a class="anchor" id="Audio_HAL_Driver_Modeling"></a>
2.1 Driver Modeling</h3>
<p>Even though each component of the Audio HAL has its own functionalities and defines different API prototypes, they follow the same basic driver modeling policies:</p><ol type="1">
<li>Audio drivers provide simple, thread-unsafe APIs for the upper layers.</li>
<li>Upper layers register driver callbacks to receive driver internal events.</li>
</ol>
<p>The Audio HAL consists of the following components:</p><ul>
<li>SPORT HAL - provides I2S/PCM/TDM driver interfaces.</li>
<li>SPDIF HAL - provides SPDIF driver interfaces.</li>
<li>Codec HAL - provides Hardware Codec driver interfaces.</li>
<li>DSP HAL - provides DSP driver interfaces.</li>
<li>ANC HAL - provides APT/ANC driver interfaces.</li>
<li>PAD HAL - provides audio pin pad driver interfaces.</li>
<li>Bin Loader HAL - provides binary file loading interfaces.</li>
<li>SHM HAL - provides MCU/DSP IPC driver interfaces.</li>
</ul>
<p>Table 2-1 lists the modeling file locations of the Audio HAL components. </p><center><div id="table_2_1"><b>Table 2-1 Audio HAL Component Location</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">HAL Component  </th><th class="markdownTableHeadCenter">Location   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SPORT  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/sport_driver.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SPDIF  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/spdif_driver.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Codec  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/codec_driver.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">DSP  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/dsp_driver.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/anc_driver.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PAD  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/audio_pad.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Bin Loader  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/bin_loader_driver.h   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SHM  </td><td class="markdownTableBodyCenter">/sdk/inc/hal/audio/dsp_shm.h   </td></tr>
</table>
<h3><a class="anchor" id="Audio_HAL_Configuration_Files"></a>
2.2 Configuration Files</h3>
<p>Audio HAL Configuration Files are considered to be part of the Audio HAL. These files provide Audio driver policies that are not suitable in API style, or too trivial to maintain in API format.</p>
<p>Configuration Files are free to be constructed in any format, e.g. C structure style, XML or INI. They are also free to be declared in raw flash partitions or various file systems.</p>
<blockquote class="doxtable">
<p><b>Notes</b><br />
 Currently, we only provide C structure style format declared in raw flash partitions. </p>
</blockquote>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Audio_Path"></a>
3 Audio Path</h2>
<p>The Audio Path is a crucial component in the Audio Subsystem that decouples the entire Audio Framework from the underlying Audio HAL. Its main purpose is to abstract various audio hardware features and group them into different <em>Audio Cateogries</em>.</p>
<p>Table 3-1 provides a list of <em>Audio Category</em> enumerations from the file <a class="el" href="audio__type_8h_source.html">audio_type.h</a>. Each category can be instantiated as one or more Audio Path instances. In this chapter, we will explain the <a href="#Audio_Path_Domain">Audio Domain</a> that the Audio Path modeling is based on, illustrate the <a href="#Audio_Path_Lifecycle">Audio Path Lifecycle</a>, and guide users on customizing the Audio Path with <a href="#Audio_Path_Plugin">Audio Plugin</a>.</p>
<center><div id="table_3_1"><b>Table 3-1 Audio Category Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Category  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO  </td><td class="markdownTableBodyCenter">Audio playback   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VOICE  </td><td class="markdownTableBodyCenter">Voice communication   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">RECORD  </td><td class="markdownTableBodyCenter">Record or capture   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LINE  </td><td class="markdownTableBodyCenter">Analog or digital line-level loopback   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">RINGTONE  </td><td class="markdownTableBodyCenter">Ringtone   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VP  </td><td class="markdownTableBodyCenter">Voice prompt   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT  </td><td class="markdownTableBodyCenter">Ambient pass-through   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LLAPT  </td><td class="markdownTableBodyCenter">Low-latency ambient pass-through   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC  </td><td class="markdownTableBodyCenter">Active Noise Cancellation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VAD  </td><td class="markdownTableBodyCenter">Voice activity detection   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">KWS  </td><td class="markdownTableBodyCenter">Keyword spotting   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PIPE  </td><td class="markdownTableBodyCenter">Coder conversion pipe   </td></tr>
</table>
<h3><a class="anchor" id="Audio_Path_Domain"></a>
3.1 Path Domain</h3>
<p>The Path Domain defines the stream and routing control points for an Audio Path. Each Audio Path is composed of several Audio Path Domains. There are 3 kinds of Audio Path Domains listed in Table 3-2.</p>
<center><div id="table_3_2"><b>Table 3-2 Audio Path Domain Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Analog  </td><td class="markdownTableBodyCenter">Aanlog control point   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Digital  </td><td class="markdownTableBodyCenter">Digital control point   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway  </td><td class="markdownTableBodyCenter">Routing control point   </td></tr>
</table>
<p>As depicted in Figure 3-1, these Path Domains provide the necessary abstraction and resource management capabilities for the underlying drivers, enable the Audio Subsystem to interact with the hardware and perform various audio processing and routing tasks:</p><ul>
<li>Analog Domain serves as the resource manager for the Codec driver and ANC (Active Noise Cancellation) driver. It handles the management and configuration of resources related to analog audio processing, such as codecs and ANC functionality. It ensures proper control and utilization of analog audio resources.</li>
<li>Digital Domain serves as the resource manager for the DSP (Digital Signal Processing) driver. It handles the management and configuration of resources related to digital audio processing, such as signal processing algorithms, digital audio effects, and other digital processing capabilities. It allows for the control and customization of digital audio processing functions.</li>
<li>Gateway Domain serves as the resource manager for the SPORT (Serial Port) driver and SPDIF (Sony/Philips Digital Interface) driver. It handles the management and configuration of resources related to audio data transmission and interfacing. This domain ensures proper routing and synchronization of audio data between different devices and interfaces.</li>
</ul>
<div class="image">
<img src="Audio-Subsystem-Path-Domain.jpg" alt="Audio-Subsystem-Path-Domain.jpg"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 Audio Path Domain</b></div></center><p>For example, an audio playback path typically routes the stream from the DSP Digital Domain, through the SPORT Gateway Domain, and to the Codec Analog Domain. In contrast, an ANC path only routes the stream within the ANC Analog Domain. There are cases where an Audio Line path may need to route through different Gateways, e.g. AUX In and SPDIF Out loopback path. To facilitate easy construction of Audio Paths in such scenarios, the Gateway Domain adopts the <a href="https://en.wikipedia.org/wiki/Factory_method_pattern">Factory Method</a> pattern illustrated in Figure 3-2.</p>
<div class="image">
<img src="Audio-Subsystem-Path-Gateway-Pattern.jpg" alt="Audio-Subsystem-Path-Gateway-Pattern.jpg"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 Audio Path Gateway Pattern</b></div></center><h3><a class="anchor" id="Audio_Path_Lifecycle"></a>
3.2 Path Lifecycle</h3>
<p>As the Audio Path Domain is applied, the Auduio Path can unify its external behavior and lifecycle management across different <em>Audio Categories</em>. The lifecycle of an Audio Path Lifecycle can be defined by the following states - Idle, Pending, Ready, Running, Suspending and Stopping. Table 3-3 provides the definitions for these states.</p>
<center><div id="table_3_3"><b>Table 3-3 Audio Path State Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">State  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Idle  </td><td class="markdownTableBodyCenter">Path created or stopped   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pending  </td><td class="markdownTableBodyCenter">Path pending for scheduling   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Ready  </td><td class="markdownTableBodyCenter">Path pending for starting   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Running  </td><td class="markdownTableBodyCenter">Path active and enabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Suspending  </td><td class="markdownTableBodyCenter">Path under pausing transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Stopping  </td><td class="markdownTableBodyCenter">Path under stopping transient state   </td></tr>
</table>
<p>Figure 3-3 illustrates the state transitions of an Audio Path. When an Audio Path instance is created, it enters the <em>Idle</em> state. Upon starting the Audio Path, it first transitions to the <em>Pending</em> state which is a transient state for scheduling, and then enters the <em>Ready</em> state for Path Domain enabling. When all Path Domains related to this Audio Path are enabled, it enters the <em>Running</em> state. During the <em>Running</em> state, the Audio Path can be either stopped or paused, transitioning to the <em>Stopping</em> or <em>Suspending</em> state, respectively. Once all Path Domains related to the Audio Path are disabled, it returns to either the <em>Idle</em> state or the <em>Pending</em> state.</p>
<blockquote class="doxtable">
<p><b>Notes</b><br />
 A paused Audio Path will automatically enter the <em>Pending</em> state for rescheduling. On the other hand, a stopped Audio Path will only be rescheduled if it is started by an upper layer component. </p>
</blockquote>
<div class="image">
<img src="Audio-Subsystem-Path-FSM.jpg" alt="Audio-Subsystem-Path-FSM.jpg"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 Audio Path State Machine</b></div></center><h3><a class="anchor" id="Audio_Path_Plugin"></a>
3.3 Audio Plugin</h3>
<p>There are certain requirements for customer audio solutions to integrate external audio devices ( vendor hardware Codecs, vendor DSPs, DACs, Amplifiers, etc.) into the Audio Subsystem. The Audio Plugin is designed to address these use scenarios, where external audio devices can be seamlessly integrated into Audio Paths and their corresponding stream routings can be customized, without necessitating changes to Audio Paths' APIs and behaviors.</p>
<p>Figure 3-4 provides a high-level overview of the Audio Plugin in the Audio Subsystem. The yellow Line streams represent the default routing configurations:</p><ul>
<li>Uplink stream routes from the builtin input (MIC or Line-in), connected to the internal Codec, through the SPORT Gateway and internal DSP, and finally to the MCU.</li>
<li>Downlink stream routes from the MCU, through the internal DSP and SPORT Gateway, and finally to the builtin output (SPK) connected to the internal Codec.</li>
</ul>
<p>The green line streams, on the other hand, represent the customized routing configurations:</p><ul>
<li>Uplink stream routes from the plug input (extMIC), connected to the ExtDSP, through the SPORT Gateway and internal DSP, and finally to the MCU.</li>
<li>Downlink stream routes from the MCU, through the internal DSP and SPORT Gateway, and finally to the plug output (extSPK) connected to the extDSP/DAC.</li>
</ul>
<div class="image">
<img src="Audio-Subsystem-Path-AudioPlugin.jpg" alt="Audio-Subsystem-Path-AudioPlugin.jpg"/>
</div>
 <center><div id="figure_3_4"><b>Figure 3-4 Audio Plugin Overview</b></div></center><blockquote class="doxtable">
<p><b>Notes</b><br />
 Refer to the doc <a class="el" href="_u_m016__a_u_d_i_o__p_l_u_g_i_n.html#Audio_Plugin_Page">Audio Plugin User Manual </a> for detailed guides on using the Audio Plugin. </p>
</blockquote>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Audio_Route"></a>
4 Audio Route</h2>
<p>The Audio Route is used to configure the physical paths that are bound to the corresponding Audio Paths. As mentioned in chapter <a href="#AudioSubsystem_Audio_Path">3 Audio Path</a>, the Audio Path is responsible for managing hardware resources through <a href="#Audio_Path_Domain">Path Domain</a> and providing universal operation interfaces for high layers. The configuration of these hardware resources contained in the <a href="#Audio_Path_Domain">Path Domain</a> is done through the Audio Route.</p>
<p>Figure 4-1 illustrates the topology of the Audio Route. The root node is the <a href="#AudioSubsystem_Audio_Route_Path">Physical Path</a>, with the level-1 <a href="#table_3_1">Audio Category</a> node representing its specific use scenario. The level-2 <a href="#AudioSubsystem_Audio_Route_Logical_IO">Logical IO</a> node indicates the specific routing functionality for the <em>Physical Path</em>. The level-3 <a href="#AudioSubsystem_Audio_Route_Gateway">Gateway</a> node acts as the routing multiplexer for the <em>Physical Path</em>. The level-4 <a href="#AudioSubsystem_Audio_Route_Endpoint">Endpoint</a> node indicates the IO type, with the level-5 <a href="#AudioSubsystem_Audio_Route_Physical_IO">Physical IO</a> representing its physical identifier. We will introduce these Audio Route terminologies in the following sections.</p>
<div class="image">
<img src="Audio-Subsystem-Route-Topology.jpg" alt="Audio-Subsystem-Route-Topology.jpg"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 Audio Route Topology</b></div></center><h3><a class="anchor" id="AudioSubsystem_Audio_Route_Path"></a>
4.1 Physical Path</h3>
<p>The Physical Path is the root node (see <a href="#figure_4_1">Figure 4-1</a>) and the minimum routing granularity of the Audio Route. It defines the hardware layer routing path for the corresponding high layer <a href="#AudioSubsystem_Audio_Path">Audio Path</a>. The Physical Path has the following attributes:</p><ul>
<li>Each Physical Path instance belongs to only one <em>Audio Category</em>.</li>
<li>Each Physical Path instance is composed of <em>Logical IO</em>, <em>IO Gateway</em>, <em>IO Endpoint</em>, and <em>Physical IO</em>.</li>
<li>One or more Physical Path instances of the same <em>Audio Category</em> are grouped together.</li>
<li>Physical Path instances of different <em>Audio Categorys</em> likely have different routing control flows.</li>
<li>The routing control flow of each Physical Path instance shall match up with the <em>Audio Path</em> instance to which it is bound.</li>
</ul>
<h3><a class="anchor" id="AudioSubsystem_Audio_Route_Logical_IO"></a>
4.2 Logical IO</h3>
<p>The Logical IO defines the routing functionality for the <a href="#AudioSubsystem_Audio_Route_Path">Physical Path</a>. Each <em>Physical Path</em> instance shall have one, and only one, Logical IO. Furthermore, all <em>Physical Path</em> instances of the same <em>Audio Category</em> shall have different Logical IOs from each other.</p>
<p>The Logical IO is enumerated in the order of <em>Audio Category</em> as shown in the following Table 4-1.</p>
<center><div id="table_4_1"><b>Table 4-1 Logical IO Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Audio Primary Out  </td><td class="markdownTableBodyCenter">0x00  </td><td class="markdownTableBodyCenter">Audio Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Audio Secondary Out  </td><td class="markdownTableBodyCenter">0x01  </td><td class="markdownTableBodyCenter">Audio Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Audio Primary Reference Out  </td><td class="markdownTableBodyCenter">0x02  </td><td class="markdownTableBodyCenter">Audio Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Audio Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x03  </td><td class="markdownTableBodyCenter">Audio Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Primary Out  </td><td class="markdownTableBodyCenter">0x10  </td><td class="markdownTableBodyCenter">Voice Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Secondary Out  </td><td class="markdownTableBodyCenter">0x11  </td><td class="markdownTableBodyCenter">Voice Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Primary Reference Out  </td><td class="markdownTableBodyCenter">0x12  </td><td class="markdownTableBodyCenter">Voice Primary Reference Ou   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x13  </td><td class="markdownTableBodyCenter">Voice Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Primary Reference In  </td><td class="markdownTableBodyCenter">0x14  </td><td class="markdownTableBodyCenter">Voice Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Secondary Reference In  </td><td class="markdownTableBodyCenter">0x15  </td><td class="markdownTableBodyCenter">Voice Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Primary In  </td><td class="markdownTableBodyCenter">0x16  </td><td class="markdownTableBodyCenter">Voice Primary In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Secondary In  </td><td class="markdownTableBodyCenter">0x17  </td><td class="markdownTableBodyCenter">Voice Secondary In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Fusion In  </td><td class="markdownTableBodyCenter">0x18  </td><td class="markdownTableBodyCenter">Voice Fusion In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Bone Conduction In  </td><td class="markdownTableBodyCenter">0x19  </td><td class="markdownTableBodyCenter">Voice Bone Conduction Sensor In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Record Primary Reference In  </td><td class="markdownTableBodyCenter">0x20  </td><td class="markdownTableBodyCenter">Record Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Record Secondary Reference In  </td><td class="markdownTableBodyCenter">0x21  </td><td class="markdownTableBodyCenter">Record Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Record Primary In  </td><td class="markdownTableBodyCenter">0x22  </td><td class="markdownTableBodyCenter">Record Primary In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Record Secondary In  </td><td class="markdownTableBodyCenter">0x23  </td><td class="markdownTableBodyCenter">Record Secondary In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Record Fusion In  </td><td class="markdownTableBodyCenter">0x24  </td><td class="markdownTableBodyCenter">Record Fusion In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Record Bone Conduction In  </td><td class="markdownTableBodyCenter">0x25  </td><td class="markdownTableBodyCenter">Record Bone Conduction Sensor In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Line Primary Out  </td><td class="markdownTableBodyCenter">0x30  </td><td class="markdownTableBodyCenter">Line Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Line Secondary Out  </td><td class="markdownTableBodyCenter">0x31  </td><td class="markdownTableBodyCenter">Line Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Line Primary Reference Out  </td><td class="markdownTableBodyCenter">0x32  </td><td class="markdownTableBodyCenter">Line Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Line Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x33  </td><td class="markdownTableBodyCenter">Line Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Line Primary Reference In  </td><td class="markdownTableBodyCenter">0x34  </td><td class="markdownTableBodyCenter">Line Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Line Secondary Reference In  </td><td class="markdownTableBodyCenter">0x35  </td><td class="markdownTableBodyCenter">Line Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Line Left In  </td><td class="markdownTableBodyCenter">0x36  </td><td class="markdownTableBodyCenter">Line Left In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Line Right In  </td><td class="markdownTableBodyCenter">0x37  </td><td class="markdownTableBodyCenter">Line Right In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Ringtone Primary Out  </td><td class="markdownTableBodyCenter">0x40  </td><td class="markdownTableBodyCenter">Ringtone Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Ringtone Secondary Out  </td><td class="markdownTableBodyCenter">0x41  </td><td class="markdownTableBodyCenter">Ringtone Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Ringtone Primary Reference Out  </td><td class="markdownTableBodyCenter">0x42  </td><td class="markdownTableBodyCenter">Ringtone Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Ringtone Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x43  </td><td class="markdownTableBodyCenter">Ringtone Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Prompt Primary Out  </td><td class="markdownTableBodyCenter">0x50  </td><td class="markdownTableBodyCenter">Voice Prompt Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Prompt Secondary Out  </td><td class="markdownTableBodyCenter">0x51  </td><td class="markdownTableBodyCenter">Voice Prompt Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Voice Prompt Primary Reference Out  </td><td class="markdownTableBodyCenter">0x52  </td><td class="markdownTableBodyCenter">Voice Prompt Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Voice Prompt Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x53  </td><td class="markdownTableBodyCenter">Voice Prompt Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT Primary Out  </td><td class="markdownTableBodyCenter">0x60  </td><td class="markdownTableBodyCenter">APT Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">APT Secondary Out  </td><td class="markdownTableBodyCenter">0x61  </td><td class="markdownTableBodyCenter">APT Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT Primary Reference Out  </td><td class="markdownTableBodyCenter">0x62  </td><td class="markdownTableBodyCenter">APT Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">APT Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x63  </td><td class="markdownTableBodyCenter">APT Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT Primary Reference In  </td><td class="markdownTableBodyCenter">0x64  </td><td class="markdownTableBodyCenter">APT Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">APT Secondary Reference In  </td><td class="markdownTableBodyCenter">0x65  </td><td class="markdownTableBodyCenter">APT Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT Primary Left In  </td><td class="markdownTableBodyCenter">0x66  </td><td class="markdownTableBodyCenter">APT Primary Left In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">APT Primary Right In  </td><td class="markdownTableBodyCenter">0x67  </td><td class="markdownTableBodyCenter">APT Primary Right In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">APT Secondary Left In  </td><td class="markdownTableBodyCenter">0x68  </td><td class="markdownTableBodyCenter">APT Secondary Left In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">APT Secondary Right In  </td><td class="markdownTableBodyCenter">0x69  </td><td class="markdownTableBodyCenter">APT Secondary Right In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LL-APT Primary Out  </td><td class="markdownTableBodyCenter">0x70  </td><td class="markdownTableBodyCenter">Low Latency APT Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">LL-APT Secondary Out  </td><td class="markdownTableBodyCenter">0x71  </td><td class="markdownTableBodyCenter">Low Latency APT Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LL-APT Primary Reference Out  </td><td class="markdownTableBodyCenter">0x72  </td><td class="markdownTableBodyCenter">Low Latency APT Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">LL-APT Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x73  </td><td class="markdownTableBodyCenter">Low Latency APT Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LL-APT Primary Reference In  </td><td class="markdownTableBodyCenter">0x74  </td><td class="markdownTableBodyCenter">Low Latency APT Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">LL-APT Secondary Reference In  </td><td class="markdownTableBodyCenter">0x75  </td><td class="markdownTableBodyCenter">Low Latency APT Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LL-APT Left In  </td><td class="markdownTableBodyCenter">0x76  </td><td class="markdownTableBodyCenter">Low Latency APT Left In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">LL-APT Right In  </td><td class="markdownTableBodyCenter">0x77  </td><td class="markdownTableBodyCenter">Low Latency APT Right In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC Primary Out  </td><td class="markdownTableBodyCenter">0x80  </td><td class="markdownTableBodyCenter">ANC Primary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ANC Secondary Out  </td><td class="markdownTableBodyCenter">0x81  </td><td class="markdownTableBodyCenter">ANC Secondary Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC Primary Reference Out  </td><td class="markdownTableBodyCenter">0x82  </td><td class="markdownTableBodyCenter">ANC Primary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ANC Secondary Reference Out  </td><td class="markdownTableBodyCenter">0x83  </td><td class="markdownTableBodyCenter">ANC Secondary Reference Out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC Primary Reference In  </td><td class="markdownTableBodyCenter">0x84  </td><td class="markdownTableBodyCenter">ANC Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ANC Secondary Reference In  </td><td class="markdownTableBodyCenter">0x85  </td><td class="markdownTableBodyCenter">ANC Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC FF Left In  </td><td class="markdownTableBodyCenter">0x86  </td><td class="markdownTableBodyCenter">ANC Feedforward Left In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ANC FF Right In  </td><td class="markdownTableBodyCenter">0x87  </td><td class="markdownTableBodyCenter">ANC Feedforward Right In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ANC FB Left In  </td><td class="markdownTableBodyCenter">0x88  </td><td class="markdownTableBodyCenter">ANC Feedback Left In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ANC FB Right In  </td><td class="markdownTableBodyCenter">0x89  </td><td class="markdownTableBodyCenter">ANC Feedback Right In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VAD Primary Reference In  </td><td class="markdownTableBodyCenter">0x90  </td><td class="markdownTableBodyCenter">VAD Primary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VAD Secondary Reference In  </td><td class="markdownTableBodyCenter">0x91  </td><td class="markdownTableBodyCenter">VAD Secondary Reference In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">VAD Primary In  </td><td class="markdownTableBodyCenter">0x92  </td><td class="markdownTableBodyCenter">VAD Primary In   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VAD Secondary In  </td><td class="markdownTableBodyCenter">0x93  </td><td class="markdownTableBodyCenter">VAD Secondary In   </td></tr>
</table>
<h3><a class="anchor" id="AudioSubsystem_Audio_Route_Gateway"></a>
4.3 IO Gateway</h3>
<p>The IO Gateway acts as a multiplexer for the <em>Physical Path</em> and controls its inflow and outflow. It provides common configurations for the <em>Physical Path</em>, such as sample rate, data length, channel length, channel mode, etc.</p>
<p>Currently, the Audio Route supports three Gateway types as defined in Table 4-2.</p>
<center><div id="table_4_2"><b>Table 4-2 IO Gateway Types</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">I2S  </td><td class="markdownTableBodyCenter">0x00   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SPDIF  </td><td class="markdownTableBodyCenter">0x01   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">USB  </td><td class="markdownTableBodyCenter">0x02   </td></tr>
</table>
<p>Each IO Gateway shall have two directions as defined in Table 4-3.</p>
<center><div id="table_4_3"><b>Table 4-3 IO Gateway Directions</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway TX  </td><td class="markdownTableBodyCenter">0x00   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Gateway RX  </td><td class="markdownTableBodyCenter">0x01   </td></tr>
</table>
<p>Moreover, each IO Gateway shall support a maximum of 8 Gateway Channels in each direction as specified in Table 4-4.</p>
<center><div id="table_4_4"><b>Table 4-4 IO Gateway Channels</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway Channel 0  </td><td class="markdownTableBodyCenter">0x00   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Gateway Channel 1  </td><td class="markdownTableBodyCenter">0x01   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway Channel 2  </td><td class="markdownTableBodyCenter">0x02   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Gateway Channel 3  </td><td class="markdownTableBodyCenter">0x03   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway Channel 4  </td><td class="markdownTableBodyCenter">0x04   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Gateway Channel 5  </td><td class="markdownTableBodyCenter">0x05   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway Channel 6  </td><td class="markdownTableBodyCenter">0x06   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Gateway Channel 7  </td><td class="markdownTableBodyCenter">0x07   </td></tr>
</table>
<p>Additionally, each IO Gateway Channel shall have two signal polarities as defined in Table 4-5.</p>
<center><div id="table_4_5"><b>Table 4-5 IO Gateway Channel Polarities</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Gateway Channel Positive  </td><td class="markdownTableBodyCenter">0x00   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Gateway Channel Negative  </td><td class="markdownTableBodyCenter">0x01   </td></tr>
</table>
<blockquote class="doxtable">
<p><b>Notes</b><br />
 Usually, Gateways are integrated into the Audio Route and controlled by the Audio Subystem. However, in customized audio solutions, there may be user requirements for Gateways to be controlled directly by applications.</p>
<p>There is a restriction that Gateways can only be controlled exclusively by the Audio Route or Applications. If a specific Gateway is already configured in the Audio Route (see <a class="el" href="_u_m015__a_u_d_i_o__s_u_b_s_y_s_t_e_m.html#AudioSubsystem_Audio_Route_Tool_Configurations">4.6.2 Tool Configurations</a>), the application shall <b>not</b> control it anymore, and vice versa.</p>
<p>Currently, we only support the I2S Gateway to be controlled by applications. Refer to the doc <a class="el" href="_u_m012__i_o__d_e_m_o.html#IO_Demo_App_Page">IO User Manual </a> for the usage of I2S at the application layer. </p>
</blockquote>
<h3><a class="anchor" id="AudioSubsystem_Audio_Route_Endpoint"></a>
4.4 IO Endpoint</h3>
<p>The IO Endpoint defines the peripheral interface type for the <em>Physical Paths</em>. It is paired with the Logical IO to distinguish all routing paths from each other.</p>
<p>The IO Endpoint is enumerated as follows:</p>
<center><div id="table_4_6"><b>Table 4-6 IO Endpoint Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MIC  </td><td class="markdownTableBodyCenter">0x00  </td><td class="markdownTableBodyCenter">Microphone input endpoint   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SPK  </td><td class="markdownTableBodyCenter">0x01  </td><td class="markdownTableBodyCenter">Speaker output endpoint   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUX  </td><td class="markdownTableBodyCenter">0x02  </td><td class="markdownTableBodyCenter">Auxiliary input endpoint or Auxiliary output endpoint   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SPDIF  </td><td class="markdownTableBodyCenter">0x03  </td><td class="markdownTableBodyCenter">SPDIF input endpoint or SPDIF output endpoint   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">USB  </td><td class="markdownTableBodyCenter">0x04  </td><td class="markdownTableBodyCenter">USB input endpoint or USB output endpoint   </td></tr>
</table>
<h3><a class="anchor" id="AudioSubsystem_Audio_Route_Physical_IO"></a>
4.5 Physical IO</h3>
<p>The Physical IO defines the enumerations for the hardware driver layer interface corresponding to each <em>IO Endpoint</em>. Apparently, the Physical IO enumerations of each <em>IO endpoint</em> type are coupled with the underlying hardware capabilities.</p>
<p>Table 4-7 defines the Physical MIC enumerations of the MIC Endpoint:</p>
<center><div id="table_4_7"><b>Table 4-7 Physical MIC Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_MIC1  </td><td class="markdownTableBodyCenter">0x00  </td><td class="markdownTableBodyCenter">Physical microphone 1   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_MIC2  </td><td class="markdownTableBodyCenter">0x01  </td><td class="markdownTableBodyCenter">Physical microphone 2   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_MIC3  </td><td class="markdownTableBodyCenter">0x02  </td><td class="markdownTableBodyCenter">Physical microphone 3   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_MIC4  </td><td class="markdownTableBodyCenter">0x03  </td><td class="markdownTableBodyCenter">Physical microphone 4   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_REF_MIC  </td><td class="markdownTableBodyCenter">0x0E  </td><td class="markdownTableBodyCenter">Internal microphone for reference signal in   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_EXT_MIC  </td><td class="markdownTableBodyCenter">0x0F  </td><td class="markdownTableBodyCenter">External microphone   </td></tr>
</table>
<p>Table 4-8 defines the Physical SPK enumerations of the SPK Endpoint:</p>
<center><div id="table_4_8"><b>Table 4-8 Physical SPK Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_SPK1  </td><td class="markdownTableBodyCenter">0x00  </td><td class="markdownTableBodyCenter">Physical speaker 1   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_SPK2  </td><td class="markdownTableBodyCenter">0x01  </td><td class="markdownTableBodyCenter">Physical speaker 2   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_REF_SPK  </td><td class="markdownTableBodyCenter">0x06  </td><td class="markdownTableBodyCenter">Internal speaker for reference signal out   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_EXT_SPK  </td><td class="markdownTableBodyCenter">0x07  </td><td class="markdownTableBodyCenter">External speaker   </td></tr>
</table>
<p>Table 4-9 defines the Physical AUX enumerations of the AUX Endpoint:</p>
<center><div id="table_4_9"><b>Table 4-9 Physical AUX Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_AUX_L  </td><td class="markdownTableBodyCenter">0x00  </td><td class="markdownTableBodyCenter">AUX-IN left channel   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_AUX_R  </td><td class="markdownTableBodyCenter">0x01  </td><td class="markdownTableBodyCenter">AUX-IN right channel   </td></tr>
</table>
<p>Table 4-10 defines the Physical SPDIF enumerations of the SPDIF Endpoint:</p>
<center><div id="table_4_10"><b>Table 4-10 Physical SPDIF Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Name  </th><th class="markdownTableHeadCenter">Value  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_ROUTE_SPDIF_0  </td><td class="markdownTableBodyCenter">0x00  </td><td class="markdownTableBodyCenter">SPDIF interface 0   </td></tr>
</table>
<h3><a class="anchor" id="AudioSubsystem_Audio_Route_Configurations"></a>
4.6 Configurations</h3>
<p>The Audio Route provides two methods for configuring and controlling the physical paths depicted in <a href="#figure_4_1">Figure 4-1</a>:</p><ul>
<li><b>API Configurations</b> - Applications can set, update and extend Audio Route configurations at runtime by invoking Audio Route APIs.</li>
<li><b>Tool Configurations</b> - Users can statically configure the Audio Route using the <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSet_MCUConfigTool">MCU Configure Tool</a>(refer to the <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSetIntro">Tool Set User Manual </a>).</li>
</ul>
<blockquote class="doxtable">
<p><b>Notes</b><br />
 These two configuration methods can be combined, where configurations can be initially set from the <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSet_MCUConfigTool">MCU Configure Tool</a> and dynamic configurations can be applied at runtime through API invocation if needed. </p>
</blockquote>
<p>Regardless of the configuration methods chosen, it is important to understand the internal software design and construction ideas illustrated in Figure 4-2:</p><ol type="1">
<li>The physical paths of each <em>Audio Category</em> are grouped in a PathGroup, which consists of path_num and path_array. path_num indicates the number of physical paths for the specific <em>Audio Category</em>, while path_array allocates the resources for these physical paths based on the size of path_num.</li>
<li>Each physical path is represented as a <em>Path</em>, which contains io_type, io_polariy, endpoint_type, endpoint_attr, and gateway_attr. io_type represents the <a href="#AudioSubsystem_Audio_Route_Logical_IO">Logical IO</a>; io_polariy is defined in <a href="#table_4_5">Table 4-5</a>; endpoint_type represents the <a href="#AudioSubsystem_Audio_Route_Endpoint">IO Endpoint</a>; endpoint_attr is illustrated in the <em>EndpointAttribute</em>; gateway_attr is illustrated in the <em>GatewayAttribute</em>.</li>
<li>The <em>EndpointAttribute</em> is a union for <em>Physical IOs</em>. These physical IOs for each <em>Endpoint Type</em> are defined in DeviceMIC, DeviceSPK, DeviceAUXIN, DeviceSPDIFIN, and DeviceSPDIFOUT, respectively.</li>
<li>The <em>GatewayAttribute</em> defines the deatail attributes for the binding physical path.</li>
</ol>
<div class="image">
<img src="Audio-Subsystem-Route-Construction.jpg" alt="Audio-Subsystem-Route-Construction.jpg"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 Audio Route Construction</b></div></center><h4><a class="anchor" id="AudioSubsystem_Audio_Route_API_Configurations"></a>
4.6.1 API Configurations</h4>
<p>The process of controlling the Audio Route using APIs at runtime is depicted in Figure 4-3. Applications should follow the control flow outlined below:</p><ol type="1">
<li>Applications load the Audio Route path group by invoking the audio_route_path_group_take API.</li>
<li>Applications should allocate a block of memory to copy the loaded Audio Route path group.</li>
<li>Applications release the Audio Route path group by invoking the audio_route_path_group_give API.</li>
<li>Applications can update any fields or attributes as illustrated in <a href="#figure_4_2">Figure 4-2</a>.</li>
<li>Applications register the modifed Audio Route path group into the Audio Route component by invoking the <a class="el" href="group___a_u_d_i_o___r_o_u_t_e.html#ga9207596f14ceeccbfe9859ddef1f4f03">audio_route_category_path_register</a> API.</li>
<li>Applications can unregister and restore the default Audio Route path group if needed by invoking the <a class="el" href="group___a_u_d_i_o___r_o_u_t_e.html#gac3de2778d2cc13210b72bfd5a6a53437">audio_route_category_path_unregister</a> API.</li>
</ol>
<div class="image">
<img src="Audio-Subsystem-Route-API-Control-Flow.jpg" alt="Audio-Subsystem-Route-API-Control-Flow.jpg"/>
</div>
 <center><div id="figure_4_3"><b>Figure 4-3 Audio Route API Control Flow</b></div></center><blockquote class="doxtable">
<p><b>Notes</b><br />
 The corresponding <a href="#AudioSubsystem_Audio_Path">Audio Path</a> shall enter the <em>Idle</em> state (see <a href="#figure_3_3">Figure 3-3</a>) before applications register or unregister the Audio Route path group. </p>
</blockquote>
<h4><a class="anchor" id="AudioSubsystem_Audio_Route_Tool_Configurations"></a>
4.6.2 Tool Configurations</h4>
<p>Users can statically configure the Audio Route using the MCU Configure Tool. Here are two steps for usage:</p><ol type="1">
<li>Read the doc <a class="el" href="_u_m017__a_u_d_i_o__r_o_u_t_e.html#AudioRoute_Page">Audio Route User Manual </a> to gain a deeper understanding of Audio Route configurations.</li>
<li>Read the section <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSet_MCUConfigTool">MCU Configure Tool</a> in the doc <a class="el" href="_u_m003__t_o_o_l__s_e_t__i_n_t_r_o.html#ToolSetIntro">Tool Set User Manual </a> to learn how to use the MCU Configure Tool.</li>
</ol>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Audio_Stream"></a>
5 Audio Stream</h2>
<p>The Audio Stream component offers a collection of abstract, efficient, and flexible audio data control and processing functions for the application layer. These functions can be categorized into the following three categories:</p><ol type="1">
<li>Audio Track - Used for handling playback, voice communication, and record streams.</li>
<li>Audio Line - Used to control various loopback streams.</li>
<li>Audio Pipe - Used for codec conversion of various streams.</li>
</ol>
<p>By utilizing the <a href="#AudioSubsystem_Audio_Route">Audio Route</a> to configure the underlying hardware stream routing paths, developers can conveniently handle complex audio scenarios using the APIs provided by these high-level Audio Stream models. The remainder of this chapter will delve into the implementation details of Audio Track, Audio Line, and Audio Pipe.</p>
<h3><a class="anchor" id="AudioSubsystem_Audio_Stream_Track"></a>
5.1 Audio Track</h3>
<p>The Audio Track provides a set of dedicated high-level APIs for handling playback, voice communication, and record streams. The <em>Playback</em> stream refers to music or multimedia audio. The <em>Voice communication</em> stream refers to various bidirectional speeches transmitted through VoIP, cellular calls, and other mediums. The <em>Record</em> stream is used for speech recognition or data capturing. These three type streams are defined in Table 5-1 below:</p>
<center><div id="table_5_1"><b>Table 5-1 Audio Track Stream Types</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_STREAM_TYPE_PLAYBACK  </td><td class="markdownTableBodyCenter">0x00   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_STREAM_TYPE_VOICE  </td><td class="markdownTableBodyCenter">0x01   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_STREAM_TYPE_RECORD  </td><td class="markdownTableBodyCenter">0x02   </td></tr>
</table>
<p>Figure 5-1 below illustrates an overview of the Audio Track across different modules. A <em>playback</em> Audio Track transfers the dedicated stream from the Application layer to the local output Peripherals. A <em>record</em> Audio Track transfers the dedicated stream from the local input Peripherals to the Application layer. A <em>voice</em> Audio Track functions as a combination of the <em>playback</em> Audio Track and the <em>record</em> Audio Track, but with a different stream type.</p>
<div class="image">
<img src="Audio-Subsystem-Track-Overview.jpg" alt="Audio-Subsystem-Track-Overview.jpg"/>
</div>
 <center><div id="figure_5_1"><b>Figure 5-1 Audio Track Overview</b></div></center><p>Table 5-2 summarizes the Audio Track Endpoints for different stream types. Applications shall select the appropriate stream type to create an Audio Track instance.</p>
<center><div id="table_5_2"><b>Table 5-2 Audio Track Endpoints</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Source Endpint  </th><th class="markdownTableHeadCenter">Sink Endpint   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_STREAM_TYPE_PLAYBACK  </td><td class="markdownTableBodyCenter">Application  </td><td class="markdownTableBodyCenter">Output Peripherals   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_STREAM_TYPE_VOICE  </td><td class="markdownTableBodyCenter">Application (Decoder)<br />
Input Peripherals (Encoder)  </td><td class="markdownTableBodyCenter">Output Peripherals (Decoder)<br />
Application (Decoder)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_STREAM_TYPE_RECORD  </td><td class="markdownTableBodyCenter">Input Peripherals  </td><td class="markdownTableBodyCenter">Application   </td></tr>
</table>
<h4><a class="anchor" id="AudioSubsystem_Audio_Stream_Track_Modeling"></a>
5.1.1 Track Modeling</h4>
<p>The Audio Track is designed to be based on the Audio Path component and bundled with a Media Buffer instance. As shown in Figure 5-2, the Audio Track utilizes the Audio Path to configure and control the underlying hardware routings, ensuring synchronization between the state of the Audio Track and the Audio Path. Additionally, the Audio Track creates a Media Buffer instance for each stream direction. The Media Buffer instance is responsible for storing stream data for decoding and encoding purposes and provides a set of jitter handling operations for the Audio Track.</p>
<div class="image">
<img src="Audio-Subsystem-Track-Modeling.jpg" alt="Audio-Subsystem-Track-Modeling.jpg"/>
</div>
 <center><div id="figure_5_2"><b>Figure 5-2 Audio Track Modeling</b></div></center><h4><a class="anchor" id="AudioSubsystem_Audio_Stream_Track_Lifecycle"></a>
5.1.2 Track Lifecycle</h4>
<p>Each instance of Audio Track has its own lifecycle, which can be defined by the following states: Released, Creating, Created, Starting, Started, Stopping, Stopped, Pausing, Paused, Restarting and Releasing. The definitions of these states are provided in Table 5-3.</p>
<center><div id="table_5_3"><b>Table 5-3 Audio Track State Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">State  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Released  </td><td class="markdownTableBodyCenter">Track instance not existed or destroyed already   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Creating  </td><td class="markdownTableBodyCenter">Track instance under creating transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Created  </td><td class="markdownTableBodyCenter">Track instance created and statical resources allocated   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Starting  </td><td class="markdownTableBodyCenter">Track instance under starting transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Started  </td><td class="markdownTableBodyCenter">Track instance started and underlying hardware enabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Stopping  </td><td class="markdownTableBodyCenter">Track instance under stopping transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Stopped  </td><td class="markdownTableBodyCenter">Track instance stopped and underlying hardware disabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pausing  </td><td class="markdownTableBodyCenter">Track instance under pausing transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Paused  </td><td class="markdownTableBodyCenter">Track instance paused and underlying hardware disabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Restarting  </td><td class="markdownTableBodyCenter">Track instance under restarting transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Releasing  </td><td class="markdownTableBodyCenter">Track instance under releasing transient state   </td></tr>
</table>
<p>Figure 5-3 illustrates the state transitions for an Audio Track. When an instance of Audio Track is created, it initially enters the <em>Released</em> state as a temporary placeholder and then transitions directly to the <em>Creating</em> state. Once the creation process of the Audio Track instance is completed, it enters the <em>Created</em> state. From the <em>Created</em> state, the Audio Track instance can either be released directly, transitioning from the <em>Releasing</em> state to the <em>Released</em> state, or it can be started on demand, transitioning from the <em>Starting</em> state to the <em>Started</em> state. An active instance of Audio Track can also be stopped on demand, transitioning from the <em>Stopping</em> state to the <em>Stopped</em> state.</p>
<blockquote class="doxtable">
<p><b>Notes</b><br />
</p><ul>
<li>The pause action terminates the Audio Track until the stream in the binding Media Buffer is drained. On the other hand, the stop action terminates the Audio Track directly.</li>
<li>The restart action combines the stop and start actions. If the Audio Track is active, it transitions from the <em>Stopping</em> state to the <em>Stopped</em> state, and then from the <em>Starting</em> to the <em>Started</em> state. If the Audio Track is already stopped or has not been started yet, it will be started directly, transitioning from the <em>Starting</em> state to the <em>Started</em> state. </li>
</ul>
</blockquote>
<div class="image">
<img src="Audio-Subsystem-Track-Lifecycle.jpg" alt="Audio-Subsystem-Track-Lifecycle.jpg"/>
</div>
 <center><div id="figure_5_3"><b>Figure 5-3 Audio Track Lifecycle</b></div></center><h3><a class="anchor" id="AudioSubsystem_Audio_Stream_Line"></a>
5.2 Audio Line</h3>
<p>The Audio Line provides a set of dedicated high-level APIs for stream loopback. The key distinction between the Audio Line and the Audio Track is that the Audio Line stream bypasses the application layer and performs direct underlying stream loopback.</p>
<p>Figure 5-4 below provides an overview of how the Audio Line operates across different modules. Each instance of Audio Line takes the dedicated stream from local input Peripherals and pours it into local output Peripherals. The local input Peripheral can include builtin MIC, external MIC, AUX-In, or SPDIF-In, while the local output Peripheral can include builtin SPK, external SPK, AUX-Out, or SPDIF-Out. The Audio Line supports flexible combinations of the input and output Peripherals.</p>
<div class="image">
<img src="Audio-Subsystem-Line-Overview.jpg" alt="Audio-Subsystem-Line-Overview.jpg"/>
</div>
 <center><div id="figure_5_4"><b>Figure 5-4 Audio Line Overview</b></div></center><h4><a class="anchor" id="AudioSubsystem_Audio_Stream_Line_Modeling"></a>
5.2.1 Line Modeling</h4>
<p>The Audio Line is designed to be based on the Audio Path component. As shown in Figure 5-5, The Audio Line utilizes the capabilities of the Audio Path component to configure and control the hardware routing. As a result, the state of the Audio Line is synchronized with the state of the Audio Path component.</p>
<div class="image">
<img src="Audio-Subsystem-Line-Modeling.jpg" alt="Audio-Subsystem-Line-Modeling.jpg"/>
</div>
 <center><div id="figure_5_5"><b>Figure 5-5 Audio Line Modeling</b></div></center><h4><a class="anchor" id="AudioSubsystem_Audio_Stream_Line_Lifecycle"></a>
5.2.2 Line Lifecycle</h4>
<p>Each instance of Audio Line follows a specific lifecycle defined by the following states: Released, Creating, Created, Starting, Started, Stopping, Stopped, Pausing, Paused, and Releasing. The definitions of these states are provided in Table 5-4.</p>
<center><div id="table_5_4"><b>Table 5-4 Audio Line State Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">State  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Released  </td><td class="markdownTableBodyCenter">Line instance not existed or destroyed already   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Creating  </td><td class="markdownTableBodyCenter">Line instance under creating transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Created  </td><td class="markdownTableBodyCenter">Line instance created and statical resources allocated   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Starting  </td><td class="markdownTableBodyCenter">Line instance under starting transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Started  </td><td class="markdownTableBodyCenter">Line instance started and underlying hardware enabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Stopping  </td><td class="markdownTableBodyCenter">Line instance under stopping transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Stopped  </td><td class="markdownTableBodyCenter">Line instance stopped and underlying hardware disabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pausing  </td><td class="markdownTableBodyCenter">Line instance under pausing transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Paused  </td><td class="markdownTableBodyCenter">Line instance paused and underlying hardware disabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Releasing  </td><td class="markdownTableBodyCenter">Line instance under releasing transient state   </td></tr>
</table>
<p>Figure 5-6 illustrates the state transitions of an Audio Line instance. When an Audio Line instance is created, it initially enters the <em>Released</em> state as a temporary placeholder. It then transitions directly to the <em>Creating</em> state. Once the creation process is completed, the instance enters the <em>Created</em> state. From the <em>Created</em> state, an Audio Line instance can be released directly by transitioning from the <em>Releasing</em> state to the <em>Released</em> state, or it can be started on demand by transitioning from the <em>Starting</em> state to the <em>Started</em> state. An active Audio Line instance can be stopped on demand by transitioning from the <em>Stopping</em> state to the <em>Stopped</em> state.</p>
<div class="image">
<img src="Audio-Subsystem-Line-Lifecycle.jpg" alt="Audio-Subsystem-Line-Lifecycle.jpg"/>
</div>
 <center><div id="figure_5_6"><b>Figure 5-6 Audio Line Lifecycle</b></div></center><h3><a class="anchor" id="AudioSubsystem_Audio_Stream_Pipe"></a>
5.3 Audio Pipe</h3>
<p>The Audio Pipe provides a set of dedicated high-level APIs for codec conversion. Figure 5-7 below illustrates an overview of how the Audio Pipe operates across different modules. Each Audio Pipe instance retrieves the dedicated stream from the Application layer, converts the stream's codec format, and then returns the converted stream to the Application layer.</p>
<div class="image">
<img src="Audio-Subsystem-Pipe-Overview.jpg" alt="Audio-Subsystem-Pipe-Overview.jpg"/>
</div>
 <center><div id="figure_5_7"><b>Figure 5-7 Audio Pipe Overview</b></div></center><p>Table 5-5 lists the codec types supported by the Audio Pipe. The Audio Pipe not only only facilitates the conversion between different codec types but also enables the conversion of specific codec attributes within the same codec type.</p>
<center><div id="table_5_5"><b>Table 5-5 Codec Type Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_PCM  </td><td class="markdownTableBodyCenter">0x00   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_CVSD  </td><td class="markdownTableBodyCenter">0x01   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_MSBC  </td><td class="markdownTableBodyCenter">0x02   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_SBC  </td><td class="markdownTableBodyCenter">0x03   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_AAC  </td><td class="markdownTableBodyCenter">0x04   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_OPUS  </td><td class="markdownTableBodyCenter">0x05   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_FLAC  </td><td class="markdownTableBodyCenter">0x06   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_MP3  </td><td class="markdownTableBodyCenter">0x07   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_LC3  </td><td class="markdownTableBodyCenter">0x08   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_LDAC  </td><td class="markdownTableBodyCenter">0x09   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AUDIO_FORMAT_TYPE_LHDC  </td><td class="markdownTableBodyCenter">0x0A   </td></tr>
</table>
<h4><a class="anchor" id="AudioSubsystem_Audio_Stream_Pipe_Modeling"></a>
5.3.1 Pipe Modeling</h4>
<p>The Audio Pipe is designed to be based on the Audio Path component. As shown in Figure 5-8, the Audio Pipe utilizes the capabilities of the Audio Path component to configure and control the hardware routing. Therefore, the state of the Audio Pipe is synchronized with the state of the Audio Path.</p>
<blockquote class="doxtable">
<p><b>Notes</b><br />
 The Audio Pipe only controls Audio Path's Digital Domain, so the Audio Route is not included in the Audio Pipe's control. </p>
</blockquote>
<div class="image">
<img src="Audio-Subsystem-Pipe-Modeling.jpg" alt="Audio-Subsystem-Pipe-Modeling.jpg"/>
</div>
 <center><div id="figure_5_8"><b>Figure 5-8 Audio Pipe Modeling</b></div></center><h4><a class="anchor" id="AudioSubsystem_Audio_Stream_Pipe_Lifecycle"></a>
5.3.2 Pipe Lifecycle</h4>
<p>Each instance of Audio Pipe follows a specific lifecycle defined by the following states: Released, Creating, Created, Starting, Started, Stopping, Stopped, and Releasing. The definitions of these states are provided in Table 5-4.</p>
<center><div id="table_5_6"><b>Table 5-6 Audio Pipe State Enumerations</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">State  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Released  </td><td class="markdownTableBodyCenter">Pipe instance not existed or destroyed already   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Creating  </td><td class="markdownTableBodyCenter">Pipe instance under creating transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Created  </td><td class="markdownTableBodyCenter">Pipe instance created and statical resources allocated   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Starting  </td><td class="markdownTableBodyCenter">Pipe instance under starting transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Started  </td><td class="markdownTableBodyCenter">Pipe instance started and underlying hardware enabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Stopping  </td><td class="markdownTableBodyCenter">Pipe instance under stopping transient state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Stopped  </td><td class="markdownTableBodyCenter">Pipe instance stopped and underlying hardware disabled   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Releasing  </td><td class="markdownTableBodyCenter">Pipe instance under releasing transient state   </td></tr>
</table>
<p>Figure 5-9 illustrates the state transitions of an Audio Pipe instance. When an Audio Pipe instance is created, it initially enters the <em>Released</em> state as a temporary placeholder. It then transitions directly to the <em>Creating</em> state. Once the creation process is completed, the instance enters the <em>Created</em> state. From the <em>Created</em> state, an Audio Pipe instance can be released directly by transitioning from the <em>Releasing</em> state to the <em>Released</em> state, or it can be started on demand by transitioning from the <em>Starting</em> state to the <em>Started</em> state. An active Audio Pipe instance can be stopped on demand by transitioning from the <em>Stopping</em> state to the <em>Stopped</em> state.</p>
<div class="image">
<img src="Audio-Subsystem-Pipe-Lifecycle.jpg" alt="Audio-Subsystem-Pipe-Lifecycle.jpg"/>
</div>
 <center><div id="figure_5_9"><b>Figure 5-9 Audio Pipe Lifecycle</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Notification"></a>
6 Notification</h2>
<p>Notifications are audio messages that are short and urgent for users. Currently, the Audio Subsystem supports three types of notifications:</p><ol type="1">
<li>Ringtone - generated by the Frequency Modulation (FM) synthesizer.</li>
<li>Voice Prompt - pre-recorded voice interaction data.</li>
<li>TTS - text speech generated by the speech synthesizer.</li>
</ol>
<p>The Notification module within the Audio Subsystem operates asynchronously. The Application can trigger multiple notification instances with the same or different notification types. As shown in Figure 6-1, the Application invokes Notification APIs to play, stop, cancel, or flush notifications. These activities are then serialized into a queue by the Notification Activity Manager. The Notification Scheduler receives requests from the Notification Activity Manager and controls the lifecycle of Notification instances by performing the following tasks:</p><ol type="1">
<li>Manipulating the Notification Buffers attached to Notification instances</li>
<li>Manipulating the Audio Paths attached to Notification instances</li>
</ol>
<div class="image">
<img src="Audio-Subsystem-Notification-Architecture.jpg" alt="Audio-Subsystem-Notification-Architecture.jpg"/>
</div>
 <center><div id="figure_6_1"><b>Figure 6-1 Notification Architecture</b></div></center><h3><a class="anchor" id="AudioSubsystem_Notification_Ringtone"></a>
6.1 Ringtone</h3>
<p>A Ringtone is a sine-wave synthesized sound used for notifications, alarms, prompts, or other situations. The APIs used to control the Ringtone are illustrated in Figure 6-2. The Application should follow the control flow outlined below:</p><ol type="1">
<li>The Application invokes the <a class="el" href="group___a_u_d_i_o___r_i_n_g_t_o_n_e.html#ga29bba7093647dcc40608aefff83553a8">ringtone_play</a> API to trigger the start procedure.</li>
<li>The Notification module pushes this Ringtone activity into the queue.</li>
<li>If the Notification module is busy, the activity is pended for rescheduling. Otherwise, the activity is popped from the queue.</li>
<li>The specific Ringtone coefficients are loaded from storage.</li>
<li>The Ringtone Audio Path is started, and the loaded Ringtone coefficients are freed.</li>
<li>The Application can stop the playing Ringtone by invoking the <a class="el" href="group___a_u_d_i_o___r_i_n_g_t_o_n_e.html#ga5c4774446c08d07d802bfbdae7b2dc7b">ringtone_stop</a> API.</li>
</ol>
<div class="image">
<img src="Audio-Subsystem-Notification-Ringtone-Control-Flow.jpg" alt="Audio-Subsystem-Notification-Ringtone-Control-Flow.jpg"/>
</div>
 <center><div id="figure_6_2"><b>Figure 6-2 Ringtone Control Flow</b></div></center><h3><a class="anchor" id="AudioSubsystem_Notification_VoicePrompt"></a>
6.2 Voice Prompt</h3>
<p>A Voice Prompt is used to play voice files in the required languages. It is used for notifications, alarms, user confirmations, and other situations that require voice prompts. The APIs used to control the Voice Prompt are illustrated in Figure 6-3. The Application should follow the control flow outlined below:</p><ol type="1">
<li>The Application invokes the <a class="el" href="group___a_u_d_i_o___v_o_i_c_e___p_r_o_m_p_t.html#ga98b2ceb688ad91f730104ae0fdb4a3ad">voice_prompt_play</a> API to trigger the start procedure.</li>
<li>The Notification module pushes this Voice Prompt activity into the queue.</li>
<li>If the Notification module is busy, the activity is pended for rescheduling. Otherwise, the activity is popped from the queue.</li>
<li>The specific Voice Prompt header is parsed from storage.</li>
<li>The Notification Buffer is attached to the Voice Prompt instance.</li>
<li>The Voice Prompt Audio Path is started.</li>
<li>The Application can stop the playing Voice Prompt by invoking the <a class="el" href="group___a_u_d_i_o___v_o_i_c_e___p_r_o_m_p_t.html#gaa1707c2d40edbb47eba82145a71f1d91">voice_prompt_stop</a> API.</li>
</ol>
<div class="image">
<img src="Audio-Subsystem-Notification-VoicePrompt-Control-Flow.jpg" alt="Audio-Subsystem-Notification-VoicePrompt-Control-Flow.jpg"/>
</div>
 <center><div id="figure_6_3"><b>Figure 6-3 Voice Prompt Control Flow</b></div></center><h3><a class="anchor" id="AudioSubsystem_Notification_TTS"></a>
6.3 TTS</h3>
<p>Text-to-Speech (TTS) synthesizes speech from normal language text for playback or to create voice files. The APIs used to control the TTS are illustrated in Figure 6-4. The Application should follow the control flow outlined below:</p><ol type="1">
<li>The Application invokes the <a class="el" href="group___a_u_d_i_o___t_t_s.html#ga1438e592e03c89405cba7b1fdb00a210">tts_start</a> API to trigger the start procedure.</li>
<li>The Notification module pushes this TTS activity into the queue.</li>
<li>If the Notification module is busy, the activity is pended for rescheduling. Otherwise, the activity is popped from the queue.</li>
<li>The Notification Buffer is attached to the TTS instance.</li>
<li>The TTS Audio Path is started.</li>
<li>The Application can stop the playing TTS by invoking the <a class="el" href="group___a_u_d_i_o___t_t_s.html#ga4dd06b8bc75a3fd651a05af2a21c7583">tts_stop</a> API.</li>
</ol>
<blockquote class="doxtable">
<p><b>Notes</b><br />
 TTS and Voice Prompt have similar procedures within the Notification Module. Their main difference between them is that Voice Prompt's stream source is from flash, while TTS's stream source is from the Application layer. </p>
</blockquote>
<div class="image">
<img src="Audio-Subsystem-Notification-TTS-Control-Flow.jpg" alt="Audio-Subsystem-Notification-TTS-Control-Flow.jpg"/>
</div>
 <center><div id="figure_6_4"><b>Figure 6-4 TTS Control Flow</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Signal"></a>
7 Audio Signal</h2>
<p>TBD.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Audio_Volume"></a>
8 Audio Volume</h2>
<p>TBD.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Effect"></a>
9 Audio Effect</h2>
<p>TBD.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="AudioSubsystem_Probe"></a>
10 Audio Probe</h2>
<p>TBD. </p>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
