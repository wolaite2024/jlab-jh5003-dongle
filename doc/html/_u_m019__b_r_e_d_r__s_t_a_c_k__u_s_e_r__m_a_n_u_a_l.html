<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="BREDR_Page"></a>
BREDR Stack User Manual    </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.3</b></center><p><br />
 </p><center><b>2024/01/25</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Revision"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0  </td><td class="markdownTableBodyCenter">2023/07/01  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/08/25  </td><td class="markdownTableBodyCenter">Delete repetitive term   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/09/28  </td><td class="markdownTableBodyCenter">Rename document title   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.3  </td><td class="markdownTableBodyCenter">2024/01/25  </td><td class="markdownTableBodyCenter">Add authentication method mapping table   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Revision">Revision History</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Table_List">Table List</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Introduction">1 Overview</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Management">2 BR/EDR Device Management</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#Bluetooth_Device_Address">2.1 Bluetooth Device Address</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#Bluetooth_Device_Address_Config">2.1.1 Bluetooth Device Address Configuration</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Name">2.2 BR/EDR Device Name</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Name_Config">2.2.1 BR/EDR Device Name Configuration</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Name_Read">2.2.2 BR/EDR Device Name Reading</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_COD">2.3 BR/EDR Class of Device</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Mode">2.4 BR/EDR Device Mode</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Mode_Config">2.4.1 BR/EDR Device Mode Configuration</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Mode_Read">2.4.2 BR/EDR Device Mode Reading</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Discovery">2.5 BR/EDR Device Discovery</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_One_Time_Inquiry">2.5.1 BR/EDR One-Time Inquiry</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Periodic_Inquiry">2.5.2 BR/EDR Periodic Inquiry</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Security_Management">2.6 BR/EDR Security Management</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Pairing_Mode">2.6.1 Pairing Mode</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Pairing_Mode_Auth_Req">2.6.2 Pairing Mode Authentication Requirements</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_IO_Cap">2.6.3 IO Capabilities</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_OOB_Data">2.6.4 OOB Data</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Bond_Information_management">2.6.5 BR/EDR Bond Information Management</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Initialization">2.7 BR/EDR Device Initialization</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Parameters_Initialization">2.7.1 BR/EDR Device Parameters Initialization</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Startup_Flow">2.7.2 BR/EDR Device Startup Flow</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP">3 BR/EDR SDP</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP_Capacity">3.1 BR/EDR SDP Capacity</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_ID_Discovery">3.1.1 BR/EDR Device Identification Discovery</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Profile_Service_Discovery">3.1.2 BR/EDR Profile Service Discovery</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP_Data_Representation">3.2 BR/EDR SDP Data Representation</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP_Attr_ID">3.2.1 Attribute ID</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP_Attr_Val">3.2.2 Attribute Value</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP_Data_Element">3.2.3 Data Element</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP_INIT">3.3 BR/EDR SDP Initialization</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Link_Management">4 BR/EDR Link Management</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Link_Establishment">4.1 BR/EDR Link Establishment</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Link_Creation">4.1.1 Link Creation</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Link_Auth_Encrypt">4.1.2 Link Authentication And Encryption</a></li>
</ul>
</li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Link_Control">4.2 BR/EDR Link Control</a><ul>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Role_Switch">4.2.1 Role Switch</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_QoS_Config">4.2.2 QoS Configuration</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Pkt_Type_Config">4.2.3 Packet Type Configuration</a></li>
<li><a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Sniff_Mode_Config">4.2.4 BR/EDR Link Sniff Mode Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_2_1">Table 2-1 Relationship Between Scan Interval and Page Scan Repetition Modes</a></li>
<li><a href="#table_2_2">Table 2-2 User Input Capabilities</a></li>
<li><a href="#table_2_3">Table 2-3 User Output Capabilities</a></li>
<li><a href="#table_2_4">Table 2-4 IO Capability Mapping</a></li>
<li><a href="#table_2_5">Table 2-5 Authentication Method Mapping</a></li>
<li><a href="#table_3_1">Table 3-1 Device ID Service Record Attributes</a></li>
<li><a href="#table_3_2">Table 3-2 Data Element Type Descriptor</a></li>
<li><a href="#table_3_3">Table 3-3 Data Element Size Descriptor</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_1">Figure 1-1 Bluetooth BR/EDR Stack Architecture</a></li>
<li><a href="#figure_2_1">Figure 2-1 Bluetooth Device Address Config in MCU Config Tool</a></li>
<li><a href="#figure_2_2">Figure 2-2 BR/EDR Device Name Config in MCU Config Tool</a></li>
<li><a href="#figure_2_3">Figure 2-3 Read Remote BR/EDR Device Name</a></li>
<li><a href="#figure_2_4">Figure 2-4 BR/EDR Class of Device Structure</a></li>
<li><a href="#figure_2_5">Figure 2-5 BR/EDR Device Mode State</a></li>
<li><a href="#figure_2_6">Figure 2-6 BR/EDR Device Mode Configuration</a></li>
<li><a href="#figure_2_7">Figure 2-7 Continuous Configuring BR/EDR Device Mode</a></li>
<li><a href="#figure_2_8">Figure 2-8 BR/EDR One-Time Inquiry Flow</a></li>
<li><a href="#figure_2_9">Figure 2-9 BR/EDR One-Time Inquiry Cancel Flow</a></li>
<li><a href="#figure_2_10">Figure 2-10 BR/EDR One-Time Inquiry Cancel When Finished</a></li>
<li><a href="#figure_2_11">Figure 2-11 BR/EDR Periodic Inquiry Flow</a></li>
<li><a href="#figure_2_12">Figure 2-12 OOB Data Block Format</a></li>
<li><a href="#figure_2_13">Figure 2-13 BR/EDR Read Extended OOB Data</a></li>
<li><a href="#figure_2_14">Figure 2-14 BR/EDR Read OOB Data</a></li>
<li><a href="#figure_2_15">Figure 2-15 BR/EDR Maximum Bond Number Configuration</a></li>
<li><a href="#figure_3_1">Figure 3-1 BR/EDR SDP Client-Server Interaction</a></li>
<li><a href="#figure_3_2">Figure 3-2 BR/EDR DID Discovery Flow</a></li>
<li><a href="#figure_3_3">Figure 3-3 BR/EDR DID Discovery Terminate Flow</a></li>
<li><a href="#figure_3_4">Figure 3-4 BR/EDR Profile Service Discovery Flow</a></li>
<li><a href="#figure_3_5">Figure 3-5 BR/EDR Profile Service Discovery Terminate Flow</a></li>
<li><a href="#figure_3_6">Figure 3-6 BR/EDR Service Record</a></li>
<li><a href="#figure_4_1">Figure 4-1 BR/EDR Link Creation</a></li>
<li><a href="#figure_4_2">Figure 4-2 BR/EDR Link Pairing Flow</a></li>
<li><a href="#figure_4_3">Figure 4-3 BR/EDR Link Authentication Encryption With Link Key</a></li>
<li><a href="#figure_4_4">Figure 4-4 BR/EDR Link Role Switch</a></li>
<li><a href="#figure_4_5">Figure 4-5 BR/EDR Link Configure QoS</a></li>
<li><a href="#figure_4_6">Figure 4-6 BR/EDR Link Configure Packet Type</a></li>
<li><a href="#figure_4_7">Figure 4-7 BR/EDR Link Enable Sniff Mode</a></li>
<li><a href="#figure_4_8">Figure 4-8 BR/EDR Link Disable Sniff Mode</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BD_ADDR  </td><td class="markdownTableBodyCenter">Bluetooth device address   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">L2CAP  </td><td class="markdownTableBodyCenter">Logical Link Control And Adaptation protocol   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MITM  </td><td class="markdownTableBodyCenter">Man in The Middle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SMP  </td><td class="markdownTableBodyCenter">Security Manager protocol   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">OOB  </td><td class="markdownTableBodyCenter">Out of Band   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOC  </td><td class="markdownTableBodyCenter">System on Chip   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MCU  </td><td class="markdownTableBodyCenter">Microprogrammed Control Unit   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">EIR  </td><td class="markdownTableBodyCenter">Extended Inquiry Response   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">COD  </td><td class="markdownTableBodyCenter">Class of Device   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">DID  </td><td class="markdownTableBodyCenter">Device Identification   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SDP  </td><td class="markdownTableBodyCenter">Service Discovery Protocol   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">QoS  </td><td class="markdownTableBodyCenter">Quality of Service   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Introduction"></a>
1 Overview</h2>
<p>The purpose of this document is to give an overview of Bluetooth BR/EDR Stack APIs. <br />
</p>
<div class="image">
<img src="BREDR_Stack_Arch.png" alt="BREDR_Stack_Arch.png"/>
</div>
 <center><div id="figure_1_1"><b>Figure 1-1 Bluetooth BR/EDR Stack Architecture </b></div></center><p>As shown in Figure 1-1 above, Bluetooth BR/EDR Stack APIs can be divided into several modules: Device Management APIs, Service Discovery Protocol (SDP) APIs and BR/EDR Link Management APIs.<br />
 Applications can interact with BR/EDR stack through Device Management/SDP/Link Manager APIs &amp; Callback message. <br />
</p>
<p>Device Management APIs will be introduced in <a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Device_Management">2 BR/EDR Device Management</a>. SDP APIs will be introduced in <a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_SDP">3 BR/EDR SDP</a>. BR/EDR Link Management APIs will be introduced in <a class="el" href="_u_m019__b_r_e_d_r__s_t_a_c_k__u_s_e_r__m_a_n_u_a_l.html#BREDR_Link_Management">4 BR/EDR Link Management</a>.<br />
</p>
<p>Application shall call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> and <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a> to configure BR/EDR Stack parameters before stack initialization, and application shall call <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga337f0e91aaa1af727c165620e64d91af">gap_start_bt_stack</a> to trigger stack initialization. After stack initialization, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a9320e2b7e774c93377720bf3327f7b5e">BT_EVENT_READY</a> event.<br />
</p>
<blockquote class="doxtable">
<p><b>Notes</b>: There is an ongoing process of restructuring the BR/EDR stack APIs. Some APIs within application folder are being moved to more suitable locations or encapsulated. </p>
</blockquote>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Device_Management"></a>
2 BR/EDR Device Management</h2>
<p>The BR/EDR Device Management defines the common requirements related to modes and access procedures. The BR/EDR Device Management will be introduced in the following several parts:<br />
</p><ul>
<li>Bluetooth device address. <br />
</li>
<li>BR/EDR device name. <br />
</li>
<li>Class of device. <br />
</li>
<li>BR/EDR device mode. <br />
</li>
<li>BR/EDR device discovery. <br />
</li>
<li>Security management. <br />
</li>
<li>Device initialization flow. <br />
</li>
</ul>
<h3><a class="anchor" id="Bluetooth_Device_Address"></a>
2.1 Bluetooth Device Address</h3>
<p>Each Bluetooth device shall be allocated a unique 48-bit Bluetooth device address (BD_ADDR). The BD_ADDR uniquely identifies the device to another Bluetooth device. The BD_ADDR shall be a 48-bit extended unique identifier(EUI-48) created in accordance with section 8.2 ("Universal addresses") of <a href="http://standards.ieee.org/findstds/standard/802-2014.html">The IEEE 802-2014 Standard</a>. <br />
</p>
<h4><a class="anchor" id="Bluetooth_Device_Address_Config"></a>
2.1.1 Bluetooth Device Address Configuration</h4>
<p>As shown in Figure 2-1, user can configure BR/EDR device address in MCU config tool.<br />
 </p><div class="image">
<img src="config_bd_addr_in_mcu_config.png" alt="config_bd_addr_in_mcu_config.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Bluetooth Device Address Config in MCU Config Tool </b></div></center><p>The Bluetooth device address configured in MCU config tool will be set directly to stack layer. After stack initialization, the application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a9320e2b7e774c93377720bf3327f7b5e">BT_EVENT_READY</a> event with parameter Bluetooth device address currently used. The application shall call the API <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#gac87b4ee1f2402d027a460374377a302f">gap_set_bd_addr</a> to set Bluetooth device address after stack initialization.<br />
</p>
<h3><a class="anchor" id="BREDR_Device_Name"></a>
2.2 BR/EDR Device Name</h3>
<p>The BR/EDR device name is the user-friendly name that a Bluetooth device exposes to remote devices.<br />
</p>
<h4><a class="anchor" id="BREDR_Device_Name_Config"></a>
2.2.1 BR/EDR Device Name Configuration</h4>
<p>As shown in Figure 2-2, user can configure BR/EDR device name in MCU config tool.<br />
 </p><div class="image">
<img src="config_br_name_in_mcu_config.png" alt="config_br_name_in_mcu_config.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 BR/EDR Device Name Config in MCU Config Tool </b></div></center><p> The maximum length of BR/EDR device name is 40 bytes. Application shall call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a79f332b77ae9d9b8d597b2a57e75c76e">GAP_BR_PARAM_NAME</a> to configure BR/EDR Device Name before stack initialization. After stack initialization, application shall call the API <a class="el" href="group___b_t___b_t_m.html#gadd3eae2a3d76ab91530b3690eeee65e4">bt_local_name_set</a> to set BR/EDR device name at runtime.<br />
</p>
<h4><a class="anchor" id="BREDR_Device_Name_Read"></a>
2.2.2 BR/EDR Device Name Reading</h4>
<p>Application can call <a class="el" href="group___b_t___b_t_m.html#ga2b74de92eb812cb87e7380480285d8b0">bt_remote_name_req</a> to obtain the user-friendly name of another BR/EDR device. As shown in Figure 2-3, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aaf7bc9852c9d36ea59208457d70f7dd6">BT_EVENT_REMOTE_NAME_RSP</a> event after remote name request procedure finished. <br />
 </p><div class="image">
<img src="br-remote-name-req.png" alt="br-remote-name-req.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Read Remote BR/EDR Device Name </b></div></center><blockquote class="doxtable">
<p><b>Notes</b>: The parameter name in <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aaf7bc9852c9d36ea59208457d70f7dd6">BT_EVENT_REMOTE_NAME_RSP</a> event is a null-terminated (0x00) string.<br />
 </p>
</blockquote>
<h3><a class="anchor" id="BREDR_COD"></a>
2.3 BR/EDR Class of Device</h3>
<p>Class of device is used to indicate the type of device. The Class of device is composed of four fields: A major service classes bitfield, a major device class enumerated value, the minor device classes, and a fixed value of 0b00 in the two least significant bits. The structure of the Class of Device is defined in Figure 2-4: </p><div style="page-break-after: always;"></div> <div class="image">
<img src="br-cod-structure.png" alt="br-cod-structure.png"/>
</div>
 <center><div id="figure_2_4"><b>Figure 2-4 BR/EDR Class of Device Structure </b></div></center><p>The format of the Minor Device Class is determined by the Major Device Class value. The major and minor device class field should not be used to determine whether a device supports any specific service(s). The terms for the defined major service classes, major device classes and minor device classes are defined in <a href="https://www.bluetooth.com/specifications/assigned-numbers/">Bluetooth Assigned-Numbers</a>.</p>
<p>Application shall call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ac1d1f37e9c1617fd60a364a20eaba32b">GAP_BR_PARAM_COD</a> to configure class of device before stack initialization.<br />
</p>
<h3><a class="anchor" id="BREDR_Device_Mode"></a>
2.4 BR/EDR Device Mode</h3>
<p>Users can change the connectivity and discoverability of the device by configuring device mode.<br />
 Ther are four device mode:</p><ul>
<li><a class="el" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31a0e7b1e29fedb6eface96d7c71db00989">BT_DEVICE_MODE_IDLE</a> - Undiscoverable and non-connectable mode. <br />
</li>
<li><a class="el" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31a3040d880a897949b8e53ec2d27c46922">BT_DEVICE_MODE_DISCOVERABLE</a> - Discoverable and non-connectable mode. <br />
</li>
<li><a class="el" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31a4da9889e30eacedd3d5c236afe5d73c6">BT_DEVICE_MODE_CONNECTABLE</a> - Undiscoverable and connectable mode. <br />
</li>
<li><a class="el" href="group___b_t___b_t_m.html#ggad908458f246b75e84b49543f93c92b31ab1e48ea0abec2793a2af9d89a7232ff2">BT_DEVICE_MODE_DISCOVERABLE_CONNECTABLE</a> - Discoverable and connectable mode. <br />
</li>
</ul>
<p>As shown in Figure 2-5, the four device mode can be switched unconditionally. </p><div class="image">
<img src="br-device-mode-state.png" alt="br-device-mode-state.png"/>
</div>
 <center><div id="figure_2_5"><b>Figure 2-5 BR/EDR Device Mode State </b></div></center><h4><a class="anchor" id="BREDR_Device_Mode_Config"></a>
2.4.1 BR/EDR Device Mode Configuration</h4>
<p>The default device mode in stack is undiscoverable and non-connectable mode. Application shall call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a912576c7b52d02eda942686609844422">GAP_BR_PARAM_RADIO_MODE</a> to configure default device mode when initializing BR/EDR device parameters. <br />
 </p><blockquote class="doxtable">
<p><b>Notes</b>: The device mode should be set to undiscoverable and non-connectable mode before stack initialized.<br />
 </p>
</blockquote>
<p>After stack initialization, application shall call <a class="el" href="group___b_t___b_t_m.html#ga0406bce24375ca0f2c090bb7517e2323">bt_device_mode_set</a> to configure BR/EDR device mode at runtime. And application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a6f06e7667b17bcb8fd499bfb04c9fba4">BT_EVENT_DEVICE_MODE_RSP</a> event after device mode configuration. The device mode configuration prodecure described in Figure 2-6.<br />
 </p><div class="image">
<img src="br-device-mode-configure.png" alt="br-device-mode-configure.png"/>
</div>
 <center><div id="figure_2_6"><b>Figure 2-6 BR/EDR Device Mode Configuration </b></div></center><p>As shown in Figure 2-7, application can trigger next device mode configuration before receiving <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a6f06e7667b17bcb8fd499bfb04c9fba4">BT_EVENT_DEVICE_MODE_RSP</a> event, as the API <a class="el" href="group___b_t___b_t_m.html#ga0406bce24375ca0f2c090bb7517e2323">bt_device_mode_set</a> can pend the latest device mode configuration command. And the pending device mode will be set automatically after last device mode configuration. <br />
 </p><div class="image">
<img src="br-device-mode-configure-continuously.png" alt="br-device-mode-configure-continuously.png"/>
</div>
 <center><div id="figure_2_7"><b>Figure 2-7 Continuous Configuring BR/EDR Device Mode </b></div></center><p>Application can change the discoverable mode parameters and connectable mode parameters as required. <br />
</p>
<p>The discoverable mode parameters include Inquiry_Scan_Type, Inquiry_Scan_Interval and Inquiry_Scan_Window parameters. <br />
</p>
<ul>
<li>Inquiry_Scan_Type<ul>
<li>The Inquiry_Scan_Type configuration parameter indicates whether inquiry scanning will be done using non-interlaced scan or interlaced scan. If the scan interval is not at least twice the scan window then generalized interlaced scan shall not be used.</li>
<li>The defaulte vaule is <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga05c1d4877e4a671063a54ae911f34ca8a5cdc3b787720e453c46007f28286e95c">GAP_INQUIRY_SCAN_TYPE_INTERLACED</a>.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146abdd3008779778280db99fdd7644359c3">GAP_BR_PARAM_INQUIRY_SCAN_TYPE</a> to configure default Inquiry_Scan_Type when initializing BR/EDR device parameters. And the recommended value is <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga05c1d4877e4a671063a54ae911f34ca8a5cdc3b787720e453c46007f28286e95c">GAP_INQUIRY_SCAN_TYPE_INTERLACED</a>.</li>
</ul>
</li>
<li>Inquiry_Scan_Interval<ul>
<li>The Inquiry_Scan_Interval configuration parameter defines the amount of time between consecutive inquiry scans. This is defined as the time interval from when the BR/EDR Controller started its last inquiry scan until it begins the next inquiry scan.</li>
<li>The Inquiry_Scan_Interval range from 0x0012 to 0x1000 in 625us slot unit; and only even values are valid. The default value is 0x1000.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ac4e288adf29bc1be3d7018762a8ee8c0">GAP_BR_PARAM_INQUIRY_SCAN_INTERVAL</a> to configure default Inquiry_Scan_Interval when initializing BR/EDR device parameters. And the recommended value is 0x1000.</li>
</ul>
</li>
<li>Inquiry_Scan_Window<ul>
<li>The Inquiry_Scan_Window configuration parameter defines the amount of time for the duration of the inquiry scan. The Inquiry_Scan_Window can only be less than or equal to the Inquiry_Scan_Interval.</li>
<li>The Inquiry_Scan_Window range from 0x0011 to Inquiry_Scan_Interval in 625us slot unit. The default value is 0x12.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ae0586216befadb6fe9fb7753f644747b">GAP_BR_PARAM_INQUIRY_SCAN_WINDOW</a> to configure default Inquiry_Scan_Window when initializing BR/EDR device parameters. And the recommended value is 0x12.</li>
</ul>
</li>
</ul>
<p>The connectable mode parameters include Page_Scan_Type, Page_Scan_Interval and Page_Scan_Window parameters.</p><ul>
<li>Page_Scan_Type<ul>
<li>The Page_Scan_Type parameter indicates whether page scanning will be done using non-interlaced scan or interlaced scan. If the scan interval is not at least twice the scan window, then generalized interlaced scan shall not be used.</li>
<li>The defaulte vaule is <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga8a3e921da25496e99f3f718d82eeac35ae8144c6f6f36312e5d28e1771160cb36">GAP_PAGE_SCAN_TYPE_STANDARD</a>.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146aca39b87645c90bb4d852f8a5c1f4730d">GAP_BR_PARAM_PAGE_SCAN_TYPE</a> to configure default Page_Scan_Type when initializing BR/EDR device parameters. And the recommended value is <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga8a3e921da25496e99f3f718d82eeac35ac62e453f8f4c98a29647e269ac66a995">GAP_PAGE_SCAN_TYPE_INTERLACED</a>.</li>
</ul>
</li>
<li>Page_Scan_Interval<ul>
<li>The Page_Scan_Interval configuration parameter defines the amount of time between consecutive page scans. This time interval is defined from when the Controller started its last page scan until it begins the next page scan.</li>
<li>The Page_Scan_Interval range from 0x0012 to 0x1000 in 625us slot unit; and only even values are valid. The default value is 0x800.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a662cfb3a079acab6eab89b7150c860e3">GAP_BR_PARAM_PAGE_SCAN_INTERVAL</a> to configure default Page_Scan_Interval when initializing BR/EDR device parameters. And the recommended value is 0x800.</li>
</ul>
</li>
<li>Page_Scan_Window<ul>
<li>The Page_Scan_Window configuration parameter defines the amount of time for the duration of the page scan. The Page_Scan_Window can only be less than or equal to the Page_Scan_Interval.</li>
<li>The Page_Scan_Window range from 0x0011 to Page_Scan_Interval in 625us slot unit. The default value is 0x12.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a74543c81043ff458b7eadb900a86353d">GAP_BR_PARAM_PAGE_SCAN_WINDOW</a> to configure default Page_Scan_Window when initializing BR/EDR device parameters. And the recommended value is 0x12.</li>
</ul>
</li>
<li>Page_Scan_Repetition_Mode<ul>
<li>The Page_Scan_Repetition_Mode configuration parameter indicates the interval between two consecutive page scan windows. The relationship between scan interval and page scan repetition modes are shown in Table 2-1.</li>
<li>The deafult value is <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga5efd5ff3bc58b9c929669cd1b2e16582a6d95d56ddc0f1f082b1ca5e3c8e2a2c4">GAP_PAGE_SCAN_REPETITION_R2</a>.</li>
<li>Application can call <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a> with parameter <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga6f8fd9e3693bfbe6df27b23771759146">T_GAP_BR_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a3bfaea393846c476f152b4550b215c08">GAP_BR_PARAM_PAGE_SCAN_REPETITION_MODE</a> to configure default Page_Scan_Repetition_Mode when initializing BR/EDR device parameters. And the recommended value is <a class="el" href="group___g_a_p___b_r_e_d_r.html#gga5efd5ff3bc58b9c929669cd1b2e16582a8e82521c999acc11f16e0133d0f5bcbc">GAP_PAGE_SCAN_REPETITION_R1</a>.</li>
</ul>
</li>
</ul>
<center><div id="table_2_1"><b>Table 2-1 Relationship Between Scan Interval and Page Scan Repetition Modes </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Page Scan Repetition Modes  </th><th class="markdownTableHeadLeft">Page Scan Interval   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">R0  </td><td class="markdownTableBodyLeft">less than or equal to 1.28 s and equal to Tw_page_scan   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">R1  </td><td class="markdownTableBodyLeft">less than or equal to 1.28 s   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">R2  </td><td class="markdownTableBodyLeft">less than or equal to 2.56 s   </td></tr>
</table>
<h4><a class="anchor" id="BREDR_Device_Mode_Read"></a>
2.4.2 BR/EDR Device Mode Reading</h4>
<p>After stack initialization, Application can call <a class="el" href="group___b_t___b_t_m.html#gaa2df726efb4c2a110407417ebf98ae85">bt_device_mode_get</a> to get current device mode at runtime. <br />
 </p><blockquote class="doxtable">
<p><b>Notes</b>: The device mode obtained by <a class="el" href="group___b_t___b_t_m.html#gaa2df726efb4c2a110407417ebf98ae85">bt_device_mode_get</a> may be meaningless quickly if there is a device mode configuration in process. <br />
 </p>
</blockquote>
<h3><a class="anchor" id="BREDR_Device_Discovery"></a>
2.5 BR/EDR Device Discovery</h3>
<p>The purpose of the BR/EDR device discovery procedure is to provide the initiator with the BR/EDR device address, Class of Device, Receive Signal Strength Indicator, and extended inquiry response information of devices in discoverable mode.</p>
<h4><a class="anchor" id="BREDR_One_Time_Inquiry"></a>
2.5.1 BR/EDR One-Time Inquiry</h4>
<div class="image">
<img src="br-one-time-inquiry.png" alt="br-one-time-inquiry.png"/>
</div>
 <center><div id="figure_2_8"><b>Figure 2-8 BR/EDR One-Time Inquiry Flow </b></div></center><p> As shown in Figure 2-8 above, application can call <a class="el" href="group___b_t___b_t_m.html#ga9c75bb34e9ff923b2b7f6f3481513261">bt_inquiry_start</a> to start an one-time inquiry procedure. <br />
 After one-time inquiry started successfully, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aa3d8017137963ff899732c17758436f6">BT_EVENT_INQUIRY_RSP</a> event with cause 0x0, otherwise, the one-time inquiry started failed. After one-time inquiry started successfully, application will receive a <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a1572e8ef8f86afe074b86a9f250b5465">BT_EVENT_INQUIRY_RESULT</a> event when a nearby device is found. Application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac1df112af3a1895bb49bf51417d7347e">BT_EVENT_INQUIRY_CMPL</a> event after one-time inquiry command finished. <br />
</p>
<p>As shown in Figure 2-9, application can stop the one-time inquiry procedure after receiving <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aa3d8017137963ff899732c17758436f6">BT_EVENT_INQUIRY_RSP</a> event with cause 0x0. Add application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a50bfc4676a06f999e1731e2c543f177e">BT_EVENT_INQUIRY_CANCEL_RSP</a> event after inquiry canceled. <br />
 </p><div class="image">
<img src="br-one-time-inquiry-cancel.png" alt="br-one-time-inquiry-cancel.png"/>
</div>
 <center><div id="figure_2_9"><b>Figure 2-9 BR/EDR One-Time Inquiry Cancel Flow </b></div></center><p>As stopping one-time inquiry is an asynchronous process, application may still receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a1572e8ef8f86afe074b86a9f250b5465">BT_EVENT_INQUIRY_RESULT</a> event after call <a class="el" href="group___b_t___b_t_m.html#gadfacf1c51778fff02d293e9fb8c8e9f7">bt_inquiry_stop</a> successfully. <br />
</p>
<p>As shown in Figure 2-10, if application calls <a class="el" href="group___b_t___b_t_m.html#gadfacf1c51778fff02d293e9fb8c8e9f7">bt_inquiry_stop</a> when one-time inquiry has been finished and application has not receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac1df112af3a1895bb49bf51417d7347e">BT_EVENT_INQUIRY_CMPL</a> event, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac1df112af3a1895bb49bf51417d7347e">BT_EVENT_INQUIRY_CMPL</a> event first and then <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a50bfc4676a06f999e1731e2c543f177e">BT_EVENT_INQUIRY_CANCEL_RSP</a> event. <br />
 </p><div class="image">
<img src="br-one-time-inquiry-cancel-when-cmpl.png" alt="br-one-time-inquiry-cancel-when-cmpl.png"/>
</div>
 <center><div id="figure_2_10"><b>Figure 2-10 BR/EDR One-Time Inquiry Cancel When Finished </b></div></center><h4><a class="anchor" id="BREDR_Periodic_Inquiry"></a>
2.5.2 BR/EDR Periodic Inquiry</h4>
<p>Periodic inquiry is used when the inquiry procedure is to be repeated periodically. <br />
</p>
<p>As shown in Figure 2-11, application can call <a class="el" href="group___b_t___b_t_m.html#gae53d3c224fc160e01fc38e404c2b5887">bt_periodic_inquiry_start</a> to start periodic inquiry. And application can call <a class="el" href="group___b_t___b_t_m.html#ga4cc0d97eda39fdf4b50e9f1eccb66019">bt_periodic_inquiry_stop</a> to stop periodic inquiry.<br />
 </p><div class="image">
<img src="br-periodic-inquiry.png" alt="br-periodic-inquiry.png"/>
</div>
 <center><div id="figure_2_11"><b>Figure 2-11 BR/EDR Periodic Inquiry Flow </b></div></center><p>The parameters Max_Period_Length and Min_Period_Length define the time range between two consecutive inquiries, from the beginning of an inquiry until the start of the next inquiry. The BR/EDR controller will use this range to determine a new random time between two consecutive inquiries for each inquiry. When each of the inquiry processes are completed, application will receive a <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac1df112af3a1895bb49bf51417d7347e">BT_EVENT_INQUIRY_CMPL</a> event which means the latest inquiry process has finished. <br />
</p>
<blockquote class="doxtable">
<p><b>Notes</b>: Max_Period_Length shall be greater than Min_Period_Length. Min_Period_Length shall be greater than Inquiry_Length. A device which responds during a periodic inquiry process will be reported to the application only once. </p>
</blockquote>
<h3><a class="anchor" id="BREDR_Security_Management"></a>
2.6 BR/EDR Security Management</h3>
<p>The BR/EDR security model includes five distinct security features: pairing, bonding, device authentication, encryption and message integrity. <br />
 <b>Pairing:</b> the process for creating one or more shared secret keys. <br />
 <b>Bonding:</b> the act of storing the keys created during pairing for use in subsequent connections in order to form a trusted device pair. <br />
 <b>Device authentication:</b> verification that the two devices have the same keys. <br />
 <b>Encryption:</b> message confidentiality. <br />
 <b>Message integrity:</b> protects against message forgeries. <br />
</p>
<p>The purpose of this chapter is to give an overview of security setting and bond information management. <br />
</p>
<p>Application should set appropriate security parameters according to the local features to ensure pairing, authentication, and encryption work properly. <br />
</p>
<h4><a class="anchor" id="BREDR_Pairing_Mode"></a>
2.6.1 Pairing Mode</h4>
<p>The pairing mode parameter is used to configure whether pairing with a new device is allowed. Application can call <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a> with parameter <a class="el" href="group___g_a_p___common___exported___types.html#ga6b5a306a5b8edce2b24cc7c6019073a2">T_GAP_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2ac1e0ac58313c76368f83ea15c17dfebc">GAP_PARAM_BOND_PAIRING_MODE</a> to configure pairing mode before stack initialization. <br />
</p>
<h4><a class="anchor" id="BREDR_Pairing_Mode_Auth_Req"></a>
2.6.2 Pairing Mode Authentication Requirements</h4>
<p>The authentication requirements are used to configure MITM and bonding flags. <br />
 To make sure authentication procedure work properly, application msut call <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a> with parameter <a class="el" href="group___g_a_p___common___exported___types.html#ga6b5a306a5b8edce2b24cc7c6019073a2">T_GAP_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2a4caada923b034620e0692e3b5cc0d1c2">GAP_PARAM_BOND_AUTHEN_REQUIREMENTS_FLAGS</a> to configure authentication requirements parameters before stack initialization. <br />
</p>
<h4><a class="anchor" id="BREDR_IO_Cap"></a>
2.6.3 IO Capabilities</h4>
<p>The I/O capabilities is used to set local input and output capabilities for device authentication. <br />
</p>
<p>The input and output capabilities are described in Table 2-2 and Table 2-3:</p>
<center><div id="table_2_2"><b>Table 2-2 User Input Capabilities </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Capability  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><div style="width:160px">No Input</div>  </td><td class="markdownTableBodyLeft">Device does not have the ability to indicate 'yes' or 'no'   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Yes / No  </td><td class="markdownTableBodyLeft">Device has at least two buttons that are mapped easily to 'yes' and 'no' or the <br />
 device has a mechanism whereby the user can indicate either 'yes' or 'no'   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Keyboard  </td><td class="markdownTableBodyLeft">Device has a numeric keyboard that can input the numbers '0' through '9' and a <br />
 confirmation. Device also has two buttons that can be easily mapped to 'yes' and <br />
 'no' or the device has a mechanism whereby the user can indicate either 'yes' or 'no'   </td></tr>
</table>
<center><div id="table_2_3"><b>Table 2-3 User Output Capabilities </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Capability  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><div style="width:160px">No Output</div>  </td><td class="markdownTableBodyLeft">Device does not have the ability to display or communicate a 6 digit decimal number   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Numeric Output  </td><td class="markdownTableBodyLeft">Device has the ability to display or communicate a 6 digit decimal number   </td></tr>
</table>
<p>To make sure authentication procedure work properly, application shall call <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a> with parameter <a class="el" href="group___g_a_p___common___exported___types.html#ga6b5a306a5b8edce2b24cc7c6019073a2">T_GAP_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2a85b5072df10e518def21aeca3d78e22a">GAP_PARAM_BOND_IO_CAPABILITIES</a> to configure IO capabilities parameters. <br />
 The mapping of input / output capabilities to IO capabilities is shown in Table 2-4: </p><div style="page-break-after: always;"></div> <center><div id="table_2_4"><b>Table 2-4 IO Capability Mapping </b></div></center> <table class="doxtable">
<tr>
<th colspan="2" rowspan="2"></th><th colspan="2" align="center">Local Output Capability  </th></tr>
<tr>
<th align="center">No Output </th><th align="center">Numeric Output  </th></tr>
<tr>
<th align="center" rowspan="3">Local Input Capacity </th><th align="center">No Input </th><td align="center">NoInputNoOutput </td><td align="center">DisplayOnly  </td></tr>
<tr>
<th align="center">Yes / No </th><td align="center">NoInputNoOutput </td><td align="center">DisplayYesNo  </td></tr>
<tr>
<th align="center">Keyboard </th><td align="center">KeyboardOnly </td><td align="center">DisplayYesNo  </td></tr>
</table>
<p>As shown in Table 2-5, The authentication method used is deterministic based on the I/O capabilities of the two devices.</p>
<center><div id="table_2_5"><b>Table 2-5 Authentication Method Mapping </b></div></center> <table class="doxtable">
<tr>
<th colspan="2" rowspan="2"></th><th colspan="4" align="center">Initiator  </th></tr>
<tr>
<th align="center">DisplayOnly </th><th align="center">DisplayYesNo </th><th align="center">KeyboardOnly </th><th align="center">NoInput<br />
NoOutput  </th></tr>
<tr>
<th align="center" rowspan="4">Responder </th><th align="center">DisplayOnly </th><td align="center">Numeric<br />
Comparison </td><td align="center">Numeric<br />
Comparison </td><td align="center">Passkey<br />
Entry </td><td align="center">Numeric<br />
Comparison  </td></tr>
<tr>
<th align="center">DisplayYesNo </th><td align="center">Numeric<br />
Comparison </td><td align="center">Numeric<br />
Comparison </td><td align="center">Passkey<br />
Entry </td><td align="center">Numeric<br />
Comparison  </td></tr>
<tr>
<th align="center">KeyboardOnly </th><td align="center">Passkey<br />
Entry </td><td align="center">Passkey<br />
Entry </td><td align="center">Passkey<br />
Entry </td><td align="center">Numeric<br />
Comparison  </td></tr>
<tr>
<th align="center">NoInput<br />
NoOutput </th><td align="center">Numeric<br />
Comparison </td><td align="center">Numeric<br />
Comparison </td><td align="center">Numeric<br />
Comparison </td><td align="center">Numeric<br />
Comparison  </td></tr>
</table>
<p>Application will receive the corresponding authentication method message in the callback function registered with <a class="el" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>.<br />
</p><ul>
<li>If application receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac64773cf38776fb9a2dbbb4338f017c8">BT_EVENT_LINK_USER_CONFIRMATION_REQ</a> event, application shall respond by calling <a class="el" href="group___g_a_p___b_r_e_d_r.html#ga8b248c5e5701624012d08c76749b59d0">gap_br_user_cfm_req_cfm</a>. Application can choose whether to require user confirmation based on the just_work parameter and local IO capabilities.<br />
</li>
<li>If application receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac33a9f2f62a7e2312d137e1d1486f217">BT_EVENT_LINK_USER_PASSKEY_REQ</a> event, application shall wait for user to enter the key and call gap_br_input_passkey to reply.<br />
</li>
<li>If application receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a949e869e01945bde353b06326be11fcf">BT_EVENT_LINK_USER_PASSKEY_NOTIF</a> event, application shall display the key in its UI terminal.<br />
</li>
</ul>
<h4><a class="anchor" id="BREDR_OOB_Data"></a>
2.6.4 OOB Data</h4>
<p>The Out of Band (OOB) association model is primarily designed for scenarios where an Out of Band mechanism is used to both discover the devices as well as to exchange or transfer cryptographic numbers used in the pairing process. <br />
</p>
<p>As shown in Figure 2-12, the contents of the OOB data block are:<br />
</p><ul>
<li>Mandatory contents: <br />
<ul>
<li>Length (2 bytes) <br />
</li>
<li>BD_ADDR (6 bytes) <br />
</li>
</ul>
</li>
<li>Optional contents: <br />
<ul>
<li>Class of Device (3 bytes) <br />
</li>
<li>Simple Pairing Hash C (16 bytes) <br />
</li>
<li>Simple Pairing Randomizer R (16 bytes) <br />
</li>
<li>Local name (variable length) <br />
</li>
<li>Other information <br />
</li>
</ul>
</li>
</ul>
<div class="image">
<img src="br-OOB-data-block-format.png" alt="br-OOB-data-block-format.png"/>
</div>
 <center><div id="figure_2_12"><b>Figure 2-12 OOB Data Block Format </b></div></center><blockquote class="doxtable">
<p><b>Notes</b>: The length field includes all bytes in the OOB data block including the length field itself. The BD_ADDR will be a fixed field in the beginning of the OOB data block. Following the BD_ADDR will be zero or more EIR tag fields containing optional contents. The EIR tag format will be used for the optional contents.<br />
 </p>
</blockquote>
<p>The OOB mechanism may be implemented as either read only or read/write. If one side is read only, a one-way authentication is performed. If both sides are read/write, a two-way authentication is performed. <br />
 Each OOB transfer will have unique C and R values. After each OOB transfer, application shall obtain a new set of values for the next OOB transfer. <br />
</p>
<p>Application should call <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a> with parameter <a class="el" href="group___g_a_p___common___exported___types.html#ga6b5a306a5b8edce2b24cc7c6019073a2">T_GAP_PARAM_TYPE</a> set to <a class="el" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2a2c6acd9336a3701fe2d0108e7e2478b1">GAP_PARAM_BOND_OOB_ENABLED</a> to configure whether OOB supported. <br />
</p>
<div class="image">
<img src="br-read-extended-OOB-data.png" alt="br-read-extended-OOB-data.png"/>
</div>
 <center><div id="figure_2_13"><b>Figure 2-13 BR/EDR Read Extended OOB Data</b></div></center><p>As shown in Figure 2-13 above, if OOB supported and <a class="el" href="group___b_o_n_d___m_i_t_m___d_e_f_i_n_e_s.html#ga916e8571ac8ea9183d5a1855b68dcfb2">GAP_AUTHEN_BIT_SC_BR_FLAG</a> has been set in authentication requirements, application shall call <a class="el" href="group___g_a_p___b_r_e_d_r.html#gad2e868f10da0ed3a58bb101134893668">gap_br_local_oob_extended_data_read</a> to collect OOB data, and <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac23b4438ba9d09c6f80f405d26fcbcff">BT_EVENT_LOCAL_OOB_EXTENDED_DATA_RSP</a> will be received. <br />
</p>
<p>As shown in Figure 2-14, if OOB supported and <a class="el" href="group___b_o_n_d___m_i_t_m___d_e_f_i_n_e_s.html#ga916e8571ac8ea9183d5a1855b68dcfb2">GAP_AUTHEN_BIT_SC_BR_FLAG</a> not be set in authentication requirements, application shall call gap_br_read_local_oob to collect OOB data, and <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ab8688ee002e7b419f37e5f7213db7bb9">BT_EVENT_LOCAL_OOB_DATA_RSP</a> will be received. <br />
 </p><div class="image">
<img src="br-read-OOB-data.png" alt="br-read-OOB-data.png"/>
</div>
 <center><div id="figure_2_14"><b>Figure 2-14 BR/EDR Read OOB Data</b></div></center><h4><a class="anchor" id="BREDR_Bond_Information_management"></a>
2.6.5 BR/EDR Bond Information Management</h4>
<p>If <a class="el" href="group___b_o_n_d___m_i_t_m___d_e_f_i_n_e_s.html#ga7a7f5bff0fb0c0ecd4c7316420ea166d">GAP_AUTHEN_BIT_BONDING_FLAG</a> has been set in authentication requirements, application should manage the bond informations of paired devices. Application can manage bond informations using the implementation in stack, or using functions registered with <a class="el" href="group___b_t___b_o_n_d___x3_d.html#ga49ae800adfeee65995e9081702cf45a6">bt_bond_register_hal()</a>. <br />
</p>
<p>The contents of bond informations in stack for each bonded device are: <br />
</p><ul>
<li>Maximum bond device number (1 byte)<br />
</li>
<li>Bond information index (1 byte)<br />
</li>
<li>Bond information priority (1 byte)<br />
</li>
<li>Remote Bluetooth device address (6 bytes)<br />
</li>
<li>Link key type (1 byte)<br />
</li>
<li>Link key (16 bytes)<br />
</li>
<li>Bond flag (4 bytes) <br />
</li>
</ul>
<p>As shown in Figure 2-15, application can configure the stack layer maximum bond device number in MCU config tool. And application can call <a class="el" href="group___b_t___b_o_n_d___x3_e.html#ga0f1c4d5fad18c4b46020deb281d474b8">bt_max_bond_num_get</a> to get maximum bond device number in stack layer. <br />
 </p><div class="image">
<img src="br-max-bond-num-config.png" alt="br-max-bond-num-config.png"/>
</div>
 <center><div id="figure_2_15"><b>Figure 2-15 BR/EDR Maximum Bond Number Configuration</b></div></center><p>The bond information index is the unique index for each bonded device's bond infiormation. When application saving a new Bluetooth device's bond information, the bond information index allocated automatically in stack layer and can not be changed. <br />
 The bond information priority indicate the priority of bonded device, range from 1 to maximum bond device number. The larger the priority value, the higher the priority. <br />
</p>
<h3><a class="anchor" id="BREDR_Device_Initialization"></a>
2.7 BR/EDR Device Initialization</h3>
<p>The purpose of this chapter is to give an overview of device initialization and Startup Flow which include how to configure BR/EDR device parameters and BR/EDR device startup flow.<br />
</p>
<h4><a class="anchor" id="BREDR_Device_Parameters_Initialization"></a>
2.7.1 BR/EDR Device Parameters Initialization</h4>
<p>Parameter initialize is fulfilled in app_main.c only by modifying codes for <a class="el" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga475d55a0a331f1115e2986d39109f327">app_bt_gap_init</a> in main.c. <br />
 </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga475d55a0a331f1115e2986d39109f327">app_bt_gap_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint32_t class_of_device = (uint32_t)((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#gab6df9660ad8a8346a0e929b266349122">class_of_device</a>[0]) |</div><div class="line">                                          (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#gab6df9660ad8a8346a0e929b266349122">class_of_device</a>[1] &lt;&lt; 8) |</div><div class="line">                                          (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#gab6df9660ad8a8346a0e929b266349122">class_of_device</a>[2] &lt;&lt; 16));</div><div class="line"></div><div class="line">    uint16_t supervision_timeout = DEFAULT_SUPVISIONTIMEOUT;</div><div class="line">    uint16_t link_policy = <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga1d709796ddfe349af53a535bd028f14d">GAP_LINK_POLICY_ROLE_SWITCH</a> | <a class="code" href="group___g_a_p___b_r_e_d_r.html#gaaad0b98f90b2e336494bb9ee9bcf291e">GAP_LINK_POLICY_SNIFF_MODE</a>;</div><div class="line">    uint8_t radio_mode = <a class="code" href="group___g_a_p___b_r_e_d_r.html#ggab52b1bf8f3a7e6103f1e3930578c3775a6b229fb7731a1203115f85649bc19fe4">GAP_RADIO_MODE_NONE_DISCOVERABLE</a>;</div><div class="line">    <span class="keywordtype">bool</span> limited_discoverable = <span class="keyword">false</span>;</div><div class="line">    <span class="keywordtype">bool</span> auto_accept_acl = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    uint8_t  pagescan_type = <a class="code" href="group___g_a_p___b_r_e_d_r.html#gga8a3e921da25496e99f3f718d82eeac35ac62e453f8f4c98a29647e269ac66a995">GAP_PAGE_SCAN_TYPE_INTERLACED</a>;</div><div class="line">    uint16_t pagescan_interval = DEFAULT_PAGESCAN_INTERVAL;</div><div class="line">    uint16_t pagescan_window = DEFAULT_PAGESCAN_WINDOW;</div><div class="line">    uint16_t page_timeout = DEFAULT_PAGE_TIMEOUT;</div><div class="line">    uint8_t  page_scan_repetition_mode = <a class="code" href="group___g_a_p___b_r_e_d_r.html#gga5efd5ff3bc58b9c929669cd1b2e16582a8e82521c999acc11f16e0133d0f5bcbc">GAP_PAGE_SCAN_REPETITION_R1</a>;</div><div class="line"></div><div class="line">    uint8_t inquiryscan_type = <a class="code" href="group___g_a_p___b_r_e_d_r.html#gga05c1d4877e4a671063a54ae911f34ca8a5cdc3b787720e453c46007f28286e95c">GAP_INQUIRY_SCAN_TYPE_INTERLACED</a>;</div><div class="line">    uint16_t inquiryscan_window = DEFAULT_INQUIRYSCAN_WINDOW;</div><div class="line">    uint16_t inquiryscan_interval = DEFAULT_INQUIRYSCAN_INTERVAL;</div><div class="line">    uint8_t inquiry_mode = <a class="code" href="group___g_a_p___b_r_e_d_r.html#ggabf21c02d36bacc9ef5eed80dc9552fc1af4954d70e2234f70f5e32372615168cb">GAP_INQUIRY_MODE_EXTENDED_RESULT</a>;</div><div class="line"></div><div class="line">    uint8_t pair_mode = <a class="code" href="group___b_o_n_d___p_a_i_r_i_n_g___m_o_d_e___d_e_f_i_n_e_s.html#gad3d7b9d5543cf1e4743396ee3680dc16">GAP_PAIRING_MODE_PAIRABLE</a>;</div><div class="line">    uint16_t auth_flags = <a class="code" href="group___b_o_n_d___m_i_t_m___d_e_f_i_n_e_s.html#ga7a7f5bff0fb0c0ecd4c7316420ea166d">GAP_AUTHEN_BIT_BONDING_FLAG</a> | <a class="code" href="group___b_o_n_d___m_i_t_m___d_e_f_i_n_e_s.html#ga8c6188c207f5f749b0733453f7bf9ee0">GAP_AUTHEN_BIT_SC_FLAG</a>;</div><div class="line">    uint8_t io_cap = <a class="code" href="group___g_a_p___common___exported___types.html#ggafa5f8a475a6c3126ab20d51881e8dc8da37845069e8fce0d25222ca70bf5af666">GAP_IO_CAP_NO_INPUT_NO_OUTPUT</a>;</div><div class="line">    uint8_t oob_enable = <span class="keyword">false</span>;</div><div class="line">    uint8_t bt_mode = <a class="code" href="group___g_a_p___b_r_e_d_r.html#gga7acb9d43cbf87049472c21ba5d1da658a8bbfd5425d299c7a19a95fe6e6aefeee">GAP_BT_MODE_21ENABLED</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group___b_t___b_o_n_d___c_o_m_m_o_n___exported___functions.html#ga873d72a41afe2ba67efd6dba56a7b325">bt_bond_init</a>();</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga6413e985e869d949a7c5faba945c3ff3">gap_lib_init</a>();</div><div class="line"></div><div class="line">    <span class="comment">//0: to be master</span></div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#gab48545daefb11de0ac1503e24482df4d">gap_br_cfg_accept_role</a>(1);</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a79f332b77ae9d9b8d597b2a57e75c76e">GAP_BR_PARAM_NAME</a>, <a class="code" href="group___g_a_p___common___macros.html#gaf61e23036a464a4299b13309cb44b11d">GAP_DEVICE_NAME_LEN</a>, <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gaf2dbb266dec477095d156ae715f53014">device_name_legacy</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a>(<a class="code" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2ac1e0ac58313c76368f83ea15c17dfebc">GAP_PARAM_BOND_PAIRING_MODE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;pair_mode);</div><div class="line">    <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a>(<a class="code" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2a4caada923b034620e0692e3b5cc0d1c2">GAP_PARAM_BOND_AUTHEN_REQUIREMENTS_FLAGS</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;auth_flags);</div><div class="line">    <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a>(<a class="code" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2a85b5072df10e518def21aeca3d78e22a">GAP_PARAM_BOND_IO_CAPABILITIES</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;io_cap);</div><div class="line">    <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga7a7eae87166f80b6d5f17b2ce42fa049">gap_set_param</a>(<a class="code" href="group___g_a_p___common___exported___types.html#gga6b5a306a5b8edce2b24cc7c6019073a2a2c6acd9336a3701fe2d0108e7e2478b1">GAP_PARAM_BOND_OOB_ENABLED</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;oob_enable);</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a32c285169f1487a6afb3a24f64cc3598">GAP_BR_PARAM_BT_MODE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;bt_mode);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ac1d1f37e9c1617fd60a364a20eaba32b">GAP_BR_PARAM_COD</a>, <span class="keyword">sizeof</span>(uint32_t), &amp;class_of_device);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a36900d35b5bd9ce0a12dfd3634f0da3e">GAP_BR_PARAM_LINK_POLICY</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;link_policy);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a9b0b621640de24dc953a44228521925b">GAP_BR_PARAM_SUPV_TOUT</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;supervision_timeout);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a1edb7db49f63bf9a1171d615b0c57571">GAP_BR_PARAM_AUTO_ACCEPT_ACL</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>), &amp;auto_accept_acl);</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a912576c7b52d02eda942686609844422">GAP_BR_PARAM_RADIO_MODE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;radio_mode);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a4f5bc878a7932b27983767c5ad55c6ae">GAP_BR_PARAM_LIMIT_DISCOV</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>), &amp;limited_discoverable);</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146aca39b87645c90bb4d852f8a5c1f4730d">GAP_BR_PARAM_PAGE_SCAN_TYPE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;pagescan_type);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a662cfb3a079acab6eab89b7150c860e3">GAP_BR_PARAM_PAGE_SCAN_INTERVAL</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;pagescan_interval);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a74543c81043ff458b7eadb900a86353d">GAP_BR_PARAM_PAGE_SCAN_WINDOW</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;pagescan_window);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146adbaee71569139dd637950dcd5875eefd">GAP_BR_PARAM_PAGE_TIMEOUT</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;page_timeout);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146a3bfaea393846c476f152b4550b215c08">GAP_BR_PARAM_PAGE_SCAN_REPETITION_MODE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;page_scan_repetition_mode);</div><div class="line"></div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146abdd3008779778280db99fdd7644359c3">GAP_BR_PARAM_INQUIRY_SCAN_TYPE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;inquiryscan_type);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ac4e288adf29bc1be3d7018762a8ee8c0">GAP_BR_PARAM_INQUIRY_SCAN_INTERVAL</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;inquiryscan_interval);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ae0586216befadb6fe9fb7753f644747b">GAP_BR_PARAM_INQUIRY_SCAN_WINDOW</a>, <span class="keyword">sizeof</span>(uint16_t), &amp;inquiryscan_window);</div><div class="line">    <a class="code" href="group___g_a_p___b_r_e_d_r.html#ga8557c9d45ee732eba800b6c7f80011e7">gap_br_set_param</a>(<a class="code" href="group___g_a_p___b_r_e_d_r.html#gga6f8fd9e3693bfbe6df27b23771759146ac9b998b546994be97a6acb02e47eb980">GAP_BR_PARAM_INQUIRY_MODE</a>, <span class="keyword">sizeof</span>(uint8_t), &amp;inquiry_mode);</div><div class="line">}</div></div><!-- fragment --><h4><a class="anchor" id="BREDR_Device_Startup_Flow"></a>
2.7.2 BR/EDR Device Startup Flow</h4>
<p>Application should configure BR/EDR device parameters firstly, and call <a class="el" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga337f0e91aaa1af727c165620e64d91af">gap_start_bt_stack</a> in application task. <br />
 Application can call <a class="el" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a> to receive callback messages. And application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a9320e2b7e774c93377720bf3327f7b5e">BT_EVENT_READY</a> after BR/EDR device initialization. <br />
</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_device_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line">    <span class="keywordtype">bool</span> handle = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a9320e2b7e774c93377720bf3327f7b5e">BT_EVENT_READY</a>:</div><div class="line">        {</div><div class="line">            <span class="comment">//do something after stack initializing completely</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga475d55a0a331f1115e2986d39109f327">app_bt_gap_init</a>();</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___b_t___b_t_m.html#ga657a9b30bbdc9aa19c404edd4741e338">bt_mgr_init</a>(<a class="code" href="group___a_p_p___l_i_n_k.html#ga51f528a501ab0487c37c465106298105">MAX_BR_LINK_NUM</a>);</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>(app_bt_cback);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#gab31ebd8f8c8b560ef3c96e2b599dd653">app_main_task</a>(<span class="keywordtype">void</span> *p_param)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___g_a_p___c_o_m_m_o_n___e_x_p_o_r_t___functions.html#ga337f0e91aaa1af727c165620e64d91af">gap_start_bt_stack</a>(<a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#gaefd4e39cd81a67ec6bb571646ce73fec">evt_queue_handle</a>, <a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#gab16d5e105b1c246220eda8b551cdeb67">io_queue_handle</a>, <a class="code" href="group___p_e_r_i_p_h___a_p_p___t_a_s_k.html#gaaf45be3842e5882f90db4267ffbfe036">MAX_NUMBER_OF_GAP_MESSAGE</a>);</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_SDP"></a>
3 BR/EDR SDP</h2>
<p>The Service Discovery protocol (SDP) provides a means for applications to discover which services are available and to determine the characteristics of those available services. <br />
</p>
<p>The SDP layer will be introduced according to the following several parts:<br />
</p><ul>
<li>BR/EDR SDP Capacity <br />
</li>
<li>BR/EDR SDP Data Representation. <br />
</li>
<li>BR/EDR SDP Initialization. <br />
</li>
</ul>
<h3><a class="anchor" id="BREDR_SDP_Capacity"></a>
3.1 BR/EDR SDP Capacity</h3>
<p>The service discovery mechanism provides the means for client applications to discover the existence of services provided by server applications as well as the attributes of those services. The attributes of a service include the type or class of service offered and the mechanism or protocol information needed to utilize the service.</p>
<div class="image">
<img src="br-sdp-client-server-interaction.png" alt="br-sdp-client-server-interaction.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 BR/EDR SDP Client-Server Interaction</b></div></center><p>As shown in Figure 3-1 above, SDP involves communication between an SDP server and an SDP client. <br />
 The server maintains an SDP database which consists of a list of service records that describe the characteristics of services associated with the server. Each service record contains information about a single service. <br />
 A client can retrieve information from a service record maintained by the SDP server by issuing an SDP request. <br />
</p>
<h4><a class="anchor" id="BREDR_Device_ID_Discovery"></a>
3.1.1 BR/EDR Device Identification Discovery</h4>
<p>Device ID information for the device is exported in terms of an explicit SDP record on that device. <br />
 The Device ID Service Record attributes are listed in Table 3-1: </p><div style="page-break-after: always;"></div> <center><div id="table_3_1"><b>Table 3-1 Device ID Service Record Attributes </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Attribute  </th><th class="markdownTableHeadLeft">Attribute ID  </th><th class="markdownTableHeadLeft">Attribute Value Type   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SpecificationID  </td><td class="markdownTableBodyLeft">0x0200  </td><td class="markdownTableBodyLeft">2 byte unsigned integer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VendorID  </td><td class="markdownTableBodyLeft">0x0201  </td><td class="markdownTableBodyLeft">2 byte unsigned integer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ProductID  </td><td class="markdownTableBodyLeft">0x0202  </td><td class="markdownTableBodyLeft">2 byte unsigned integer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Version  </td><td class="markdownTableBodyLeft">0x0203  </td><td class="markdownTableBodyLeft">2 byte unsigned integer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PrimaryRecord  </td><td class="markdownTableBodyLeft">0x0204  </td><td class="markdownTableBodyLeft">bool   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">VendorIDSource  </td><td class="markdownTableBodyLeft">0x0205  </td><td class="markdownTableBodyLeft">2 byte unsigned integer   </td></tr>
</table>
<ul>
<li>SpecificationID<ul>
<li>The SpecificationID is intended to reflect the version number of the Bluetooth Device ID Profile specification supported by the device. <br />
</li>
<li>The two most significant hexadecimal digits will indicate the major number of the Bluetooth Device ID Profile specification and the two least significant hexadecimal digits will reflect the minor number of the specification. For example, version 1.3 will be 0x0103. <br />
</li>
</ul>
</li>
<li>VendorID<ul>
<li>The VendorID is intended to uniquely identify the vendor of the device, which determines which organization assigned the VendorID value. The VendorID 0xFFFF is reserved as the default VendorID when no Device ID Service Record is present in the device. <br />
</li>
</ul>
</li>
<li>ProductID<ul>
<li>The ProductID is intended to distinguish between different products made by the vendor above. These IDs are managed by the vendors themselves. <br />
</li>
</ul>
</li>
<li>Version<ul>
<li>This is a vendor-assigned field, which defines the version of the product identified by the VendorID and ProductID attributes. This attribute is intended to differentiate between versions of products with identical VendorIDs and ProductIDs. <br />
</li>
<li>The value of the field is 0xJJMN for version JJ.M.N (JJ - major version number, M - minor version number, N - sub-minor version number). <br />
</li>
</ul>
</li>
<li>PrimaryRecord<ul>
<li>This is intended to designate one particular Device ID Service Record (in case multiple Device ID Service Records exist on a device) as the primary Device ID Service Record for the device - the PrimaryRecord attribute is set to TRUE for that record and FALSE for all other records. <br />
</li>
<li>The client device can use the primary Device ID Service Record from the source device for UI purposes. <br />
</li>
</ul>
</li>
<li>VendorIDSource<ul>
<li>This attribute designates which organization assigned the VendorID attribute. <br />
 Defined values: <br />
</li>
<li>0x0001 = Bluetooth SIG assigned Device ID Vendor ID value from the Assigned Numbers document <br />
</li>
<li>0x0002 = USB Implementer's Forum assigned Vendor ID value <br />
</li>
<li>0x0000, 0x0003 - 0xFFFF = Reserved for future use <br />
</li>
</ul>
</li>
</ul>
<p>As shown in Figure 3-2, application can call <a class="el" href="group___b_t___s_d_p.html#gac3233e131e80e5d539a90bbf761ff5fd">bt_did_discov_start</a> to start a DID discover procedure. Application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a6bbae55a6e762c61de79376a2349fb36">BT_EVENT_DID_ATTR_INFO</a> event with DID attributes information. <br />
 </p><div class="image">
<img src="br-did-discover.png" alt="br-did-discover.png"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 BR/EDR DID Discovery Flow</b></div></center><p> After DID procedure complete, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a66dd1bd42b4c9bbe3d0afd0b59eaac2f">BT_EVENT_SDP_DISCOV_CMPL</a> event. <br />
</p>
<p>As shown in Figure 3-3, application can call <a class="el" href="group___b_t___s_d_p.html#ga9493faad95cc872e9e499850d055d12d">bt_sdp_discov_stop</a> to stop a DID discover procedure. <br />
 </p><div class="image">
<img src="br-did-discover-terminate.png" alt="br-did-discover-terminate.png"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 BR/EDR DID Discovery Terminate Flow</b></div></center><p> Application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83af8979ba7c15909341debed55e9cb4699">BT_EVENT_SDP_DISCOV_STOP</a> event after DID discover procedure stopped. <br />
</p>
<h4><a class="anchor" id="BREDR_Profile_Service_Discovery"></a>
3.1.2 BR/EDR Profile Service Discovery</h4>
<p>The SDP record contents of BR/EDR Profiles Please refer to each profile user Manual. <br />
</p>
<p>As shown in Figure 3-4, application can call <a class="el" href="group___b_t___s_d_p.html#ga395b3d4c700e3aa4bb4635c3f64eabc8">bt_sdp_discov_start</a> to start a profile service discover procedure. Application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a4d6b781d7df2a68759c22de424935578">BT_EVENT_SDP_ATTR_INFO</a> event with profile service attributes information; After discover procedure complete, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a66dd1bd42b4c9bbe3d0afd0b59eaac2f">BT_EVENT_SDP_DISCOV_CMPL</a> event. <br />
 </p><div class="image">
<img src="br-profile-service-discover.png" alt="br-profile-service-discover.png"/>
</div>
 <center><div id="figure_3_4"><b>Figure 3-4 BR/EDR Profile Service Discovery Flow</b></div></center><p>As shown in Figure 3-5, application can call <a class="el" href="group___b_t___s_d_p.html#ga9493faad95cc872e9e499850d055d12d">bt_sdp_discov_stop</a> to stop a profile service discover procedure. And application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83af8979ba7c15909341debed55e9cb4699">BT_EVENT_SDP_DISCOV_STOP</a> event after profile service discover procedure stopped. <br />
 </p><div class="image">
<img src="br-profile-service-discover-terminate.png" alt="br-profile-service-discover-terminate.png"/>
</div>
 <center><div id="figure_3_5"><b>Figure 3-5 BR/EDR Profile Service Discovery Terminate Flow</b></div></center><h3><a class="anchor" id="BREDR_SDP_Data_Representation"></a>
3.2 BR/EDR SDP Data Representation</h3>
<p>All of the information about a service that is maintained by an SDP server is contained within a single service record. <br />
 As shown in Figure 3-6, the service record shall only be a list of service attributes. <br />
 </p><div class="image">
<img src="br-service-record.png" alt="br-service-record.png"/>
</div>
 <center><div id="figure_3_6"><b>Figure 3-6 BR/EDR Service Record</b></div></center><p> The service attribute consists of two components: an attribute ID and an attribute value. <br />
</p>
<h4><a class="anchor" id="BREDR_SDP_Attr_ID"></a>
3.2.1 Attribute ID</h4>
<p>An attribute ID is a 16-bit unsigned integer that distinguishes each service attribute from other service attributes within a service record. <br />
 An attribute ID is represented as a data element. <br />
</p>
<h4><a class="anchor" id="BREDR_SDP_Attr_Val"></a>
3.2.2 Attribute Value</h4>
<p>The attribute value is a variable length field whose meaning is determined by the attribute ID associated with it and by the service class of the service record in which the attribute is contained. <br />
 An attribute value is represented as a data element. <br />
</p>
<h4><a class="anchor" id="BREDR_SDP_Data_Element"></a>
3.2.3 Data Element</h4>
<p>A data element is a typed data representation. It consists of two fields: a header field and a data field. <br />
 The header field, in turn, is composed of two parts: a type descriptor and a size descriptor. <br />
 The data is a sequence of bytes whose length is specified in the size descriptor (described in Section 3.3) and whose meaning is (partially) specified by the type descriptor. <br />
 </p><center><div id="table_3_2"><b>Table 3-2 Data Element Type Descriptor </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Type Descriptor <br />
Value  </th><th class="markdownTableHeadLeft">Valid Size <br />
Descriptor Values  </th><th class="markdownTableHeadLeft">Type Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">Nil, the null type   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1  </td><td class="markdownTableBodyLeft">0,1,2,3,4  </td><td class="markdownTableBodyLeft">Unsigned integer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">2  </td><td class="markdownTableBodyLeft">0,1,2,3,4  </td><td class="markdownTableBodyLeft">Signed Twos-complement integer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">3  </td><td class="markdownTableBodyLeft">1,2,4  </td><td class="markdownTableBodyLeft">UUID, auniversally unique identifier   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">4  </td><td class="markdownTableBodyLeft">5,6,7  </td><td class="markdownTableBodyLeft">Text string   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">5  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">Boolean   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">6  </td><td class="markdownTableBodyLeft">5,6,7  </td><td class="markdownTableBodyLeft">Data element sequence, a data element whose data field is a <br />
sequence of data elements   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">7  </td><td class="markdownTableBodyLeft">5,6,7  </td><td class="markdownTableBodyLeft">Data element alternative, data element whose data field is a <br />
sequence of data elements from which one data element <br />
 is to be selected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">8  </td><td class="markdownTableBodyLeft">5,6,7  </td><td class="markdownTableBodyLeft">URL, a uniform resource locator   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Other  </td><td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">Reserved for future use   </td></tr>
</table>
<p>A data element type is represented as a 5-bit type descriptor. The type descriptor is contained in the most significant (high-order) 5 bits of the first byte of the data element header. Table 3-2 describes the definitions of data element type descriptors.</p>
<p>The data element size descriptor is represented as a 3-bit size index followed by 0, 8, 16, or 32 bits. The size index is contained in the least significant (loworder) 3 bits of the first byte of the data element header. As shown in Table 3-3, the size index is encoded as follows. </p><div style="page-break-after: always;"></div> <center><div id="table_3_3"><b>Table 3-3 Data Element Size Descriptor </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Size Index  </th><th class="markdownTableHeadLeft">Additional Bits  </th><th class="markdownTableHeadLeft">Data Size   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">1 byte. Exception: if the data element type is nil, <br />
the data size is 0 bytes   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">2 bytes   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">2  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">4 bytes   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">3  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">8 bytes   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">4  </td><td class="markdownTableBodyLeft">0  </td><td class="markdownTableBodyLeft">16 bytes   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">5  </td><td class="markdownTableBodyLeft">8  </td><td class="markdownTableBodyLeft">The data size is contained in the additional 8 bits,<br />
which are interpreted as an unsigned integer.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">6  </td><td class="markdownTableBodyLeft">16  </td><td class="markdownTableBodyLeft">The data size is contained in the additional 16 bits,<br />
which are interpreted as an unsigned integer.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">7  </td><td class="markdownTableBodyLeft">32  </td><td class="markdownTableBodyLeft">The data size is contained in the additional 32 bits,<br />
which are interpreted as an unsigned integer.   </td></tr>
</table>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t a2dp_sdp_record[] =</div><div class="line">{</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x39,<span class="comment">//0x55,</span></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_CLASS_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga54b9fa1bd5126b6e5070873e1d1187ab">UUID_AUDIO_SINK</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga54b9fa1bd5126b6e5070873e1d1187ab">UUID_AUDIO_SINK</a>),</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROTO_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x10,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a>),</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___p_s_m.html#ga6db75c9162ffb534c855804327fea0ea">PSM_AVDTP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___p_s_m.html#ga6db75c9162ffb534c855804327fea0ea">PSM_AVDTP</a>),</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga757abe5de4d297c7fb59e294b3647667">UUID_AVDTP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga757abe5de4d297c7fb59e294b3647667">UUID_AVDTP</a>),</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x01,</div><div class="line">    0x03,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_BROWSE_GROUP_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a>),</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROFILE_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x08,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#gad8bc231e47cb3858e71a1b9aa44a8e91">UUID_ADVANCED_AUDIO_DISTRIBUTION</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#gad8bc231e47cb3858e71a1b9aa44a8e91">UUID_ADVANCED_AUDIO_DISTRIBUTION</a>),</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x01,<span class="comment">//version 1.4</span></div><div class="line">    0x04,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SUPPORTED_FEATURES</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___p_r_o_f_i_l_e___a_t_t_r_i_b_u_t_e_s.html#ga1d91531d2bd55bfc1bd089e36ad45816">SDP_ATTR_SUPPORTED_FEATURES</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___p_r_o_f_i_l_e___a_t_t_r_i_b_u_t_e_s.html#ga1d91531d2bd55bfc1bd089e36ad45816">SDP_ATTR_SUPPORTED_FEATURES</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x00,</div><div class="line">    0x03</div><div class="line">};</div></div><!-- fragment --><h3><a class="anchor" id="BREDR_SDP_INIT"></a>
3.3 BR/EDR SDP Initialization</h3>
<p>The SDP table will be initialized after application call <a class="el" href="group___b_t___b_t_m.html#ga657a9b30bbdc9aa19c404edd4741e338">bt_mgr_init()</a>, and applicaiton should add or delete SDP record after this step. <br />
</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___b_t___b_t_m.html#ga657a9b30bbdc9aa19c404edd4741e338">bt_mgr_init</a>(<a class="code" href="group___a_p_p___l_i_n_k.html#ga51f528a501ab0487c37c465106298105">MAX_BR_LINK_NUM</a>);</div><div class="line">    ......</div><div class="line">    <a class="code" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef">bt_sdp_record_add</a>((<span class="keywordtype">void</span> *)sdp_record);</div><div class="line">}</div></div><!-- fragment --><p>As shown in Figure 3-7, Application can call <a class="el" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef">bt_sdp_record_add</a> to add SDP record so that the remote device can find this service through the SDP search process. <br />
 </p><div class="image">
<img src="br-add-service-record.png" alt="br-add-service-record.png"/>
</div>
 <center><div id="figure_3_7"><b>Figure 3-7 BR/EDR ADD Service Record</b></div></center><p>As shown in Figure 3-8, Application can call <a class="el" href="group___b_t___s_d_p.html#ga6545b68b7bd817e5dcabc4e6af6b2353">bt_sdp_record_delete</a> to delete the SDP record. <br />
 </p><div class="image">
<img src="br-delete-service-record.png" alt="br-delete-service-record.png"/>
</div>
 <center><div id="figure_3_8"><b>Figure 3-8 BR/EDR Delete Service Record</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="BREDR_Link_Management"></a>
4 BR/EDR Link Management</h2>
<p>Application can establish BR/EDR link or control BR/EDR link according to different scenarios. The BR/EDR link management will be introduced according to the following several parts:<br />
</p><ul>
<li>BR/EDR link establishment. <br />
</li>
<li>BR/EDR link control. <br />
</li>
</ul>
<h3><a class="anchor" id="BREDR_Link_Establishment"></a>
4.1 BR/EDR Link Establishment</h3>
<p>The purpose of the link establishment procedure is to establish a logical transport (of ACL type) between two Bluetooth devices. <br />
 </p>
<h4><a class="anchor" id="BREDR_Link_Creation"></a>
4.1.1 Link Creation</h4>
<p>As shown in Figure 4-1, application can create an acl link by initiating a SDP discovery process. And stack layer will check whether ACL link existed, if not, link creation process initiated automatically. </p><div class="image">
<img src="br-link-creation.png" alt="br-link-creation.png"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 BR/EDR Link Creation</b></div></center><p>After the ACL is established, applicaiton will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a16b52db502dc6b9cfe5d6ca9027f4f02">BT_EVENT_ACL_CONN_SUCCESS</a> event. And then after the stack layer sets default link parameters, the application receives the <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac6e5033fdb0cf1bb9d48dabfa37c9c24">BT_EVENT_ACL_CONN_READY</a> event, which means link ready. <br />
</p>
<p>If ACL link created failed, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a035db12b6e5e60407710f284e1b4bed7">BT_EVENT_ACL_CONN_FAIL</a> event and <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a66dd1bd42b4c9bbe3d0afd0b59eaac2f">BT_EVENT_SDP_DISCOV_CMPL</a> event. <br />
 The default link role for link initiator is master, and applicaiton will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a7b4db45f63358fb502964bd172b3895e">BT_EVENT_ACL_ROLE_MASTER</a> event before link ready. <br />
 If remote device change link role, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ab2bb6109f305fa8cda76f1b8e8a06512">BT_EVENT_ACL_ROLE_SLAVE</a> event instead of <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a7b4db45f63358fb502964bd172b3895e">BT_EVENT_ACL_ROLE_MASTER</a> event before link ready. <br />
 If no service channel is available for 4 seconds, the BR/EDR link will be disconnected automatically, so application should initiate profile connection in 4 seconds after SDP discovery process completed. <br />
</p>
<h4><a class="anchor" id="BREDR_Link_Auth_Encrypt"></a>
4.1.2 Link Authentication And Encryption</h4>
<p>Application can initiate a BR/EDR profile connection process after link ready. The stack layer will check profile security check and trigger authentication and encryption process automatically. <br />
</p>
<p>As shown in Figure 4-2, pairing process will be triggered if applicaiton has no link key. </p><div class="image">
<img src="br-link-pairing.png" alt="br-link-pairing.png"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 BR/EDR Link Pairing Flow</b></div></center><p>Figure 4-3 shows the authentication and encryption process when application has link key. </p><div class="image">
<img src="br-link-authen-encryption.png" alt="br-link-authen-encryption.png"/>
</div>
 <center><div id="figure_4_3"><b>Figure 4-3 BR/EDR Link Authentication Encryption With Link Key</b></div></center><h3><a class="anchor" id="BREDR_Link_Control"></a>
4.2 BR/EDR Link Control</h3>
<p>Application can change link parameters for different scenarios.</p>
<h4><a class="anchor" id="BREDR_Role_Switch"></a>
4.2.1 Role Switch</h4>
<p>As shown in Figure 4-4, application can trigger role switch process after link ready. </p><div class="image">
<img src="br-link-role-switch.png" alt="br-link-role-switch.png"/>
</div>
 <center><div id="figure_4_4"><b>Figure 4-4 BR/EDR Link Role Switch</b></div></center><p> If role switch process succeeds, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a7b4db45f63358fb502964bd172b3895e">BT_EVENT_ACL_ROLE_MASTER</a> or <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ab2bb6109f305fa8cda76f1b8e8a06512">BT_EVENT_ACL_ROLE_SLAVE</a> event. <br />
 If role switch process failed, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83acb8e54236e17a8c4ceac7766ead67c0a">BT_EVENT_ACL_ROLE_SWITCH_FAIL</a> event. <br />
 As role switch process conflicted with authentication and encryption, applicaiton shouldn't trigger role switch when authentication or encryption in process.</p>
<h4><a class="anchor" id="BREDR_QoS_Config"></a>
4.2.2 QoS Configuration</h4>
<p>As shown in Figure 4-5, application can call <a class="el" href="group___b_t___b_t_m.html#gadba2350e49cdeada583e90fb97520235">bt_link_qos_set</a> to configure link QoS. </p><div class="image">
<img src="br-link-config-QoS.png" alt="br-link-config-QoS.png"/>
</div>
 <center><div id="figure_4_5"><b>Figure 4-5 BR/EDR Link Configure QoS</b></div></center><p> If QoS configuration proccess succeeds, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a15a6d50649beaba076e42cefab859f15">BT_EVENT_LINK_QOS_SET_CMPL</a> event, otherwise, application will receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a338881d18e948383755d158a2d7b9558">BT_EVENT_LINK_QOS_SET_RSP</a> event.</p>
<h4><a class="anchor" id="BREDR_Pkt_Type_Config"></a>
4.2.3 Packet Type Configuration</h4>
<p>As shown in Figure 4-6, application can configure using specific packet types for link communication. <br />
 </p><div class="image">
<img src="br-link-config-packet-type.png" alt="br-link-config-packet-type.png"/>
</div>
 <center><div id="figure_4_6"><b>Figure 4-6 BR/EDR Link Configure Packet Type</b></div></center><h4><a class="anchor" id="BREDR_Sniff_Mode_Config"></a>
4.2.4 BR/EDR Link Sniff Mode Configuration</h4>
<p>If sniff mode enabled, the Bluetooth manager module can automatically enter or exit sniff mode in different scenarios. <br />
 As shown in Figure 4-7, application can call <a class="el" href="group___b_t___b_t_m.html#ga7d1224e1afe94c99bf97867e8ac3e41f">bt_sniff_mode_enable</a> to enable BR/EDR link sniff mode or change sniff mode parameters.<br />
 </p><div class="image">
<img src="br-link-enable-sniff-mode.png" alt="br-link-enable-sniff-mode.png"/>
</div>
 <center><div id="figure_4_7"><b>Figure 4-7 BR/EDR Link Enable Sniff Mode</b></div></center><p>As shown in Figure 4-8, application can call <a class="el" href="group___b_t___b_t_m.html#ga98845f3f0972439eafa3dd8861de2ede">bt_sniff_mode_disable</a> to disable BR/EDR link sniff mode.<br />
 </p><div class="image">
<img src="br-link-disable-sniff-mode.png" alt="br-link-disable-sniff-mode.png"/>
</div>
 <center><div id="figure_4_8"><b>Figure 4-8 BR/EDR Link Disable Sniff Mode</b></div></center> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
