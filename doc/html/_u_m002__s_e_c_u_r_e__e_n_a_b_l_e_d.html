<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
</p>
<h1><a class="anchor" id="SECURE_ENABLED"></a>
MP Flow for Secure-Enabled Chip   </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.12</b></center><p><br />
 </p><center><b>2024/01/29</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_REV"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyNone">2021/10/21  </td><td class="markdownTableBodyNone">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyNone">2021/11/15  </td><td class="markdownTableBodyNone">Add RTL87X3D support   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.2  </td><td class="markdownTableBodyNone">2022/03/03  </td><td class="markdownTableBodyNone">Resign mcu sdk for RTL87x3E   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.3  </td><td class="markdownTableBodyNone">2022/03/15  </td><td class="markdownTableBodyNone">Modify resign for RTL87x3E   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.4  </td><td class="markdownTableBodyNone">2022/08/16  </td><td class="markdownTableBodyNone">Add security level   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.5  </td><td class="markdownTableBodyNone">2023/03/08  </td><td class="markdownTableBodyNone">Update document by review   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.6  </td><td class="markdownTableBodyNone">2023/03/13  </td><td class="markdownTableBodyNone">Adjust the format   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.7  </td><td class="markdownTableBodyNone">2023/03/14  </td><td class="markdownTableBodyNone">Add more description about secure boot   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.8  </td><td class="markdownTableBodyNone">2023/03/20  </td><td class="markdownTableBodyNone">Update by the review advices   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.9  </td><td class="markdownTableBodyNone">2023/03/21  </td><td class="markdownTableBodyNone">Update by the review advices   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.10  </td><td class="markdownTableBodyNone">2023/05/22  </td><td class="markdownTableBodyNone">Update the format   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.11  </td><td class="markdownTableBodyNone">2023/06/08  </td><td class="markdownTableBodyNone">Update the format   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.12  </td><td class="markdownTableBodyNone">2024/01/29  </td><td class="markdownTableBodyNone">Support to burn public key hash independently   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_REV">Revision History</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Table_List">Table List</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Figure_List">Figure List</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Glossary">Glossary</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Intro">1 Introduction</a><ul>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Secure_Boot">1.1 Secure Boot</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_RSA_Sign">1.2 RSA Sign and Verify</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_RSA_Key">1.3 RSA Key and Key Hash</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_EVB_IC">1.4 EVB and MP IC</a></li>
</ul>
</li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Pre">2 Prerequisites</a><ul>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Toolset">2.1 Toolset</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Images">2.2 Images</a></li>
</ul>
</li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_MP_Flow">3 MP Flow for Secure-Enabled Chip</a><ul>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Generate_RSA_Key">3.1 Generate RSA Key and Key Hash by RSA Key Generator</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Sign_Images">3.2 Sign Images by Re-sign Tool</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Pack_Images">3.3 Pack Images by MPPGTOOL</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_DOWNLOAD_PUB_KEY_HASH">3.4 Download public key hash by MP Programming Tool</a></li>
</ul>
</li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURITY_LEVEL">4 Security Level</a></li>
<li><a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_FAQs">5 FAQs</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_2_1">Table 2-1 RTL87x3E Image Type and Name Mapping Table</a></li>
<li><a href="#table_2_2">Table 2-2 RTL87x3D Image Type and Name Mapping Table</a></li>
<li><a href="#table_4_1">Table 4-1 Security Level Table</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 RTL87X3E SDK Bin Folder 1</a></li>
<li><a href="#figure_2_2">Figure 2-2 RTL87X3E SDK Bin Folder 2</a></li>
<li><a href="#figure_2_3">Figure 2-3 RTL87X3D SDK Bin Folder 1</a></li>
<li><a href="#figure_2_4">Figure 2-4 RTL87X3D SDK Bin Folder 2</a></li>
<li><a href="#figure_3_1">Figure 3-1 Generate RSA Key and Key Hash</a></li>
<li><a href="#figure_3_2">Figure 3-2 RTK Default RSA Key and Key Hash</a></li>
<li><a href="#figure_3_3">Figure 3-3 Images to be Re-signed</a></li>
<li><a href="#figure_3_4">Figure 3-4 RTL87x3E Resign All Images</a></li>
<li><a href="#figure_3_5">Figure 3-5 RTL87x3E Only Resign App Image</a></li>
<li><a href="#figure_3_6">Figure 3-6 RTL87x3D Resign All Images</a></li>
<li><a href="#figure_3_7">Figure 3-7 MPPackTool</a></li>
<li><a href="#figure_3_8">Figure 3-8 Load Flash Layout</a></li>
<li><a href="#figure_3_9">Figure 3-9 Browse Images to Pack</a></li>
<li><a href="#figure_3_10">Figure 3-10 Load and Check Images</a></li>
<li><a href="#figure_3_11">Figure 3-11 Pack Done</a></li>
<li><a href="#figure_3_12">Figure 3-12 Generate Packed Image</a></li>
<li><a href="#figure_3_13">Figure 3-13 MPPGTool</a></li>
<li><a href="#figure_3_14">Figure 3-14 MP Mode</a></li>
<li><a href="#figure_3_15">Figure 3-15 Unlock Setting Interface</a></li>
<li><a href="#figure_3_16">Figure 3-16 Enter Password</a></li>
<li><a href="#figure_3_17">Figure 3-17 Password Modify Menu</a></li>
<li><a href="#figure_3_18">Figure 3-18 Modify Password</a></li>
<li><a href="#figure_3_19">Figure 3-19 RTL87x3D Load Packed Image and RSA Key Hash</a></li>
<li><a href="#figure_3_20">Figure 3-20 RTL87x3E Load Packed Image and RSA Key SHA256</a></li>
<li><a href="#figure_3_21">Figure 3-21 RTL87x3E Load Packed Image and MCU SDK Key</a></li>
<li><a href="#figure_3_22">Figure 3-22 MP Download</a></li>
<li><a href="#figure_5_1">Figure 5-1 Secure Boot Flow</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">ROM  </td><td class="markdownTableBodyCenter">Read Only Memory   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">RTK  </td><td class="markdownTableBodyCenter">RealTeK   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SoC  </td><td class="markdownTableBodyCenter">System On Chip   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">EVB  </td><td class="markdownTableBodyCenter">Evaluation Board   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MP  </td><td class="markdownTableBodyCenter">Mass Production   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PEM  </td><td class="markdownTableBodyCenter">Privacy Enhanced Mail   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">RSA  </td><td class="markdownTableBodyCenter">Rivest-Shamir-Adelman cryptographic algorithm   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AES  </td><td class="markdownTableBodyCenter">Advanced Encryption Standard   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CMAC  </td><td class="markdownTableBodyCenter">Cipher Block Chaining-Message Authentication Code   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SHA256  </td><td class="markdownTableBodyCenter">Secure Hash Algorithms with a digest size of 256 bits   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">OTA  </td><td class="markdownTableBodyCenter">Over The Air   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">XIP  </td><td class="markdownTableBodyCenter">eXecute In Place   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_Intro"></a>
1 Introduction</h2>
<p>This document is about the following content:</p><ol type="1">
<li>how to enable non-secure IC as secure IC;</li>
<li>how to generate rsa signature key;</li>
<li>how to prepare rsa signed images for the secure IC.</li>
</ol>
<p>If the IC is used as non-secure status in the project, and it doesn't need to be enabled into secure status, please skip this document.</p>
<p><b>Note:</b><br />
 User can get the IC secure status by the "Check Secure Boot" button in the RD_Download page of MPPGTOOL. For the detail operation method, please refer to the "Efuse SHA check" part in the "MPPGTool User Guide.docx" under the directory of MPPGTOOL.</p>
<h3><a class="anchor" id="SECURE_ENABLED_Secure_Boot"></a>
1.1 Secure Boot</h3>
<p>Secure Boot is used to enhance security authentication for the images in the boot procedure. Different algorithm mechanisms are used for the images in the different procedures, such as RSA-2048 signature, AES CMAC, AES ECB/CBC, SHA256, and CRC16.</p>
<ul>
<li>If the image is without valid CMAC in the image header, RSA verificaiton will be done in the first boot procedures, and the CMAC will be updated in the boot procedure when the RSA verification success. Then the CMAC verificaiton will be done in the future boot procedure to speed up the boot time.</li>
<li>There are sha256 value and crc16 value field in the image header, and the sha256 and crc16 are usually used to check the image integrity in the OTA upgrade procedure, and the SHA256 algorithm is also used in the RSA verificaiton procedure.</li>
<li>The AES ECB algorithm is used in the eFuse key management, and the AES CBC algorithm is used in the image encryption and decryption procedure for the ram code in the image. The application image usually run as flash XIP code because the code size is too big to put in the ram.</li>
<li>The RSA algorithm and AES algorithm for images are used with the key management mechanism in the eFuse, and the AES keys for image ram code encryption and decryption are bonded with the IC partnumber type privated by RTK. The RSA keys can be generated by users and privated by users. User only need to pay attention to the RSA verificaiton procedure.</li>
</ul>
<p>The RSA verificaiton is used for the image authentication, and there are two checking points for the images:</p><ol type="1">
<li>check RSA public key in the image with the RSA public key hash in the eFuse.</li>
<li>verify the RSA signature in the image.</li>
</ol>
<p>So if the Secure Boot status is enabled, the RSA public key hash should be burned into the eFuse of the IC, and all important images (e.g. App image developed by users) need to be signed before downloading into Flash. Since different users can use the tool provided by RTK to generate their own unique RSA Key, bonding chip with key can prevent potential risks caused by users's image leakage.<br />
</p>
<p>If user A and user B generate RSA key separately, the RSA key will be different and private. If user A wants to modify the images to run on the device of the specified user B, user A doesn't have the RSA key of user B, so the modified images can't run on the device of user B. And because the RSA key are different between user A and user B, their images can't run on each other's device. So it's important to protect the RSA key.</p>
<p>If the IC is non-secure status, it will be changed into secure status when user bond a RSA key with the IC.</p>
<p><b>Note:</b><br />
 Secure Boot cannot prevent images in Flash from being damaged (unintentionally or maliciously). It is designed to avoid the following situations: user's images are acquired and tampered by Hacker, and they try to re-run the images in the user IC, with the purpose of modifying the customer's product behavior.</p>
<h3><a class="anchor" id="SECURE_ENABLED_RSA_Sign"></a>
1.2 RSA Sign and Verify</h3>
<p>RSA Sign mentioned in this user guide refers to the action of RSA signature on the image using PC Tool provided by RTK. RSA Verify mentioned in this user guide refers to the action of RSA verification on images in Flash by Secure Bootloader.</p>
<h3><a class="anchor" id="SECURE_ENABLED_RSA_Key"></a>
1.3 RSA Key and Key Hash</h3>
<p>The RSA Key mentioned in this user guide refers to the RSA Private Key in PEM format generated by RSA key generator tool provided by RTK. This key is kept by users and used for users images RSA signing.</p>
<p>The RSA public key hash mentioned in this user guide refers to the SHA256 hash file in the binary format generated by RSA key generator tool. This file is kept by users and used for burning into eFuse, from where the Secure Bootloader would check whether the RSA public key hash matches with the RSA public key in the image header when doing image authentication.</p>
<h3><a class="anchor" id="SECURE_ENABLED_EVB_IC"></a>
1.4 EVB and MP IC</h3>
<p>Users can refer the different part of this document as follows:</p><ol type="1">
<li>The secure EVB has been bonded with RTK default RSA Key already, so there is no need to burn any key hash into EVB. Users only need to refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Sign_Images">3.2 Sign Images by Re-sign Tool</a> to do the re-sign step with the default key.</li>
<li>The secure IC for MP directly provided by RTK has not been bonded with any RSA key. Please refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_MP_Flow">3 MP Flow for Secure-Enabled Chip</a> to do the whole validation process.</li>
<li>For the non-secure IC which is needed to be changed into secure state, please refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_MP_Flow">3 MP Flow for Secure-Enabled Chip</a> to do the whole validation process. The non-secure IC will be changed into secure when the RSA public key hash is burned into the eFuse.</li>
</ol>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_Pre"></a>
2 Prerequisites</h2>
<h3><a class="anchor" id="SECURE_ENABLED_Toolset"></a>
2.1 Toolset</h3>
<p>First, please prepare the tools below:</p><ul>
<li>rsa_key_generator(v0.5.3 or above): used to generate the customer's own RSA key and public key hash.</li>
<li>resign_tool(v3.7 or above): used to re-sign images that need to be re-signed.</li>
<li>MPPGTool(v6.1.81.0 or above):<ul>
<li>pack the signed images with pack function under the tool menu of MPPGTOOL.</li>
<li>used to download the packed signed images into Flash.</li>
<li>used to burn RSA public key hash into eFuse (only once for each IC).</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="SECURE_ENABLED_Images"></a>
2.2 Images</h3>
<p>Please prepare images that need to be downloaded for the project.</p>
<h4><a class="anchor" id="SECURE_ENABLED_Images_87X3E"></a>
2.2.1 RTL87X3E Images</h4>
<p>Take the default images for primary device provided in the bin directory of RTL87X3E SDK-vX.X.X.X, and there are 16 images listed below to be downloaded.</p>
<p>Images under the bank directory is as <a href="#figure_2_1">Figure 2-1</a>:</p>
<div class="image">
<img src="RTL87X3E_SDK_IMG_1.png" alt="RTL87X3E_SDK_IMG_1.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 RTL87X3E SDK Bin Folder 1</b></div></center><p>Images generated by the MCUCfgTool are as <a href="#figure_2_2">Figure 2-2</a>:</p>
<div class="image">
<img src="RTL87X3E_SDK_IMG_2.png" alt="RTL87X3E_SDK_IMG_2.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 RTL87X3E SDK Bin Folder 2</b></div></center><p>The image type and image name mapping table for RTL87x3E is as <a href="#table_2_1">Table 2_1</a>.</p>
<div style="page-break-after: always;"></div> <center><div id="table_2_1"><b>Table 2-1 RTL87x3E Image Type and Name Mapping Table</b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">No.  </th><th class="markdownTableHeadNone">Image Type  </th><th class="markdownTableHeadNone">Image Name   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">System Config image  </td><td class="markdownTableBodyNone">SYSTEM_Config_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Boot Patch Image  </td><td class="markdownTableBodyNone">boot_patch_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">Platform ext Image  </td><td class="markdownTableBodyNone">platform_ext_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">Lowerstack ext Image  </td><td class="markdownTableBodyNone">lowerstack_ext_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">Upperstack Image  </td><td class="markdownTableBodyNone">upperstack_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">VP Data Image  </td><td class="markdownTableBodyNone">VPData_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone">OTA Header Image  </td><td class="markdownTableBodyNone">OTAHeader_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">FSBL Image  </td><td class="markdownTableBodyNone">fsbl_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9  </td><td class="markdownTableBodyNone">Sys Patch Image  </td><td class="markdownTableBodyNone">sys_patch_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">Stack Patch Image  </td><td class="markdownTableBodyNone">stack_patch_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">11  </td><td class="markdownTableBodyNone">App Image  </td><td class="markdownTableBodyNone">rws_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">App UI Parameter Image  </td><td class="markdownTableBodyNone">App_Config_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">13  </td><td class="markdownTableBodyNone">DSP SYS Image  </td><td class="markdownTableBodyNone">dsp_sys_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">14  </td><td class="markdownTableBodyNone">DSP APP Image  </td><td class="markdownTableBodyNone">dsp_app_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">15  </td><td class="markdownTableBodyNone">DSP UI Parameter Image  </td><td class="markdownTableBodyNone">dsp_config_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">16  </td><td class="markdownTableBodyNone">ANC image  </td><td class="markdownTableBodyNone">ANCxxxxx.bin   </td></tr>
</table>
<h4><a class="anchor" id="SECURE_ENABLED_Images_87X3D"></a>
2.2.2 RTL87X3D Images</h4>
<p>Take the default images in the bin directory of RTL87X3D SDK-vX.X.X.X in <a href="#figure_2_3">Figure 2-3</a>and <a href="#figure_2_4">Figure 2-4</a>, there are 11 images listed below to be downloaded.</p>
<div class="image">
<img src="RTL87X3D_SDK_IMG_1.png" alt="RTL87X3D_SDK_IMG_1.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 RTL87X3D SDK Bin Folder 1</b></div></center><div class="image">
<img src="RTL87X3D_SDK_IMG_2.png" alt="RTL87X3D_SDK_IMG_2.png"/>
</div>
 <center><div id="figure_2_4"><b>Figure 2-4 RTL87X3D SDK Bin Folder 2</b></div></center><p>The image type and image name mapping table for RTL87x3D is as <a href="#table_2_2">Table 2_2</a>.</p>
<div style="page-break-after: always;"></div> <center><div id="table_2_2"><b>Table 2-2 RTL87x3D Image Type and Name Mapping Table</b></div></center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">No.  </th><th class="markdownTableHeadNone">Image Type  </th><th class="markdownTableHeadNone">Image Name   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">System Config image  </td><td class="markdownTableBodyNone">SYSTEM_Config_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Boot Patch Image  </td><td class="markdownTableBodyNone">boot_patch_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">OTA Header Image  </td><td class="markdownTableBodyNone">OTAHeader_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">FSBL Image  </td><td class="markdownTableBodyNone">fsbl_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">ROM Patch Image  </td><td class="markdownTableBodyNone">patch_bankxxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">Stack Patch Image  </td><td class="markdownTableBodyNone">stack_patch_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone">App Image  </td><td class="markdownTableBodyNone">rws_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">App UI Parameter Image  </td><td class="markdownTableBodyNone">App_Config_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9  </td><td class="markdownTableBodyNone">DSP1 SYS Image  </td><td class="markdownTableBodyNone">dsp1_sys_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">DSP1 APP Image  </td><td class="markdownTableBodyNone">dsp1_app_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">11  </td><td class="markdownTableBodyNone">DSP2 SYS Image  </td><td class="markdownTableBodyNone">dsp2_sys_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">DSP3 app image  </td><td class="markdownTableBodyNone">dsp3_app_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">13  </td><td class="markdownTableBodyNone">DSP UI Parameter Image  </td><td class="markdownTableBodyNone">dsp_config_image_xxxx.bin   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">14  </td><td class="markdownTableBodyNone">ANC image  </td><td class="markdownTableBodyNone">ANCxxxxx.bin   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_MP_Flow"></a>
3 MP Flow for Secure-Enabled Chip</h2>
<p>The main purpose of validation on Secure Chip is to bond Chip and RSA Key.Note that this process only needs to be done once for a new Secure Chip.</p>
<p>For a new Secure Chip, please guarantee the following four points:</p><ol type="1">
<li>There should be a well-kept RSA Key and its corresponding Public Key Hash, such as default_rsa_key.pem and default_rsa_key_hash.bin.<br />
</li>
<li>Public Key Hash should be downloaded into eFuse (note that this step can only be performed in MP mode of MPPGTool).<br />
</li>
<li>The images that need to be re-signed should be re-signed.<br />
</li>
<li>The correctly signed images should be downloaded into Flash.<br />
</li>
</ol>
<p>For a validated Secure Chip, please make sure the following two points:</p><ol type="1">
<li>The images that need to be re-signed should be re-signed by correct RSA Key.<br />
</li>
<li>The correctly signed images should be downloaded into Flash.<br />
</li>
</ol>
<h3><a class="anchor" id="SECURE_ENABLED_Generate_RSA_Key"></a>
3.1 Generate RSA Key and Key Hash by RSA Key Generator</h3>
<p>RSA Key Generator Tool is a Windows command-line tool.</p>
<p>Open the cmd window in the directory of tool\Gadgets\rsa_key_generator.exe and input command:<br />
 &ensp;&ensp;&ensp;&ensp;<em>rsa_key_generator.exe -g file_name</em>.<br />
</p>
<p>Then a key named file_name and its corresponding hash will be generated.<br />
</p>
<p>For example, if a Key File named rsa_key is to be generated, just input command as shown in the following <a href="#figure_3_1">Figure 3-1</a>:<br />
 &ensp;&ensp;&ensp;&ensp;<em>rsa_key_generator.exe -g rsa_key</em><br />
</p>
<div class="image">
<img src="RSA_Key_and_Key_Hash.png" alt="RSA_Key_and_Key_Hash.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 Generate RSA Key and Key Hash</b></div></center><p>Three files will be generated in the current directory:</p><ol type="1">
<li><b>rsa_key.pem:</b> It is the RSA Private Key needed by re-sign tool to sign images.</li>
<li><b>rsa_key.pub:</b> It is an appendant RSA Public Key, which has no practical role for validation and can be ignored.</li>
<li><b>rsa_key_hash.bin:</b> It is the RSA Key Hash file needed by MPPGTool to validate new Secure Chip.</li>
</ol>
<p>In addition to RSA Key Generator Tool, a default RSA Key and its corresponding Key Hash File (default_rsa_key.pem and default_rsa_key_hash.bin) are provided in SDK and Secure Tool Pack by RTK, as shown in the following <a href="#figure_3_2">Figure 3-2</a>.</p>
<div class="image">
<img src="Default_RSA_Key_and_Key_Hash.png" alt="Default_RSA_Key_and_Key_Hash.png"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 RTK Default RSA Key and Key Hash</b></div></center><p><b>Note:</b><br />
 The default RSA key is provided for all SDK users by RTK. For the customer in RD stage, the default RSA key can be used to validate Secure Chip quickly and reduce the risk of the chaos of key management caused by the generation of multiple keys. However, this ease of use will eliminate Secure Boot's security advantages. Therefore, it is strongly recommended that users use the tool to generate their own RSA Key and Hash in MP stage and keep them safely to really protect their products.<br />
</p>
<h3><a class="anchor" id="SECURE_ENABLED_Sign_Images"></a>
3.2 Sign Images by Re-sign Tool</h3>
<p>Re-sign Tool is a Windows command-line tool. it's under tool\Gadgets\resign_tool directory of sdk. It can be used to re-sign single image or all the images in a directory at one time.</p>
<p>re-sign single image command line: <br />
 &ensp;&ensp;&ensp;&ensp;<em>resign_tool.exe -f img_file.bin -k rsa_key.pem</em><br />
</p>
<p>re-sign all images in a directory command line:<br />
 &ensp;&ensp;&ensp;&ensp;<em>resign_tool.exe -d resign_imgs_dir -k rsa_key.pem</em><br />
</p>
<p>For RTL87x3E, --sign_all or --sign_app_only is required to used to select the resign image type under the directory.</p>
<h4>3.2.1 RTL87X3E</h4>
<p>For RTL87x3E SDK, --sign_all or --sign_app_only is needed to be used with "-d resign_imgs_dir".<br />
</p>
<p>If only the app image under the directory is needed to be resigned, please use --sign_app_only.<br />
 &ensp;&ensp;&ensp;&ensp;<em>resign_tool.exe -d resign_imgs_dir -k rsa_key.pem --sign_app_only</em></p>
<p>If all images under the directory are needed to be resigned, please use --sign_all.<br />
 &ensp;&ensp;&ensp;&ensp;<em>resign_tool.exe -d resign_imgs_dir -k rsa_key.pem --sign_all</em></p>
<h4>3.2.2 RTL87X3D</h4>
<p>For RTL87X3D SDK, all images will be resigned by resign tool. --sign_all and --sign_app_only are not needed in the image directory resign. <br />
 refer as the following command line:<br />
 &ensp;&ensp;&ensp;&ensp;<em>resign_tool.exe -d resign_imgs_dir -k rsa_key.pem</em></p>
<p>The flow about how to re-sign images by Re-sign Tool and RSA Private Key (generated in <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Generate_RSA_Key">3.1 Generate RSA Key and Key Hash by RSA Key Generator</a>) is described below.</p>
<p>1.Create a new directory named resign_imgs in the resign_tool_amd64_v3.4 directory.</p>
<p>2.Copy the images that need to be re-signed or all sdk images (refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Images">2.2 Images</a>) to resign_imgs directory, as shown in the following <a href="#figure_3_3">Figure 3-3</a>.</p>
<div class="image">
<img src="Images_to_be_Re_signed.png" alt="Images_to_be_Re_signed.png"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 Images to be Re-signed</b></div></center><p>3.Copy rsa_key.pem generated in <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Generate_RSA_Key">3.1 Generate RSA Key and Key Hash by RSA Key Generator</a> to resign tool directory. Open cmd window in this directory and input command. <br />
&ensp;&ensp;&ensp;For RTL87x3D, use <em>resign_tool.exe -d resign_imgs -k rsa_key.pem</em>. <br />
&ensp;&ensp;&ensp;For RTL87x3E, resign all images under the specified directory, use <em>resign_tool.exe -d resign_imgs_dir -k rsa_key.pem --sign_all</em>. <br />
&ensp;&ensp;&ensp;For RTL87x3E, only resign app image under the specified directory, use <em>resign_tool.exe -d resign_imgs_dir -k rsa_key.pem --sign_app_only</em>.</p>
<p>&ensp;&ensp;&ensp;For RTL87x3E, resign all images as the following <a href="#figure_3_4">Figure 3-4</a>:</p>
<div class="image">
<img src="RTL87x3E_resign_all.png" alt="RTL87x3E_resign_all.png"/>
</div>
 <center><div id="figure_3_4"><b>Figure 3-4 RTL87x3E Resign All Images</b></div></center><p>&ensp;&ensp;&ensp;For RTL87x3E, only resign app image as the following <a href="#figure_3_5">Figure 3-5</a>:</p>
<div class="image">
<img src="RTL87x3E_resign_app_only.png" alt="RTL87x3E_resign_app_only.png"/>
</div>
 <center><div id="figure_3_5"><b>Figure 3-5 RTL87x3E Only Resign App Image</b></div></center><p>&ensp;&ensp;&ensp;For RTL87x3D, resign all images as the following <a href="#figure_3_6">Figure 3-6</a>:</p>
<div class="image">
<img src="RTL87x3D_resign_dir.png" alt="RTL87x3D_resign_dir.png"/>
</div>
 <center><div id="figure_3_6"><b>Figure 3-6 RTL87x3D Resign All Images</b></div></center><p><b>Note:</b></p><ol type="1">
<li>The file content and file name of images will change after re-signed.</li>
<li>Some old versions of Windows systems may fail with resign tools. If users encounter this problem, please refer to the usage document in the tool directory to solve it.</li>
<li>The resign tool supports resigning a single image or images in a directory for both RTL87X3E and RTL87X3D.</li>
<li>The resign tool may update in the future, get the resign tool under sdk tool\Gadgets\resign_tool directory.</li>
</ol>
<h3><a class="anchor" id="SECURE_ENABLED_Pack_Images"></a>
3.3 Pack Images by MPPGTOOL</h3>
<p>Image pack function is integrated in MPPGTool under the menu "Tool" -&gt; "Pack". Using this tool, all images to be downloaded into flash can be packed into a Pack File.</p>
<p>For RTL87X3E and RTL87X3D, the pack file types are different, but the pack procedures are similar.</p>
<p>First, select the IC Series and IC Type in the MPPGTool start page.<br />
</p>
<p>The pack flow by Pack function is described below, take RTL87X3E pack images as example.</p>
<p>1.Copy all the images (including images that do not to be signed in SDK and images have been re-signed by Re-sign Tool) to a folder (e.g. imgs_for_pack) before packing.</p>
<p>2.Open Pack function integrated in MPPGTool through the menu "Tool" -&gt;"Pack", and select For MP mode.</p>
<div class="image">
<img src="pack_secure_step1.png" alt="pack_secure_step1.png"/>
</div>
 <center><div id="figure_3_7"><b>Figure 3-7 MPPackTool</b></div></center><p>3.Click Load Flash Layout button to load flash map.ini, e.g. RTL87X3E-SDK-VX.X.X.X/bin/flash_map_config/flash_4M.</p>
<div class="image">
<img src="pack_secure_step2.png" alt="pack_secure_step2.png"/>
</div>
 <center><div id="figure_3_8"><b>Figure 3-8 Load Flash Layout</b></div></center><p>4.Choose bank and click Add Files button to add all the images in imgs_for_pack directory. For RTL87X3E and RTL87X3D, the supported image types are different.</p>
<div class="image">
<img src="pack_secure_step3.png" alt="pack_secure_step3.png"/>
</div>
 <center><div id="figure_3_9"><b>Figure 3-9 Browse Images to Pack</b></div></center><p>5.After images are loaded in, the log window in the lower right corner will prompt whether the information such as images format, version, address and so on are all passed by checking.</p>
<div class="image">
<img src="pack_secure_step4.png" alt="pack_secure_step4.png"/>
</div>
 <center><div id="figure_3_10"><b>Figure 3-10 Load and Check Images</b></div></center><p>6.Click Pack button to see the pack done prompt window.</p>
<div class="image">
<img src="pack_secure_step5.png" alt="pack_secure_step5.png"/>
</div>
 <center><div id="figure_3_11"><b>Figure 3-11 Pack Done</b></div></center><p>7.The packed image (ImgPacketFile-xxxxxxxxx.bin) will be generated in the selected directory.</p>
<div class="image">
<img src="pack_secure_step6.png" alt="pack_secure_step6.png"/>
</div>
 <center><div id="figure_3_12"><b>Figure 3-12 Generate Packed Image</b></div></center><p><b>Note:</b><br />
 For validated Secure Chip (that is, RSA Key Hash has been downloaded into eFuse), packing images before downlaoding is not necessary. The RD mode provided by MPPGTool can support single image downloading, users can refer to MPPGTool.</p>
<p>The reason why images need to be packed in Secure Chip validation is:</p><ol type="1">
<li>The function of burning RSA Key Hash into eFuse is only supported in MP mode of MPPGTool.<br />
</li>
<li>In MP mode of MPPGTool before v6.1.124.0, RSA Key Hash must be burned together with images downloading.In the MPPGTOOL v6.1.124.0 or above, RSA Key Hash can be burned independently without downlaoding image.<br />
</li>
<li>In MP mode of MPPGTool, only the packed images processed by Pack function can be downloaded.<br />
</li>
</ol>
<h3><a class="anchor" id="SECURE_ENABLED_DOWNLOAD_PUB_KEY_HASH"></a>
3.4 Download public key hash by MP Programming Tool</h3>
<p>MPPGTool is a Windows tool with UI.It can be used to download images into Flash. There are two modes in this tool: RD mode and MP mode. Please refer to MPPGTool User Guide document for the specific usage of the two modes. This document will only describe how to download RSA Key Hash to eFuse in MP mode.</p>
<p><b>Note:</b><br />
 The MPPGTOOL supports to download public key hash independently in the version v6.1.124.0 or above. Before the version v6.1.124.0, the public key hash should be downloaded together with the packed image downloading.</p>
<p>For RTL87x3e, eFuse power is related with VBAT. Please make sure the VBAT is charged.</p>
<p>1.Before using MPPGTool, make sure that the serial port of PCBA or EVB is connected properly and the system is in downloadable mode (aka HCI mode).</p>
<p>2.Open MPPGTool. Choose chip type and click the Confirm button.</p>
<div class="image">
<img src="download_secure_step1.png" alt="download_secure_step1.png"/>
</div>
 <center><div id="figure_3_13"><b>Figure 3-13 MPPGTool</b></div></center><p>3.Click 'Type' in the menu bar and choose 'MP' mode.</p>
<div class="image">
<img src="download_secure_step2.png" alt="download_secure_step2.png"/>
</div>
 <center><div id="figure_3_14"><b>Figure 3-14 MP Mode</b></div></center><p>4.Switch to the MP Setting interface, and the interface is inoperable at this moment. It is used to protect the setting against arbitrary modification.</p>
<p>5.Click the Unlock button and enter the password in the pop-up window to make the setting interface operable.</p>
<p>&ensp;&ensp;&ensp;The default unlock password is 1, and user can change the unlock password through the menu "Setting" -&gt; "Password Modify". If the user has forgotten the current unlock password, please refer the UNLOCK_PASSWORD item under the UNLockSetting section in the MPPGToolSetting.ini under the MPPGTOOL directory.<br />
</p>
<div class="image">
<img src="download_secure_step3.png" alt="download_secure_step3.png"/>
</div>
 <center><div id="figure_3_15"><b>Figure 3-15 Unlock Setting Interface</b></div></center><div class="image">
<img src="download_secure_step4.png" alt="download_secure_step4.png"/>
</div>
 <center><div id="figure_3_16"><b>Figure 3-16 Enter Password</b></div></center><div class="image">
<img src="password_modify_menu.png" alt="password_modify_menu.png"/>
</div>
 <center><div id="figure_3_17"><b>Figure 3-17 Password Modify Menu</b></div></center><div class="image">
<img src="modify_password_ui.png" alt="modify_password_ui.png"/>
</div>
 <center><div id="figure_3_18"><b>Figure 3-18 Modify Password</b></div></center><p>6.Load the packed image (refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Pack_Images">3.3 Pack Images by MPPGTOOL</a>) in "Packet File" box.</p>
<p>&ensp;&ensp;&ensp;This step is only used for the MPPGTOOL before the version v6.1.124.0, For the MPPGTOOL v6.1.124.0 or above,user can skip this operaton to download public key hash independently.</p>
<p>7.Load packed image and rsa key file.Then click Lock button.</p>
<p>&ensp;&ensp;For the MPPGTOOL before v6.1.124.0,select the public key hash file to download the public key hash in the packed image downloading procedure.</p>
<p>&ensp;&ensp;For RTL87x3D,if the IC part number supports to write public key sha256, In the MPPGTOOL MP_Settings page, there will be a groupbox about "Write sha256 key" in the ui. Enable "Write sha256 key" option and load the rsa_key_hash.bin (refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Generate_RSA_Key">3.1 Generate RSA Key and Key Hash by RSA Key Generator</a>).</p>
<div class="image">
<img src="RTL87x3D_write_key_sha256.png" alt="RTL87x3D_write_key_sha256.png"/>
</div>
 <center><div id="figure_3_19"><b>Figure 3-19 RTL87x3D Load Packed Image and RSA Key Hash</b></div></center><p>&ensp;&ensp;For RTL87x3E, the ICs of some part numbers need to write RSA key sha256. Then all images will be resigned. In the MPPGTOOL MP_Settings page, there's a groupbox about "Write Key" in the ui. Enable "Write RSA Key SHA256" option and load the customer_rsa_key_hash.bin(refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Generate_RSA_Key">3.1 Generate RSA Key and Key Hash by RSA Key Generator</a>).</p>
<div class="image">
<img src="RTL87x3E_write_rsa_key_sha256.png" alt="RTL87x3E_write_rsa_key_sha256.png"/>
</div>
 <center><div id="figure_3_20"><b>Figure 3-20 RTL87x3E Load Packed Image and RSA Key SHA256</b></div></center><p>&ensp;&ensp;For RTL87x3E, the MCU SDK part numbers need to write MCU SDK key. Then only app image will be resigned. In the MPPGTOOL MP_Settings page, there's a groupbox about "Write Key" in the ui. Enable "Write MCU SDK Key" option and load the mcu_sdk_rsa_key_hash.bin(refer to <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Generate_RSA_Key">3.1 Generate RSA Key and Key Hash by RSA Key Generator</a>).</p>
<div class="image">
<img src="RTL87x3E_MCU_SDK_hash.png" alt="RTL87x3E_MCU_SDK_hash.png"/>
</div>
 <center><div id="figure_3_21"><b>Figure 3-21 RTL87x3E Load Packed Image and MCU SDK Key</b></div></center><p>&ensp;&ensp;For the MPPGTOOL v6.1.124.0 or above, user can select the checkbox of "Only write key(bypass download image)" in the groupbox of "Write key" to skip the downloading image procedure.</p>
<div class="image">
<img src="only_write_pub_key_hash.png" alt="only_write_pub_key_hash.png"/>
</div>
 <center><div id="figure_3_22"><b>Figure 3-22 only write public key hash</b></div></center><p>8.Switch to the MP_dowload interface, Click the Download button to download images into Flash and Key Hash into eFuse respectively. <br />
 </p><div class="image">
<img src="download_secure_step6.png" alt="download_secure_step6.png"/>
</div>
 <center><div id="figure_3_23"><b>Figure 3-23 MP Download</b></div></center><p><b>Note:</b><br />
 For each Secure IC, RSA public key hash binary file only can be downloaded once.Repeated downlaoding will get an error prompt on the MPPGTool.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURITY_LEVEL"></a>
4 Security Level</h2>
<p>If the ic needs to set different security level, there are 3 security levels: 0, 1, and 2. Larger number indicates higher security level, which will affect efuse read/write. Function control of each module under different security level is listed as follow: </p><center><div id="table_4_1"><b>Table 4-1 Security Level Table</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Security Level<br />
  </th><th class="markdownTableHeadLeft">eFuse Read  </th><th class="markdownTableHeadLeft">eFuse Write<br />
(bypass flash scenario)  </th><th class="markdownTableHeadLeft">MP Flash Download<br />
  </th><th class="markdownTableHeadLeft">HCI BT Test<br />
   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><div style="width:140px">0</div>  </td><td class="markdownTableBodyLeft"><div style="width:230px">Enable</div>  </td><td class="markdownTableBodyLeft"><div style="width:250px">Enable</div>  </td><td class="markdownTableBodyLeft"><div style="width:200px">Enable </div>  </td><td class="markdownTableBodyLeft"><div style="width:150px">Enable</div>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1  </td><td class="markdownTableBodyLeft">Enabled by debug password  </td><td class="markdownTableBodyLeft">Enabled by debug password  </td><td class="markdownTableBodyLeft">Enable  </td><td class="markdownTableBodyLeft">Enable   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">2  </td><td class="markdownTableBodyLeft">Disable  </td><td class="markdownTableBodyLeft">Disable  </td><td class="markdownTableBodyLeft">Enable  </td><td class="markdownTableBodyLeft">Enable   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SECURE_ENABLED_FAQs"></a>
5 FAQs</h2>
<ol type="1">
<li>What is the meaning of the log "wdt reset(3), sb = 828, id = 0x2790, bk = 2, lr = 0x10f, sp = 0x2893a0"? <br />
 In the log, sb represents the line number for error in secure_boot.c and id represents the image ID of the image validated currently. <br />
 All the image ID values are as follows(not all image id are used for RTL87X3E or RTL87X3D,refer <a class="el" href="_u_m002__s_e_c_u_r_e__e_n_a_b_l_e_d.html#SECURE_ENABLED_Images">2.2 Images</a>): <div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#gaafcd13ecd413d322e8e0ee9d901964c3">_IMG_ID</a></div><div class="line">{</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3afb39f9c9833bf78b5b3acc24ab250615">IMG_OCCD</a>        = 0x278E,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a27074df962e41f730dbdc5318020c8b7">IMG_BOOTPATCH</a>   = 0x278F,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3ae9c5fe78bf4fb0fc7a4d2f68519cf423">IMG_OTA</a>         = 0x2790, <span class="comment">/* OTA header */</span></div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a8b71cc252881cfd6957207e08e1de8f0">IMG_SBL</a>         = 0x2791,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a5f39a9f4172bc26481ff03429cc56561">IMG_MCUPATCH</a>    = 0x2792,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a6f8c0721b32c159a651bec4e072a6251">IMG_MCUAPP</a>      = 0x2793,</div><div class="line">    IMG_DSPPATCH    = 0x2794,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a9ea267aa85e1dc2b1698f8024b994029">IMG_DSPAPP</a>      = 0x2795,</div><div class="line">    IMG_MCUDATA     = 0x2796,</div><div class="line">    IMG_DSPDATA     = 0x2797,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3aaecabfd50181c6acc0e0f149a5ebd825">IMG_ANC</a>         = 0x2798,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3ac09297eb9e43d75f749d07b7d3cfa602">IMG_EXT1</a>        = 0x2799,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a0b3a4bb7671937fea24ecddb1d71539c">IMG_EXT2</a>        = 0x279A,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a3c3a9834db808c87d7965a2f0267de4a">IMG_EXT3</a>        = 0x279B,</div><div class="line">    IMG_PLATFORM    = 0x279C,</div><div class="line">    IMG_LOWERSTACK  = 0x279D,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a597edb9ee9cc32a1efbbeeded4a0ade8">IMG_UPPERSTACK</a>  = 0x279E,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a3a4d93569e55f2afbbe01db7b034483c">IMG_FRAMEWORK</a>   = 0x279F,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a763edae71ee3af55cc00cb5455baf07f">IMG_SYSDATA</a>     = 0x27A0,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a71b3dd74eb58008a462f150093543d0e">IMAGE_MAX</a></div><div class="line">} <a class="code" href="group___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#gacfa373bf0533efafd8102646a61c9576">IMG_ID</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ga18924b4e8c61512604e22305c1138392">_PRE_IMG_ID</a></div><div class="line">{</div><div class="line">    PRE_IMG_SYSPATCH         = <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ggaafcd13ecd413d322e8e0ee9d901964c3a71b3dd74eb58008a462f150093543d0e">IMAGE_MAX</a>,</div><div class="line">    PRE_IMG_STACKPATCH       = 0x27A2,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#gga18924b4e8c61512604e22305c1138392a81e9d235e0a56f69401948dc28ddadef">PRE_IMG_UPPERSTACK</a>       = 0x27A3,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#gga18924b4e8c61512604e22305c1138392a2a4ab19716adac5f2d717d9725359ece">PRE_IMG_VP</a>               = 0x27A4,</div><div class="line">    <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#gga18924b4e8c61512604e22305c1138392abfcb53a5ce54bb9e05a8e05154878485">PRE_IMAGE_MAX</a></div><div class="line">} <a class="code" href="group__x3e___f_l_a_s_h___d_e_v_i_c_e___exported___types.html#ga23d88bfa7bf9fbbcbcc39dfc6574e9c9">PRE_IMG_ID</a>;</div></div><!-- fragment --> The image ID printed here is 0x2790 in hexadecimal so that it shows the OTA Header rsa verifing is failed. <br />
 The possible reasons are: <br />
 (1). The OTA bin file has not been downloaded. <br />
 (2). There are some errors when re-signing OTA bin file. <br />
 (3). The OTA bin file has been modified.</li>
<li>What is the meaning of the log "wdt reset(3), sb = 816, id = 0x2793, bk = 0, lr = 0x10f, sp = 0x2893a0"? <br />
 In the log, id is 0x2793 which represents app image. This log indicates that the rsa public key hash verificaiton is failed, User should check the app image has been burned to the specified flash address, and the image is signed with correct rsa key, then check whether the RSA Public Key Hash has been burned on the efuse.</li>
<li>What is the meaning of the log "port 0, SHA Conflict Error !" in MPPGTool when downloading images in MP mode? <br />
 This log indicates that an incorrect RSA Key Hash is tried to be burned into a secure chip which had already been bonded with another key hash.</li>
<li>What is the secure boot normal flow? <div class="image">
<img src="secure_boot_flow.png" alt="secure_boot_flow.png"/>
</div>
 <center><div id="figure_5_1"><b>Figure 5-1 Secure Boot Flow</b></div></center> <br />
 For 8763E, boot patch image is required. <br />
 For 8763D, boot patch image is required only when the efuse disable_boot_patch filed is burned as b'00. </li>
</ol>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
