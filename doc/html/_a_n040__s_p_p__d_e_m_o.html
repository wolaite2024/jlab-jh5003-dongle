<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="SPP_DEMO_USER_MANU"></a>
SPP Demo Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/05/19</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_DEMO_Revision_History"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2023/03/30  </td><td class="markdownTableBodyCenter">Adjust the document structure   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/05/19  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_DEMO_Revision_History">Revision History</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_DEMO_Table_List">Table List</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_DEMO_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_DEMO_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Demo_Intro">1 SPP Introduction</a><ul>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Role">1.1 SPP role featrues</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Stack">1.2 SPP profile stack</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_UUID">1.3 SPP UUID</a></li>
</ul>
</li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Demo_Proj_Ov">2 Project Overview</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Demo_Code_Ov">3 Source Code Overview</a><ul>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#Init">3.1 Initialization</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SDP">3.2 SPP SDP Record</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#Cback_Handler">3.3 SPP Callback Handler</a><ul>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#Gap_Cback">3.3.1 GAP Callback Handler</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Client_Cback">3.3.2 SPP Client Callback Handler</a></li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Server_Cback">3.3.3 SPP Server Callback Handler</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_a_n040__s_p_p__d_e_m_o.html#SPP_Demo_Test_Procedure">4 Test Procedure</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_DEMO_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_2_1">Table 2-1 File List</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_DEMO_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_1">Figure 1-1 SPP Role</a></li>
<li><a href="#figure_1_2">Figure 1-2 SPP Profile Structure</a></li>
<li><a href="#figure_2_1">Figure 2-1 Directory Structure</a></li>
<li><a href="#figure_3_1">Figure 3-1 SPP Connect Flow</a></li>
<li><a href="#figure_3_2">Figure 3-2 SPP Data Trx Flow</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_DEMO_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SPP  </td><td class="markdownTableBodyCenter">Serial Port Profile   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_Demo_Intro"></a>
1 SPP Introduction</h2>
<p>The purpose of this document is to give an overview of the Serial Port Profile(SPP) and demo application.<br />
 The SPP demo project implements a very simple SPP application and can be used as a framework for developing many different SPP applications.</p>
<h3><a class="anchor" id="SPP_Role"></a>
1.1 SPP role featrues</h3>
<p>SPP roles are typically defined as Figure 1-1.</p><ul>
<li>Device A (DevA) - This is the device that takes initiative to form a connection to another device.<ul>
<li>SPP client</li>
</ul>
</li>
<li>Device B (DevB) - This is the device that waits for another device to take initiative to connect.<ul>
<li>SPP server <div class="image">
<img src="spp_profile_scenario.jpg" alt="spp_profile_scenario.jpg"/>
</div>
 <center><div id="figure_1_1"><b>Figure 1-1 Serial Port profile </b></div></center></li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="SPP_Stack"></a>
1.2 SPP profile stack</h3>
<p>Protocols and entities used in SPP profile shown in Figure 1-2.</p><ul>
<li>The Baseband LMP and L2CAP are the OSI layer 1 and 2 Bluetooth protocols.</li>
<li>RFCOMM is the Bluetooth adaptation of GSM TS 07.10 , providing a transport protocol for serial port emulation.</li>
<li>SDP is the Bluetooth Service Discovery Protocol.</li>
</ul>
<div class="image">
<img src="protocol_model.jpg" alt="protocol_model.jpg"/>
</div>
 <center><div id="figure_1_2"><b>Figure 1-2 SPP Profile Structure </b></div></center><h3><a class="anchor" id="SPP_UUID"></a>
1.3 SPP UUID</h3>
<ul>
<li>Universally Unique Identifier(UUID) is a universally unique identifier that is guaranteed to be unique across all space and all time. UUIDs can be independently created in a distributed fashion. No central registry of assigned UUIDs is required. A UUID is a 128-bit value.</li>
<li>The full 128-bit value of a 16-bit or 32-bit UUID may be computed by a simple arithmetic operation:<ul>
<li>128_bit_value = 16_bit_value * 296 + Bluetooth_Base_UUID</li>
<li>128_bit_value = 32_bit_value * 296 + Bluetooth_Base_UUID</li>
<li>The Base UUID(Bluetooth_Base_UUID) is used for calculating 128-bit UUIDs from 'short UUIDs' (uuid16 and uuid32) as described in the SDP Specification: 00000000-0000-1000-8000-00805F9B34FB</li>
<li>A 16-bit UUID may be converted to 32-bit UUID format by zero-extending the 16-bit value to 32-bits. An equivalent method is to add the 16-bit UUID value toa zero-valued 32-bit UUID.</li>
</ul>
</li>
<li>Blutetooth SDP UUID numbers is defined in <a href="https://www.bluetooth.com/specifications/assigned-numbers/service-discovery/">https://www.bluetooth.com/specifications/assigned-numbers/service-discovery/</a>.</li>
<li>SPP UUID in SPP server and SPP client should be the same and registered using <a class="el" href="group___b_t___s_p_p.html#ga1607029cb335c8a9ae8d13e030b8cca8" title="Register SPP service. ">bt_spp_service_register()</a>.<br />
</li>
<li>Different SPP applications shall use different SPP UUIDs.</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_Demo_Proj_Ov"></a>
2 Project Overview</h2>
<p>This section describes project directory and project structure. Reference files directory as follows:</p><ul>
<li>Project directory: sdk\board\evb\spp_demo</li>
<li>Project source code directory: sdk\src\sample\spp_demo</li>
</ul>
<p>Directory structure of the project is shown in Figure 2-1: </p><div class="image">
<img src="spp_demo_project.jpg" alt="spp_demo_project.jpg"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Directory Structure </b></div></center><p>The file list is divided into the following groups: </p><center><div id="table_2_1"><b>Table 2-1 File List </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Directory  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">include  </td><td class="markdownTableBodyLeft">ROM UUID header files. User does not need to modify.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">lib  </td><td class="markdownTableBodyLeft">The protocol stack and gap library file. User does not need to modify.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">cmsis  </td><td class="markdownTableBodyLeft">The cmsis source code. User does not need to modify.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">app  </td><td class="markdownTableBodyLeft">The application source code. More information on these files can be found <br />
in SPP demo source code.   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_Demo_Code_Ov"></a>
3 Source Code Overview</h2>
<p>This section describes some parts of the source codes used in application of this project.</p>
<h3><a class="anchor" id="Init"></a>
3.1 Initialization</h3>
<p>Main function is invoked when the application is powered on or the chip resets and performs the following initialization functions. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga916f2adc2080b4fe88034086d107a8dc">board_init</a>();</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#ga59514b422707a3074faba295f9f299fa">spp_demo_role_set</a>(<span class="keyword">true</span>);<span class="comment">//set device spp role; false: client; true: server.</span></div><div class="line"></div><div class="line">    <a class="code" href="group___o_s__87x3d___message.html#ga78583ff4df155099dbb1592bd71dedfb">os_msg_queue_create</a>(&amp;<a class="code" href="group___s_p_p___d_e_m_o___t_a_s_k.html#gaf28a5b87658c372504d37477319b2c73">spp_demo_io_queue_handle</a>, <a class="code" href="group___s_p_p___d_e_m_o___t_a_s_k.html#gac882e62436b60c93e48ee461f0d19ea9">SPP_DEMO_MAX_NUMBER_OF_IO_MESSAGE</a>, <span class="keyword">sizeof</span>(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a>));</div><div class="line">    <a class="code" href="group___o_s__87x3d___message.html#ga78583ff4df155099dbb1592bd71dedfb">os_msg_queue_create</a>(&amp;<a class="code" href="group___s_p_p___d_e_m_o___t_a_s_k.html#ga0d5e9f800f6bad114cfd8b22be007ece">spp_demo_evt_queue_handle</a>, <a class="code" href="group___s_p_p___d_e_m_o___t_a_s_k.html#ga93f84cc41e95df685125b0b16d6fa469">SPP_DEMO_MAX_NUMBER_OF_EVENT_MESSAGE</a>,</div><div class="line">                        <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>));</div><div class="line"></div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#gae0e3245b704e5b87aba9ab8f4c8dbad0">framework_init</a>();</div><div class="line">    bt_gap_init();</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___g_a_p___exported___functions.html#ga5b04c50a6bf371b72684c8fae495ade3">spp_demo_gap_init</a>();</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___functions.html#gaefbd3a3a04638a712561f57ed2b138c4">spp_demo_sdp_init</a>();</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___a_p_p___exported___functions.html#ga08fd8083b3069a3d36e59c1aad35f5b6">spp_demo_app_init</a>();</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga2d5f6c88428ff65ce252e63964752e76">task_init</a>();</div><div class="line">    <a class="code" href="group___o_s__87x3e___schedule.html#ga3300197ad1a1b9d64a335dc4ffc0769f">os_sched_start</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>SPP proifle could be initialized as follows.</p><ul>
<li>SPP server/client may support SPP service, vendor SPP service or more services at the same time by registering related uuid and service channel with <a class="el" href="group___b_t___s_p_p.html#ga1607029cb335c8a9ae8d13e030b8cca8">bt_spp_service_register</a>.</li>
<li>SPP server/client may process the corresponding event by registering SPP porfile callback handler with <a class="el" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>. <div style="page-break-after: always;"></div> <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___s_p_p___d_e_m_o___a_p_p___exported___functions.html#ga08fd8083b3069a3d36e59c1aad35f5b6">spp_demo_app_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;spp_demo_app_init&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">//initialize the SPP capability with SPP_DEMO_LINK_NUM and SPP_DEMO_RFC_SPP_SERVICE_NUM;</span></div><div class="line">    <span class="comment">//only one SPP server channel exists in the unique link.</span></div><div class="line">    <a class="code" href="group___b_t___s_p_p.html#gaedb90b83a56a08058084e006d25ae0dc">bt_spp_init</a>(<a class="code" href="group___s_p_p___d_e_m_o___a_p_p___exported___macros.html#ga023fe4d8d89d17608e9ca632b574d2a1">SPP_DEMO_LINK_NUM</a>, <a class="code" href="group___s_p_p___d_e_m_o___a_p_p___exported___macros.html#gae697e7be7c4d0e88a982d54645a277fc">SPP_DEMO_RFC_SPP_SERVICE_NUM</a>);</div><div class="line"></div><div class="line">    <span class="comment">//enable or disable ERTM mode</span></div><div class="line">    <a class="code" href="group___b_t___s_p_p.html#gac4955ba358db41bda63ec0073bd19a2f">bt_spp_ertm_mode_set</a>(<span class="keyword">true</span>);<span class="comment">//enable spp l2cap ERTM mode.</span></div><div class="line"></div><div class="line">    <span class="comment">//register spp uuid together with local server channel.</span></div><div class="line">    <span class="comment">//register spp service with uuid.</span></div><div class="line">    <a class="code" href="group___b_t___s_p_p.html#ga1607029cb335c8a9ae8d13e030b8cca8">bt_spp_service_register</a>((uint8_t *)spp_demo_service_class_uuid128, <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>);</div><div class="line">    <a class="code" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>(spp_demo_app_bt_cback);</div><div class="line"></div><div class="line"><span class="preprocessor"> #ifdef RTK_VENDOR_SPP</span></div><div class="line">    <span class="comment">//register spp vendor uuid together with local server channel.</span></div><div class="line">    <span class="comment">//register vendor spp service with uuid.</span></div><div class="line">    <a class="code" href="group___b_t___s_p_p.html#ga1607029cb335c8a9ae8d13e030b8cca8">bt_spp_service_register</a>((uint8_t *)rtk_vendor_spp_service_class_uuid128, <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#ga9a39f02077e140e72ab7d55f311528e2">SPP_DEMO_RFC_VENDOR_SPP_CHANN_NUM</a>);</div><div class="line">    <a class="code" href="group___b_t___b_t_m.html#gad5518472fde08b8e93d5fc9c40d72f85">bt_mgr_cback_register</a>(spp_demo_app_vendor_bt_cback);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">}</span></div></div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="SDP"></a>
3.2 SPP SDP Record</h3>
<ul>
<li>SPP SDP local record should be registered by <a class="el" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef">bt_sdp_record_add</a>, SPP SDP local record includes the SPP service num. Moreover, SPP service num may be different in different SPP application.</li>
<li>For Serial Port Profile, 16-bit UUID 0x1101 <a class="el" href="group___b_t___t_y_p_e_s.html#gaa8bc4e348e8093266efe0fa323f592e9">UUID_SERIAL_PORT</a> is reserved, meanwhile, for Vendor Serial Port, 128-bit vendor UUID may be defined and used by the user.</li>
<li>SPP server may support SPP service, vendor SPP service or more services at the same time by registering the related sdp record. <div class="fragment"><div class="line"><span class="keyword">const</span> uint8_t spp_demo_sdp_record[] =</div><div class="line">{</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x4C,</div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_CLASS_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gaa8bc4e348e8093266efe0fa323f592e9">UUID_SERIAL_PORT</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gaa8bc4e348e8093266efe0fa323f592e9">UUID_SERIAL_PORT</a>),</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROTO_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x0c,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x05,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gae79453f41389da4c5f2bdd1b31814dd0">UUID_RFCOMM</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gae79453f41389da4c5f2bdd1b31814dd0">UUID_RFCOMM</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga87b74d21f9c850aa838ad27c2881982a">SDP_UNSIGNED_ONE_BYTE</a>,</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_BROWSE_GROUP_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_LANG_BASE_ATTR_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gac632e35802c2000d951d4cbfd76d581c">SDP_ATTR_LANG_BASE_ATTR_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gac632e35802c2000d951d4cbfd76d581c">SDP_ATTR_LANG_BASE_ATTR_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x09,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga59193fd534551a66c905f59a2e8a2292">SDP_LANG_ENGLISH</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga59193fd534551a66c905f59a2e8a2292">SDP_LANG_ENGLISH</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga9750914f645e442d203118942473e2a5">SDP_CHARACTER_UTF8</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga9750914f645e442d203118942473e2a5">SDP_CHARACTER_UTF8</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROFILE_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x08,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gaa8bc4e348e8093266efe0fa323f592e9">UUID_SERIAL_PORT</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gaa8bc4e348e8093266efe0fa323f592e9">UUID_SERIAL_PORT</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x01,<span class="comment">//version 1.2</span></div><div class="line">    0x02,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_NAME</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)((<a class="code" href="group___b_t___t_y_p_e_s.html#ga3c3fbd0a8e6f368f0a3261835901488d">SDP_ATTR_SRV_NAME</a> + <a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>) &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga3c3fbd0a8e6f368f0a3261835901488d">SDP_ATTR_SRV_NAME</a> + <a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>),</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga7e6da9cd524f983c421d0d84d65d8855">SDP_STRING_HDR</a>,</div><div class="line">    0x0B,</div><div class="line">    0x73, 0x65, 0x72, 0x69, 0x61, 0x6c, 0x20, 0x70, 0x6f, 0x72, 0x74 <span class="comment">//&quot;serial port&quot;</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef RTK_VENDOR_SPP</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> uint8_t rtk_vendor_spp_sdp_record[] =</div><div class="line">{</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x4E,</div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_CLASS_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x11,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga31854e0789725b5f0d793d694f93207c">SDP_UUID128_HDR</a>,</div><div class="line">    <span class="comment">//rtk_vendor_spp_service_class_uuid128</span></div><div class="line">    0x6a, 0x24, 0xee, 0xab, 0x4b, 0x65, 0x46, 0x93, 0x98, 0x6b, 0x3c, 0x26, 0xc3, 0x52, 0x26, 0x4f,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROTO_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga3e3afe98f67b0f02ee51ca67e2d257b6">SDP_ATTR_PROTO_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x0c,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga847ad44f6d4c69761ac39371da15020d">UUID_L2CAP</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x05,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gae79453f41389da4c5f2bdd1b31814dd0">UUID_RFCOMM</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gae79453f41389da4c5f2bdd1b31814dd0">UUID_RFCOMM</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga87b74d21f9c850aa838ad27c2881982a">SDP_UNSIGNED_ONE_BYTE</a>,</div><div class="line">    <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#ga9a39f02077e140e72ab7d55f311528e2">SPP_DEMO_RFC_VENDOR_SPP_CHANN_NUM</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_BROWSE_GROUP_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_LANG_BASE_ATTR_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#gac632e35802c2000d951d4cbfd76d581c">SDP_ATTR_LANG_BASE_ATTR_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#gac632e35802c2000d951d4cbfd76d581c">SDP_ATTR_LANG_BASE_ATTR_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x09,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga59193fd534551a66c905f59a2e8a2292">SDP_LANG_ENGLISH</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga59193fd534551a66c905f59a2e8a2292">SDP_LANG_ENGLISH</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga9750914f645e442d203118942473e2a5">SDP_CHARACTER_UTF8</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga9750914f645e442d203118942473e2a5">SDP_CHARACTER_UTF8</a>,</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_NAME</span></div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)((<a class="code" href="group___b_t___t_y_p_e_s.html#ga3c3fbd0a8e6f368f0a3261835901488d">SDP_ATTR_SRV_NAME</a> + <a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>) &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___t_y_p_e_s.html#ga3c3fbd0a8e6f368f0a3261835901488d">SDP_ATTR_SRV_NAME</a> + <a class="code" href="group___b_t___t_y_p_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>),</div><div class="line">    <a class="code" href="group___b_t___t_y_p_e_s.html#ga7e6da9cd524f983c421d0d84d65d8855">SDP_STRING_HDR</a>,</div><div class="line">    0x0B,</div><div class="line">    <span class="charliteral">&#39;r&#39;</span>, <span class="charliteral">&#39;t&#39;</span>, <span class="charliteral">&#39;k&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;v&#39;</span>, <span class="charliteral">&#39;n&#39;</span>, <span class="charliteral">&#39;d&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;s&#39;</span>, <span class="charliteral">&#39;p&#39;</span>, <span class="charliteral">&#39;p&#39;</span></div><div class="line">};</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___functions.html#gaefbd3a3a04638a712561f57ed2b138c4">spp_demo_sdp_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;spp_demo_sdp_init&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">//Add SPP local SDP record.</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef">bt_sdp_record_add</a>((<span class="keywordtype">void</span> *)spp_demo_sdp_record);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef RTK_VENDOR_SPP</span></div><div class="line">    <span class="comment">//Add vendor SPP local SDP record.</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef">bt_sdp_record_add</a>((<span class="keywordtype">void</span> *)rtk_vendor_spp_sdp_record);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">}</span></div></div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="Cback_Handler"></a>
3.3 SPP Callback Handler</h3>
<p>When device connected or spp data receiveed, callback handler can receive event.</p>
<h4><a class="anchor" id="Gap_Cback"></a>
3.3.1 GAP Callback Handler</h4>
<ul>
<li>Spp_demo_gap_bt_cback function is used to handle BT Manager Gap related events.</li>
<li>SPP client will call legacy_start_sdp_discov to discover the SPP SDP record in SPP server when receives BT_EVENT_BT_READY. <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> spp_demo_gap_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> BT_EVENT_BT_READY:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gafaa587f146374746f0dde8f673f6d63b">spp_demo_role_get</a>() == <span class="keyword">false</span>)</div><div class="line">            {</div><div class="line">                <a class="code" href="union_t___g_a_p___u_u_i_d___d_a_t_a.html">T_GAP_UUID_DATA</a> uuid;</div><div class="line">                <a class="code" href="group___g_a_p___b_r_e_d_r.html#gaa0986ce90f56b17df2aa7e55971fcf5f">T_GAP_UUID_TYPE</a> uuid_type = <a class="code" href="group___g_a_p___b_r_e_d_r.html#ggaa0986ce90f56b17df2aa7e55971fcf5faec9e3ab8b7cca88657e7c5ad9b8eb077">GAP_UUID16</a>;</div><div class="line"></div><div class="line">                uuid.<a class="code" href="union_t___g_a_p___u_u_i_d___d_a_t_a.html#af4fea99995e2110b688ca292edb5f462">uuid_16</a> = <a class="code" href="group___b_t___t_y_p_e_s.html#gae79453f41389da4c5f2bdd1b31814dd0">UUID_RFCOMM</a>;</div><div class="line">                legacy_start_sdp_discov(server_addr, uuid_type, uuid);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --></li>
<li>SPP client will call <a class="el" href="group___b_t___s_p_p.html#gada7bf51fc3d9ece908508076245488b1">bt_spp_registered_uuid_check</a> to check if SPP server supports SPP profile by UUID registered in <a class="el" href="group___s_p_p___d_e_m_o___a_p_p___exported___functions.html#ga08fd8083b3069a3d36e59c1aad35f5b6">spp_demo_app_init</a> or not and get local SPP service number when receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a4d6b781d7df2a68759c22de424935578">BT_EVENT_SDP_ATTR_INFO</a>.</li>
<li>For Serial Port Profile, 16-bit UUID 0x1101 <a class="el" href="group___b_t___t_y_p_e_s.html#gaa8bc4e348e8093266efe0fa323f592e9">UUID_SERIAL_PORT</a> is reserved, meanwhile, for Vendor Serial Port, 128-bit vendor UUID may be defined and used by the user.</li>
<li>SPP server may support SPP service, vendor SPP service or more services at the same time by registering the related uuid. <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t spp_demo_service_class_uuid128[16] =</div><div class="line">{</div><div class="line">    0x00, 0x00, 0x11, 0x01, 0x00, 0x00, 0x10, 0x00, 0x80, 0x00, 0x00, 0x80, 0x5f, 0x9b, 0x34, 0xfb</div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef RTK_VENDOR_SPP</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t rtk_vendor_spp_service_class_uuid128[16] =</div><div class="line">{</div><div class="line">    0x6a, 0x24, 0xee, 0xab, 0x4b, 0x65, 0x46, 0x93, 0x98, 0x6b, 0x3c, 0x26, 0xc3, 0x52, 0x26, 0x4f</div><div class="line">};</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --></li>
<li>If SPP server support SPP profile, SPP client will initiate the SPP profile connection by <a class="el" href="group___b_t___s_p_p.html#ga14a484afa3f2fe0b4aa0a5065ddd1de6">bt_spp_connect_req</a> when receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a66dd1bd42b4c9bbe3d0afd0b59eaac2f">BT_EVENT_SDP_DISCOV_CMPL</a>. <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> spp_demo_app_gap_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a4d6b781d7df2a68759c22de424935578">BT_EVENT_SDP_ATTR_INFO</a>:</div><div class="line">        {</div><div class="line">            uint8_t temp_local_server_chann = 0;</div><div class="line">            <span class="comment">//Remote SPP UUID check and get local SPP server channel.</span></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___b_t___s_p_p.html#gada7bf51fc3d9ece908508076245488b1">bt_spp_registered_uuid_check</a>(param-&gt;bt_sdp_attr_info.info.srv_class_uuid_type,</div><div class="line">                                             param-&gt;bt_sdp_attr_info.info.srv_class_uuid_data, &amp;temp_local_server_chann))</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (param-&gt;bt_sdp_attr_info.info.server_channel == <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">                {</div><div class="line">                    is_spp_sdp_ok = <span class="keyword">true</span>;</div><div class="line">                    local_server_chann = temp_local_server_chann;</div><div class="line">                    remote_server_channel = param-&gt;bt_sdp_attr_info.info.server_channel;</div><div class="line">                }</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef RTK_VENDOR_SPP</span></div><div class="line">                <span class="keywordflow">if</span> (param-&gt;bt_sdp_attr_info.info.server_channel == <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#ga9a39f02077e140e72ab7d55f311528e2">SPP_DEMO_RFC_VENDOR_SPP_CHANN_NUM</a>)</div><div class="line">                {</div><div class="line">                    is_vendor_spp_sdp_ok = <span class="keyword">true</span>;</div><div class="line">                    vendor_local_server_chann = temp_local_server_chann;</div><div class="line">                    vendor_remote_server_channel = param-&gt;bt_sdp_attr_info.info.server_channel;</div><div class="line">                }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a66dd1bd42b4c9bbe3d0afd0b59eaac2f">BT_EVENT_SDP_DISCOV_CMPL</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (is_spp_sdp_ok)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (param-&gt;bt_sdp_discov_cmpl.cause == 0x00)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___b_t___s_p_p.html#ga14a484afa3f2fe0b4aa0a5065ddd1de6">bt_spp_connect_req</a>(server_addr, remote_server_channel, <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gae4fe3ad368ce13daf92a4c5e54112247">SPP_DEMO_SPP_DEFAULT_MTU_SIZE</a>,</div><div class="line">                                       <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa87feae08c07e1f2052510f435bc003c">SPP_DEMO_SPP_DEFAULT_CREDITS</a>,</div><div class="line">                                       local_server_chann);</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef RTK_VENDOR_SPP</span></div><div class="line">            <span class="keywordflow">if</span> (is_vendor_spp_sdp_ok)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (param-&gt;bt_sdp_discov_cmpl.cause == 0x00)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___b_t___s_p_p.html#ga14a484afa3f2fe0b4aa0a5065ddd1de6">bt_spp_connect_req</a>(server_addr, vendor_remote_server_channel, <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gae4fe3ad368ce13daf92a4c5e54112247">SPP_DEMO_SPP_DEFAULT_MTU_SIZE</a>,</div><div class="line">                                       <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa87feae08c07e1f2052510f435bc003c">SPP_DEMO_SPP_DEFAULT_CREDITS</a>,</div><div class="line">                                       vendor_local_server_chann);</div><div class="line">                }</div><div class="line">            }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div><div class="line">}</div></div><!-- fragment --><ul>
<li>The spp connect flow is shown in Figure 3-1. <div class="image">
<img src="spp_connect_flow.png" alt="spp_connect_flow.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 SPP Connect Flow </b></div></center></li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="SPP_Client_Cback"></a>
3.3.2 SPP Client Callback Handler</h4>
<ul>
<li>SPP client:<ul>
<li>SPP profile connection is completed when it receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac490286996a17bd8fb85ea8f7e0172ae">BT_EVENT_SPP_CONN_CMPL</a>, SPP client should manage the SPP data transport according to SPP link credit and SPP frame size <a class="el" href="group___b_t___b_t_m.html#gaeafe5bb30db1be9d1b876ef555fedadd">T_BT_EVENT_PARAM_SPP_CONN_CMPL</a>. SPP link credit means the SPP tx transport window size and SPP frame size means the SPP tx/rx transport MTU size.</li>
<li>If Spp link credit is zero, then, it will be set according to <a class="el" href="group___b_t___b_t_m.html#ga2f78b6f543cc9cb16b7f06887c01f1b5">T_BT_EVENT_PARAM_SPP_CREDIT_RCVD</a> when recieve <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a881ea26067449d68e64af12b9a85921c">BT_EVENT_SPP_CREDIT_RCVD</a>. AnyWay, if SPP link credits is not zero, SPP client could send the tx data.</li>
<li>Spp client receives the SPP data from SPP server when it receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a53a1f1c2b9546b007f4ce073188d0393">BT_EVENT_SPP_DATA_IND</a>. Meanwhile, it should call <a class="el" href="group___b_t___s_p_p.html#gaf5cdeb5addaf55dbc59ad7aa7cbae82f">bt_spp_credits_give</a> to update the SPP server tx credit(SPP client rx window size). <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> spp_demo_app_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac490286996a17bd8fb85ea8f7e0172ae">BT_EVENT_SPP_CONN_CMPL</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_conn_cmpl.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_conn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                p_link-&gt;rfc_spp_credit = param-&gt;bt_spp_conn_cmpl.link_credit;</div><div class="line">                p_link-&gt;rfc_spp_frame_size = param-&gt;bt_spp_conn_cmpl.frame_size;</div><div class="line"></div><div class="line">                <span class="comment">//check credit</span></div><div class="line">                <span class="keywordflow">if</span> (p_link-&gt;rfc_spp_credit)</div><div class="line">                {</div><div class="line">                    <span class="comment">//spp send first data</span></div><div class="line">                    spp_demo_app_tx_data_test(param-&gt;bt_spp_conn_cmpl.bd_addr);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a881ea26067449d68e64af12b9a85921c">BT_EVENT_SPP_CREDIT_RCVD</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_credit_rcvd.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_credit_rcvd.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link == <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___t_r_a_c_e.html#gaf20aac2fd019420214bcab2eadd15156">APP_PRINT_ERROR0</a>(<span class="stringliteral">&quot;spp_demo_app_bt_cback: no acl link found&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> ((p_link-&gt;rfc_spp_credit == 0) &amp;&amp; (param-&gt;bt_spp_credit_rcvd.link_credit))</div><div class="line">            {</div><div class="line">                <span class="comment">//send data when spp tx credit is no more 0 or send first data.</span></div><div class="line">                spp_demo_app_tx_data_test(param-&gt;bt_spp_credit_rcvd.bd_addr);</div><div class="line">            }</div><div class="line">            p_link-&gt;rfc_spp_credit = param-&gt;bt_spp_credit_rcvd.link_credit;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a53a1f1c2b9546b007f4ce073188d0393">BT_EVENT_SPP_DATA_IND</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_data_ind.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_data_ind.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link == <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___t_r_a_c_e.html#gaf20aac2fd019420214bcab2eadd15156">APP_PRINT_ERROR0</a>(<span class="stringliteral">&quot;spp_demo_app_bt_cback: no acl link found&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">//spp data received.</span></div><div class="line">            spp_demo_app_rx_data_test(param-&gt;bt_spp_data_ind.bd_addr, param-&gt;bt_spp_data_ind.data,</div><div class="line">                                          param-&gt;bt_spp_data_ind.len);</div><div class="line">            <a class="code" href="group___b_t___s_p_p.html#gaf5cdeb5addaf55dbc59ad7aa7cbae82f">bt_spp_credits_give</a>(param-&gt;bt_spp_data_ind.bd_addr, param-&gt;bt_spp_data_ind.local_server_chann,</div><div class="line">                                1);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div></div><!-- fragment --></li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="SPP_Server_Cback"></a>
3.3.3 SPP Server Callback Handler</h4>
<ul>
<li>SPP server:<ul>
<li>SPP profile connection requst should be confirmed when it receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a10f93e18445def5447406fb7b14696f9">BT_EVENT_SPP_CONN_IND</a>.</li>
<li>SPP profile connection is completed when it receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac490286996a17bd8fb85ea8f7e0172ae">BT_EVENT_SPP_CONN_CMPL</a>, SPP server should manage the SPP data transport according to SPP link credit and SPP frame size <a class="el" href="group___b_t___b_t_m.html#gaeafe5bb30db1be9d1b876ef555fedadd">T_BT_EVENT_PARAM_SPP_CONN_CMPL</a>. SPP link credit means the SPP tx transport window size and SPP frame size means the SPP tx/rx transport MTU size.</li>
<li>If Spp link credit is zero, then, it will be set according to <a class="el" href="group___b_t___b_t_m.html#ga2f78b6f543cc9cb16b7f06887c01f1b5">T_BT_EVENT_PARAM_SPP_CREDIT_RCVD</a> when it receive <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a881ea26067449d68e64af12b9a85921c">BT_EVENT_SPP_CREDIT_RCVD</a>. AnyWay, if SPP link credits is not zero, SPP server could send the tx data.</li>
<li>Spp server receive the SPP data from SPP client when it receives <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a53a1f1c2b9546b007f4ce073188d0393">BT_EVENT_SPP_DATA_IND</a>. Meanwhile, it should call <a class="el" href="group___b_t___s_p_p.html#gaf5cdeb5addaf55dbc59ad7aa7cbae82f">bt_spp_credits_give</a> to update the SPP client tx credit(SPP server rx window size). <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> spp_demo_app_spp_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    ......</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac490286996a17bd8fb85ea8f7e0172ae">BT_EVENT_SPP_CONN_CMPL</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_conn_cmpl.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_conn_cmpl.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                p_link-&gt;rfc_spp_credit = param-&gt;bt_spp_conn_cmpl.link_credit;</div><div class="line">                p_link-&gt;rfc_spp_frame_size = param-&gt;bt_spp_conn_cmpl.frame_size;</div><div class="line"></div><div class="line">                <span class="comment">//check credit</span></div><div class="line">                <span class="keywordflow">if</span> (p_link-&gt;rfc_spp_credit)</div><div class="line">                {</div><div class="line">                    <span class="comment">//spp send first data</span></div><div class="line">                    spp_demo_app_tx_data_test(param-&gt;bt_spp_conn_cmpl.bd_addr);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a881ea26067449d68e64af12b9a85921c">BT_EVENT_SPP_CREDIT_RCVD</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_credit_rcvd.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_credit_rcvd.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link == <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___t_r_a_c_e.html#gaf20aac2fd019420214bcab2eadd15156">APP_PRINT_ERROR0</a>(<span class="stringliteral">&quot;spp_demo_app_bt_cback: no acl link found&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> ((p_link-&gt;rfc_spp_credit == 0) &amp;&amp; (param-&gt;bt_spp_credit_rcvd.link_credit))</div><div class="line">            {</div><div class="line">                <span class="comment">//send data when spp tx credit is no more 0 or send first data.</span></div><div class="line">                spp_demo_app_tx_data_test(param-&gt;bt_spp_credit_rcvd.bd_addr);</div><div class="line">            }</div><div class="line">            p_link-&gt;rfc_spp_credit = param-&gt;bt_spp_credit_rcvd.link_credit;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a53a1f1c2b9546b007f4ce073188d0393">BT_EVENT_SPP_DATA_IND</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_data_ind.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_data_ind.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link == <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___t_r_a_c_e.html#gaf20aac2fd019420214bcab2eadd15156">APP_PRINT_ERROR0</a>(<span class="stringliteral">&quot;spp_demo_app_bt_cback: no acl link found&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">//spp data recieved.</span></div><div class="line">            spp_demo_app_rx_data_test(param-&gt;bt_spp_data_ind.bd_addr, param-&gt;bt_spp_data_ind.data,</div><div class="line">                                          param-&gt;bt_spp_data_ind.len);</div><div class="line">            <a class="code" href="group___b_t___s_p_p.html#gaf5cdeb5addaf55dbc59ad7aa7cbae82f">bt_spp_credits_give</a>(param-&gt;bt_spp_data_ind.bd_addr, param-&gt;bt_spp_data_ind.local_server_chann,</div><div class="line">                                1);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a10f93e18445def5447406fb7b14696f9">BT_EVENT_SPP_CONN_IND</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (param-&gt;bt_spp_conn_ind.local_server_chann != <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa5085b473ce7ad3bfe4d1057fde3f22d">SPP_DEMO_RFC_SPP_CHANN_NUM</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___s_p_p___d_e_m_o___l_i_n_k___exported___functions.html#gad544e5b882e392b1262a56e212e4da0f">spp_demo_find_link</a>(param-&gt;bt_spp_conn_ind.bd_addr);</div><div class="line">            <span class="keywordflow">if</span> (p_link == <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___t_r_a_c_e.html#gaf20aac2fd019420214bcab2eadd15156">APP_PRINT_ERROR0</a>(<span class="stringliteral">&quot;spp_demo_app_bt_cback: no acl link found&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            uint8_t local_server_chann = param-&gt;bt_spp_conn_ind.local_server_chann;</div><div class="line">            uint16_t frame_size = param-&gt;bt_spp_conn_ind.frame_size;</div><div class="line">            <a class="code" href="group___b_t___s_p_p.html#ga9b64b7e36b89b1f03adfe07fea26819a">bt_spp_connect_cfm</a>(p_link-&gt;bd_addr, local_server_chann, <span class="keyword">true</span>, frame_size,</div><div class="line">                               <a class="code" href="group___s_p_p___d_e_m_o___s_d_p___exported___macros.html#gaa87feae08c07e1f2052510f435bc003c">SPP_DEMO_SPP_DEFAULT_CREDITS</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    ......</div></div><!-- fragment --></li>
</ul>
</li>
</ul>
<p>The spp data transfer and receive flow is shown in Figure 3-2. </p><div class="image">
<img src="spp_data_trx_flow.png" alt="spp_data_trx_flow.png"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 SPP Data Trx Flow </b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="SPP_Demo_Test_Procedure"></a>
4 Test Procedure</h2>
<p>In order to demo spp application, you need to do step by step as follows:</p>
<p>1 Prepare 2 sets of Evolution Boards, EVB 1 and EVB 2</p>
<p>2 Build and Download the SPP DEMO application binary to the EVBs</p>
<ul>
<li>2.1. Generate spp server demo bin and downlaod to EVB 1:<ul>
<li>set the SPP_DEMO_SERVER_ROLE in app_flag.h to 1, build and generate spp_demo_bank0_MP-xxx.bin, download it to EVB 1</li>
<li>the spp server demo bin can also find in bin</li>
</ul>
</li>
<li>2.2. Generate spp client demo bin and downlaod to EVB 2:<ul>
<li>set the SPP_DEMO_SERVER_ROLE in app_flag.h to 2, build and generate spp_demo_bank0_MP-xxx.bin, download it to EVB 2</li>
<li>the spp client demo bin can also find in bin</li>
</ul>
</li>
</ul>
<p>3 Reset and power on two EVBs, the EVB as server will auto connect to the EVB as client according to demo source code</p>
<p>4 After log tool shows BT_EVENT_SPP_CONN_CMPL in callback, data tx/rx can be test through spp. </p><blockquote class="doxtable">
<p><em>Log tool shows</em> : <br />
 [APP] spp_demo_app_bt_cback: event_type 0x3001 </p>
</blockquote>
<ul>
<li>4.1. According to demo source code, the EVB as server will auto send data to the EVB as client. When the EVB as client received data, it will also send data to the EVB as server. The following logs can be seen in log tool.</li>
</ul>
<blockquote class="doxtable">
<p><em>Log tool shows</em> : <br />
 [APP] spp_demo_app_bt_cback: event_type 0x3005 </p>
</blockquote>
<blockquote class="doxtable">
<p><em>Log tool shows</em> : <br />
 [APP] spp_demo_app_rx_data_test: buf[i:0] 0x1 <br />
 [APP] spp_demo_app_rx_data_test: buf[i:1] 0x2 <br />
 [APP] spp_demo_app_rx_data_test: buf[i:2] 0x3 <br />
 [APP] spp_demo_app_rx_data_test: buf[i:3] 0x4 <br />
 [APP] spp_demo_app_rx_data_test: buf[i:4] 0x5 <br />
 </p>
</blockquote>
<ul>
<li>4.2. If more data is need to send, spp_demo_app_tx_data_test can be used. Then if data is received, tool shows <a class="el" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a53a1f1c2b9546b007f4ce073188d0393">BT_EVENT_SPP_DATA_IND</a> in callback. </li>
</ul>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
