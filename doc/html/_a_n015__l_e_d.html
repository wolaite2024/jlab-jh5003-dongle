<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="Led_Page"></a>
LED Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.3</b></center><p><br />
 </p><center><b>2023/05/23</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.0.0.1  </td><td class="markdownTableBodyCenter">2022/11/07  </td><td class="markdownTableBodyCenter">Add high active/low active LED warning   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.2  </td><td class="markdownTableBodyCenter">2023/05/18  </td><td class="markdownTableBodyCenter">Optimize content   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.3  </td><td class="markdownTableBodyCenter">2023/05/23  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Rev">Revision History</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Table_List">Table List</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Mode_Overview">2 LED Mode Overview</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_McuConfigTool_Configuration">3 McuConfigTool Configuration</a><ul>
<li><a class="el" href="_a_n015__l_e_d.html#Led_McuConfigTool_HW_Settings">3.1 LED Hardware Settings</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_McuConfigTool_Behavior_Settings">3.2 LED Behavior Settings</a></li>
</ul>
</li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Flow_Overview">4 LED Flow Overview</a><ul>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Mode_Priority">4.1 Priority of LED Modes</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Synchronous_Mechanism">4.2 LED Mode Synchronous Mechanism</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Mode_Judgement">4.3 LED Mode Judgement</a></li>
</ul>
</li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Customized_Mode">5 Add a Customized LED Mode</a></li>
<li><a class="el" href="_a_n015__l_e_d.html#Led_Power_Saving">6 LED Power Saving</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_4_1">Table 4-1 LED Mode Priority</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_3_1">Figure 3-1 Enable LED Module and Setting LED Counts</a></li>
<li><a href="#figure_3_2">Figure 3-2 Setting LED Pinmux</a></li>
<li><a href="#figure_3_3">Figure 3-3 LED Tab Settings</a></li>
<li><a href="#figure_3_4">Figure 3-4 LED0 with ANC ON Specified Function 1</a></li>
<li><a href="#figure_3_5">Figure 3-5 LED0 with ANC ON Specified Function 2</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Glossary"></a>
Glossary</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Introduction"></a>
1 Introduction</h2>
<p>The LED function is composed of two portions: LED module (led_module.c) and LED application (app_led.c). <br />
</p><ul>
<li>LED module provides APIs to easily configure LED display patterns, such as on, off, blink, breath, etc. <br />
</li>
<li>LED application provides pre-defined LED modes for different use cases. <br />
</li>
</ul>
<p>The maximum number of LED modes, consisting of repeat and non-repeat modes, is limited to 32 in the McuConfigTool configuration. The remaining LED modes defined in the RAM table are not available to change display patterns in McuConfigTool.</p>
<p>LED can be controlled by Hardware (Sleep LED) or Software program (SW LED).</p><ul>
<li>Only the following GPIO pins are available for Sleep LED:<ul>
<li>RTL87X3D: P0_0, P0_1, P0_6, P0_7, P1_0, P1_1, P1_4, P2_0, P2_1, P2_2</li>
<li>RTL87X3E: P0_0, P0_1, P1_0, P1_1, P1_1, P2_2, P2_3, P2_4, P3_0, P3_1</li>
<li>RTL87X3G: P0_0, P0_1, P1_0, P1_1, P2_1, P2_2, P2_3, P2_4, P3_0, P3_1</li>
</ul>
</li>
<li>The other GPIO pins are available for SW LED.</li>
<li>SW LED with breath type can not enter power saving mode.</li>
<li>More information about Sleep LED can refer to <a class="el" href="_u_m012__i_o__d_e_m_o.html#SLEEP_LED">17 SLEEP LED</a> of <a class="el" href="_u_m012__i_o__d_e_m_o.html#IO_Demo_App_Page">IO User Manual </a>.</li>
</ul>
<p><b>LED Features:</b></p><ul>
<li>Max 3 channels LED display</li>
<li>Display types:<ol type="1">
<li>Always Off</li>
<li>Always On</li>
<li>On/Off repeat</li>
<li>Off/On repeat</li>
<li>Breath</li>
<li>Bypass</li>
</ol>
</li>
</ul>
<p><b>LED display parameters:</b></p><ul>
<li>Type</li>
<li>On time (unit 10ms)</li>
<li>Off time (unit 10ms)</li>
<li>Blink count (range {0,1,2,3,4})</li>
<li>Blink interval (unit 100ms)</li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Mode_Overview"></a>
2 LED Mode Overview</h2>
<p>LED modes have 2 categories:</p><ul>
<li>Repeat LED Mode</li>
<li>Non-repeat LED mode</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    <span class="comment">/* Repeat LED Mode */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa01f7a5a2ce2d7a537ae3b35b57fe56e5">LED_MODE_DONGLE_MODE</a>,                   <span class="comment">//0x00</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aab83c47794e03257e1ac1e5382fe84b62">LED_MODE_RSV2</a>,                          <span class="comment">//0x01</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aab9d55eade8d5ca1dbcac2017ada6dcc5">LED_MODE_LINK_BACK</a>,                     <span class="comment">//0x02</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa67a94a30b0a7b0d25b7771ea8ba18750">LED_MODE_STANDBY</a>,                       <span class="comment">//0x03</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa6df1fcf18fff854a48f537b386cfce4b">LED_MODE_PAIRING</a>,                       <span class="comment">//0x04</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa180e457ef186f89b8d1104fd29f4f6ef">LED_MODE_CONNECTED_SINGLE_LINK</a>,         <span class="comment">//0x05</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aae2bd94f541dccda5172bf835a1e6597e">LED_MODE_CONNECTED_MULTI_LINK</a>,          <span class="comment">//0x06</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aad2ddb4e2f499421cfd78ae9f8720f033">LED_MODE_INCOMING_CALL</a>,                 <span class="comment">//0x07</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aad35a18e994dd91bec85243ba0b1337a4">LED_MODE_TALKING</a>,                       <span class="comment">//0x08</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaea7d2218f5781cd15ccd9736ddc72016">LED_MODE_MIC_MUTE</a>,                      <span class="comment">//0x09</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa53823706ddf4ee44b3d02ab0e506db2c">LED_MODE_AUDIO_PLAYING</a>,                 <span class="comment">//0x0A</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa68b68bcf175142557979058da61011be">LED_MODE_APT_ON</a>,                        <span class="comment">//0x0B</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aacedbf8e1811616228221aeaefef1d4b0">LED_MODE_RWS_CREATION</a>,                  <span class="comment">//0x0C  // AUX-IN also use this</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aae1db3af933e94c2967b1feae10b224ad">LED_MODE_OUTGOING_CALL</a>,                 <span class="comment">//0x0D</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aac6b082b97f014c427d0abee923dab0ec">LED_MODE_BUD_FIRST_ENGAGE_CREATION</a>,     <span class="comment">//0x0E</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa6b0c018fed293be679e9a3759471d3a6">LED_MODE_ANC_ON</a>,                        <span class="comment">//0x0F</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aacbcfb629b63efa21af845f0b896dc6c8">LED_MODE_BUD_ROLE_PRIMARY</a>,              <span class="comment">//0x10</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa0be81f88c14964fa946b3cae904f64f4">LED_MODE_BUD_ROLE_SECONDARY</a>,            <span class="comment">//0x11</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa688ac00891719353bf166128fb3b43f1">LED_MODE_CHARGING</a>,                      <span class="comment">//0x12</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa62ff0bacaa72aac9e1491f89aff5e26e">LED_MODE_CHARGING_COMPLETE</a>,             <span class="comment">//0x13</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aacc89c32e4bb7d69b37062d015ef65e52">LED_MODE_CHARGING_ERROR</a>,                <span class="comment">//0x14</span></div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaea3382892c45a6c97120fc4c294021dc">LED_MODE_DUT_TEST_MODE</a>,                 <span class="comment">//0x15</span></div><div class="line"></div><div class="line">    <span class="comment">// may be a repeat or non-repeat mode according to the McuConfig setting</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaa98a7afaf40ae6aa6f6bc00581de0174">LED_MODE_GAMING_MODE</a>,                   <span class="comment">//0x16</span></div><div class="line"></div><div class="line">    <span class="comment">/* Non-Repeat LED Mode */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa9bcf12a2d77186a388ed1c8986cd2af4">LED_MODE_POWER_ON</a>,                      <span class="comment">//0x17</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaf2b9441a8d882272bb7e414c6418d1e2">LED_MODE_POWER_OFF</a>,                     <span class="comment">//0x18</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaf0fc25a7c04c17cd557e0d653d48307c">LED_MODE_PAIRING_COMPLETE</a>,              <span class="comment">//0x19</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa112402ac68be1301f81b54f448211365">LED_MODE_FACTORY_RESET</a>,                 <span class="comment">//0x1A</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaf775c4c28b608c6a41966823d3b72068">LED_MODE_LOW_BATTERY</a>,                   <span class="comment">//0x1B</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa16d4de5d1c923fc65f85ba2a606e4fc7">LED_MODE_RSV3</a>,                          <span class="comment">//0x1C</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa8c227b9beeb4ea509efae4ec2dfc704c">LED_MODE_VOL_ADJUST</a>,                    <span class="comment">//0x1D</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aafa3a1badb7488a9ea239e1a603ab2e9a">LED_MODE_VOL_MAX_MIN</a>,                   <span class="comment">//0x1E</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa2db7d7e6a3f2dbb58c56cdacdd904c11">LED_MODE_ENTER_PCBA_SHIPPING_MODE</a>,      <span class="comment">//0x1F</span></div><div class="line"></div><div class="line">    <span class="comment">/* Do not use, means the start point of LED modes from RAM table */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa839044af3f99aa220f162618f9567e91">LED_MODE_RAM_TABLE_START</a>,               <span class="comment">//0x20</span></div><div class="line"></div><div class="line">    <span class="comment">/* Repeat LED Mode, defined in RAM */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaebf96b1c870abbe63f09f2f4e5948776">LED_MODE_ALL_BLINKING</a>,                  <span class="comment">//0x21</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aabb535ffe34c37e979b2163952ff8ed95">LED_MODE_ALL_OFF</a>,                       <span class="comment">//0x22</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa88025198d808701abc1bfdbfa6727f1e">LED_MODE_ALL_ON</a>,                        <span class="comment">//0x23</span></div><div class="line"></div><div class="line">    <span class="comment">/* The end point of LED modes */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa9eb5a0b99ed71628fae1d64c99c10625">LED_MODE_TOTAL</a>                          <span class="comment">//0x24</span></div><div class="line">} <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ga471fba543b9cfdb2f840c06cb9113cc3">T_LED_MODE</a>;</div></div><!-- fragment --><p> <br />
 </p><div class="fragment"><div class="line"><span class="comment">// constant LED modes, define in ram</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="struct_t___l_e_d___t_a_b_l_e.html">T_LED_TABLE</a> LED_RAM_TABLE[LED_RAM_MODE_TOTAL][LED_NUM] =</div><div class="line">{</div><div class="line">    <span class="comment">//LED_MODE_ALL_BLINKING</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11a9e004cac18fdafa704bc7b637f74920c">LED_TYPE_ON_OFF</a>, 5, 5, 4, 0},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11a9e004cac18fdafa704bc7b637f74920c">LED_TYPE_ON_OFF</a>, 5, 5, 4, 0},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11a9e004cac18fdafa704bc7b637f74920c">LED_TYPE_ON_OFF</a>, 5, 5, 4, 0}</div><div class="line">    },</div><div class="line"></div><div class="line">    <span class="comment">//LED_MODE_ALL_OFF</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>}</div><div class="line">    },</div><div class="line"></div><div class="line">    <span class="comment">//LED_MODE_ALL_ON</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>}</div><div class="line">    },</div><div class="line">};</div></div><!-- fragment --><div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_McuConfigTool_Configuration"></a>
3 McuConfigTool Configuration</h2>
<h3><a class="anchor" id="Led_McuConfigTool_HW_Settings"></a>
3.1 LED Hardware Settings</h3>
<p>LEDs can be enabled in the "HW Feature" tab to select LED counts and assign LED pins. </p><div class="image">
<img src="mcuconfig_led_enable.png" alt="mcuconfig_led_enable.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 Enable LED Module and Setting LED Counts</b></div></center><p> <br />
 </p><div class="image">
<img src="mcuconfig_led_pin_setting.png" alt="mcuconfig_led_pin_setting.png"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 Setting LED Pinmux</b></div></center><div style="page-break-after: always;"></div><h3><a class="anchor" id="Led_McuConfigTool_Behavior_Settings"></a>
3.2 LED Behavior Settings</h3>
<p>The settings of LED behaviors are shown below. Please refer to McuConfigTool User Guide for the introductions of each UI option. </p><div class="image">
<img src="mcuconfig_led_tab_settings.png" alt="mcuconfig_led_tab_settings.png"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 LED Tab Settings</b></div></center><ol type="1">
<li>LED active <br />
<ul>
<li>Each LED can be configured to be high/low active.</li>
<li>If a default pull-up pin is used as a high/low active LED, or any other pull-down pin is used as a low active LED, it will blink when the system boots. Please refer to the hardware design to avoid this.<ul>
<li>For both RTL87X3D and RTL87X3E, P1_0/P1_1/P2_0/P3_0/P3_1 are default pull up. <br />
<br />
</li>
</ul>
</li>
</ul>
</li>
<li>LED Specify Function <br />
 LED Specify Function is used to config a LED for a specific function listed below. <div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    LED_SPECIFY_FUNCTION_NONE,</div><div class="line">    LED_SPECIFY_FUNCTION_ANC_ON,</div><div class="line">    LED_SPECIFY_FUNCTION_APT_ON,</div><div class="line">    LED_SPECIFY_FUNCTION_ANC_APT_ON,</div><div class="line">} T_APP_LED_SPECIFY_MODE;</div></div><!-- fragment --> <br />
 If the LED Specify Function is not LED_SPECIFY_FUNCTION_NONE, certain LED is only available for specific functions. For example, if LED 0 is specified with the function "ANC ON", LED 0 is only available for ANC On mode.</li>
</ol>
<div class="image">
<img src="mcuconfig_led_specify1.png" alt="mcuconfig_led_specify1.png"/>
</div>
 <center><div id="figure_3_4"><b>Figure 3-4 LED0 with ANC ON Specified Function 1</b></div></center><p> <br />
 </p><div class="image">
<img src="mcuconfig_led_specify2.png" alt="mcuconfig_led_specify2.png"/>
</div>
 <center><div id="figure_3_5"><b>Figure 3-5 LED0 with ANC ON Specified Function 2</b></div></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Flow_Overview"></a>
4 LED Flow Overview</h2>
<h3><a class="anchor" id="Led_Mode_Priority"></a>
4.1 Priority of LED Modes</h3>
<p>When a non-repeat LED mode is active, led_stop_check is set to 1 to prevent any repeat LED mode interruption. The priority of LED modes can be summarized as below: </p><center><div id="table_4_1"><b>Table 4-1 LED Mode Priority</b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Priority  </th><th class="markdownTableHeadNone">Category  </th><th class="markdownTableHeadNone">LED mode   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">Non-repeat Mode  </td><td class="markdownTableBodyNone">All   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">Specify Function  </td><td class="markdownTableBodyNone">ANC On   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">Specify Function  </td><td class="markdownTableBodyNone">APT/LLAPT On   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">Specify Function  </td><td class="markdownTableBodyNone">ANC On/APT On   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">Charger  </td><td class="markdownTableBodyNone">Charging   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">Charger  </td><td class="markdownTableBodyNone">Charging Complete   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">Charger  </td><td class="markdownTableBodyNone">Charging Error   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Call Status (BT)  </td><td class="markdownTableBodyNone">MIC Mute   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Call Status (BT)  </td><td class="markdownTableBodyNone">Talking   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Call Status (BT)  </td><td class="markdownTableBodyNone">Incoming Call   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Call Status (BT)  </td><td class="markdownTableBodyNone">Outgoing Call   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">Call Status (Dongle)  </td><td class="markdownTableBodyNone">MIC Mute   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">Call Status (USB)  </td><td class="markdownTableBodyNone">MIC Mute   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">AUX-IN  </td><td class="markdownTableBodyNone">AUX-IN Playing   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">RWS Creation (with UI timer setting)  </td><td class="markdownTableBodyNone">RWS Creation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Pairing   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Audio Playing   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">RWS Creation  </td><td class="markdownTableBodyNone">Bud First Engage Creation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">RWS Creation (without UI timer setting)  </td><td class="markdownTableBodyNone">RWS Creation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">9  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Link-Back   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">Listening mode  </td><td class="markdownTableBodyNone">ANC On   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">Listening mode  </td><td class="markdownTableBodyNone">APT On/LLAPT On   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">11  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Dongle mode   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Multi-link Connected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Single link Connected   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Bud Role Primary   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Bud Role Secondary   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">13  </td><td class="markdownTableBodyNone">BT state  </td><td class="markdownTableBodyNone">Standby (Default)   </td></tr>
</table>
<div style="page-break-after: always;"></div><h3><a class="anchor" id="Led_Synchronous_Mechanism"></a>
4.2 LED Mode Synchronous Mechanism</h3>
<p>LED mode synchronous mechanism is activated when two buds are bonded. LED mode is not synchronized in the below conditions, otherwise, it is supposed to synchronize with the connected bud.</p><ul>
<li>app_led_is_blink_alone(T_LED_MODE mode) returns true</li>
<li>Charging LED modes</li>
<li>LED Specify Function</li>
</ul>
<p>The relay message types are shown as below: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    LED_MSG_SYNC_FROM_PRI,</div><div class="line">    LED_MSG_REQUEST_NEW_MODE,</div><div class="line">    LED_MSG_TOTAL</div><div class="line">} T_APP_LED_REMOTE_MSG;</div></div><!-- fragment --><ul>
<li>LED_MSG_SYNC_FROM_PRI: Used in the primary bud when it needs to sync a LED mode to the secondary bud.</li>
<li>LED_MSG_REQUEST_NEW_MODE: Used in the secondary bud when it wants the primary bud to update LED mode.</li>
<li>Synchronized LED mode needs to re-sync every 3 minutes with these messages to avoid two buds not blinking simultaneously.</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#define RESYNC_LED_TIME_MS      180000 // 3 mins</span></div></div><!-- fragment --><h3><a class="anchor" id="Led_Mode_Judgement"></a>
4.3 LED Mode Judgement</h3>
<ol type="1">
<li>When the app task receives any message, it calls <a class="el" href="group___a_p_p___l_e_d___exported___functions.html#ga275a8379483c06117cfa0e1fa14b205b">app_led_check_charging_mode()</a> and <a class="el" href="group___a_p_p___l_e_d___exported___functions.html#ga7760af3630b47f74919846caaf2066bb">app_led_check_repeat_mode()</a> to check if the current LED mode needs to be updated.</li>
<li>When a non-repeat LED mode is activated, current repeat LED mode will be interrupted. After the non-repeat LED mode finishes blinking, <a class="el" href="group___a_p_p___l_e_d___exported___functions.html#ga5ce7108d839fdbc0128afcfbb1bf9f3d">app_led_disable_non_repeat_mode()</a> will be triggered to resume repeat LED mode.</li>
</ol>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Led_Customized_Mode"></a>
5 Add a Customized LED Mode</h2>
<p>To add a new customized LED mode which is defined in RAM:</p><ol type="1">
<li>Add the new LED mode between <a class="el" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa88025198d808701abc1bfdbfa6727f1e">LED_MODE_ALL_ON</a> and <a class="el" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa9eb5a0b99ed71628fae1d64c99c10625">LED_MODE_TOTAL</a> in <a class="el" href="group___a_p_p___l_e_d___exported___types.html#ga471fba543b9cfdb2f840c06cb9113cc3">T_LED_MODE</a>, refer to <a class="el" href="_a_n015__l_e_d.html#Led_Mode_Overview">2 LED Mode Overview</a>.</li>
<li>Add the new LED mode settings in LED_RAM_TABLE, refer to <a class="el" href="_a_n015__l_e_d.html#Led_Mode_Overview">2 LED Mode Overview</a>.</li>
<li>Add the conditions in app_led_is_repeat_mode().</li>
</ol>
<p>For example, to add a repeat LED mode named "LED_MODE_CUSTOMIZED1" and a non-repeat mode named "LED_MODE_CUSTOMIZED2", please follow the steps:</p>
<ol type="1">
<li>Add LED mode in T_LED_MODE: <div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="comment">/* Repeat LED Mode, defined in RAM */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaebf96b1c870abbe63f09f2f4e5948776">LED_MODE_ALL_BLINKING</a>,                  <span class="comment">//0x21</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aabb535ffe34c37e979b2163952ff8ed95">LED_MODE_ALL_OFF</a>,                       <span class="comment">//0x22</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa88025198d808701abc1bfdbfa6727f1e">LED_MODE_ALL_ON</a>,                        <span class="comment">//0x23</span></div><div class="line"></div><div class="line">    LED_MODE_CUSTOMIZED1,                   <span class="comment">//0x24   // repeat mode</span></div><div class="line">    LED_MODE_CUSTOMIZED2,                   <span class="comment">//0x25   // non-repeat mode</span></div><div class="line"></div><div class="line">    <span class="comment">/* means the end point of LED modes */</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa9eb5a0b99ed71628fae1d64c99c10625">LED_MODE_TOTAL</a>                          <span class="comment">//0x26</span></div><div class="line">} <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ga471fba543b9cfdb2f840c06cb9113cc3">T_LED_MODE</a>;</div></div><!-- fragment --> <br />
</li>
<li>Add LED mode settings in LED_RAM_TABLE: <div class="fragment"><div class="line"><span class="comment">// constant LED modes, define in ram</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="struct_t___l_e_d___t_a_b_l_e.html">T_LED_TABLE</a> LED_RAM_TABLE[LED_RAM_MODE_TOTAL][LED_NUM] =</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="comment">// LED_MODE_ALL_ON</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>}</div><div class="line">    },</div><div class="line"></div><div class="line">    <span class="comment">// {TYPE, ON_TIME, OFF_TIME, BLINK_COUNT, BLINK_INTERVAL}</span></div><div class="line">    <span class="comment">// LED_MODE_CUSTOMIZED1 (repeat mode)</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11a9e004cac18fdafa704bc7b637f74920c">LED_TYPE_ON_OFF</a>, 10, 10, 2, 20},   <span class="comment">/* LED0 is in on-off blink type</span></div><div class="line"><span class="comment">                                             * with on-time and off-time for 100 ms</span></div><div class="line"><span class="comment">                                             * and will blink twice with </span></div><div class="line"><span class="comment">                                             * an interval of 2 seconds. */</span></div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aa23b31ee07d01d6321b74177febc49fa">LED_TYPE_KEEP_ON</a>},                 <span class="comment">/* LED1 is in keep-on type   */</span></div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11aea3a2b2c424eeb2b460bac5aebb2a1a2">LED_TYPE_KEEP_OFF</a>},                <span class="comment">/* LED2 is in keep-off type  */</span></div><div class="line">    },</div><div class="line"></div><div class="line">    <span class="comment">// LED_MODE_CUSTOMIZED2 (non-repeat mode)</span></div><div class="line">    <span class="comment">// Blink interval needs to be 0 for non-repeat mode</span></div><div class="line">    {</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ae4e096c5fb52f7fc97eaa562b3509d41">LED_TYPE_BREATH</a>, 320, 320, 2, 0}, <span class="comment">/* All LEDs are in breath type</span></div><div class="line"><span class="comment">                                            * with on-time and off-time for 3.2s</span></div><div class="line"><span class="comment">                                            * and will blink twice.      */</span></div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ae4e096c5fb52f7fc97eaa562b3509d41">LED_TYPE_BREATH</a>, 320, 320, 2, 0},</div><div class="line">        {<a class="code" href="group___l_e_d___m_o_d_u_l_e___exported___types.html#ggaa077308a693d5653d3ec26af5e63aa11ae4e096c5fb52f7fc97eaa562b3509d41">LED_TYPE_BREATH</a>, 320, 320, 2, 0},</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --> <br />
</li>
<li>Add the conditions in app_led_is_repeat_mode(): <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> app_led_is_repeat_mode(<a class="code" href="group___a_p_p___l_e_d___exported___types.html#ga471fba543b9cfdb2f840c06cb9113cc3">T_LED_MODE</a> mode)</div><div class="line">{</div><div class="line">    uint8_t non_repeat_mode_start_point;</div><div class="line">    uint8_t non_repeat_mode_end_point = <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa839044af3f99aa220f162618f9567e91">LED_MODE_RAM_TABLE_START</a>;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a1633bf8cf63840dd0038c7952501c2bc">enable_repeat_gaming_mode_led</a>)</div><div class="line">    {</div><div class="line">        non_repeat_mode_start_point = <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aa9bcf12a2d77186a388ed1c8986cd2af4">LED_MODE_POWER_ON</a>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        non_repeat_mode_start_point = <a class="code" href="group___a_p_p___l_e_d___exported___types.html#ggaf1b9b6078d653f4019351856bfffff2aaa98a7afaf40ae6aa6f6bc00581de0174">LED_MODE_GAMING_MODE</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Non-repeat LED mode</span></div><div class="line">    <span class="keywordflow">if</span> ((mode &gt;= non_repeat_mode_start_point) &amp;&amp; (mode &lt; non_repeat_mode_end_point))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// non-repeat mode in LED_RAM_TABLE</span></div><div class="line">    <span class="keywordflow">if</span> (mode == LED_MODE_CUSTOMIZED2)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --> <div style="page-break-after: always;"></div></li>
</ol>
<h2><a class="anchor" id="Led_Power_Saving"></a>
6 LED Power Saving</h2>
<p>The system is allowed to enter DLPS mode to save power when LEDs are worked in the below types:</p><ol type="1">
<li>HW Sleep LED blink type</li>
<li>HW Sleep LED breathe type</li>
<li>SW LED blink type </li>
</ol>
</div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
