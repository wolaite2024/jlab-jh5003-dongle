<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="Line_In_Page"></a>
Line In Function Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.1</b></center><p><br />
 </p><center><b>2023/06/23</b></center><div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/06/23  </td><td class="markdownTableBodyCenter">Optimize content   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Rev">Revision History</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Table_List">Table List</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_McuConfigTool_Configuration">2 McuConfigTool Configuration</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_DSPConfigTool_Configuration">3 DSPConfigTool Configuration</a></li>
<li><a class="el" href="_a_n042__l_i_n_e__i_n__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#Line_In_Source_Code_Overview">4 Source Code Overview</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 Line In Enable</a></li>
<li><a href="#figure_2_2">Figure 2-2 Line In Pinmux Config</a></li>
<li><a href="#figure_2_3">Figure 2-3 Line In Plug Enter Airplane Mode</a></li>
<li><a href="#figure_2_4">Figure 2-4 Line In Priority</a></li>
<li><a href="#figure_3_1">Figure 3-1 Line In ADC Default Gain Setting</a></li>
<li><a href="#figure_3_2">Figure 3-2 Line In DAC Default Gain Setting</a></li>
<li><a href="#figure_3_3">Figure 3-3 Line In EQ</a></li>
</ul>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
</table>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_Introduction"></a>
1 Introduction</h2>
<p>The purpose of this document is to give an overview of line in function. The following topics are included:</p><ul>
<li>Configuration in McuConfigTool</li>
<li>Configuration in DSPConfigTool</li>
<li>Source code review</li>
</ul>
<p>Macro F_APP_LINEIN_SUPPORT should be defined to 1 when line in module is used.</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_McuConfigTool_Configuration"></a>
2 McuConfigTool Configuration</h2>
<p>Line In mode can be enabled in "HW Feature" page as shown in following figure. </p><div class="image">
<img src="LINE_IN_Enable.jpg" alt="LINE_IN_Enable.jpg"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 Line In Enable</b></div></center><p> <br />
 <br />
 Select line in pinmux as shown in following figure. Line in will be started when this pin pulled low and will be closed when pulled high. </p><div class="image">
<img src="LINE_IN_pinmux_config.jpg" alt="LINE_IN_pinmux_config.jpg"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 Line In Pinmux Config</b></div></center><p> <br />
 <br />
 Line in plug enter airplane mode can be enabled in "HW Feature" page as shown in following figure. </p><div class="image">
<img src="LINE_IN_plug_enter_airplane_mode.jpg" alt="LINE_IN_plug_enter_airplane_mode.jpg"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 Line In Plug Enter Airplane Mode</b></div></center><p> <br />
 <br />
 Line in priority can be enabled in "Audio" page as shown in figure. </p><div class="image">
<img src="LINE_IN_priority.jpg" alt="LINE_IN_priority.jpg"/>
</div>
 <center><div id="figure_2_4"><b>Figure 2-4 Line In Priority</b></div></center><p> <br />
 <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_DSPConfigTool_Configuration"></a>
3 DSPConfigTool Configuration</h2>
<p>ADC default gain can be set in DSPConfigTool as shown in following figure. </p><div class="image">
<img src="LINE_IN_ADC_default_gain_setting.jpg" alt="LINE_IN_ADC_default_gain_setting.jpg"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 Line In ADC Default Gain Setting</b></div></center><p> <br />
 <br />
 DAC default gain can be set in DSPConfigTool as shown in following figure. </p><div class="image">
<img src="LINE_IN_DAC_default_gain_setting.jpg" alt="LINE_IN_DAC_default_gain_setting.jpg"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 Line In DAC Default Gain Setting</b></div></center><p> <br />
 <br />
 Line in EQ can be set in DSPConfigTool as shown in following figure. </p><div class="image">
<img src="LINE_IN_EQ.jpg" alt="LINE_IN_EQ.jpg"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 Line In EQ</b></div></center><p> <br />
 <br />
</p>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="Line_In_Source_Code_Overview"></a>
4 Source Code Overview</h2>
<p>This section discribes the line in flow in SDK application.</p>
<h3>4.1 Line In Initialization</h3>
<p>In driver initialization, set interrupt polarity to low and disable io interrupt until power on. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_line_in_driver_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/*gpio init*/</span></div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga3826ae3324dab5d23192d2101f2cab3b">hal_gpio_init_pin</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga99f5eecc2036d1804f919c79cb4ce469">line_in_pinmux</a>, <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#gga18690463b43fb88963baf1098b54f075ad6bf32430a2b7af6721521d3e247f978">GPIO_TYPE_CORE</a>, <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#gga83e087b95bdbbc7626f48a407120b429a3f9cca83af864e65a125bb363f5cc1a6">GPIO_DIR_INPUT</a>, <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#ggac9b234191aefcbffa9f5cbfcb67ba911ae7d1b2a9078939dd744dd9a7cd61d9df">GPIO_PULL_UP</a>);</div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga33877bb6f864bf13365d530ea498f829">hal_gpio_set_up_irq</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga99f5eecc2036d1804f919c79cb4ce469">line_in_pinmux</a>, <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#ggaf9fd97f2ddde04dd3ae2a54dbc0f27f7a2636d7c0a40a6aa62fdeab06e5343914">GPIO_IRQ_EDGE</a>, <a class="code" href="group___h_a_l___g_p_i_o___exported___constants.html#gga73aa619532bdbf9d2b620ec419641690ad67ef08eb10e464490335f1267f5d61b">GPIO_IRQ_ACTIVE_LOW</a>, <span class="keyword">true</span>);</div><div class="line">    <a class="code" href="group__x3d___g_p_i_o___i_n_t___h__.html#ga986785a267647c840ad807c08dffa9c9">hal_gpio_register_isr_callback</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga99f5eecc2036d1804f919c79cb4ce469">line_in_pinmux</a>, app_line_in_detect_intr_cb, 0);</div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga915514c710f982852b566f59aa264692">hal_gpio_irq_disable</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga99f5eecc2036d1804f919c79cb4ce469">line_in_pinmux</a>);</div><div class="line">}</div></div><!-- fragment --><p>The following initialization will create line in track and do volume in/out setting. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_line_in_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    app_line_in_handle = audio_line_create(<a class="code" href="group___a_u_d_i_o___d_e_v_i_c_e___b_i_t_m_a_s_k.html#gab3446f12db748f7e8371ae9f3c77eab8">AUDIO_DEVICE_IN_AUX</a> | <a class="code" href="group___a_u_d_i_o___d_e_v_i_c_e___b_i_t_m_a_s_k.html#ga616a5c9dbef9d607f46a799caff4c921">AUDIO_DEVICE_OUT_SPK</a>, 48000, 48000);</div><div class="line"></div><div class="line">    audio_line_volume_out_max_set(app_dsp_cfg_vol.<a class="code" href="struct_t___a_p_p___d_s_p___c_f_g___v_o_l_u_m_e.html#a840934b139edf567221dbeb7a74682b6">line_in_volume_out_max</a>);</div><div class="line">    audio_line_volume_out_min_set(app_dsp_cfg_vol.<a class="code" href="struct_t___a_p_p___d_s_p___c_f_g___v_o_l_u_m_e.html#a98cb8423fd380e9ac18f517aceee0be5">line_in_volume_out_min</a>);</div><div class="line">    audio_line_volume_out_set(app_line_in_handle, <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ad0a33ceb13c86e1bd04f760ca812e93d">line_in_gain_level</a>);</div><div class="line">    audio_line_volume_in_max_set(app_dsp_cfg_vol.<a class="code" href="struct_t___a_p_p___d_s_p___c_f_g___v_o_l_u_m_e.html#a8823f6f3b18345e7ab9e48eee6ac4e8e">line_in_volume_in_max</a>);</div><div class="line">    audio_line_volume_in_min_set(app_dsp_cfg_vol.<a class="code" href="struct_t___a_p_p___d_s_p___c_f_g___v_o_l_u_m_e.html#a7771a3db466ecb7dd6d3f7d2698b4c9e">line_in_volume_in_min</a>);</div><div class="line">    audio_line_volume_in_set(app_line_in_handle, app_dsp_cfg_vol.<a class="code" href="struct_t___a_p_p___d_s_p___c_f_g___v_o_l_u_m_e.html#a0e74a20feb0bb16d142c08d336fb3e7c">line_in_volume_in_default</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group___s_y_s_t_e_m___m_a_n_a_g_e_r.html#ga6b27ecfe7b3dfa93341db098f907a839">sys_mgr_cback_register</a>(app_line_in_dm_cback);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ga67189dab89dfb141cf0ada6529f057bd">audio_mgr_cback_register</a>(app_line_in_audio_cback);</div><div class="line">    <a class="code" href="group___a_p_p___t_i_m_e_r.html#ga5d2a3ae9710b2036a2907647a1932f0f">app_timer_reg_cb</a>(app_line_in_timeout_cb, &amp;app_line_in_timer_id);</div><div class="line">}</div></div><!-- fragment --><p>Enable line in interrupt when system power on. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_line_in_power_on_check(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gaae922b7d64d09b96637d21715a386260">hal_gpio_irq_enable</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="group___a_p_p___c_f_g.html#ga99f5eecc2036d1804f919c79cb4ce469">line_in_pinmux</a>);</div><div class="line">}</div></div><!-- fragment --><h3>4.2 Line In Interrupt Handler</h3>
<p>This chapter shows the process from line in interrupt comes up to excuting line in start or stop action. </p><div class="fragment"><div class="line"><a class="code" href="group___s_e_c_t_i_o_n___exported___macros.html#gaf901ecfe15c401262a5dfd752a0b0287">ISR_TEXT_SECTION</a> <span class="keywordtype">void</span> app_line_in_detect_intr_cb(uint32_t param)</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    app_line_in_intpolarity_update();</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a> = gpio_status;</div><div class="line">    gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#acb5cfd209ba75c853d03f701e7f91679">type</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074af11ba4096588dc277d9bd604f1007024">IO_MSG_TYPE_GPIO</a>;</div><div class="line">    gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggac53061b3924b56c44eacd7e43a711f10a7db8c31737e48c3f54c6bccfc0412c53">IO_MSG_GPIO_LINE_IN</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___i_o___m_s_g.html#ga88a966ae202533d382e23ae22b27b819">app_io_msg_send</a>(&amp;gpio_msg);</div><div class="line"></div><div class="line">    <span class="comment">/* Enable GPIO interrupt */</span></div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gaae922b7d64d09b96637d21715a386260">hal_gpio_irq_enable</a>(pin_num);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_line_in_detect_msg_handler(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> *io_driver_msg_recv)</div><div class="line">{</div><div class="line">    uint8_t gpio_status;</div><div class="line"></div><div class="line">    gpio_status = io_driver_msg_recv-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a>;</div><div class="line">    <a class="code" href="group___a_p_p___t_i_m_e_r.html#gab262773f9eb7292623795486a27219a2">app_stop_timer</a>(&amp;timer_idx_line_in_debounce);</div><div class="line">    <a class="code" href="group___a_p_p___t_i_m_e_r.html#ga7e0ebc306e15dabba884fda9e981df9a">app_start_timer</a>(&amp;timer_idx_line_in_debounce, <span class="stringliteral">&quot;line_in_debounce&quot;</span>,</div><div class="line">                    app_line_in_timer_id, APP_TIMER_LINE_IN_DEBOUNCE, gpio_status, <span class="keyword">false</span>,</div><div class="line">                    500);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_line_in_timeout_cb(uint8_t timer_id, uint16_t timer_chann)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (timer_id)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> APP_TIMER_LINE_IN_DEBOUNCE:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">     }</div><div class="line">     ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_line_in_handler(<span class="keywordtype">bool</span> is_in, <span class="keywordtype">bool</span> first_power_on)</div><div class="line">{</div><div class="line">    uint8_t app_idx = app_get_active_a2dp_idx();</div><div class="line">    <span class="keywordtype">bool</span> allow_line_in_start = <span class="keyword">true</span>;</div><div class="line">    <a class="code" href="group__x3d___t_r_a_c_e.html#gacede19f539147e375272a511869b7a77">APP_PRINT_INFO2</a>(<span class="stringliteral">&quot;app_line_in_handler: is_in %d, is_playing %d&quot;</span>, is_in, is_playing);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (is_in)</div><div class="line">    {</div><div class="line">        ...</div><div class="line">        app_line_in_start_line_in();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        ...</div><div class="line">        app_line_in_stop_line_in();</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h3>4.3 Line In Volume Adjust</h3>
<p>Following MMI can be used to adjust line in volume level. </p><div class="fragment"><div class="line"><a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae56062b30503adb2295ae991da5521a3">MMI_DEV_SPK_VOL_UP</a> = 0x30,</div><div class="line"><a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3ea2c8afda57bdcea1867727bdb764da">MMI_DEV_SPK_VOL_DOWN</a> = 0x31,</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_line_in_volume_up_handle(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    audio_line_volume_out_set(app_line_in_handle, curr_volume);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_line_in_volume_down_handle(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    audio_line_volume_out_set(app_line_in_handle, curr_volume);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
