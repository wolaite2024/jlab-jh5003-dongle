<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="PBAP_USER_MANU"></a>
PBAP Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.2</b></center><p><br />
 </p><center><b>2023/06/15</b></center><div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/05/24  </td><td class="markdownTableBodyCenter">Change version number to 2 digits   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.2  </td><td class="markdownTableBodyCenter">2023/06/15  </td><td class="markdownTableBodyCenter">Content supplement   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_p_b_a_p.html#PBAP_Rev">Revision History</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Table_List">Table List</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Figure_List">Figure List</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Glossary">Glossary</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Intro">1 Introduction</a><ul>
<li><a class="el" href="_p_b_a_p.html#PBAP_Profile_Stack">1.1 PBAP Profile Stack</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Role">1.2 PBAP Roles</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Repo">1.3 PBAP Repositories</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Object">1.4 PBAP Objects</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Folder">1.5 PBAP Virtual Folders Structure</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_SDP_RECORD">1.6 PBAP SDP Record</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_COD">1.7 Class of Device Field</a></li>
</ul>
</li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Flow">2 Phonebook Retrieve Procedure</a><ul>
<li><a class="el" href="_p_b_a_p.html#PBAP_Init">2.1 PBAP Initialization</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_SDP">2.2 PBAP Service Discovery</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Connect">2.3 PBAP Connect</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Pull">2.4 PBAP Pull</a></li>
<li><a class="el" href="_p_b_a_p.html#PBAP_Disconnect">2.5 PBAP Disconnect</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_1_1">Figure 1-1 PBAP Profile Stack</a></li>
<li><a href="#figure_1_2">Figure 1-2 PBAP Virtual Folders Structure</a></li>
<li><a href="#figure_1_3">Figure 1-3 PBAP Class of Device Field</a></li>
<li><a href="#figure_2_1">Figure 2-1 PBAP Service Discover Procedure</a></li>
<li><a href="#figure_2_2">Figure 2-2 PBAP Connect Procedure</a></li>
<li><a href="#figure_2_3">Figure 2-3 PBAP Get Phonebook Size</a></li>
<li><a href="#figure_2_4">Figure 2-4 PBAP Pull Phonebook</a></li>
<li><a href="#figure_2_5">Figure 2-5 PBAP Set Phonebook</a></li>
<li><a href="#figure_2_6">Figure 2-6 PBAP Get Vcard Listing by Phone Number</a></li>
<li><a href="#figure_2_7">Figure 2-7 PBAP Disconnect</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PBAP  </td><td class="markdownTableBodyCenter">Phone Book Access Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GOEP  </td><td class="markdownTableBodyCenter">Generic Object Exchange Profile   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PSE  </td><td class="markdownTableBodyCenter">Phone Book Server Equipment   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PCE  </td><td class="markdownTableBodyCenter">Phone Book Client Equipment   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Intro"></a>
1 Introduction</h2>
<p>PBAP defines the protocols and procedures that shall be used by devices for the retrieval of phone book objects. It is based on a Client-Server interaction model where the Client device pulls phone book objects from the Server device. This manual describes the <b>PBAP API definition</b> and how to use these APIs to pull phone book objects from the Server device. <br />
</p>
<h3><a class="anchor" id="PBAP_Profile_Stack"></a>
1.1 PBAP Profile Stack</h3>
<p>Figure 1-1 shows the protocols and entities used in this profile. </p><div class="image">
<img src="profile_pbap.png" alt="profile_pbap.png"/>
</div>
 <center><div id="figure_1_1"><b>Figure 1-1 PBAP Profile Stack </b></div></center><p> The Baseband, LMP and L2CAP are the physical and data link layers of the Bluetooth protocols. RFCOMM is the Bluetooth serial port emulation entity. SDP is the Bluetooth Service Discovery Protocol.</p>
<h3><a class="anchor" id="PBAP_Role"></a>
1.2 PBAP Roles</h3>
<ul>
<li><b>PSE</b> - This is the device that contains the source phone book objects.</li>
<li><b>PCE</b> - This is the device that retrieves phone book objects from the Server Equipment.</li>
</ul>
<h3><a class="anchor" id="PBAP_Repo"></a>
1.3 PBAP Repositories</h3>
<p>There might be several repositories for phone book objects. <a class="el" href="group___b_t___p_b_a_p.html#gaa8c99ec5f27aefb15d7cd3836dfe32bb">t_bt_pbap_repository</a> defines a typical example, one phone book is stored locally in the phone's memory, and another phone book is stored on the phone's SIM card.</p>
<h3><a class="anchor" id="PBAP_Object"></a>
1.4 PBAP Objects</h3>
<p><a class="el" href="group___b_t___p_b_a_p.html#ga84b66e1a1da82a0886b52630fb58235c">t_bt_pbap_phone_book</a> defines seven types of phone book objects.</p><ul>
<li>The main phone book object (pb) corresponds to the user phone book of the current repository.</li>
<li>The Incoming Calls History object (ich) corresponds to a list of the most recently received calls.</li>
<li>The Outgoing Calls History object (och) corresponds to a list of the most recently made calls.</li>
<li>The Missed Calls History object (mch) corresponds to a list of the most recently missed calls.</li>
<li>The Combined Calls History object (cch) corresponds to the combination of ich, och and mch.</li>
<li>The Speed-Dial object (spd) corresponds to the list of S speed dial entries on the PSE.</li>
<li>The Favorite Contacts object (fav) corresponds to a list of favorites on the PSE.</li>
</ul>
<h3><a class="anchor" id="PBAP_Folder"></a>
1.5 PBAP Virtual Folders Structure</h3>
<p>Phone book information is organized under the virtual folders architecture described in Figure 1-2. </p><div class="image">
<img src="pbap_folder.png" alt="pbap_folder.png"/>
</div>
 <center><div id="figure_1_2"><b>Figure 1-2 PBAP Virtual Folders Structure </b></div></center><p> The local phone book information is located under the telecom folder. When the PSE also contains a SIM card, SIM card phone book information shall be located under the SIM1/telecom/ folder.</p>
<h3><a class="anchor" id="PBAP_SDP_RECORD"></a>
1.6 PBAP SDP Record</h3>
<p>PBAP local record <b>pbap_pce_sdp_record</b> should be registered by <a class="el" href="group___b_t___s_d_p.html#ga929bad3b33b7416db99e39e776641fef" title="Add an SDP record to BT stack. ">bt_sdp_record_add()</a>. </p><div class="fragment"><div class="line"><span class="keyword">const</span> uint8_t pbap_pce_sdp_record[] =</div><div class="line">{</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x36,</div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_CLASS_ID_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#gae6e31379df951f323d24e4f8b85d42d3">SDP_ATTR_SRV_CLASS_ID_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga884c193cacb15856d9ae455745e026de">UUID_PBAP_PCE</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga884c193cacb15856d9ae455745e026de">UUID_PBAP_PCE</a>),</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_BROWSE_GROUP_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4b6cf5cf717a8c0f70bfe4df57f0fbfa">SDP_ATTR_BROWSE_GROUP_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x03,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___u_u_i_d.html#ga089c7a7d51a97c5a4e47136ba1dcbadf">UUID_PUBLIC_BROWSE_GROUP</a>,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_PROFILE_DESC_LIST</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga4aa7aa3090459d3056faa878fcfde257">SDP_ATTR_PROFILE_DESC_LIST</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x08,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga3162e2d0cb09ada26915070f4082f82a">SDP_DATA_ELEM_SEQ_HDR</a>,</div><div class="line">    0x06,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga9d465beea934f5f89796f9c6901da35c">SDP_UUID16_HDR</a>,</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___u_u_i_d.html#ga529de72491eeba3541b1ab9484e1c293">UUID_PBAP</a> &gt;&gt; 8),</div><div class="line">    (uint8_t)<a class="code" href="group___b_t___u_u_i_d.html#ga529de72491eeba3541b1ab9484e1c293">UUID_PBAP</a>,</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    0x01,<span class="comment">//version 1.2</span></div><div class="line">    0x02,</div><div class="line"></div><div class="line">    <span class="comment">//attribute SDP_ATTR_SRV_NAME</span></div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga942a94138894beb2b2bc75daebc6e2d0">SDP_UNSIGNED_TWO_BYTE</a>,</div><div class="line">    (uint8_t)((<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga3c3fbd0a8e6f368f0a3261835901488d">SDP_ATTR_SRV_NAME</a> + <a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>) &gt;&gt; 8),</div><div class="line">    (uint8_t)(<a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga3c3fbd0a8e6f368f0a3261835901488d">SDP_ATTR_SRV_NAME</a> + <a class="code" href="group___b_t___s_d_p___a_t_t_r_i_b_u_t_e_s.html#ga8724613c287eece3321573a98c81da5b">SDP_BASE_LANG_OFFSET</a>),</div><div class="line">    <a class="code" href="group___b_t___s_d_p___h_e_a_d_e_r.html#ga7e6da9cd524f983c421d0d84d65d8855">SDP_STRING_HDR</a>,</div><div class="line">    0x14,</div><div class="line">    0x50, 0x68, 0x6f, 0x6e, 0x65, 0x62, 0x6f, 0x6f, 0x6b, 0x20, 0x41, 0x63, 0x63, 0x65, 0x73, 0x73, 0x20, 0x50, 0x43, 0x45 <span class="comment">//&quot;Phonebook Access PCE&quot;</span></div><div class="line">};</div></div><!-- fragment --><h3><a class="anchor" id="PBAP_COD"></a>
1.7 Class of Device Field</h3>
<p>There is no obvious correlation between the Class of Device/Service Field and the support for the Phone Book Access Profile since it is expected that many different types of devices will implement the Phone Book Access Profile. </p><div class="image">
<img src="pbap_cod.png" alt="pbap_cod.png"/>
</div>
 <center><div id="figure_1_3"><b>Figure 1-3 PBAP Class of Device Field </b></div></center><p> <b>Notice</b>: The PSE may implement policies that prevent the device from accessing the phonebook privileges of phone. Making the COD to Car Audio or Hands Free may be practicable.</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="PBAP_Flow"></a>
2 Phonebook Retrieve Procedure</h2>
<h3><a class="anchor" id="PBAP_Init"></a>
2.1 PBAP Initialization</h3>
<p><a class="el" href="group___b_t___p_b_a_p.html#ga337d1f28c0e382029976758318f754c5" title="Initialize PBAP profile. ">bt_pbap_init()</a> is invoked when the application is powered on or the chip is reset. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___b_t___p_a_n___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">//board init</span></div><div class="line"></div><div class="line">    <a class="code" href="group___b_t___p_b_a_p.html#ga337d1f28c0e382029976758318f754c5">bt_pbap_init</a>(link_num);</div><div class="line"></div><div class="line">    <span class="comment">//task create</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="PBAP_SDP"></a>
2.2 PBAP Service Discovery</h3>
<p>Service discover procedure is shown is Figure 2-1: </p><div class="image">
<img src="pbap_sdp.png" alt="pbap_sdp.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 PBAP Service Discover Procedure </b></div></center><p> <b>Note: UUID_PBAP_PSE</b> shall be used to do service discovery. It is not recommended to use UUID_PBAP, as the SDP record of PCE and PSE may both be obtained from the PSE device.</p>
<h3><a class="anchor" id="PBAP_Connect"></a>
2.3 PBAP Connect</h3>
<p>OBEX connections in PBAP shall always be initiated by the PCE device using bt_pbap_connect_req(), as shown in Figure 2-2: </p><div style="page-break-after: always;"></div> <div class="image">
<img src="pbap_connect.png" alt="pbap_connect.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 PBAP Connect Procedure </b></div></center><p> <b>Note:</b> It takes time to complete the authorization which involves user participation. So <b>DO NOT</b> initiate a PBAP connection immediately after pairing with phone. It is recommended to establish a PBAP connection when actually needed.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> app_pbap_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a4d6b781d7df2a68759c22de424935578">BT_EVENT_SDP_ATTR_INFO</a>:</div><div class="line">            {</div><div class="line">                <a class="code" href="structt__bt__sdp__attr__info.html">T_BT_SDP_ATTR_INFO</a> *sdp_info = &amp;param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a2a26fa4bdf160fc664a921ca0fe0cfd6">sdp_attr_info</a>.<a class="code" href="structt__bt__event__param__sdp__attr__info.html#aede2e502d17f13440b299bd8b5e92f62">info</a>;</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (sdp_info-&gt;<a class="code" href="structt__bt__sdp__attr__info.html#a9fe9edcdd42620e0f0d86d9d6a74367d">srv_class_uuid_data</a>.<a class="code" href="uniont__bt__sdp__uuid__data.html#af4fea99995e2110b688ca292edb5f462">uuid_16</a> == <a class="code" href="group___b_t___u_u_i_d.html#gab231d40153359b81c9924ede2f4c46d1">UUID_PBAP_PSE</a>)</div><div class="line">                {</div><div class="line">                    bt_pbap_connect_req(param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a2a26fa4bdf160fc664a921ca0fe0cfd6">sdp_attr_info</a>.<a class="code" href="structt__bt__event__param__sdp__attr__info.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>, sdp_info-&gt;<a class="code" href="structt__bt__sdp__attr__info.html#ace5623b10edbf3417840ed509e9614bb">server_channel</a>,</div><div class="line">                                        sdp_info-&gt;<a class="code" href="structt__bt__sdp__attr__info.html#a5d0c90cc4fe200f5933e2f1a835bc379">pbap_supported_feat</a>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a715c0755caa91a95b2a6348ec3384de0">BT_EVENT_PBAP_CONN_CMPL</a>:</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="PBAP_Pull"></a>
2.4 PBAP Pull</h3>
<h4>2.4.1 Pull Phonebook</h4>
<p>Call <a class="el" href="group___b_t___p_b_a_p.html#ga3f2e2ec588ca4d8884c5c1c869a3ac03" title="Send a request to get the number of indexes in the phone book of interest. ">bt_pbap_phone_book_size_get()</a> if PCE wants to know the number of used indexes in the phone book of interest. </p><div class="image">
<img src="pbap_get_size.png" alt="pbap_get_size.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 PBAP Get Phonebook Size </b></div></center><p><a class="el" href="group___b_t___p_b_a_p.html#gafb118dae372533bf419ef3140f1cb10b" title="Send a request to pull the entire phone book. ">bt_pbap_phone_book_pull()</a> and <a class="el" href="group___b_t___p_b_a_p.html#ga98df9f3b112084035c20305f36240b08" title="Send a request to pull more data from the remote server. ">bt_pbap_pull_continue()</a> are usually used together to retrieve an entire phone book object from the PSE device. Call <a class="el" href="group___b_t___p_b_a_p.html#gafffeb0542e909d2eef0f061caaf1f33c" title="Send a request to terminate the ongoing pull operation. ">bt_pbap_pull_abort()</a> if the phonebook pull procedure need to be interrupted, while the PBAP connection need to be maintained. </p><div class="image">
<img src="pbap_pull_pb.png" alt="pbap_pull_pb.png"/>
</div>
 <center><div id="figure_2_4"><b>Figure 2-4 PBAP Pull Phonebook </b></div></center><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_pbap_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a3d0df7b1c9c2844dfa0363ea87bb3908">BT_EVENT_PBAP_GET_PHONE_BOOK_SIZE_CMPL</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordtype">int</span> size;</div><div class="line"></div><div class="line">            size = param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#aca59c787489ab730356a88156606e80b">pbap_get_phone_book_size_cmpl</a>.<a class="code" href="structt__bt__event__param__pbap__get__phone__book__size__cmpl.html#a96895c383471546d9354424d65f150c9">pb_size</a>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a5119784a3ff62826f871fc2276182c65">BT_EVENT_PBAP_SET_PHONE_BOOK_CMPL</a>:</div><div class="line">        {</div><div class="line">            uint64_t filter = BT_PBAP_PROPERTY_VERSION | BT_PBAP_PROPERTY_FN |</div><div class="line">                              BT_PBAP_PROPERTY_N       | BT_PBAP_PROPERTY_TEL;</div><div class="line"></div><div class="line">            <a class="code" href="group___b_t___p_b_a_p.html#gafb118dae372533bf419ef3140f1cb10b">bt_pbap_phone_book_pull</a>(param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a575f25bc68b3f4312481280f5a846866">pbap_conn_cmpl</a>.<a class="code" href="structt__bt__event__param__pbap__conn__cmpl.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>, <a class="code" href="group___b_t___p_b_a_p.html#ggaa8c99ec5f27aefb15d7cd3836dfe32bba6330cb65679874a3c90a1c2ed1ca4e2a">BT_PBAP_REPOSITORY_LOCAL</a>,</div><div class="line">                                    <a class="code" href="group___b_t___p_b_a_p.html#gga84b66e1a1da82a0886b52630fb58235ca46e04db2d194bd4b231e4fe1b2ae6582">BT_PBAP_PHONE_BOOK_PB</a>, 0, 0xFFFF, filter);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ac465c9b3ede70afa2e40e09fda6b43f5">BT_EVENT_PBAP_GET_PHONE_BOOK_CMPL</a>:</div><div class="line">        {</div><div class="line">            <span class="comment">//deal with data</span></div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (!param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a7d164ed14e164d5c14c5a35c6fc27ceb">pbap_get_phone_book_cmpl</a>.<a class="code" href="structt__bt__event__param__pbap__get__phone__book__cmpl.html#af22a8e3b49524861f704f410106d60a6">data_end</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___b_t___p_b_a_p.html#ga98df9f3b112084035c20305f36240b08">bt_pbap_pull_continue</a>();</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h4>2.4.2 Get VCard Listing by Phone Number</h4>
<p><a class="el" href="group___b_t___p_b_a_p.html#ga78887e783c217a0bf4e47f4e69649bf1" title="Send a request to set active phone book. ">bt_pbap_phone_book_set()</a> is used for the PCE to select the phone book object of interest. </p><div class="image">
<img src="pbap_set_pb.png" alt="pbap_set_pb.png"/>
</div>
 <center><div id="figure_2_5"><b>Figure 2-5 PBAP Set Phonebook </b></div></center><p><a class="el" href="group___b_t___p_b_a_p.html#ga3c5a93f2649a49a502a6da87488300c4" title="Send a request to pull the vCard listing in current phone book by phone number. ">bt_pbap_vcard_listing_by_number_pull()</a> is used to acquire the caller's name when a call is coming. </p><div class="image">
<img src="pbap_pull_vcard_by_number.png" alt="pbap_pull_vcard_by_number.png"/>
</div>
 <center><div id="figure_2_6"><b>Figure 2-6 PBAP Get Vcard Listing by Phone Number </b></div></center><p> <b>Note:</b> This function will retrieve the vCard Listing object of the <b>current folder</b>. It is recommended to set folder to root/telecom/pb after PBAP connection is established.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> app_hfp_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83aa35683c83c52d5b0dfd3d0cf87ac0b9f">BT_EVENT_HFP_CALLER_ID_IND</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordtype">char</span> *number;</div><div class="line"></div><div class="line">            number = (<span class="keywordtype">char</span> *)param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a47847fde0beeace1fd3b1f8fb2cc85d5">hfp_caller_id_ind</a>.<a class="code" href="structt__bt__event__param__hfp__caller__id__ind.html#a8ad68a761c0142e4fbbbba9340f61f05">number</a>;</div><div class="line">            <a class="code" href="group___b_t___p_b_a_p.html#ga3c5a93f2649a49a502a6da87488300c4">bt_pbap_vcard_listing_by_number_pull</a>(param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a47847fde0beeace1fd3b1f8fb2cc85d5">hfp_caller_id_ind</a>.<a class="code" href="structt__bt__event__param__hfp__caller__id__ind.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>, number);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_pbap_bt_cback(<a class="code" href="group___b_t___b_t_m.html#ga60f938d2fe9ea1ac81e1bf400fbb5b03">T_BT_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html">T_BT_EVENT_PARAM</a> *param = event_buf;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a715c0755caa91a95b2a6348ec3384de0">BT_EVENT_PBAP_CONN_CMPL</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="group___b_t___p_b_a_p.html#ga78887e783c217a0bf4e47f4e69649bf1">bt_pbap_phone_book_set</a>(param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a575f25bc68b3f4312481280f5a846866">pbap_conn_cmpl</a>.<a class="code" href="structt__bt__event__param__pbap__conn__cmpl.html#a624fd24b46be2b40c8731334c9de5d06">bd_addr</a>, <a class="code" href="group___b_t___p_b_a_p.html#ggaa8c99ec5f27aefb15d7cd3836dfe32bba6330cb65679874a3c90a1c2ed1ca4e2a">BT_PBAP_REPOSITORY_LOCAL</a>, <a class="code" href="group___b_t___p_b_a_p.html#gga7b1c6380843362029b1d007835f7b071acd43617a20cdc5e1ce36226fe8114cae">BT_PBAP_PATH_PB</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83a5119784a3ff62826f871fc2276182c65">BT_EVENT_PBAP_SET_PHONE_BOOK_CMPL</a>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_t___b_t_m.html#ggad24078c623525f9ed318443fdc4e4c83ae54728dcd57a942661ca2216bc3a908a">BT_EVENT_PBAP_CALLER_ID_NAME</a>:</div><div class="line">        <span class="keywordflow">if</span> (param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a1dbce902880e5a4e41bec9684cb6ddf2">pbap_caller_id_name</a>.<a class="code" href="structt__bt__event__param__pbap__caller__id__name.html#a0604de392031676ba14d072c32e4c9af">name_len</a>)</div><div class="line">        {</div><div class="line">            uint8_t *data;</div><div class="line">            uint16_t len;</div><div class="line"></div><div class="line">            len = param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a1dbce902880e5a4e41bec9684cb6ddf2">pbap_caller_id_name</a>.<a class="code" href="structt__bt__event__param__pbap__caller__id__name.html#a0604de392031676ba14d072c32e4c9af">name_len</a> + 3;</div><div class="line">            data = <a class="code" href="group___o_s__87x3d___memory.html#ga08d79d2a875308455fdffbac5cb4ec67">os_mem_alloc</a>(<a class="code" href="group__x3e___m_e_m___c_o_n_f_i_g___exported___types.html#gga20f6fc28665b1bdf8326a4826ba69b77a53394a9ecf33e56adc53407220bae73d">RAM_TYPE_DATA_ON</a>, len);</div><div class="line">            <span class="keywordflow">if</span> (data != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                data[0] = 0;</div><div class="line">                data[1] = <a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gabefbac5f2a394cc371665653f31845c9">CALLER_ID_TYPE_NAME</a>;</div><div class="line">                data[2] = param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a1dbce902880e5a4e41bec9684cb6ddf2">pbap_caller_id_name</a>.<a class="code" href="structt__bt__event__param__pbap__caller__id__name.html#a0604de392031676ba14d072c32e4c9af">name_len</a>;</div><div class="line">                memcpy(data + 3, param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a1dbce902880e5a4e41bec9684cb6ddf2">pbap_caller_id_name</a>.<a class="code" href="structt__bt__event__param__pbap__caller__id__name.html#a0b1d5075f3c3049fa3c6c1f8ebac38c5">name_ptr</a>, param-&gt;<a class="code" href="union_t___b_t___e_v_e_n_t___p_a_r_a_m.html#a1dbce902880e5a4e41bec9684cb6ddf2">pbap_caller_id_name</a>.<a class="code" href="structt__bt__event__param__pbap__caller__id__name.html#a0604de392031676ba14d072c32e4c9af">name_len</a>);</div><div class="line"></div><div class="line">                <a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gab68a0f6aaed4553d0c5bad7608f434dc">app_report_event</a>(<a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gga5d33818623af7687eff8863825004c35ad02df31c353532bddcf4743ad9d7725b">CMD_PATH_SPP</a>, <a class="code" href="group___a_p_p___r_e_p_o_r_t.html#gga7726a52eb69945b78d3a5a1463a839c7ad701e51a8ac05dd16f8aca7263f22e69">EVENT_CALLER_ID</a>, 0, data, len);</div><div class="line"></div><div class="line">                <a class="code" href="group___o_s__87x3e___memory___exported__functions.html#gaa24b3140450c6eda57a1365a6c3d9d26">os_mem_free</a>(data);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="PBAP_Disconnect"></a>
2.5 PBAP Disconnect</h3>
<p>When PBAP connection is no longer needed, call <a class="el" href="group___b_t___p_b_a_p.html#ga7411c9aa1216ec2a9c9603644fc134a5" title="Send a PBAP disconnection request. ">bt_pbap_disconnect_req()</a> to terminate the PBAP connection. </p><div class="image">
<img src="pbap_disconnect.png" alt="pbap_disconnect.png"/>
</div>
 <center><div id="figure_2_7"><b>Figure 2-7 PBAP Disconnect </b></div></center> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
