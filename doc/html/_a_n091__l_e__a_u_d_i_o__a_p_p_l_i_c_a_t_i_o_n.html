<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="LE_Audio_Application_Page"></a>
LE Audio Application </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.0</b></center><p><br />
 </p><center><b>2023/08/12</b></center><div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0  </td><td class="markdownTableBodyCenter">2023/08/12  </td><td class="markdownTableBodyCenter">Normal Release   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Note_Content"></a>
Contents</h2>
<ul>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Rev">Revision History</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Table_List">Table List</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Overview">1 Overview</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Lib_Dependencies">2 BLE Lib Dependencies</a><ul>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Lib_Usage">2.1 Ble_mgr lib and Leaudio lib Usage</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Lib_Msg_Callback">2.2 GAP Message and Callback Handling</a></li>
</ul>
</li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization">3 Initialization of LE audio Application</a><ul>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Components">3.1 Supported Components Role of TMAP</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Project_Overview">3.2 Project Overview</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Start">3.3 Application Startup</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler">3.4 LEA modules Initialization and Message Handler</a><ul>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_ASCS">3.4.1 ASCS</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_MCP">3.4.2 MCP</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_CCP">3.4.3 CCP</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_VCS">3.4.4 VCS</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_PACS">3.4.5 PACS</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_CSIS">3.4.6 CSIS</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_TMAS">3.4.7 TMAS</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_UMR">3.4.8 UMR</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_BMR">3.4.9 BMR</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_Message_Handler_LEA_MGR">3.4.10 LEA MGR</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Usage">4 LE Audio application Usage</a><ul>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_UMR_Start_Stop">4.1 Unicast Media Receiver Start and Stop Flow</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_BMR_Start_Stop">4.2 Broadcast Media Receiver Start and Stop Flow</a><ul>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_BMR_Start">4.2.1 Broadcast Media Receiver Start Flow</a></li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Initialization_BMR_Stop">4.2.2 Broadcast Media Receiver Stop Flow</a></li>
</ul>
</li>
<li><a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_MMI">4.3 LEA MMI Handler</a></li>
</ul>
</li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Table_List"></a>
Table List</h2>
<ul>
<li><a href="#table_1_1">Table 1-1 Mapping of TMAP roles to CAP roles</a></li>
<li><a href="#table_2_1">Table 2-1 BLE dependent Libs</a></li>
</ul>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_3_1">Figure 3-1 Codec Frame length Process</a></li>
<li><a href="#figure_3_2">Figure 3-2 Representation of expanded PAC record</a></li>
<li><a href="#figure_3_3">Figure 3-3 Generating SIRK</a></li>
<li><a href="#figure_4_1">Figure 4-1 Unicast Media Receiver Start and Stop Flow</a></li>
<li><a href="#figure_4_2">Figure 4-2 Broadcast Media Receiver Start Flow</a></li>
<li><a href="#figure_4_3">Figure 4-3 Broadcast Media Receiver Stop Flow</a></li>
</ul>
<div style="page-break-after: always;"></div><p> <br />
</p>
<h2><a class="anchor" id="LE_Audio_Application_Glossary"></a>
Glossary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Terms  </th><th class="markdownTableHeadCenter">Definitions   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">eRWS  </td><td class="markdownTableBodyCenter">Realtek proprietary enhanced real wireless stereo scheme   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Multilink  </td><td class="markdownTableBodyCenter">Allow headset concurrent connect with at most two Bluetooth Classic source devices   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">B2S  </td><td class="markdownTableBodyCenter">Bud to Bluetooth Classic Source link   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">B2B  </td><td class="markdownTableBodyCenter">Bud to Bud with Bluetooth Classic link   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">B2SL  </td><td class="markdownTableBodyCenter">Bud to Bluetooth LE audio Source link   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pri  </td><td class="markdownTableBodyCenter">Primary bud which would be seen from the Bluetooth Classic source   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Sec  </td><td class="markdownTableBodyCenter">Secondary bud which would be sniffing from the Bluetooth Classic source   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CIS  </td><td class="markdownTableBodyCenter">LE Connected Isochronous Streams   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BIS  </td><td class="markdownTableBodyCenter">Broadcast Isochronous Streams   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">LEA  </td><td class="markdownTableBodyCenter">LE Audio   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">UMR  </td><td class="markdownTableBodyCenter">Unicast Media Receiver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">BMR  </td><td class="markdownTableBodyCenter">Broadcast Media Receiver   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">UMS  </td><td class="markdownTableBodyCenter">Unicast Media Sender   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">BMS  </td><td class="markdownTableBodyCenter">Broadcast Media Sender   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CG  </td><td class="markdownTableBodyCenter">Call Gateway   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CT  </td><td class="markdownTableBodyCenter">Call Terminal   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CSIS  </td><td class="markdownTableBodyCenter">Coordinated Set Identification Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SIRK  </td><td class="markdownTableBodyCenter">Set Identity Resolving Key   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">RSI  </td><td class="markdownTableBodyCenter">Resolvable Set Identifier   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ASCS  </td><td class="markdownTableBodyCenter">Audio Stream Control Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PACS  </td><td class="markdownTableBodyCenter">Published Audio Capabilities Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">BASS  </td><td class="markdownTableBodyCenter">Broadcast Audio Scan Service   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CDKD  </td><td class="markdownTableBodyCenter">Cross-Transport Key Derivation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">EATT  </td><td class="markdownTableBodyCenter">Enhanced Attribute protocol   </td></tr>
</table>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Overview"></a>
1 Overview</h2>
<p>TMAP is an application profile for telephony and media audio. The purpose of this document is to introduce the TMAP development for the LEA Application. The LEA Application includes the three roles of the UMR, CT, and BMR. <br />
</p>
<p>1.Unicast Media Receiver <br />
 <br />
 The Unicast Media Receiver (UMR) role is defined for devices that receive media audio content from a source device in one or more Unicast Audio Streams. Typical devices implementing the UMR role include headphones, earbuds, and wireless speakers. <br />
</p>
<p>2.Call Terminal <br />
 <br />
 The Call Terminal (CT) role is defined for headset type devices in telephony or VoIP applications. Typical devices implementing the CT role include wireless headsets, speakers, and microphones that participate in conversational audio.<br />
</p>
<p>3.Broadcast Media Receiver <br />
 <br />
 The Broadcast Media Receiver (BMR) role is defined for devices that receive media audio content from a source device in a broadcast Audio Stream. Typical devices implementing the BMR role include headphones, earbuds, and speakers. A smartphone may also support this role to receive broadcast Audio Streams from a BMS.<br />
</p>
<p>TMAP uses the CAP roles of Initiator, Acceptor, and Commander.<br />
</p>
<p>Table 1.1 lists the CAP role support requirements for each TMAP role. </p><center><div id="table_1_1"><b>Table 1-1 Mapping of TMAP roles to CAP roles </b></div></center> <div class="image">
<img src="Mapping_TMAP_to_CAP.png" alt="Mapping_TMAP_to_CAP.png"/>
</div>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Lib_Dependencies"></a>
2 BLE Lib Dependencies</h2>
<p>Table 2-1 lists BLE dependent Libs for LE Audio Application. </p><center><div id="table_2_1"><b>Table 2-1 BLE dependent Libs </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Lib  </th><th class="markdownTableHeadCenter">Used Header Files  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">gap_utils.lib  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">Gap libary file implements BLE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ble_mgr.lib  </td><td class="markdownTableBodyCenter">sdk  </td><td class="markdownTableBodyCenter">BLE manager libary include auxiliary API for BLE function   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">leaudio.lib  </td><td class="markdownTableBodyCenter">sdk  </td><td class="markdownTableBodyCenter">Gap libary file implements BLE   </td></tr>
</table>
<h3><a class="anchor" id="LE_Audio_Application_Lib_Usage"></a>
2.1 Ble_mgr lib and Leaudio lib Usage</h3>
<p>The initialization code for ble_mgr lib is displayed below. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_ble_gap_ble_mgr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">     <a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html">BLE_MGR_PARAMS</a> param = {0};</div><div class="line"></div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bd7683baadc3ca1ca7ae8c1b895611a">ble_ext_adv</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bd7683baadc3ca1ca7ae8c1b895611a">ble_ext_adv</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a719280eb2fedb81d95d276e2addd979a">adv_num</a> = app_ble_gap_get_ext_adv_num();</div><div class="line"></div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bf99cce3fab31103463a96bd3f2d034">ble_conn</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line">    uint8_t supported_max_le_link_num = <a class="code" href="group___g_a_p___l_e___c_o_m_m_o_n___exported___functions.html#ga13f6449e757dab08b87c3f08a855d1a5">le_get_max_link_num</a>();</div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a4bf99cce3fab31103463a96bd3f2d034">ble_conn</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ae45d5bbf79348f323a96f15e6a7c26f4">link_num</a> = ((<a class="code" href="group___a_p_p___l_i_n_k.html#ga9875ca18a9c76318637e0df3774093ed">MAX_BLE_LINK_NUM</a> &lt;= supported_max_le_link_num) ? <a class="code" href="group___a_p_p___l_i_n_k.html#ga9875ca18a9c76318637e0df3774093ed">MAX_BLE_LINK_NUM</a> :</div><div class="line">                               supported_max_le_link_num);</div><div class="line">    ...</div><div class="line">    param.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#a50e84e72fc87e7f0652f7519248d96ab">ble_scan</a>.<a class="code" href="struct_b_l_e___m_g_r___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line"><span class="comment">//BMR must enable ble scan </span></div><div class="line">    ble_mgr_init(&amp;param);</div><div class="line">}</div></div><!-- fragment --><p> The ble_mgr lib is initialized using ble_mgr_init(). <br />
</p>
<p>The initialization code for leaudio lib is displayed below. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_lea_mgr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html">T_BLE_AUDIO_PARAMS</a> ble_audio_param;</div><div class="line"></div><div class="line">    ble_audio_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html#aefd4e39cd81a67ec6bb571646ce73fec">evt_queue_handle</a> = <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#ga1dc336635d2a407d06df2101d4208c43">audio_evt_queue_handle</a>;</div><div class="line">    ble_audio_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html#ab16d5e105b1c246220eda8b551cdeb67">io_queue_handle</a> = <a class="code" href="group___a_p_p___m_a_i_n___exported___variables.html#gae608acf4da9aeedaf885f18e8b91eefc">audio_io_queue_handle</a>;</div><div class="line"><span class="preprocessor">#if F_APP_EATT_SUPPORT</span></div><div class="line">    ble_audio_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html#a33ce8d848089f496a62db9e2e19eae0c">bt_gatt_client_init</a> = <a class="code" href="group___g_a_t_t___d_i_s_c_o_v___m_o_d_e.html#ga9c2ab7991444c0891af27b9a2bed87b5">GATT_CLIENT_DISCOV_MODE_REG_SVC_BIT</a> |</div><div class="line">                                          <a class="code" href="group___g_a_t_t___d_i_s_c_o_v___m_o_d_e.html#ga85ba780dbf02152a32187d2808409125">GATT_CLIENT_DISCOV_MODE_USE_EXT_CLIENT</a> |</div><div class="line">                                          <a class="code" href="group___g_a_t_t___d_i_s_c_o_v___m_o_d_e.html#gac8aaa0f3aa9bae1a551f09c267d3f831">GATT_CLIENT_DISCOV_MODE_GATT_SVC</a>;</div><div class="line">    <a class="code" href="group___b_t___g_a_t_t___c_l_i_e_n_t___exported___functions.html#ga39bdd8e187555550f17e26612f14740d">gatt_client_cfg_client_supported_feature</a>(<a class="code" href="group___g_a_t_t___s_v_c___c_l_t___s_u_p___f_e_a_t_u_r_e.html#ga4696b070fcdde970d7c2a600c7b462b7">GATT_SVC_CLIENT_SUPPORTED_FEATURES_EATT_BEARER_BIT</a>);</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">    ble_audio_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html#a33ce8d848089f496a62db9e2e19eae0c">bt_gatt_client_init</a> = <a class="code" href="group___g_a_t_t___d_i_s_c_o_v___m_o_d_e.html#ga9c2ab7991444c0891af27b9a2bed87b5">GATT_CLIENT_DISCOV_MODE_REG_SVC_BIT</a> |</div><div class="line">                                          <a class="code" href="group___g_a_t_t___d_i_s_c_o_v___m_o_d_e.html#ga85ba780dbf02152a32187d2808409125">GATT_CLIENT_DISCOV_MODE_USE_EXT_CLIENT</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    ble_audio_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html#a60fe14159dab99239f88e73228a9237b">acl_link_num</a> = <a class="code" href="group___g_a_p___l_e___c_o_m_m_o_n___exported___functions.html#ga13f6449e757dab08b87c3f08a855d1a5">le_get_max_link_num</a>();</div><div class="line">    ble_audio_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___p_a_r_a_m_s.html#a89d8a64df18da5f7ad50a73e9ed22589">io_event_type</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074a457dd5f2c4d95658479e878017582412">IO_MSG_TYPE_LE_AUDIO</a>;</div><div class="line">   ...</div><div class="line"></div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#ga815f80e2bf34eb3a54f8c0750f747aaa">ble_audio_init</a>(&amp;ble_audio_param);</div><div class="line">   ...</div><div class="line">}</div></div><!-- fragment --><p> The leaudio lib is initialized with <a class="el" href="group___l_e_a___l_i_b___exported___functions.html#ga815f80e2bf34eb3a54f8c0750f747aaa" title="Initialize LE audio. ">ble_audio_init()</a>. <br />
</p>
<h3><a class="anchor" id="LE_Audio_Application_Lib_Msg_Callback"></a>
2.2 GAP Message and Callback Handling</h3>
<p>GAP Message and Callback handling functions are displayed below. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga74db254007c7fbbe873ed69ab0fdd61b">app_ble_gap_handle_gap_msg</a>(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> *p_io_msg)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_t___l_e___g_a_p___m_s_g.html">T_LE_GAP_MSG</a> stack_msg;</div><div class="line">    memcpy(&amp;stack_msg, &amp;p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a>, <span class="keyword">sizeof</span>(p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a>));</div><div class="line">    <a class="code" href="group___t_r_a_c_e.html#gadbd6667019aa1db0ec6456ec90268f4f">APP_PRINT_TRACE1</a>(<span class="stringliteral">&quot;app_ble_gap_handle_gap_msg: subtype %d&quot;</span>, p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a>);</div><div class="line"></div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT || F_APP_TMAP_BMR_SUPPORT)</span></div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#ga8af460d5bdb6b5d9874a919aed2de3e0">ble_audio_handle_gap_msg</a>(p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a>, stack_msg);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_FINDMY_FEATURE_SUPPORT</span></div><div class="line">    fmna_ble_peripheral_evt(p_io_msg);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    ble_mgr_handle_gap_msg(p_io_msg-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a>, &amp;stack_msg);</div><div class="line">    ...</div><div class="line">}</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___g_a_p___common___exported___types.html#ga90b0c39404615bbdf0fc222483ed3fb9">T_APP_RESULT</a> app_ble_gap_cb(uint8_t cb_type, <span class="keywordtype">void</span> *p_cb_data)</div><div class="line">{</div><div class="line">    <a class="code" href="group___g_a_p___common___exported___types.html#ga90b0c39404615bbdf0fc222483ed3fb9">T_APP_RESULT</a> result = <a class="code" href="group___g_a_p___common___exported___types.html#gga90b0c39404615bbdf0fc222483ed3fb9a909f010ff315d17ec44d25243492a366">APP_RESULT_SUCCESS</a>;</div><div class="line">    <a class="code" href="union_t___l_e___c_b___d_a_t_a.html">T_LE_CB_DATA</a> cb_data;</div><div class="line"></div><div class="line">    memcpy(&amp;cb_data, p_cb_data, <span class="keyword">sizeof</span>(<a class="code" href="union_t___l_e___c_b___d_a_t_a.html">T_LE_CB_DATA</a>));</div><div class="line"></div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT || F_APP_TMAP_BMR_SUPPORT)</span></div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gaf8baaf1835a7e7ef94300a5d502faaea">ble_audio_handle_gap_cb</a>(cb_type, p_cb_data);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    ble_mgr_handle_gap_cb(cb_type, p_cb_data);</div><div class="line">    ....</div><div class="line">}</div></div><!-- fragment --><p> ble_mgr_handle_gap_msg() is used to handle GAP messages. <br />
 <a class="el" href="group___l_e_a___l_i_b___exported___functions.html#ga8af460d5bdb6b5d9874a919aed2de3e0">ble_audio_handle_gap_msg()</a> is used to handle GAP messages. <br />
 ble_mgr_handle_gap_cb() is used to handle GAP callback messages. <br />
 <a class="el" href="group___l_e_a___l_i_b___exported___functions.html#gaf8baaf1835a7e7ef94300a5d502faaea">ble_audio_handle_gap_cb()</a> is used to handle GAP callback messages. <br />
</p>
<div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Initialization"></a>
3 Initialization of LE audio Application</h2>
<p>The purpose of this document is to give an overview of LE Audio Application. <br />
 The implementation of LEA Application is capable of supporting concurrent roles like CT, UMR, and BMR. <br />
</p>
<h3><a class="anchor" id="LE_Audio_Application_Initialization_Components"></a>
3.1 Supported Components Role of TMAP</h3>
<p>APP Configurable Functions are defined in <a class="el" href="app__lea__flags_8h_source.html">app_lea_flags.h</a>. <br />
 Users can easily change the value of the Macro definition to switch the function. <br />
 TMAP role component: <br />
 </p><div class="fragment"><div class="line"><span class="comment">// CT and UMR must support ASCS and PACS service</span></div><div class="line"><span class="preprocessor">#define F_APP_TMAP_CT_SUPPORT           1</span></div><div class="line"><span class="preprocessor">#define F_APP_TMAP_UMR_SUPPORT          1</span></div><div class="line"><span class="preprocessor">#define F_APP_TMAP_BMR_SUPPORT          1</span></div><div class="line"><span class="preprocessor">#define F_APP_TMAS_SUPPORT              1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_TMAP_CT_SUPPORT</span></div><div class="line"><span class="preprocessor">#undef F_APP_CCP_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_CCP_SUPPORT               1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#undef F_APP_VCS_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_VCS_SUPPORT               1</span></div><div class="line"><span class="preprocessor">#undef F_APP_OPTIONAL_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_OPTIONAL_SUPPORT          1</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_TMAP_UMR_SUPPORT</span></div><div class="line"><span class="preprocessor">#undef F_APP_MCP_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_MCP_SUPPORT               1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#undef F_APP_VCS_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_VCS_SUPPORT               1</span></div><div class="line"><span class="preprocessor">#undef F_APP_OPTIONAL_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_OPTIONAL_SUPPORT          1</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_TMAP_BMR_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_LEA_REALCAST_SUPPORT      0</span></div><div class="line"><span class="preprocessor">#undef F_APP_MCP_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_MCP_SUPPORT               1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#undef F_APP_VCS_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_VCS_SUPPORT               1</span></div><div class="line"><span class="preprocessor">#undef F_APP_OPTIONAL_SUPPORT</span></div><div class="line"><span class="preprocessor">#define F_APP_OPTIONAL_SUPPORT          1</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_OPTIONAL_SUPPORT</span></div><div class="line"><span class="preprocessor">#define GATTC_TBL_STORAGE_SUPPORT       1</span></div><div class="line"><span class="preprocessor">#define BT_GATT_CLIENT_SUPPORT          1</span></div><div class="line"><span class="preprocessor">#define F_APP_LE_AUDIO_REF_CLK          1</span></div><div class="line"><span class="preprocessor">#define F_APP_LE_ISO_REF_CLK            1</span></div><div class="line"><span class="preprocessor">#define F_APP_LEA_CSIS_ENC              1</span></div><div class="line"><span class="preprocessor">#define F_APP_MICS_SUPPORT              0</span></div><div class="line"><span class="preprocessor">#define F_APP_CSIS_SUPPORT              1</span></div><div class="line"><span class="preprocessor">#define F_APP_EATT_SUPPORT              0</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><h3><a class="anchor" id="LE_Audio_Application_Initialization_Project_Overview"></a>
3.2 Project Overview</h3>
<p>The file list is divided into the following groups: </p><center><div id="table_3_1"><b>Table 3-1 LEA Application Project File List </b></div></center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">C File  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_adv.c  </td><td class="markdownTableBodyCenter">Advertising manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">app_lea_scan.c  </td><td class="markdownTableBodyCenter">Scan manager   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_profile.c  </td><td class="markdownTableBodyCenter">Parameter of bap include TMAP role and message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">app_lea_pacs.c  </td><td class="markdownTableBodyCenter">Parameter of Audio Capabilities parameter and message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_ascs.c  </td><td class="markdownTableBodyCenter">ASCS profile related process and message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">app_lea_vcs.c  </td><td class="markdownTableBodyCenter">VCS message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_csis.c  </td><td class="markdownTableBodyCenter">CSIS message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">app_lea_mcp.c  </td><td class="markdownTableBodyCenter">MCP message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_ccp.c  </td><td class="markdownTableBodyCenter">CCP message handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">app_lea_umr.c  </td><td class="markdownTableBodyCenter">Unicast Receiver Audio related process   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_bmr.c  </td><td class="markdownTableBodyCenter">Broadcast Receiver Audio related process   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">app_lea_realcast.c  </td><td class="markdownTableBodyCenter">Realcast resolution for broadcast audio   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">app_lea_mgr.c  </td><td class="markdownTableBodyCenter">Bridge of LE Audio and other models   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">multitopology_ctr.cl  </td><td class="markdownTableBodyCenter">Handle streaming from BR/EDR and LEA   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">multitopology_pro.c  </td><td class="markdownTableBodyCenter">LE Audio device handle   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">bt_ext_ftl.c, gattc_tbl_storage.c  </td><td class="markdownTableBodyCenter">GATT discovery result storage   </td></tr>
</table>
<h3><a class="anchor" id="LE_Audio_Application_Initialization_Start"></a>
3.3 Application Startup</h3>
<p>The main function is activated when the chip is reset or the program is powered on, and it carries out the initialization tasks listed below. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">   ...</div><div class="line">   <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga475d55a0a331f1115e2986d39109f327">app_bt_gap_init</a>();</div><div class="line">   ...</div><div class="line">   <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga5e597c87be17364dd4b7225dfa597861">app_ble_gap_init</a>();</div><div class="line">   <a class="code" href="group___a_p_p___b_l_e___c_l_i_e_n_t___exported___functions.html#ga6249cfb260227812db898244ef72ddde">app_ble_client_init</a>();</div><div class="line">   ...</div><div class="line">#<span class="keywordflow">if</span> F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT || F_APP_TMAP_BMR_SUPPORT</div><div class="line">   app_ble_audio_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___s_p_p___d_e_m_o___m_a_i_n.html#ga475d55a0a331f1115e2986d39109f327">app_bt_gap_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if F_APP_LEA_SUPPORT</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#abfb0c86126653790eb2fe7390d660496">bud_role</a> == <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a673a27baaad47fd731a4458b2250a6a6">REMOTE_SESSION_ROLE_SINGLE</a>)</div><div class="line">    {</div><div class="line">        auth_flags |= <a class="code" href="group___b_o_n_d___m_i_t_m___d_e_f_i_n_e_s.html#ga916e8571ac8ea9183d5a1855b68dcfb2">GAP_AUTHEN_BIT_SC_BR_FLAG</a>;</div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_BOND_MGR_SUPPORT</span></div><div class="line">    bt_bond_init();</div><div class="line"><span class="preprocessor">#if F_APP_LEA_SUPPORT</span></div><div class="line">    ble_audio_bond_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><p> <br />
1)SC must be enabled if LEA dual mode is supported.GAP_AUTHEN_BIT_SC_BR_FLAG,Secure connection for BR/EDR is required. <br />
2)Application initializes the app bond mgr module by calling bt_bond_init(),the application shall to call this function to register the bond manager callback. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___g_a_p.html#ga5e597c87be17364dd4b7225dfa597861">app_ble_gap_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">#<span class="keywordflow">if</span> <a class="code" href="group___a_p_p___f_l_a_g_s.html#gae0f4f0a2868af471361930c15d5061da">F_APP_SC_KEY_DERIVE_SUPPORT</a></div><div class="line">    app_ble_key_derive_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if GATTC_TBL_STORAGE_SUPPORT</span></div><div class="line">    gattc_tbl_storage_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_EATT_SUPPORT</span></div><div class="line">    app_ble_gap_ecfc_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p> <br />
1)app_ble_key_derive_init function set convert LTK to link key <a class="el" href="group___b_o_n_d___k_e_y___c_o_n_v_e_r_t.html">Link Key Conversion Flags</a>. <br />
2)gattc_tbl_storage_init function set GATT discovery result storage <br />
3)app_ble_gap_ecfc_init function in support of EATT, a new L2CAP mode has been defined. The new mode is called the L2CAP. Enhanced Credit Based Flow Control Mode. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___b_l_e___c_l_i_e_n_t___exported___functions.html#ga6249cfb260227812db898244ef72ddde">app_ble_client_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keyword">volatile</span> uint8_t client_num = 0;</div><div class="line">    ...</div><div class="line">#<span class="keywordflow">if</span> (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT)</div><div class="line">    client_num += 1;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (client_num)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if (F_APP_LEA_SUPPORT == 0)</span></div><div class="line">        <a class="code" href="group___g_a_t_t___client___common___exported___functions.html#ga8154deffc5d5e230be3159ebd77b8ac9">client_init</a>(client_num);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>The app_lea_profile_init function initializes the following lea sub-modules. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_ble_audio_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    app_lea_profile_init();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_lea_profile_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if F_APP_LEA_SUPPORT</span></div><div class="line">    <a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html">T_CAP_INIT_PARAMS</a> cap_init_param = {0};</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___l_e_a___a_s_c_s___exported___functions.html#ga7cbd23f48e79ca682b7fd3707db30c2f">app_lea_ascs_init</a>();</div><div class="line"><span class="preprocessor">#if F_APP_MCP_SUPPORT</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_a___m_c_p___exported___functions.html#ga8bc8c5b61428e1d4d6631e05f2f68e76">app_lea_mcp_init</a>();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_CCP_SUPPORT</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_a___c_c_p___exported___functions.html#ga06b9a2ea1e3abb504f30f3541c52af80">app_lea_ccp_init</a>();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    app_lea_pacs_init();</div><div class="line"><span class="preprocessor">#if F_APP_VCS_SUPPORT</span></div><div class="line">    app_lea_vcs_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    app_lea_umr_init();</div><div class="line">    app_lea_bmr_init();</div><div class="line">    app_lea_profile_bap_init();</div><div class="line"><span class="preprocessor">#if F_APP_CSIS_SUPPORT</span></div><div class="line">    <a class="code" href="group___a_p_p___l_e_a___c_s_i_s___exported___functions.html#gaca0f7b24140e9715e34d693848dcc1f7">app_lea_csis_init</a>(&amp;cap_init_param);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    app_lea_profile_cap_init(&amp;cap_init_param);</div><div class="line"><span class="preprocessor">#if F_APP_TMAS_SUPPORT</span></div><div class="line">    app_lea_profile_tmas_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    app_lea_mgr_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">}</span></div></div><!-- fragment --><p> <br />
1)The function app_lea_profile_bap_init sets up BAP roles and system resources. <br />
2)Other initialization of modules is in the following chapter.</p>
<h3><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler"></a>
3.4 LEA modules Initialization and Message Handler</h3>
<p>Below is a display of every sub-module register callback function and begin to processes the BLE audio.</p>
<h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_ASCS"></a>
3.4.1 ASCS</h4>
<p>ASCS can be instantiated on devices that can accept the establishment of unicast Audio Streams. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___l_e_a___a_s_c_s___exported___functions.html#ga7cbd23f48e79ca682b7fd3707db30c2f">app_lea_ascs_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gae459ea2b839f0a662f20d69aaac0013f">ble_audio_cback_register</a>(app_lea_ascs_ble_audio_cback);</div><div class="line">}</div></div><!-- fragment --><p> app_lea_ascs_ble_audio_cback function is invoked whenever a ASCS messages is received from the LE_audio_lib. More information on ASCS messages can be found in <a class="el" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> uint16_t app_lea_ascs_ble_audio_cback(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a> msg, <span class="keywordtype">void</span> *buf)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">if</span> ((msg &amp; 0xFF00) == <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ae0ccd63fc19b54ff69e4748858fef4fb">LE_AUDIO_MSG_GROUP_ASCS</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_ascs_ble_audio_cback: msg %x&quot;</span>, msg);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (msg)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba06044b51771ce1dd53fc8a24e2a09ccc">LE_AUDIO_MSG_ASCS_SETUP_DATA_PATH</a>:</div><div class="line">        {</div><div class="line">            .....</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0bae4b571e37588356e2f0c334d71f743f9">LE_AUDIO_MSG_ASCS_REMOVE_DATA_PATH</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba578ff9b1e59e45f9ed153befe9eb576e">LE_AUDIO_MSG_ASCS_CP_CONFIG_CODEC_IND</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0bab1c384539889e72811e4cbd6bce09143">LE_AUDIO_MSG_ASCS_CP_CONFIG_QOS_IND</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba846df58a2f7587af9cdb44133bfbc851">LE_AUDIO_MSG_ASCS_CP_ENABLE_IND</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba18a911d850d3cb2925633a423f3c4aca">LE_AUDIO_MSG_ASCS_CP_DISABLE_IND</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba83836bd1b4574c19d0c65e4d83ce7ae3">LE_AUDIO_MSG_ASCS_CP_UPDATE_METADATA_IND</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> cb_result;</div><div class="line">}</div></div><!-- fragment --> <h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_MCP"></a>
3.4.2 MCP</h4>
<p>Media player information, including media player category.The media state of the media player. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___l_e_a___m_c_p___exported___functions.html#ga8bc8c5b61428e1d4d6631e05f2f68e76">app_lea_mcp_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gae459ea2b839f0a662f20d69aaac0013f">ble_audio_cback_register</a>(app_lea_mcp_ble_audio_cback);</div><div class="line">}</div></div><!-- fragment --><p> app_lea_mcp_ble_audio_cback function is invoked whenever a MCP messages is received from the LE_audio_lib. More information on MCP messages can be found in <a class="el" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a>. </p><div class="fragment"><div class="line">{</div><div class="line">    uint16_t cb_result = <a class="code" href="group___b_l_e___a_u_d_i_o___c_b___r_e_s_u_l_t.html#ga6e0271af8429c63c2b6f3226948c14d5">BLE_AUDIO_CB_RESULT_SUCCESS</a>;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((msg &amp; 0xFF00) == <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a38eaa7c2d71966bd04df79c53c86d35c">LE_AUDIO_MSG_GROUP_MCP_CLIENT</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_mcp_ble_audio_cback: msg %x&quot;</span>, msg);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (msg)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba14fd1987e0192a7cb61be340c75e7667">LE_AUDIO_MSG_MCP_CLIENT_DIS_DONE</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (p_dis_done-&gt;is_found)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (p_dis_done-&gt;gmcs)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___m_c_p___client___exported___functions.html#gaec4ba064c3a539317e4a9d8bc400812a">mcp_client_cfg_cccd</a>(p_dis_done-&gt;conn_handle,</div><div class="line">                                        <a class="code" href="group___m_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#gad24fefc6d4260394f8033b38275165ee">MCP_CLIENT_CFG_CCCD_FLAG_MEDIA_CONTROL_POINT</a> | <a class="code" href="group___m_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga737b2f05fbc5ef8392228ace7c404f5f">MCP_CLIENT_CFG_CCCD_FLAG_TRACK_CHANGED</a> |</div><div class="line">                                        <a class="code" href="group___m_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga06c63cf3ed8a7ae200e7244fbf89fae3">MCP_CLIENT_CFG_CCCD_FLAG_MEDIA_STATE</a>,</div><div class="line">                                        <span class="keyword">true</span>, 0, <span class="keyword">true</span>);</div><div class="line">                    <a class="code" href="group___m_c_p___client___exported___functions.html#ga49d3a8ac3e068154d329ece73deef46c">mcp_client_read_char_value</a>(p_dis_done-&gt;conn_handle, 0, <a class="code" href="group___m_c_s___u_u_i_d___c_h_a_r.html#ga9bc5812fad29884f186bf976e28fd88c">MCS_UUID_CHAR_MEDIA_STATE</a>, <span class="keyword">true</span>);</div><div class="line">                    <a class="code" href="group___m_c_p___client___exported___functions.html#ga49d3a8ac3e068154d329ece73deef46c">mcp_client_read_char_value</a>(p_dis_done-&gt;conn_handle, 0, <a class="code" href="group___m_c_s___u_u_i_d___c_h_a_r.html#gaf3db8a384b102ed16fcf133c05110dcd">MCS_UUID_CHAR_MEDIA_PLAYER_NAME</a>, <span class="keyword">true</span>);</div><div class="line">                    p_link-&gt;gmcs = p_dis_done-&gt;gmcs;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba2871cd287d760978a0f1958189e2c889">LE_AUDIO_MSG_MCP_CLIENT_READ_RESULT</a>:</div><div class="line">        {</div><div class="line">           ...</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (p_read_result-&gt;cause == <a class="code" href="group___b_t___t_y_p_e_s.html#gae28a99be86971489212b23df8633291c">GAP_SUCCESS</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (p_read_result-&gt;char_uuid == <a class="code" href="group___m_c_s___u_u_i_d___c_h_a_r.html#ga9bc5812fad29884f186bf976e28fd88c">MCS_UUID_CHAR_MEDIA_STATE</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (p_read_result-&gt;data.media_state != <a class="code" href="group___t___m_c_s___m_e_d_i_a___s_t_a_t_e.html#gga87dff98b1ca34d06a0ad088799421457ad03df962b05d9d905944085178c004a2">MCS_MEDIA_STATE_INACTIVE</a>)</div><div class="line">                    {</div><div class="line">                        p_link-&gt;pre_media_state = p_link-&gt;media_state;</div><div class="line">                        p_link-&gt;media_state = p_read_result-&gt;data.media_state;</div><div class="line">                    }</div><div class="line">                    <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_mcp_ble_audio_cback: media_state %x&quot;</span>, p_link-&gt;media_state);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p_read_result-&gt;char_uuid == <a class="code" href="group___m_c_s___u_u_i_d___c_h_a_r.html#gaf3db8a384b102ed16fcf133c05110dcd">MCS_UUID_CHAR_MEDIA_PLAYER_NAME</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (p_read_result-&gt;data.media_player_name.media_player_name_len != 0)</div><div class="line">                    {</div><div class="line">                        uint8_t *p_name = p_read_result-&gt;data.media_player_name.p_media_player_name;</div><div class="line">                        <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_mcp_ble_audio_cback: player_name %s&quot;</span>, <a class="code" href="group___t_r_a_c_e.html#ga78c7b103f1c05e69c26a3b5d615de7e8">TRACE_STRING</a>(p_name));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0bad8e8e6ebd9bb13cc14e7102bc33df2b2">LE_AUDIO_MSG_MCP_CLIENT_NOTIFY</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">            <span class="keywordflow">switch</span> (p_notify_result-&gt;char_uuid)</div><div class="line">            {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___m_c_s___u_u_i_d___c_h_a_r.html#ga9bc5812fad29884f186bf976e28fd88c">MCS_UUID_CHAR_MEDIA_STATE</a>:</div><div class="line">                {</div><div class="line">                    <span class="comment">// Because dongle set MCP states is pause forever, not change state.</span></div><div class="line">                    <span class="comment">// here is workaround, when headset is streaming, local state will be change.</span></div><div class="line">                    <span class="keywordflow">if</span> (p_notify_result-&gt;data.media_state != <a class="code" href="group___t___m_c_s___m_e_d_i_a___s_t_a_t_e.html#gga87dff98b1ca34d06a0ad088799421457ad03df962b05d9d905944085178c004a2">MCS_MEDIA_STATE_INACTIVE</a>)</div><div class="line">                    {</div><div class="line">                        p_link-&gt;pre_media_state = p_link-&gt;media_state;</div><div class="line">                        p_link-&gt;media_state = p_notify_result-&gt;data.media_state;</div><div class="line">                    }</div><div class="line">                    <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_mcp_ble_audio_cback: media_state %x&quot;</span>, p_notify_result-&gt;data.media_state);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">   ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> cb_result;</div><div class="line">}</div></div><!-- fragment --> <h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_CCP"></a>
3.4.3 CCP</h4>
<p>The Call Control Client resides on devices that can make requests to the server to make, receive, and manage calls. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___l_e_a___c_c_p___exported___functions.html#ga06b9a2ea1e3abb504f30f3541c52af80">app_lea_ccp_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gae459ea2b839f0a662f20d69aaac0013f">ble_audio_cback_register</a>(app_lea_ccp_ble_audio_cback);</div><div class="line">}</div></div><!-- fragment --><p> app_lea_ccp_ble_audio_cback function is invoked whenever a CCP messages is received from the LE_audio_lib. More information on CCP messages can be found in <a class="el" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> uint16_t app_lea_ccp_ble_audio_cback(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a> msg, <span class="keywordtype">void</span> *buf)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">if</span> ((msg &amp; 0xFF00) == <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a53167cf6e599c92bf0bb364c1a912016">LE_AUDIO_MSG_GROUP_CCP_CLIENT</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_ccp_ble_audio_cback: msg %x&quot;</span>, msg);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (msg)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba3bbdedbb4bc67bd4429e84477de61bc1">LE_AUDIO_MSG_CCP_CLIENT_DIS_DONE</a>:</div><div class="line">        {</div><div class="line">           ...</div><div class="line">            <span class="keywordflow">if</span> (p_dis_done-&gt;is_found)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (p_dis_done-&gt;gtbs)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;find GTBS: conn_handle 0x%x&quot;</span>, p_dis_done-&gt;conn_handle);</div><div class="line">                    uint16_t cfg_flags = <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga9e0977d4e6c4fcceca399b33913bc7d6">CCP_CLIENT_CFG_CCCD_FLAG_BEARER_LIST_CURRENT_CALLS</a> |</div><div class="line">                                         <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga75bbdc7e26a8f8b56dcbef80f40e2739">CCP_CLIENT_CFG_CCCD_FLAG_STATUS_FLAGS</a> |</div><div class="line">                                         <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga90008b76f82466f9a66f48b00ebf1667">CCP_CLIENT_CFG_CCCD_FLAG_INCOMING_CALL_TARGET_BEARER_URI</a> | <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga18cdaba841b09aecbb99e49499578d60">CCP_CLIENT_CFG_CCCD_FLAG_CALL_STATE</a> |</div><div class="line">                                         <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga9a9ea88170a2f88ab9dc98ce4222dbef">CCP_CLIENT_CFG_CCCD_FLAG_CALL_CONTROL_POINT</a> | <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga7e28a0d48932a1c0be3b28740299eecc">CCP_CLIENT_CFG_CCCD_FLAG_TERMINATION_REASON</a> |</div><div class="line">                                         <a class="code" href="group___c_c_p___c_l_i_e_n_t___c_f_g___c_c_c_d___f_l_a_g.html#ga7e6fc5182ca879f415b986b82b9d8f3c">CCP_CLIENT_CFG_CCCD_FLAG_INCOMING_CALL</a>;</div><div class="line">                    <a class="code" href="group___c_c_p___client___exported___functions.html#gad542cbb2454f9aa1ee2695930ebf4357">ccp_client_cfg_cccd</a>(p_dis_done-&gt;conn_handle, 0, cfg_flags, <span class="keyword">true</span>, p_dis_done-&gt;gtbs);</div><div class="line">                    <a class="code" href="group___c_c_p___client___exported___functions.html#gabf9aa3c4e5b772edd313d2742e7ceff5">ccp_client_read_char_value</a>(p_dis_done-&gt;conn_handle, 0, <a class="code" href="group___t_b_s___u_u_i_d___c_h_a_r.html#gaa8b26f56c891d9d2c322fc506125b3e1">TBS_UUID_CHAR_CALL_STATE</a>, p_dis_done-&gt;gtbs);</div><div class="line">                    p_link-&gt;gtbs = p_dis_done-&gt;gtbs;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0baf66b3160dae5ae12e2b4fbbfd6d5ea45">LE_AUDIO_MSG_CCP_CLIENT_READ_RESULT</a>:</div><div class="line">        {</div><div class="line">           ...</div><div class="line">            <span class="keywordflow">if</span> (p_read_result-&gt;cause == <a class="code" href="group___b_t___t_y_p_e_s.html#gae28a99be86971489212b23df8633291c">GAP_SUCCESS</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (p_read_result-&gt;char_uuid == <a class="code" href="group___t_b_s___u_u_i_d___c_h_a_r.html#gaa8b26f56c891d9d2c322fc506125b3e1">TBS_UUID_CHAR_CALL_STATE</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (p_read_result-&gt;data.call_state.call_state_len &gt;= CCP_CALL_STATE_CHARA_LEN)</div><div class="line">                    {</div><div class="line">                        ...</div><div class="line">                        app_lea_ccp_update_link_call_status(p_link);</div><div class="line">                        <a class="code" href="group___a_p_p___l_e_a___c_c_p___exported___functions.html#gae48f347d9893966f4891b2b62374f6c7">app_lea_ccp_update_call_status</a>();</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba3f26be6f3b77ab48d4566e3ba3fa11f2">LE_AUDIO_MSG_CCP_CLIENT_NOTIFY</a>:</div><div class="line">        {</div><div class="line">           ...</div><div class="line">            <span class="keywordflow">switch</span> (p_notify_data-&gt;char_uuid)</div><div class="line">            {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___t_b_s___u_u_i_d___c_h_a_r.html#gaa8b26f56c891d9d2c322fc506125b3e1">TBS_UUID_CHAR_CALL_STATE</a>:</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___t_b_s___u_u_i_d___c_h_a_r.html#gade43a8ec1d52d30e3505e8b401114224">TBS_UUID_CHAR_BEARER_LIST_CURRENT_CALLS</a>:</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___t_b_s___u_u_i_d___c_h_a_r.html#gad529d73c6dd9ada0680167c81e4a8224">TBS_UUID_CHAR_INCOMING_CALL</a>:</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___a_p_p___t_y_p_e_s___exported___types.html#ga3d780dc8f03a1ae7b864c1e2b62842a4">T_APP_CALL_STATUS</a> pre_call_status = p_link-&gt;<a class="code" href="struct_t___a_p_p___b_r___l_i_n_k.html#a3bb53bb05ce52bd46410f7b8dfbbc7de">call_status</a>;</div><div class="line"></div><div class="line">                    app_lea_ccp_parse_and_update_call_state(p_link, p_notify_data);</div><div class="line">                    app_lea_ccp_update_link_call_status(p_link);</div><div class="line">                    <a class="code" href="group___a_p_p___l_e_a___c_c_p___exported___functions.html#gae48f347d9893966f4891b2b62374f6c7">app_lea_ccp_update_call_status</a>();</div><div class="line">                    app_lea_ccp_trigger_call_ringtone(p_link, pre_call_status);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___t_b_s___u_u_i_d___c_h_a_r.html#gac7c827fa44b35298d25d951aa08ead8a">TBS_UUID_CHAR_TERMINATION_REASON</a>:</div><div class="line">                {</div><div class="line">                    ...</div><div class="line">                    app_lea_ccp_update_link_call_status(p_link);</div><div class="line">                    <a class="code" href="group___a_p_p___l_e_a___c_c_p___exported___functions.html#gae48f347d9893966f4891b2b62374f6c7">app_lea_ccp_update_call_status</a>();</div><div class="line">                    app_lea_ccp_trigger_call_ringtone(p_link, pre_call_status);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> cb_result;</div><div class="line">}</div></div><!-- fragment --> <h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_VCS"></a>
3.4.4 VCS</h4>
<p>A device to expose the controls and state of its audio volume. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_lea_vcs_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_t___b_l_e___a_u_d_i_o___v_c___m_i_c___p_a_r_a_m_s.html">T_BLE_AUDIO_VC_MIC_PARAMS</a> vc_mic_param = {0};</div><div class="line">    <a class="code" href="struct_t___v_c_s___p_a_r_a_m.html">T_VCS_PARAM</a> vcs_param;</div><div class="line"></div><div class="line">    vc_mic_param.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___v_c___m_i_c___p_a_r_a_m_s.html#a2710f9a6b220f721e688a0611dafbd89">vcs_enable</a> = <span class="keyword">true</span>;</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gabfd88e00fc4d816bb04525ef662d1e92">ble_audio_vc_mic_init</a>(&amp;vc_mic_param);</div><div class="line"></div><div class="line">    vcs_param.<a class="code" href="struct_t___v_c_s___p_a_r_a_m.html#a2226397bacee4268490c252ecb79390a">volume_setting</a> = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.lea_vcs_vol_setting;</div><div class="line">    vcs_param.<a class="code" href="struct_t___v_c_s___p_a_r_a_m.html#ad9aef3fe07cb77df6845f5830762396d">mute</a> = <a class="code" href="group___v_o_l___m_u_t_e___v_a_l_u_e.html#ga9a37fccca3fe92398b9018f1c2777e03">VCS_NOT_MUTED</a>;</div><div class="line">    vcs_param.<a class="code" href="struct_t___v_c_s___p_a_r_a_m.html#abd170e2fdf2598976a62344c5ef85c27">change_counter</a> = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#a5fe51ec5e37761344dea0e3af37b98cd">lea_vcs_change_cnt</a>;</div><div class="line"><span class="preprocessor">#if F_APP_LE_AUDIO_DISABLE_ABSOLUTE_VOLUME</span></div><div class="line">    vcs_param.<a class="code" href="struct_t___v_c_s___p_a_r_a_m.html#ab2532839aef9422ffcd9f1d20f9a0e51">volume_flags</a> = <a class="code" href="group___v_o_l___f_l_a_g.html#ga5a938917a19206f32491fa122fdf07be">VCS_USER_SET_VOLUME_SETTING</a>;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">    vcs_param.<a class="code" href="struct_t___v_c_s___p_a_r_a_m.html#ab2532839aef9422ffcd9f1d20f9a0e51">volume_flags</a> = <a class="code" href="group___v_o_l___f_l_a_g.html#ga456db740ac550a35dc5c53828affb1d6">VCS_RESET_VOLUME_SETTING</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    vcs_param.<a class="code" href="struct_t___v_c_s___p_a_r_a_m.html#af9ccbdd1e2efc8d8608c53f31a48d298">step_size</a> = VCS_VOLUME_STEP_SIZE;</div><div class="line">    <a class="code" href="group___v_c_p___server___exported___functions.html#gacc44602f4b0f35de9c6f6ad1aa034e8e">vcs_set_param</a>(&amp;vcs_param);</div><div class="line">}</div></div><!-- fragment --><h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_PACS"></a>
3.4.5 PACS</h4>
<p>Sets of audio capabilities, known as Published Audio Capability (PAC) records, are exposed by using either the Sink PAC characteristic or Source PAC characteristic. Clients can discover and read these characteristics, and servers can notify these characteristics 3.4.5.1 PACS Initialization and Message_Handler{#LE_Audio_Application_Initialization_Message_Handler_Initialization_Message_Handler} </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_lea_pacs_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html">T_PACS_PARAMS</a> pacs_params;</div><div class="line"><span class="comment">//Set location</span></div><div class="line">    uint32_t sink_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga2b255f8f066639ee4d84ad79fe3a8fe1">AUDIO_LOCATION_FL</a> | <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga32980c500be6f47b205ffcf0ceb62cf2">AUDIO_LOCATION_FR</a>;</div><div class="line">    uint32_t source_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga2b255f8f066639ee4d84ad79fe3a8fe1">AUDIO_LOCATION_FL</a> | <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga32980c500be6f47b205ffcf0ceb62cf2">AUDIO_LOCATION_FR</a>;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#abfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a673a27baaad47fd731a4458b2250a6a6">REMOTE_SESSION_ROLE_SINGLE</a>)</div><div class="line">    {</div><div class="line">        sink_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga9fd64e5f6f4417858453d76ee9a63dba">AUDIO_LOCATION_MONO</a>;</div><div class="line">        source_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga9fd64e5f6f4417858453d76ee9a63dba">AUDIO_LOCATION_MONO</a>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a070baa3999451473bc481de199ca10a2">bud_side</a> == <a class="code" href="group___a_p_p___c_f_g.html#gac5dc0ff4da54ac7eb2352ca00e6689cfa57d07086a0a086d6ab101b4841cdc64f">DEVICE_BUD_SIDE_LEFT</a>)</div><div class="line">        {</div><div class="line">            sink_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga2b255f8f066639ee4d84ad79fe3a8fe1">AUDIO_LOCATION_FL</a>;</div><div class="line">            source_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga2b255f8f066639ee4d84ad79fe3a8fe1">AUDIO_LOCATION_FL</a>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            sink_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga32980c500be6f47b205ffcf0ceb62cf2">AUDIO_LOCATION_FR</a>;</div><div class="line">            source_loc = <a class="code" href="group___a_u_d_i_o___l_o_c.html#ga32980c500be6f47b205ffcf0ceb62cf2">AUDIO_LOCATION_FR</a>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a3cccafb6c3098217b74d22a899bdbc9e">sink_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a6b30e391e4d5b2b4d40e712718287013">is_exist</a> = <span class="keyword">true</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a3cccafb6c3098217b74d22a899bdbc9e">sink_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a2bd696a89e36adcc77ea930212cb79a2">is_notify</a> = <span class="keyword">true</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a3cccafb6c3098217b74d22a899bdbc9e">sink_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#aedabf689d8f5b0d22fbafd1bd8954692">is_write</a> = <span class="keyword">false</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a3cccafb6c3098217b74d22a899bdbc9e">sink_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a76491db19ac228f7a1ad72b10171f626">sink_audio_location</a> = sink_loc;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a4af681bdb4c99f124909701bcf26fe16">source_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a6b30e391e4d5b2b4d40e712718287013">is_exist</a> = <span class="keyword">true</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a4af681bdb4c99f124909701bcf26fe16">source_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a2bd696a89e36adcc77ea930212cb79a2">is_notify</a> = <span class="keyword">true</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a4af681bdb4c99f124909701bcf26fe16">source_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#aedabf689d8f5b0d22fbafd1bd8954692">is_write</a> = <span class="keyword">false</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a4af681bdb4c99f124909701bcf26fe16">source_locations</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#aaa7180041afd098442f8d2a16aca656b">source_audio_location</a> = source_loc;</div><div class="line"><span class="comment">//Support Context</span></div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#afcba2a77f7b0d2f098021545cb7f95d0">supported_contexts</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a2bd696a89e36adcc77ea930212cb79a2">is_notify</a> = <span class="keyword">true</span>;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#afcba2a77f7b0d2f098021545cb7f95d0">supported_contexts</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#a1f4651133358b73d221897be6b5da703">sink_supported_contexts</a> = app_lea_pac_sink_supported_contexts;</div><div class="line">    pacs_params.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#afcba2a77f7b0d2f098021545cb7f95d0">supported_contexts</a>.<a class="code" href="struct_t___p_a_c_s___p_a_r_a_m_s.html#afab2481d2c415efa7bdcb61e02f75c78">source_supported_contexts</a> = app_lea_pac_source_supported_contexts;</div><div class="line"></div><div class="line">    app_lea_pacs_pac_choice(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.low_latency);</div><div class="line"><span class="comment">//Add Pac</span></div><div class="line">    app_lea_pac_sink_pac_id = <a class="code" href="group___p_a_c_s___server___exported___functions.html#gadd72eaaeb858d1561a19d68c19fb199e">pacs_pac_add</a>(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggaddc9391bc23189606598d54ad592446fac2fd4f85378b7ba92e25499edfb64731">SERVER_AUDIO_SINK</a>, (<span class="keyword">const</span> uint8_t *)app_lea_pac_psink,</div><div class="line">                                           app_lea_pac_psink_size, <span class="keyword">true</span>);</div><div class="line">    app_lea_pac_source_pac_id = <a class="code" href="group___p_a_c_s___server___exported___functions.html#gadd72eaaeb858d1561a19d68c19fb199e">pacs_pac_add</a>(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggaddc9391bc23189606598d54ad592446fa0f10df7cbd97cd55d4f4288a67be678c">SERVER_AUDIO_SOURCE</a>, (<span class="keyword">const</span> uint8_t *)app_lea_pac_psource,</div><div class="line">                                             app_lea_pac_psource_size, <span class="keyword">true</span>);</div><div class="line"><span class="comment">//Initialize PACS</span></div><div class="line">    <a class="code" href="group___p_a_c_s___server___exported___functions.html#gabf7394d1e1c742b84f11b756c23fdef1">pacs_init</a>(&amp;pacs_params);</div><div class="line"><span class="comment">//Register callback to handle PACS messages is received from the LE_audio_lib</span></div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gae459ea2b839f0a662f20d69aaac0013f">ble_audio_cback_register</a>(app_lea_pacs_ble_audio_cback);</div><div class="line">}</div></div><!-- fragment --><p> <br />
1)AUDIO_LOCATION, Set audio channel location <a class="el" href="ble__audio__def_8h_source.html">ble_audio_def.h</a> <br />
2)Audio context of Sink ans Source supported <br />
3)app_lea_pacs_pac_choice, according to MCU configuration define codec sample rate. <br />
4)Add PAC of sink and source <br />
5)Initialize PACS Service.The api shall be called before gap_start_bt_stack. <br />
6)app_lea_pacs_ble_audio_cback function, Register callback to LE_audio_lib</p>
<p>app_lea_pacs_ble_audio_cback function is invoked whenever a PACS messages is received from the LE_audio_lib. More information on PACS messages can be found in <a class="el" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> uint16_t app_lea_pacs_ble_audio_cback(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a> msg, <span class="keywordtype">void</span> *buf)</div><div class="line">{</div><div class="line">    uint16_t cb_result = <a class="code" href="group___b_l_e___a_u_d_i_o___c_b___r_e_s_u_l_t.html#ga6e0271af8429c63c2b6f3226948c14d5">BLE_AUDIO_CB_RESULT_SUCCESS</a>;</div><div class="line">    <span class="keywordflow">switch</span> (msg)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0bae40039205357dcb2e5786ec2219135a4">LE_AUDIO_MSG_PACS_READ_AVAILABLE_CONTEXTS_IND</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___p_a_c_s___r_e_a_d___a_v_a_i_l_a_b_l_e___c_o_n_t_e_x_t_s___i_n_d.html">T_PACS_READ_AVAILABLE_CONTEXTS_IND</a> *p_data = (<a class="code" href="struct_t___p_a_c_s___r_e_a_d___a_v_a_i_l_a_b_l_e___c_o_n_t_e_x_t_s___i_n_d.html">T_PACS_READ_AVAILABLE_CONTEXTS_IND</a> *)buf;</div><div class="line">            ...</div><div class="line">            <a class="code" href="struct_t___a_p_p___l_e___l_i_n_k.html">T_APP_LE_LINK</a> *p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#gafc9692f05321278ca7f83523a9affedc">app_link_find_le_link_by_conn_handle</a>(p_data-&gt;<a class="code" href="struct_t___p_a_c_s___r_e_a_d___a_v_a_i_l_a_b_l_e___c_o_n_t_e_x_t_s___i_n_d.html#a0d5ffe38d68e48d81e61fc6a4999ae68">conn_handle</a>);</div><div class="line">            <span class="keywordflow">if</span> (p_link)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___p_a_c_s___server___exported___functions.html#ga0574a3bddfcf19b52acca41b833b0d28">pacs_available_contexts_read_cfm</a>(p_data-&gt;<a class="code" href="struct_t___p_a_c_s___r_e_a_d___a_v_a_i_l_a_b_l_e___c_o_n_t_e_x_t_s___i_n_d.html#a0d5ffe38d68e48d81e61fc6a4999ae68">conn_handle</a>, p_data-&gt;<a class="code" href="struct_t___p_a_c_s___r_e_a_d___a_v_a_i_l_a_b_l_e___c_o_n_t_e_x_t_s___i_n_d.html#aeb65c8711b864df01fca95cfe904d924">cid</a>, p_link-&gt;sink_available_contexts,</div><div class="line">                                                 p_link-&gt;source_available_contexts);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> cb_result;</div><div class="line">}</div></div><!-- fragment --><p> 3.4.5.1 Codec Configuration{#LE_Audio_Application_Initialization_Message_Handler_Codec_Configuration} </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_lea_pacs_pac_choice(<span class="keywordtype">bool</span> low_latency)</div><div class="line">{</div><div class="line">    T_APP_LEA_PAC_CODEC codec = {0};</div><div class="line"></div><div class="line">    app_lea_pacs_code_setting(&amp;codec);</div><div class="line">    ...</div><div class="line">    app_lea_pacs_set_sink_pac(low_latency, codec);</div><div class="line">    app_lea_pacs_set_src_pac(low_latency, codec);</div><div class="line">}</div></div><!-- fragment --><p> <br />
1.Configure Codec Sample Rate for Media and Conversation </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_lea_pacs_code_setting(T_APP_LEA_PAC_CODEC *para)</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ab482df2ad838b7630a351ca86a439508">media_downstream_sample_rate</a> &amp; PAC_MEDIA_48)</div><div class="line">    {</div><div class="line">        para-&gt;media_sample_rate |= <a class="code" href="group___s_u_p___s_a_m_p_l_i_n_g___f_r_e_q.html#gab1c7d0ab523a135f955d91f9ca0ed14d">SAMPLING_FREQUENCY_48K</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.ccp_downstream_sample_rate &amp; PAC_CCP_DSR_16)</div><div class="line">    {</div><div class="line">        para-&gt;ccp_downstream_sample_rate |= <a class="code" href="group___s_u_p___s_a_m_p_l_i_n_g___f_r_e_q.html#gaa13df484a6412bda4b7c566bd36cc1f6">SAMPLING_FREQUENCY_16K</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.ccp_upstream_sample_rate &amp; PAC_CCP_USR_16)</div><div class="line">    {</div><div class="line">        para-&gt;ccp_upstream_sample_rate |= <a class="code" href="group___s_u_p___s_a_m_p_l_i_n_g___f_r_e_q.html#gaa13df484a6412bda4b7c566bd36cc1f6">SAMPLING_FREQUENCY_16K</a>;</div><div class="line">    }</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p> <br />
2.Configure PAC of Sink </p><div class="fragment"><div class="line">app_lea_pacs_set_sink_pac(<span class="keywordtype">bool</span> low_latency, T_APP_LEA_PAC_CODEC codec)</div><div class="line">{</div><div class="line">    uint8_t qos = 0;</div><div class="line">    T_APP_LEA_PAC_SET para; </div><div class="line">    ...</div><div class="line">    *p_sink_pac_record = SINK_PAC_CNT;</div><div class="line">    ...</div><div class="line">    app_lea_pacs_framelen_setting(app_lea_pac_media_codec_set, &amp;media_stream);</div><div class="line">    app_lea_pacs_framelen_setting(app_lea_pac_ccp_downstream_codec_set, &amp;ccp_downstream);</div><div class="line">    para.context = (<a class="code" href="group___a_u_d_i_o___c_o_n_t_e_x_t.html#gac807f070b7f0e13d54ef1811a305182c">AUDIO_CONTEXT_MEDIA</a>);</div><div class="line">    app_lea_pacs_para_setting(para);</div><div class="line">    ...</div><div class="line">    para.context = (<a class="code" href="group___a_u_d_i_o___c_o_n_t_e_x_t.html#gaa900a5ba58799e34c5c80843e56fd117">AUDIO_CONTEXT_CONVERSATIONAL</a>);</div><div class="line">    app_lea_pacs_para_setting(para);</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p> <br />
3.Configure PAC of Source </p><div class="fragment"><div class="line">uint8_t qos = 0;</div><div class="line">T_APP_LEA_PAC_SET para; </div><div class="line">*p_source_pac_record = SOURCE_PAC_CNT;</div><div class="line">app_lea_pacs_framelen_setting(app_lea_pac_ccp_ccp_upstream_codec_set, &amp;ccp_upstream);</div><div class="line">app_lea_pacs_para_setting(para);</div></div><!-- fragment --><p> Developer can refer to app_lea_pac_media_codec_set,app_lea_pac_ccp_downstream_codec_set and app_lea_pac_ccp_ccp_upstream_codec_set, starting to change codec set as below displayed. <br />
</p><div class="image">
<img src="Codec_set.png" alt="Codec_set.png"/>
</div>
 <center><div id="figure_3_1"><b>Figure 3-1 Codec Frame length Process </b></div></center><p> The app_lea_pacs_para_setting function uses the PAC format, as seen below. </p><div class="image">
<img src="PAC_EX.png" alt="PAC_EX.png"/>
</div>
 <center><div id="figure_3_2"><b>Figure 3-2 Representation of expanded PAC record </b></div></center><h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_CSIS"></a>
3.4.6 CSIS</h4>
<p>A Coordinated Set is defined as a group of devices that are configured to support a specific scenario.Examples of Coordinated Sets include a pair of earbuds, or a speaker set that receives multi-channel audio and that reacts to control commands in a coordinated way (e.g., volume up and volume down). 3.4.6.1 CSIS Initialization{#LE_Audio_Application_Initialization_Message_Handler_CSIS_Initialization}</p>
<p>Here are the Initialization of CSIS. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___l_e_a___c_s_i_s___exported___functions.html#gaca0f7b24140e9715e34d693848dcc1f7">app_lea_csis_init</a>(<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html">T_CAP_INIT_PARAMS</a> *p_param)</div><div class="line">{</div><div class="line">    uint8_t size = 1;</div><div class="line">    uint8_t rank = 1;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#abfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a673a27baaad47fd731a4458b2250a6a6">REMOTE_SESSION_ROLE_SINGLE</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#a070baa3999451473bc481de199ca10a2">bud_side</a> == <a class="code" href="group___a_p_p___c_f_g.html#gac5dc0ff4da54ac7eb2352ca00e6689cfac307eaac2b3e7555b04f2f8be902fdcb">DEVICE_BUD_SIDE_RIGHT</a>)</div><div class="line">        {</div><div class="line">            rank = 2;</div><div class="line">        }</div><div class="line">        size = 2;</div><div class="line">    }</div><div class="line"></div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a8f3aef44e10b13eddaa5a1663af4985e">csis_num</a> = 1;</div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#ac842b6c1dcb3b1f11b611620199dc55c">enable</a> = <span class="keyword">true</span>;</div><div class="line"><span class="preprocessor">#if F_APP_LEA_CSIS_ENC</span></div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a578ad824aa4fdb7fd535e1dadd4b9045">csis_sirk_type</a> = <a class="code" href="group___c_s_i_p___def___exported___types.html#gga5f41e714e44e29580239fe8dd18b9cd6a8bc1f66a468ea620da71965790a39c29">CSIS_SIRK_ENC</a>;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a578ad824aa4fdb7fd535e1dadd4b9045">csis_sirk_type</a> = <a class="code" href="group___c_s_i_p___def___exported___types.html#gga5f41e714e44e29580239fe8dd18b9cd6ae416fd15695f70ec8e87fe3638d7a0c6">CSIS_SIRK_PLN</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a0936adc32c6e862a1446b0e3b4cd8b6d">csis_size</a> = size;</div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a70e8fa4bb54b37704b620daac1216c0e">csis_rank</a> = rank;</div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aa4bf31b5d00bee0193ca3ccb9311e8e3">csis_feature</a> = (<a class="code" href="group___s_e_t___m_e_m_b_e_r___f_e_a_t_u_r_e.html#gae0ac285ddeb66e04bdd2bdadf646b8ff">SET_MEMBER_LOCK_EXIST</a> | <a class="code" href="group___s_e_t___m_e_m_b_e_r___f_e_a_t_u_r_e.html#ga4b95cbfc7a784d412e4b66c31c924fa5">SET_MEMBER_SIZE_EXIST</a> | <a class="code" href="group___s_e_t___m_e_m_b_e_r___f_e_a_t_u_r_e.html#gaf8bbe62fb7289f3c1cc16240eaf88f24">SET_MEMBER_RANK_EXIST</a> |</div><div class="line">                                 <a class="code" href="group___s_e_t___m_e_m_b_e_r___f_e_a_t_u_r_e.html#gaf1bfa6de95c59539cc11d2a9ab9d3066">SET_MEMBER_SIRK_NOTIFY_SUPPORT</a>);</div><div class="line">    p_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#aee02735b07342dd4e5263aa9d570ca41">cas</a>.<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a7fb9cce62ca7e0c253f3c9856987fbeb">csis_sirk</a> = <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#ac661c5283bd90463ea87a892a9b72e9a">lea_sirk</a>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> app_lea_profile_cap_init(<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html">T_CAP_INIT_PARAMS</a> *p_cap_param)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (p_cap_param)</div><div class="line">    {</div><div class="line">        p_cap_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#adb440a2fb8cbbcff5960ca46d79493d6">cap_role</a> = <a class="code" href="group___c_a_p___r_o_l_e.html#gace6d351e79432f9ac70a7615649436f4">CAP_ACCEPTOR_ROLE</a>;</div><div class="line"><span class="preprocessor">#if F_APP_MCP_SUPPORT</span></div><div class="line">        p_cap_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a3343ccdcaa7033770f9c9c3d6b32be58">mcp_media_control_client</a> = <span class="keyword">true</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_CCP_SUPPORT</span></div><div class="line">        p_cap_param-&gt;<a class="code" href="struct_t___c_a_p___i_n_i_t___p_a_r_a_m_s.html#a15a4b3121d780ae71dee60b59e60d1fd">ccp_call_control_client</a> = <span class="keyword">true</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___c_a_p___exported___functions.html#ga7875894f3d6bedc43227feb46a2c5d2f">cap_init</a>(p_cap_param);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div></div><!-- fragment --><p> <br />
1)Configure Parameters of group size and SIRK, device rank. Set Members and shall proceed in order of increasing rank. <br />
2)Calling cap_init function,the callback is passed to the leaudio.lib. To initialize parameter of csis of cap<br />
</p>
<p>3.4.6.2 Flow Chart for Setting Coordinator Set{#LE_Audio_Application_Initialization_Message_Handler_CSIS_Initialization_Flowchart} Generating an SRI with sirk and then insert the SRI into adv data </p><div class="image">
<img src="Coordinated_set.png" alt="Coordinated_set.png"/>
</div>
 <center><div id="figure_3_3"><b>Figure 3-3 Generating SIRK </b></div></center><h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_TMAS"></a>
3.4.7 TMAS</h4>
<p>Supporting role of TMAP. </p><div class="fragment"><div class="line"><span class="preprocessor">#if F_APP_TMAS_SUPPORT</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_lea_profile_tmas_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_CT_SUPPORT)</span></div><div class="line">    app_lea_profile_tmas_role |= <a class="code" href="group___t_m_a_p___r_o_l_e___b_i_t___m_a_s_k.html#gaa7335c527c54e5001a129505d5eca1b5">TMAS_CT_ROLE</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_UMR_SUPPORT)</span></div><div class="line">    app_lea_profile_tmas_role |= <a class="code" href="group___t_m_a_p___r_o_l_e___b_i_t___m_a_s_k.html#ga866466915da758b0582a02c70e111493">TMAS_UMR_ROLE</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_BMR_SUPPORT)</span></div><div class="line">    app_lea_profile_tmas_role |= <a class="code" href="group___t_m_a_p___r_o_l_e___b_i_t___m_a_s_k.html#gafb96e58bae3a23b44a484d83becb01e0">TMAS_BMR_ROLE</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">if</span> (app_lea_profile_tmas_role &gt; 0)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___t_m_a_p___server___exported___functions.html#gaaf376194d0541a69aa42c22c164f2f1c">tmas_init</a>(app_lea_profile_tmas_role);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --> <h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_UMR"></a>
3.4.8 UMR</h4>
<p>UMR handle Unicast Receive Audio related process </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_lea_umr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___o_s__87x3e___queue.html#gace09f1bc91cf55ef47b9c31109709947">os_queue_init</a>(&amp;app_lea_umr_left_ch_queue);</div><div class="line">    <a class="code" href="group___o_s__87x3e___queue.html#gace09f1bc91cf55ef47b9c31109709947">os_queue_init</a>(&amp;app_lea_umr_right_ch_queue);</div><div class="line">    <a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ga67189dab89dfb141cf0ada6529f057bd">audio_mgr_cback_register</a>(app_lea_umr_audio_cback);</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gae459ea2b839f0a662f20d69aaac0013f">ble_audio_cback_register</a>(app_lea_umr_ble_audio_cback);</div><div class="line">}</div></div><!-- fragment --><p> <br />
1)app_lea_umr_left_ch_queue and app_lea_umr_right_ch_queue is used for 2 cis mixing. <br />
2)app_lea_umr_audio_cback , rgister callback to Audio manager. <br />
3)app_lea_umr_ble_audio_cback, rgister callback to LE_audio_lib.</p>
<p>app_lea_umr_audio_cback function handle Audio manager event </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_lea_umr_audio_cback(<a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ga5aac7f389fef58a6669380c38cf7f6e4">T_AUDIO_EVENT</a> event_type, <span class="keywordtype">void</span> *event_buf, uint16_t buf_len)</div><div class="line">{</div><div class="line">    <a class="code" href="uniont__audio__event__param.html">T_AUDIO_EVENT_PARAM</a> *param = event_buf;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (event_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_u_d_i_o___m_a_n_a_g_e_r___a_u_d_i_o.html#ggacb643b6c4a4b0a6bf5fef74c489d5465a1a7dda7830f762493af156ffa49d9939">AUDIO_EVENT_TRACK_DATA_IND</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___a_u_d_i_o___t_r_a_c_k.html#ga7df031b8938cc9213f46f62bc9774082">audio_track_read</a>(param-&gt;<a class="code" href="uniont__audio__event__param.html#a3d6cba86ba91c8e82a0b679470712e67">track_data_ind</a>.<a class="code" href="structt__audio__event__param__track__data__ind.html#aafbd0a77c69f44190cd208fac5f5c4c2">handle</a>,</div><div class="line">                                 &amp;timestamp,</div><div class="line">                                 &amp;seq_num,</div><div class="line">                                 &amp;status,</div><div class="line">                                 &amp;frame_num,</div><div class="line">                                 buf,</div><div class="line">                                 param-&gt;<a class="code" href="uniont__audio__event__param.html#a3d6cba86ba91c8e82a0b679470712e67">track_data_ind</a>.<a class="code" href="structt__audio__event__param__track__data__ind.html#a8aed22e2c7b283705ec82e0120515618">len</a>,</div><div class="line">                                 &amp;read_len) == <span class="keyword">true</span>)</div><div class="line">            {</div><div class="line">                ...</div><div class="line"></div><div class="line">                    (void)<a class="code" href="group___g_a_p___l_e___i_s_o___d_a_t_a___exported___functions.html#ga378c7ce1cf671f1f10b999ee5012ff00">gap_iso_send_data</a>((uint8_t *)buf, p_ase_entry-&gt;cis_conn_handle, param-&gt;<a class="code" href="uniont__audio__event__param.html#a3d6cba86ba91c8e82a0b679470712e67">track_data_ind</a>.<a class="code" href="structt__audio__event__param__track__data__ind.html#a8aed22e2c7b283705ec82e0120515618">len</a>,</div><div class="line">                                            <span class="keyword">true</span>, timestamp, seq_num);</div><div class="line"></div><div class="line">            }</div><div class="line">            ...</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p> Receive Mic Encode data and gap_iso_send_data by cis upstreaming.</p>
<p>app_lea_umr_ble_audio_cback function handle T_LE_AUDIO_MSG messages is received from the LE_audio_lib. </p><div class="fragment"><div class="line"><span class="keyword">static</span> uint16_t app_lea_umr_ble_audio_cback(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a> msg, <span class="keywordtype">void</span> *buf)</div><div class="line">{</div><div class="line">    uint16_t cb_result = <a class="code" href="group___b_l_e___a_u_d_i_o___c_b___r_e_s_u_l_t.html#ga6e0271af8429c63c2b6f3226948c14d5">BLE_AUDIO_CB_RESULT_SUCCESS</a>;</div><div class="line">    uint16_t msg_group;</div><div class="line"></div><div class="line">    msg_group = msg &amp; 0xFF00;</div><div class="line">    <span class="keywordflow">switch</span> (msg_group)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT)</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a1ee0c56add9671bb0a4447f90997d105">LE_AUDIO_MSG_GROUP_SERVER</a>:</div><div class="line">        cb_result = app_lea_umr_handle_cccd_msg(msg, buf);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ae0ccd63fc19b54ff69e4748858fef4fb">LE_AUDIO_MSG_GROUP_ASCS</a>:</div><div class="line">        cb_result = app_lea_umr_handle_ascs_msg(msg, buf);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_VCS_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29ab17180dde0bae24f0eca81f3fbbb42e0">LE_AUDIO_MSG_GROUP_VCS</a>:</div><div class="line">        cb_result = app_lea_umr_handle_vcs_msg(msg, buf);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_MCP_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a38eaa7c2d71966bd04df79c53c86d35c">LE_AUDIO_MSG_GROUP_MCP_CLIENT</a>:</div><div class="line">        cb_result = app_lea_umr_handle_mcp_msg(msg, buf);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_CCP_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a53167cf6e599c92bf0bb364c1a912016">LE_AUDIO_MSG_GROUP_CCP_CLIENT</a>:</div><div class="line">        cb_result = app_lea_umr_handle_ccp_msg(msg, buf);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> cb_result;</div><div class="line">}</div></div><!-- fragment --><h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_BMR"></a>
3.4.9 BMR</h4>
<p>BMR handle Broadcast Receive Audio related process </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_lea_bmr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#gae459ea2b839f0a662f20d69aaac0013f">ble_audio_cback_register</a>(app_lea_bmr_ble_audio_cback);</div><div class="line">    app_lea_bmr_db_init();</div><div class="line"><span class="preprocessor">#if F_APP_LEA_REALCAST_SUPPORT</span></div><div class="line">    app_lea_realcast_init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">}</span></div></div><!-- fragment --><p> <br />
1)app_lea_bmr_ble_audio_cback, rgister callback to LE_audio_lib. <br />
2)reset BMR data base <br />
3)app_lea_realcast_parse_cback, rgister callback to relay callback</p>
<p>app_lea_bmr_ble_audio_cback, function is invoked whenever a BASS messages is received from the LE_audio_lib. More information on BASS messages can be found in <a class="el" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a>. </p><div class="fragment"><div class="line"><span class="keyword">static</span> uint16_t app_lea_bmr_ble_audio_cback(<a class="code" href="group___l_e_a___l_i_b___exported___types.html#gabe1a2e587cdc57dc5de8e141de5d1b0b">T_LE_AUDIO_MSG</a> msg, <span class="keywordtype">void</span> *buf)</div><div class="line">{</div><div class="line">    uint16_t cb_result = <a class="code" href="group___b_l_e___a_u_d_i_o___c_b___r_e_s_u_l_t.html#ga6e0271af8429c63c2b6f3226948c14d5">BLE_AUDIO_CB_RESULT_SUCCESS</a>;</div><div class="line">    T_APP_LEA_BMR_DB *p_src_active = app_lea_bmr_find_sd_db();</div><div class="line">    uint8_t i = 0;</div><div class="line">    uint8_t j;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((msg &amp; 0xFF00) == <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggab1ac9b0faffc97f453668dadc3417e29a770bc738600823cc7e68d6a24a4e282d">LE_AUDIO_MSG_GROUP_BASS</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___t_r_a_c_e.html#ga81687b044a4d8600c4be891734f4839a">APP_PRINT_INFO1</a>(<span class="stringliteral">&quot;app_lea_bmr_ble_audio_cback: msg 0x%x&quot;</span>, msg);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (msg)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba2f757686981c14acb2fad7f0c9f505e5">LE_AUDIO_MSG_BASS_CP_IND</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___b_a_s_s___c_p___i_n_d.html">T_BASS_CP_IND</a> *p_data = (<a class="code" href="struct_t___b_a_s_s___c_p___i_n_d.html">T_BASS_CP_IND</a> *)buf;</div><div class="line">            ...</div><div class="line">            <span class="keywordflow">switch</span> (p_data-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___i_n_d.html#aa1885646446f579a91dc0692d05b7bc0">p_cp_data</a>-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___d_a_t_a.html#aaddc2238d567ceee6afe638d6062ad55">cp_op</a>)</div><div class="line">            {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___b_a_s_s___def___exported___types.html#ggaf2645d145decf72753b0dcb655514922ab9a76595cf09f946185c92d1ab8e99f9">BASS_CP_OP_ADD_SOURCE</a>:</div><div class="line">                {</div><div class="line">                    ...</div><div class="line">                    p_src_active-&gt;is_past = p_data-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___i_n_d.html#aa1885646446f579a91dc0692d05b7bc0">p_cp_data</a>-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___d_a_t_a.html#a5f4af907d469a0f4ef1e1789d23ba9cd">param</a>.<a class="code" href="union_t___b_a_s_s___c_p___p_a_r_a_m.html#a8512f851fc63310aa2521fbf2f7377a2">add_source</a>.<a class="code" href="struct_t___b_a_s_s___c_p___a_d_d___s_o_u_r_c_e.html#a3b0c5692d10a71a4478f548cd63a6476">pa_sync</a>;</div><div class="line">                    p_src_active-&gt;pa_interval = p_data-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___i_n_d.html#aa1885646446f579a91dc0692d05b7bc0">p_cp_data</a>-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___d_a_t_a.html#a5f4af907d469a0f4ef1e1789d23ba9cd">param</a>.<a class="code" href="union_t___b_a_s_s___c_p___p_a_r_a_m.html#a8512f851fc63310aa2521fbf2f7377a2">add_source</a>.<a class="code" href="struct_t___b_a_s_s___c_p___a_d_d___s_o_u_r_c_e.html#a478867b287c5aef223cad8b9e7cd6550">pa_interval</a>;</div><div class="line">                    ...</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___b_a_s_s___def___exported___types.html#ggaf2645d145decf72753b0dcb655514922a805163c0ab9f9ae18a69b17786b1ca3a">BASS_CP_OP_MODIFY_SOURCE</a>:</div><div class="line">                <span class="comment">/* to synchronize to, or to stop synchronization to, a PA and/or a BIS.</span></div><div class="line"><span class="comment">                 Add or update Metadata*/</span></div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___b_a_s_s___def___exported___types.html#ggaf2645d145decf72753b0dcb655514922a79d5e50faec4ff96b573b5227729a344">BASS_CP_OP_SET_BROADCAST_CODE</a>:</div><div class="line">                {</div><div class="line">                    ...</div><div class="line"></div><div class="line">                    <a class="code" href="struct_t___b_i_g___m_g_r___s_y_n_c___r_e_c_e_i_v_e_r___b_i_g___c_r_e_a_t_e___s_y_n_c___p_a_r_a_m.html">T_BIG_MGR_SYNC_RECEIVER_BIG_CREATE_SYNC_PARAM</a> sync_param;</div><div class="line">                    ...</div><div class="line">                    app_lea_bmr_apply_sync_pera(&amp;sync_param, p_src_active-&gt;sync_handle, 1);</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (<a class="code" href="group___b_a_p___exported___functions.html#gab702f348e991a374692ec9b718c4b39a">ble_audio_big_sync_establish</a>(p_src_active-&gt;sync_handle, &amp;sync_param))</div><div class="line">                    {</div><div class="line">                        <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#a2ff19106b797d43624a7b527bfaeaaf0">lea_encryp</a> = 1;</div><div class="line">                        memcpy(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="struct_t___a_p_p___c_f_g___n_v.html#a3968e23528dce54a29772fac65fc4884">lea_code</a>, p_src_active-&gt;broadcast_Code, <a class="code" href="group___l_e_a___l_i_b___exported___macros.html#ga3697f19ed77fc1d4ba9a4473017e92fc">BROADCAST_CODE_LEN</a>);</div><div class="line">                    }</div><div class="line">                    ...</div><div class="line">                } <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line"></div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba382db1f886cc6b7e0bf32d3e47398686">LE_AUDIO_MSG_BASS_BA_ADD_SOURCE</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html">T_BASS_BA_ADD_SOURCE</a> *p_data = (<a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html">T_BASS_BA_ADD_SOURCE</a> *)buf;</div><div class="line">            <span class="keywordflow">if</span> (mtc_check_call_sate())</div><div class="line">            {</div><div class="line">                cb_result = <a class="code" href="group___b_l_e___a_u_d_i_o___c_b___r_e_s_u_l_t.html#ga286d0d8f668f6b17dfc6d742ca40fd39">BLE_AUDIO_CB_RESULT_REJECT</a>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">            <a class="code" href="group___t_r_a_c_e.html#gacede19f539147e375272a511869b7a77">APP_PRINT_INFO2</a>(<span class="stringliteral">&quot;LE_AUDIO_MSG_BASS_BA_ADD_SOURCE: sync handle %p, source_id %d&quot;</span>,</div><div class="line">                            p_data-&gt;<a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html#a11179b03a715350e72b6eb197d656701">handle</a>, p_data-&gt;<a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html#af8997c5cd725a1ef652639c2d33b7990">source_id</a>);</div><div class="line">            <span class="keywordflow">if</span> (p_src_active != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                app_lea_bmr_bs_set_active(app_lea_bmr_sd_idx);</div><div class="line">                p_src_active-&gt;used |= APP_LEA_BMR_BS;</div><div class="line">                p_src_active-&gt;sync_handle = (<a class="code" href="group___b_a_p___exported___macros.html#ga37ac358cb4b59b4e4c777fc199cce4ee">T_BLE_AUDIO_SYNC_HANDLE</a>)p_data-&gt;<a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html#a11179b03a715350e72b6eb197d656701">handle</a>;</div><div class="line">                p_src_active-&gt;source_id = p_data-&gt;<a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html#af8997c5cd725a1ef652639c2d33b7990">source_id</a>;</div><div class="line">                p_src_active-&gt;disallow_pa = <span class="keyword">true</span>;</div><div class="line">                <a class="code" href="group___b_a_p___exported___functions.html#ga09c24fc4c2dc704837a7279ca01a3782">ble_audio_sync_update_cb</a>(p_data-&gt;<a class="code" href="struct_t___b_a_s_s___b_a___a_d_d___s_o_u_r_c_e.html#a11179b03a715350e72b6eb197d656701">handle</a>, app_lea_bmr_sync_cb);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0baccb3d03ae9a2a555f71f8e1211dc8aa4">LE_AUDIO_MSG_BASS_LOCAL_ADD_SOURCE</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___b_a_s_s___l_o_c_a_l___a_d_d___s_o_u_r_c_e.html">T_BASS_LOCAL_ADD_SOURCE</a> *p_data = (<a class="code" href="struct_t___b_a_s_s___l_o_c_a_l___a_d_d___s_o_u_r_c_e.html">T_BASS_LOCAL_ADD_SOURCE</a> *)buf;</div><div class="line">            <span class="keywordflow">if</span> (p_src_active != <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line">            {</div><div class="line">                p_src_active-&gt;used |= APP_LEA_BMR_BS;</div><div class="line">                p_src_active-&gt;sync_handle = (<a class="code" href="group___b_a_p___exported___macros.html#ga37ac358cb4b59b4e4c777fc199cce4ee">T_BLE_AUDIO_SYNC_HANDLE</a>)p_data-&gt;<a class="code" href="struct_t___b_a_s_s___l_o_c_a_l___a_d_d___s_o_u_r_c_e.html#a11179b03a715350e72b6eb197d656701">handle</a>;</div><div class="line">                p_src_active-&gt;source_id = p_data-&gt;<a class="code" href="struct_t___b_a_s_s___l_o_c_a_l___a_d_d___s_o_u_r_c_e.html#af8997c5cd725a1ef652639c2d33b7990">source_id</a>;</div><div class="line">                app_lea_bmr_bs_set_active(app_lea_bmr_sd_idx);</div><div class="line">            }</div><div class="line"></div><div class="line">            <a class="code" href="group___t_r_a_c_e.html#gacede19f539147e375272a511869b7a77">APP_PRINT_INFO2</a>(<span class="stringliteral">&quot;LE_AUDIO_MSG_BASS_LOCAL_ADD_SOURCE: sync handle %p, source_id %d&quot;</span>,</div><div class="line">                            p_data-&gt;<a class="code" href="struct_t___b_a_s_s___l_o_c_a_l___a_d_d___s_o_u_r_c_e.html#a11179b03a715350e72b6eb197d656701">handle</a>, p_data-&gt;<a class="code" href="struct_t___b_a_s_s___l_o_c_a_l___a_d_d___s_o_u_r_c_e.html#af8997c5cd725a1ef652639c2d33b7990">source_id</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___l_e_a___l_i_b___exported___types.html#ggabe1a2e587cdc57dc5de8e141de5d1b0ba8a20ff4cf0818a7e3a9d5032593dc75e">LE_AUDIO_MSG_BASS_GET_PREFER_BIS_SYNC</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html">T_BASS_SET_PREFER_BIS_SYNC</a> *p_data = (<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html">T_BASS_SET_PREFER_BIS_SYNC</a> *)buf;</div><div class="line">            <a class="code" href="group___t_r_a_c_e.html#ga98e2dee240d2fde3119d3380b4d98762">APP_PRINT_INFO3</a>(<span class="stringliteral">&quot;LE_AUDIO_MSG_BASS_GET_PREFER_BIS_SYNC: sync handle %p, source_id %d, num_subgroups %d&quot;</span>,</div><div class="line">                            p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a11179b03a715350e72b6eb197d656701">handle</a>, p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#af8997c5cd725a1ef652639c2d33b7990">source_id</a>,</div><div class="line">                            p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a1dec806195e80d89ecfab837596228c2">num_subgroups</a>);</div><div class="line">            <a class="code" href="struct_t___b_l_e___a_u_d_i_o___s_y_n_c___i_n_f_o.html">T_BLE_AUDIO_SYNC_INFO</a> sync_info;</div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a1dec806195e80d89ecfab837596228c2">num_subgroups</a>; i++)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> ((p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a9b02d2c4c3eec60660b902d90b64c9fb">p_cp_bis_info</a>-&gt;<a class="code" href="struct_t___b_a_s_s___c_p___b_i_s___i_n_f_o.html#abb47a0f0a595a5fc8388548dcffc1e36">bis_sync</a> == <a class="code" href="group___b_a_s_s___p_a_r_a_m___d_e_s_c.html#ga53abddcdf0f52f9912ea6c02f1c10701">BASS_CP_BIS_SYNC_NO_PREFER</a>) &amp;&amp;</div><div class="line">                    <a class="code" href="group___b_a_p___exported___functions.html#gac98562d178109bd9d0ca91f88161c8bc">ble_audio_sync_get_info</a>(p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a11179b03a715350e72b6eb197d656701">handle</a>, &amp;sync_info))</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (sync_info.<a class="code" href="struct_t___b_l_e___a_u_d_i_o___s_y_n_c___i_n_f_o.html#af47964af83234ef3d76897bc62c34f89">p_base_mapping</a>)</div><div class="line">                    {</div><div class="line">                        ...</div><div class="line">                        app_lea_bmr_remap_bis(p_mapping, p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a11179b03a715350e72b6eb197d656701">handle</a>);</div><div class="line">                        app_lea_bmr_apply_sync_pera(&amp;sync_param, p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#a11179b03a715350e72b6eb197d656701">handle</a>, 0);</div><div class="line">                        ...</div><div class="line"></div><div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="group___b_a_s_s___server___exported___functions.html#gadcb6a614686cd763a36c5db452e438a5">bass_cfg_prefer_bis_sync</a>(p_data-&gt;<a class="code" href="struct_t___b_a_s_s___s_e_t___p_r_e_f_e_r___b_i_s___s_y_n_c.html#af8997c5cd725a1ef652639c2d33b7990">source_id</a>, i, listen_index))</div><div class="line">                        {</div><div class="line">                            <a class="code" href="group___t_r_a_c_e.html#ga5d77ab23ef056676a6860b9959404140">APP_PRINT_INFO0</a>(<span class="stringliteral">&quot;app_bis_mgr_bas set prefer fail&quot;</span>);</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                            app_lea_bmr_bs_tgt.channel =  <a class="code" href="group___g_a_p___l_e___b_i_g___m_g_r___exported___macros.html#gada4328b9d245ae275359842fb6cab9f9">GAP_BIG_MGR_MAX_BIS_NUM</a> + 1;</div><div class="line">                        }</div><div class="line"></div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        ...</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> cb_result;</div><div class="line">}</div></div><!-- fragment --> <h4><a class="anchor" id="LE_Audio_Application_Initialization_Message_Handler_LEA_MGR"></a>
3.4.10 LEA MGR</h4>
<p>Here are the initializations for the LE Audio and other models. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> app_lea_mgr_init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <a class="code" href="group___b_t___d_i_r_e_c_t___m_s_g___e_x_p_o_r_t___functions.html#ga7f3d58c8c76d066e6cc659d1d596d7e3">gap_register_direct_cb</a>(app_lea_mgr_direct_cback);</div><div class="line">    <a class="code" href="group___a_p_p___r_e_l_a_y.html#ga3973f461a62ef1eadfe82daa3f18ce8e">app_relay_cback_register</a>(app_lea_mgr_relay_cback, app_lea_mgr_parse_cback,</div><div class="line">                             <a class="code" href="group___a_p_p___r_e_l_a_y.html#gga8fe3ea47e0bf7256d6bca08cb28eeedea943d4415347c068bf72379ab2967c940">APP_MODULE_TYPE_LEA</a>, LEA_REMOTE_MSG_TOTAL);</div><div class="line"></div><div class="line">    app_ipc_subscribe(BUD_LOCATION_IPC_TOPIC, app_lea_mgr_bud_loc_event_cback);</div><div class="line"></div><div class="line">    <a class="code" href="group___l_e_a___l_i_b___exported___functions.html#ga815f80e2bf34eb3a54f8c0750f747aaa">ble_audio_init</a>(&amp;ble_audio_param);</div><div class="line">    <a class="code" href="group___a_p_p___l_e_a___a_d_v.html#ga7db6b7af7692592839b7b082cab9477c">app_lea_adv_init</a>();</div><div class="line">    mtc_if_lcis_reg(app_lea_mgr_cis_mtc_if_handle);</div><div class="line">    mtc_if_lbis_reg(<a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);<span class="comment">//just register mtc handle bis event</span></div><div class="line">    <span class="comment">//LEA are going to combine umr and bmr handle</span></div><div class="line">    mtc_init();</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> <br />
1)app_lea_mgr_direct_cback function, register callback to gap, when messages in <a class="el" href="group___b_t___d_i_r_e_c_t___m_s_g___c_a_l_l_b_a_c_k___t_y_p_e.html">BT Direct Message Callback Type</a> happens, it will callback to app.It is in the following chapter. <br />
2)app_lea_mgr_relay_cback, rgister callback to relay callback. <br />
3)app_lea_mgr_bud_loc_event_cback, subscribe T_BUD_LOCATION_EVENT event.Later chapters introduce app_lea_mgr_bud_loc_event_cback, which subscribes to T_BUD_LOCATION_EVENT event. <br />
4)ble_audio_init function, <a class="el" href="_a_n091__l_e__a_u_d_i_o__a_p_p_l_i_c_a_t_i_o_n.html#LE_Audio_Application_Lib_Usage">2.1 Ble_mgr lib and Leaudio lib Usage</a> <br />
 <br />
5)Setparameter of adv and rgister callback to adv mgr <br />
6)MTC handles events from LE Audio and BR/EDR; it is introduced in subsequent chapters. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___a_p_p___l_e_a___a_d_v.html#ga7db6b7af7692592839b7b082cab9477c">app_lea_adv_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint16_t audio_adv_flag = 0;</div><div class="line">    uint8_t service_num = 0;</div><div class="line"></div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT)</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_ASCS;</div><div class="line">    service_num++;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_CSIS_SUPPORT</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_PSRI;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_TMAP_BMR_SUPPORT</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_BASS;</div><div class="line">    service_num++;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if(F_APP_TMAS_SUPPORT &amp;&amp; (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT || F_APP_TMAP_BMR_SUPPORT))</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_TMAS;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if (F_APP_TMAP_CT_SUPPORT || F_APP_TMAP_UMR_SUPPORT || F_APP_TMAP_BMR_SUPPORT)</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_PACS;</div><div class="line">    service_num++;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_VCS_SUPPORT</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_VCS;</div><div class="line">    service_num++;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_MICS_SUPPORT</span></div><div class="line">    audio_adv_flag |= LE_EXT_ADV_MICS;</div><div class="line">    service_num++;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    app_lea_adv_set(audio_adv_flag, service_num);</div><div class="line">}</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_lea_adv_set(uint16_t audio_adv_flag, uint8_t service_num)</div><div class="line">{</div><div class="line">    ...</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#abfb0c86126653790eb2fe7390d660496">bud_role</a> != <a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#ggad48900c988433e8bd9e07b08a225fdf4a673a27baaad47fd731a4458b2250a6a6">REMOTE_SESSION_ROLE_SINGLE</a>)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if GFPS_LE_DEVICE_SUPPORT</span></div><div class="line"><span class="comment">//use public address to start lea adv</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line">        own_address_type = <a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gga6a4a22188186cb0102eafa5628d4cb98ab751d2722a1890be60daf72ca879555a">GAP_LOCAL_ADDR_LE_RANDOM</a>;</div><div class="line"></div><div class="line">        <span class="comment">//the type of static random address is 0xC0</span></div><div class="line">        <span class="keywordflow">if</span> ((<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.lea_static_random_addr[5] &amp; 0xC0) != 0xC0)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___g_a_p___l_e___c_o_m_m_o_n___exported___functions.html#ga7a160b17460c4697f6f3289293e602fd">le_gen_rand_addr</a>(<a class="code" href="group___g_a_p___l_e___t_y_p_e_s___exported___types.html#gga22a2d99be7d398d8316d16992be41c6eacd5a63fcc32c1c3d6f77d28431abfe70">GAP_RAND_ADDR_STATIC</a>, <a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.lea_static_random_addr);</div><div class="line">            <a class="code" href="group___a_p_p___c_f_g___exported___functions.html#gab297c89769dd5a96e5d0e10c194869bc">app_cfg_store</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.lea_static_random_addr, 6);</div><div class="line">            <a class="code" href="group___t_r_a_c_e.html#gadbd6667019aa1db0ec6456ec90268f4f">APP_PRINT_TRACE1</a>(<span class="stringliteral">&quot;app_lea_adv_set: cis_static_random_addr %s&quot;</span>,</div><div class="line">                             <a class="code" href="group___t_r_a_c_e.html#ga21deae8960b0d6088c2d18b04a151e66">TRACE_BDADDR</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.lea_static_random_addr));</div><div class="line"></div><div class="line">        }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    }</div><div class="line">    ...</div><div class="line">    audio_adv_len = app_lea_adv_ext_data(audio_adv_flag, service_num);</div><div class="line">    ...</div><div class="line">    <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga21de10157b31a9041d2e7e7dc862e912">ble_ext_adv_mgr_register_callback</a>(app_lea_adv_callback, app_lea_adv_handle);</div><div class="line">}</div></div><!-- fragment --><p> <br />
1)The function app_lea_adv_ext_data fill service data in adv data such as GAP_ADTYPE_SERVICE_DATA of ASCS,TMAS,VCS,BASS, etc. <br />
1)The function app_lea_adv_callback is rgistered to adv mgr.</p>
<p>app_lea_adv_callback function handle callback for app_lea_adv_handle. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_lea_adv_callback(uint8_t cb_type, <span class="keywordtype">void</span> *p_cb_data)</div><div class="line">{</div><div class="line">    <a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html">T_BLE_EXT_ADV_CB_DATA</a> cb_data;</div><div class="line"></div><div class="line">    memcpy(&amp;cb_data, p_cb_data, <span class="keyword">sizeof</span>(<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html">T_BLE_EXT_ADV_CB_DATA</a>));</div><div class="line">    <span class="keywordflow">switch</span> (cb_type)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#gad2dc0692029ca3df07b95326745fcddd">BLE_EXT_ADV_STATE_CHANGE</a>:</div><div class="line">        {</div><div class="line">            ...</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (app_lea_adv_state == <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggac36a5ae5a7b98cc2dffe340704c8f2e3acf6402209e91954f506dfeaf6f040123">BLE_EXT_ADV_MGR_ADV_DISABLED</a>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">switch</span> (cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#a28834c69236a8dd84a2cb8cd96bd5679">p_ble_state_change</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_t_a_t_e___c_h_a_n_g_e.html#ad3d8bfc3b831e3263f0877dc3f5a1457">stop_cause</a>)</div><div class="line">                {</div><div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ggab396c9a4b54ee7b3ea205128030dc94ba23881d3656b475aef3ca0db362452964">BLE_EXT_ADV_STOP_CAUSE_CONN</a>:</div><div class="line">                    {</div><div class="line">                        stack_disable_lea_adv = <span class="keyword">true</span>;</div><div class="line">                        app_lea_mgr_dev_sm(LEA_ADV_STOP, <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___e_x_t_e_n_d_e_d___a_d_v.html#ga2dd2f17ba3ae875441107f1c21f8d994">BLE_EXT_ADV_SET_CONN_INFO</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="struct_t___a_p_p___l_e___l_i_n_k.html">T_APP_LE_LINK</a> *p_link;</div><div class="line"></div><div class="line">            p_link = <a class="code" href="group___a_p_p___l_i_n_k.html#ga922b52611db2ca2b17d84eaa641e2f76">app_link_find_le_link_by_conn_id</a>(cb_data.<a class="code" href="union_t___b_l_e___e_x_t___a_d_v___c_b___d_a_t_a.html#aaf7574159a4584c55e5e470de76aee5c">p_ble_conn_info</a>-&gt;<a class="code" href="struct_t___b_l_e___e_x_t___a_d_v___s_e_t___c_o_n_n___i_n_f_o.html#a6f2749c213f11ad9a16583079a554b39">conn_id</a>);</div><div class="line">            <span class="keywordflow">if</span> (p_link &amp;&amp; p_link-&gt;lea_device)</div><div class="line">            {</div><div class="line"><span class="preprocessor">#if GFPS_LE_DEVICE_SUPPORT</span></div><div class="line">                <span class="comment">//need to start adv for GFPS LE audio multilink</span></div><div class="line">                <span class="keywordtype">bool</span> force_enter_pair_mode = app_gfps_get_force_enter_pairing_mode_flag();</div><div class="line">                app_gfps_le_device_adv_start((<a class="code" href="group___r_e_m_o_t_e___c_o_n_t_r_o_l.html#gad48900c988433e8bd9e07b08a225fdf4">T_REMOTE_SESSION_ROLE</a>)<a class="code" href="group___a_p_p___c_f_g___exported___types.html#ga0063edee2b4c1c981d2db26ef6ff820a">app_cfg_nv</a>.<a class="code" href="group___a_p_p___c_f_g.html#gabfb0c86126653790eb2fe7390d660496">bud_role</a>, force_enter_pair_mode);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stack_disable_lea_adv == <span class="keyword">true</span>)</div><div class="line">            {</div><div class="line">                app_lea_mgr_dev_sm(LEA_CIG_START, <a class="code" href="group___platform___types___exported___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line">            }</div><div class="line">            stack_disable_lea_adv = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div></div><!-- fragment --><div style="page-break-after: always;"></div> <h2><a class="anchor" id="LE_Audio_Application_Usage"></a>
4 LE Audio application Usage</h2>
<p>The scenario and usage of LE audio application are described in this part.</p>
<h3><a class="anchor" id="LE_Audio_Application_UMR_Start_Stop"></a>
4.1 Unicast Media Receiver Start and Stop Flow</h3>
<div class="image">
<img src="UMR_audio_start.png" alt="UMR_audio_start.png"/>
</div>
 <center><div id="figure_4_1"><b>Figure 4-1 Unicast Media Receiver Start and Stop Flow </b></div></center><h3><a class="anchor" id="LE_Audio_Application_Initialization_BMR_Start_Stop"></a>
4.2 Broadcast Media Receiver Start and Stop Flow</h3>
<h4><a class="anchor" id="LE_Audio_Application_Initialization_BMR_Start"></a>
4.2.1 Broadcast Media Receiver Start Flow</h4>
<div class="image">
<img src="BMR_Sink_audio_start.png" alt="BMR_Sink_audio_start.png"/>
</div>
 <center><div id="figure_4_2"><b>Figure 4-2 Broadcast Media Receiver Start Flow </b></div></center><h4><a class="anchor" id="LE_Audio_Application_Initialization_BMR_Stop"></a>
4.2.2 Broadcast Media Receiver Stop Flow</h4>
<div class="image">
<img src="BMR_Sink_audio_stop.png" alt="BMR_Sink_audio_stop.png"/>
</div>
 <center><div id="figure_4_3"><b>Figure 4-3 Broadcast Media Receiver Stop Flow </b></div></center><h3><a class="anchor" id="LE_Audio_Application_MMI"></a>
4.3 LEA MMI Handler</h3>
<p>If LE audio has some mmi actions, will be sent to app_lea_mgr_mmi_handle(). </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> app_mmi_check_lea_action(uint8_t action)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> lea_only_mmi = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (action)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3f0e7f0839d31e474361a01f41b7a513">MMI_BIG_START</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1a9b9466a4ab3411362730ca27962967">MMI_BIG_STOP</a>:</div><div class="line">    <span class="keywordflow">case</span> MMI_CIG_START:</div><div class="line">    <span class="keywordflow">case</span> MMI_CIG_STOP:</div><div class="line">        {</div><div class="line">            app_lea_mgr_mmi_handle(action);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_CCP_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba2e06bcbc584e78f9d9e245641b85a9ba">MMI_HF_END_OUTGOING_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9171e3f9381adc52200b6fe785a9d453">MMI_HF_ANSWER_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba6fd0d50e9bd5f9aa1cef2605165e44a0">MMI_HF_END_ACTIVE_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae2475fb09cbbfe0b84079c249492b02c">MMI_HF_TRANSFER_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3581574278deabf284d171bffebab37a">MMI_HF_REJECT_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3b4c60f21ef58a22d48e341ca931aa4a">MMI_HF_JOIN_TWO_CALLS</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baf3fcad26010b8ef4716ccf21383712f0">MMI_HF_SWITCH_TO_SECOND_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1e1889f16c50e5f8cf950deba16fea5f">MMI_HF_LAST_NUMBER_REDIAL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba4d420af6b712e0a334ee16c74f57fc59">MMI_HF_RELEASE_HELD_OR_WAITING_CALL</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae5985b43183394d1bb2050464eb409c4">MMI_HF_RELEASE_ACTIVE_CALL_ACCEPT_HELD_OR_WAITING_CALL</a>:</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_MCP_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba4fb14d4fa50fb3128cc77aed93da927d">MMI_AV_STOP</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba54b72f81c7ebfa4a5c1248f53c46a817">MMI_AV_FWD</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba30d4054f0b51be45e2d2b81363a8e00f">MMI_AV_BWD</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba17d2e23faa85c464bff216ba6f147cd9">MMI_AV_FASTFORWARD</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba00838c104efd588eebf4ebf5a42a8c75">MMI_AV_REWIND</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bac75fb989e7249ef00b35bd4af8a023eb">MMI_AV_FASTFORWARD_STOP</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1baf3f5aafe9507f5641e21abb4d29d1050">MMI_AV_REWIND_STOP</a>:</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_VCS_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae56062b30503adb2295ae991da5521a3">MMI_DEV_SPK_VOL_UP</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3ea2c8afda57bdcea1867727bdb764da">MMI_DEV_SPK_VOL_DOWN</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1f013eaca019506a8a5a4297771eb33f">MMI_DEV_SPK_MUTE</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1badadeab50bfa9ef8391698dc1fff5ea22">MMI_DEV_SPK_UNMUTE</a>:</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bad540f4f8ee68a9fa380dbd270bc39534">MMI_DEV_MIC_MUTE_UNMUTE</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba9058c0c09cb16b1b1f218908de33f354">MMI_DEV_MIC_MUTE</a>:</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3a86f9c5cbfc1a1759372de3ad81af0b">MMI_DEV_MIC_UNMUTE</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (mtc_get_btmode())</div><div class="line">            {</div><div class="line">                app_lea_mgr_mmi_handle(action);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                lea_only_mmi = <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#if F_APP_MCP_SUPPORT</span></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba42030520a0b53f92ff4ad28a2b5a8565">MMI_AV_PLAY_PAUSE</a>:</div><div class="line">        {</div><div class="line">            app_lea_mgr_mmi_handle(action);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (mtc_get_btmode())</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            lea_only_mmi = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        {</div><div class="line">            lea_only_mmi = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> lea_only_mmi;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> app_lea_mgr_mmi_handle(uint8_t action)</div><div class="line">{</div><div class="line">   ...</div><div class="line">   <span class="keywordflow">if</span> (action == <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba3f0e7f0839d31e474361a01f41b7a513">MMI_BIG_START</a> ||</div><div class="line">        action == <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba1a9b9466a4ab3411362730ca27962967">MMI_BIG_STOP</a> ||</div><div class="line">        action == MMI_CIG_START ||</div><div class="line">        action == MMI_CIG_STOP)</div><div class="line">    {</div><div class="line">        app_lea_mgr_tri_mmi_handle_action(action, <span class="keyword">false</span>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">   ...</div><div class="line">   <span class="keywordflow">switch</span> (action)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if F_APP_MCP_SUPPORT</span></div><div class="line">       <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba42030520a0b53f92ff4ad28a2b5a8565">MMI_AV_PLAY_PAUSE</a>:</div><div class="line">       <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">       ...</div><div class="line">#<span class="keywordflow">if</span> F_APP_CCP_SUPPORT</div><div class="line">       <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1ba2e06bcbc584e78f9d9e245641b85a9ba">MMI_HF_END_OUTGOING_CALL</a>:</div><div class="line">       <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#if F_APP_VCS_SUPPORT</span></div><div class="line">       <span class="keywordflow">case</span> <a class="code" href="group___a_p_p___m_m_i.html#gga9d149ac6a749587538729a0111e48e1bae56062b30503adb2295ae991da5521a3">MMI_DEV_SPK_VOL_UP</a>:</div><div class="line">       <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">       ...</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
