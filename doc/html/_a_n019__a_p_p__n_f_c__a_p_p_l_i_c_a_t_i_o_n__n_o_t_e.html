<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BT AUDIO SDK: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bbpro-h55px.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BT AUDIO SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p>
<h1><a class="anchor" id="NFC_Page"></a>
APP NFC Function Application Note </h1>
<p><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 </p><center><b>V1.1</b></center><p><br />
 </p><center><b>2023/05/29</b></center> <div style="page-break-after: always;"></div><h2><a class="anchor" id="NFC_Rev"></a>
Revision History</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version  </th><th class="markdownTableHeadCenter">Date  </th><th class="markdownTableHeadCenter">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">V1.0.0.0  </td><td class="markdownTableBodyCenter">2021/10/21  </td><td class="markdownTableBodyCenter">Stable Release   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">V1.1  </td><td class="markdownTableBodyCenter">2023/05/29  </td><td class="markdownTableBodyCenter">Revise Format   </td></tr>
</table>
<div style="page-break-after: always;"></div><h2>Contents</h2>
<ul>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Rev">Revision History</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Table_List">Table List</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Figure_List">Figure List</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Glossary">Glossary</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Introduction">1 Introduction</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Configuration">2 NFC_Configuration</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Usage">3 NFC API Usage</a><ul>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Initialization">3.1 Initialization</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Multi_Link_Trigger">3.2 NFC_Multi_Link_Trigger</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_Interrput_Handler">3.3 NFC_Interrput_Handler</a></li>
<li><a class="el" href="_a_n019__a_p_p__n_f_c__a_p_p_l_i_c_a_t_i_o_n__n_o_t_e.html#NFC_GPIO_Msg_Handler">3.4 NFC_GPIO_Msg_Handler</a> <div style="page-break-after: always;"></div></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="NFC_Table_List"></a>
Table List</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="NFC_Figure_List"></a>
Figure List</h2>
<ul>
<li><a href="#figure_2_1">Figure 2-1 NFC Function Enable</a></li>
<li><a href="#figure_2_2">Figure 2-2 NFC Pin Configuration</a></li>
<li><a href="#figure_2_3">Figure 2-3 NFC Stable Time Configuration</a> <div style="page-break-after: always;"></div></li>
</ul>
<h2><a class="anchor" id="NFC_Glossary"></a>
Glossary</h2>
<div style="page-break-after: always;"></div><h2><a class="anchor" id="NFC_Introduction"></a>
1 Introduction</h2>
<p>This NFC application note contains the following information:</p><ul>
<li>how to configure NFC function on McuConfig Tool.</li>
<li>how to use NFC api. <div style="page-break-after: always;"></div></li>
</ul>
<h2><a class="anchor" id="NFC_Configuration"></a>
2 NFC_Configuration</h2>
<p>First, User can enable NFC function on McuConfig Tool HW Feature &ndash;&gt; IO as <a href="#figure_2_1">Figure 2-1</a>: </p><div class="image">
<img src="NFC_function.png" alt="NFC_function.png"/>
</div>
 <center><div id="figure_2_1"><b>Figure 2-1 NFC Function Enable</b></div></center><p>After enable NFC function, user should configure nfc io pin on McuConfig Tool HW Feature &ndash;&gt; Pinmux as <a href="#figure_2_2">Figure 2-2</a>: </p><div class="image">
<img src="NFC_pin.png" alt="NFC_pin.png"/>
</div>
 <center><div id="figure_2_2"><b>Figure 2-2 NFC Pin Configuration</b></div></center><p>Last, user can set stable time and enable NFC multiple link switch on McuConfig Tool HW Feature &ndash;&gt; Pinmux as <a href="#figure_2_3">Figure 2-3</a>: </p><div class="image">
<img src="NFC_enable.png" alt="NFC_enable.png"/>
</div>
 <center><div id="figure_2_3"><b>Figure 2-3 NFC Stable Time Configuration</b></div></center> <div style="page-break-after: always;"></div><h2><a class="anchor" id="NFC_Usage"></a>
3 NFC API Usage</h2>
<p>The purpose of this chapter is to give an overview of NFC api. The source code is in sdk\src\sample\rws\app_nfc.c.</p>
<h3><a class="anchor" id="NFC_Initialization"></a>
3.1 Initialization</h3>
<p>User can use the following api to Initialize when system does initialization. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___functions.html#gac9f3259ac0f1acb7431220b8ba48fa1d">app_nfc_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/*gpio init*/</span></div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga3826ae3324dab5d23192d2101f2cab3b">hal_gpio_init_pin</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#gga18690463b43fb88963baf1098b54f075ad6bf32430a2b7af6721521d3e247f978">GPIO_TYPE_CORE</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#gga83e087b95bdbbc7626f48a407120b429a3f9cca83af864e65a125bb363f5cc1a6">GPIO_DIR_INPUT</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#ggac9b234191aefcbffa9f5cbfcb67ba911a93970a9b4ab92816371682f4e537a8e2">GPIO_PULL_DOWN</a>);</div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga33877bb6f864bf13365d530ea498f829">hal_gpio_set_up_irq</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#ggaf9fd97f2ddde04dd3ae2a54dbc0f27f7a2636d7c0a40a6aa62fdeab06e5343914">GPIO_IRQ_EDGE</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#gga73aa619532bdbf9d2b620ec419641690ad67ef08eb10e464490335f1267f5d61b">GPIO_IRQ_ACTIVE_LOW</a>, <span class="keyword">true</span>);</div><div class="line">    <a class="code" href="group__x3d___g_p_i_o___i_n_t___h__.html#ga986785a267647c840ad807c08dffa9c9">hal_gpio_register_isr_callback</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>, app_nfc_intr_cb, 0);</div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gaae922b7d64d09b96637d21715a386260">hal_gpio_irq_enable</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>);</div><div class="line">    <span class="comment">/*register gpio nfc timer callback queue,device manager callback*/</span></div><div class="line">    <a class="code" href="group___a_p_p___t_i_m_e_r.html#ga5d2a3ae9710b2036a2907647a1932f0f">app_timer_reg_cb</a>(app_nfc_timeout_cb, &amp;app_nfc_timer_id);</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="NFC_Multi_Link_Trigger"></a>
3.2 NFC_Multi_Link_Trigger</h3>
<p>APP will use this following API to switch headset-phone bluetooth link from one phone to another. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___functions.html#ga7ff73f71bfb3321880291bce1a1ca212">app_nfc_multi_link_switch_trigger</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___types.html#ga115d643dd3cc966d1985ed3da6664a6e">nfc_data</a>.<a class="code" href="struct_t___n_f_c___d_a_t_a.html#a39231b88564250d302fe61d15ecbd81a">nfc_multi_link_switch</a> |= (<a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___macros.html#ga5b4f1ad4eaf0f1ed0cabc4518d2371e1">NFC_MULTI_LINK_SWITCH_A2DP</a> | <a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___macros.html#ga0f068a4cab8cc73d9a027d4c12d8478d">NFC_MULTI_LINK_SWITCH_HF</a>);</div><div class="line">    <a class="code" href="group___a_p_p___t_i_m_e_r.html#ga7e0ebc306e15dabba884fda9e981df9a">app_start_timer</a>(&amp;timer_idx_nfc_multi_link_switch, <span class="stringliteral">&quot;nfc_multi_link_switch&quot;</span>,</div><div class="line">                    app_nfc_timer_id, APP_TIMER_NFC_MULTI_LINK_SWITCH, 0, <span class="keyword">false</span>,</div><div class="line">                    NFC_TRIGGER_TIMER_UNIT_MS);</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="NFC_Interrput_Handler"></a>
3.3 NFC_Interrput_Handler</h3>
<p>APP will use this following API to handle NFC GPIO interrupt. </p><div class="fragment"><div class="line"><a class="code" href="group___s_e_c_t_i_o_n___exported___macros.html#gaf901ecfe15c401262a5dfd752a0b0287">ISR_TEXT_SECTION</a></div><div class="line"><span class="keywordtype">void</span> app_nfc_intr_cb(uint32_t param)</div><div class="line">{</div><div class="line">    uint8_t gpio_status;</div><div class="line">    <a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> gpio_msg;</div><div class="line"></div><div class="line">    <span class="comment">/* Control of entering DLPS */</span></div><div class="line">    <a class="code" href="group___a_p_p___d_l_p_s___exported___functions.html#ga4d38badd8336c312862e039f616933b0">app_dlps_disable</a>(<a class="code" href="group___a_p_p___d_l_p_s___exported___macros.html#ga9736593545da647d1fefb751f23eb9ec">APP_DLPS_ENTER_CHECK_GPIO</a>);</div><div class="line">    gpio_status = <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga72f8dccebef04fca81c21d69ede70381">hal_gpio_get_input_level</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>);</div><div class="line"></div><div class="line">    <span class="comment">/* Disable GPIO interrupt */</span></div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#ga915514c710f982852b566f59aa264692">hal_gpio_irq_disable</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>);</div><div class="line">    <span class="comment">/* Change GPIO Interrupt Polarity */</span></div><div class="line">    <span class="keywordflow">if</span> (gpio_status) <span class="comment">//GPIO detected and Polarity low</span></div><div class="line">    {</div><div class="line">        <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gabfa5fe624354a71be9842bbdaaeb868f">hal_gpio_irq_change_polarity</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#gga73aa619532bdbf9d2b620ec419641690ad67ef08eb10e464490335f1267f5d61b">GPIO_IRQ_ACTIVE_LOW</a>);</div><div class="line">        gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a> = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="comment">//GPIO released and Polarity High</span></div><div class="line">    {</div><div class="line">        <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gabfa5fe624354a71be9842bbdaaeb868f">hal_gpio_irq_change_polarity</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>, <a class="code" href="group__x3e___h_a_l___g_p_i_o___h__.html#gga73aa619532bdbf9d2b620ec419641690a3e3edb0a796ad9411de885e2a7e8f45b">GPIO_IRQ_ACTIVE_HIGH</a>);</div><div class="line">        gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a> = 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#acb5cfd209ba75c853d03f701e7f91679">type</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#gga468a59751cf5bb96e120b43fea01e074af11ba4096588dc277d9bd604f1007024">IO_MSG_TYPE_GPIO</a>;</div><div class="line">    gpio_msg.<a class="code" href="struct_t___i_o___m_s_g.html#ac5d9ab8403fb9ca24facc32b821dd53b">subtype</a> = <a class="code" href="group___a_p_p___m_s_g___exported___types.html#ggac53061b3924b56c44eacd7e43a711f10a58ef2275f099fa4a75ffe43d37ddb7f7">IO_MSG_GPIO_NFC</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group___a_p_p___i_o___m_s_g.html#ga88a966ae202533d382e23ae22b27b819">app_io_msg_send</a>(&amp;gpio_msg);</div><div class="line"></div><div class="line">    <span class="comment">/* Enable GPIO interrupt */</span></div><div class="line">    <a class="code" href="group__x3d___h_a_l___g_p_i_o___h__.html#gaae922b7d64d09b96637d21715a386260">hal_gpio_irq_enable</a>(<a class="code" href="group___a_p_p___c_f_g___exported___types.html#gae5da1e58b53e3ae552aafa6d26ade7a2">app_cfg_const</a>.<a class="code" href="struct_t___a_p_p___c_f_g___c_o_n_s_t.html#ae5bf31261beed813ff162ec8923b011d">nfc_pinmux</a>);</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="NFC_GPIO_Msg_Handler"></a>
3.4 NFC_GPIO_Msg_Handler</h3>
<p>APP will use this following API to hanlde NFC GPIO mmi msg. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___functions.html#ga13d7cee7aedcc450a8d9415839b00050">app_nfc_handle_msg</a>(<a class="code" href="struct_t___i_o___m_s_g.html">T_IO_MSG</a> *io_driver_msg_recv)</div><div class="line">{</div><div class="line">    <a class="code" href="group___n_f_c___p_r_o_c_e_s_s___exported___types.html#ga115d643dd3cc966d1985ed3da6664a6e">nfc_data</a>.<a class="code" href="struct_t___n_f_c___d_a_t_a.html#a3431c16a07b1991bc8a3b2d8b1b598be">nfc_detected</a> = io_driver_msg_recv-&gt;<a class="code" href="struct_t___i_o___m_s_g.html#ac3cb856d7e1befacacda7d89dbaabd13">u</a>.<a class="code" href="struct_t___i_o___m_s_g.html#aba18f3d521fde3af39c58b809a9c7ef0">param</a>;</div><div class="line">    <a class="code" href="group___a_p_p___t_i_m_e_r.html#ga7e0ebc306e15dabba884fda9e981df9a">app_start_timer</a>(&amp;timer_idx_nfc_stable, <span class="stringliteral">&quot;nfc_stable&quot;</span>,</div><div class="line">                    app_nfc_timer_id, APP_TIMER_NFC_STABLE, 0, <span class="keyword">true</span>,</div><div class="line">                    NFC_STABLE_TIMER_UNIT_MS);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->

<HR SIZE=5>
<font size="3" color="black">Copyright(c) 2020, <a href=" http://www.realtek.com.tw/"><font size="3" color="#6FB7B7"><b>Realtek Semiconductor Corporation</b></font></a>. All rights reserved.</font> 
